import{ar as e,D as l,aq as a,r as t,U as i,K as s,J as n,L as o,N as u,as as c,c as r,A as d,b as v,a as m,j as p,y as f,w as y,u as b,o as g,h,g as x,f as C,t as k,F as w,d as _,at as I,G as S,C as $,V}from"./index-DSwq2M__.js";import{u as j}from"./useIntegramSession-XyreUhfh.js";import{i as T}from"./integramApiClient-BsYdo77J.js";import{I as U}from"./IntegramBreadcrumb-YrezANl5.js";import{_ as L}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./index-CcrxTH1M.js";import"./unifiedAuthService-6fZILgG8.js";"undefined"!=typeof WorkerGlobalScope&&(globalThis,WorkerGlobalScope);const P=()=>{};function D(l,a=200,t={}){return function(e,l){return function(...a){return new Promise((t,i)=>{Promise.resolve(e(()=>l.apply(this,a),{fn:l,thisArg:this,args:a})).then(t).catch(i)})}}(function(l,a={}){let t,i,s=P;const n=e=>{clearTimeout(e),s(),s=P};let o;return u=>{const c=e(l),r=e(a.maxWait);return t&&n(t),c<=0||void 0!==r&&r<=0?(i&&(n(i),i=void 0),Promise.resolve(u())):new Promise((e,l)=>{s=a.rejectOnCancel?l:e,o=u,r&&!i&&(i=setTimeout(()=>{t&&n(t),i=void 0,e(o())},r)),t=setTimeout(()=>{i&&n(i),i=void 0,e(u())},c)})}}(a,t),l)}const z={class:"integram-table-list"},O={key:0,class:"metadata-loading-notification mb-3"},M={class:"flex align-items-center justify-content-between"},A={class:"flex align-items-center gap-2"},B={class:"flex align-items-center justify-content-between"},W={class:"flex align-items-center gap-2"},q={class:"flex gap-2 align-items-center ml-auto"},R={class:"toolbar-section mb-3"},E={class:"flex align-items-center justify-content-between flex-wrap gap-3"},J={class:"flex align-items-center gap-2 flex-wrap"},N={class:"flex align-items-center gap-2"},K={key:0,class:"flex justify-content-center py-5"},G={key:1,class:"text-center py-5"},F={key:2},Q={key:0,class:"flex justify-content-center align-items-center py-5"},H={key:1},X={key:0,class:"flex align-items-center justify-content-between mb-3"},Y={class:"text-sm text-500"},Z={key:1,class:"grid"},ee={class:"card-header-actions"},le={class:"table-name"},ae={class:"text-500 text-sm"},te={key:0},ie={key:0,class:"table-stats"},se={key:0,class:"stat-item"},ne={key:1,class:"stat-item"},oe={key:1,class:"text-400 text-sm"},ue={key:2,class:"mt-2"},ce={class:"text-xs text-500 mt-1"},re={class:"flex gap-2"},de={class:"flex align-items-center gap-2"},ve={class:"font-semibold"},me={class:"text-sm"},pe={key:0},fe={key:1,class:"pi pi-spin pi-spinner text-sm"},ye={key:0},be={class:"flex gap-1"},ge={key:3,class:"text-center py-5"},he={class:"text-color-secondary text-lg mb-2"},xe={class:"flex justify-content-center gap-2 mt-3"},Ce={class:"p-fluid"},ke={class:"field"},we={class:"field-checkbox"},_e={class:"p-fluid"},Ie={class:"field"},Se={class:"field"},$e={class:"flex align-items-center gap-3"},Ve={class:"mb-2"},je={class:"p-fluid"},Te={class:"field"},Ue={class:"flex align-items-center p-3 border-round surface-50"},Le={class:"flex justify-content-end",style:{"min-width":"6rem"}},Pe={class:"field"},De={class:"flex align-items-center p-3 border-round surface-50"},ze={class:"flex justify-content-end",style:{"min-width":"6rem"}},Oe={class:"field"},Me={class:"flex align-items-center p-3 border-round surface-50"},Ae={class:"flex justify-content-end",style:{"min-width":"6rem"}},Be="integram-table-list-view-mode",We="integram-table-favorites",qe="integram-table-metadata-cache",Re="integram-table-metadata-enabled",Ee="integram-table-pagination-enabled",Je="integram-table-smart-search",Ne=L({__name:"IntegramTableList",setup(e){const L=u(),P=o(),Ne=l();a();const{isAuthenticated:Ke}=j(),Ge=t(!1),Fe=t(null),Qe=t([]),He=t(""),Xe=t(""),Ye=t(localStorage.getItem(Be)||"grid"),Ze=t(!1),el=t("all"),ll=t("name-asc"),al=t([]),tl=t(0),il=t(null),sl=t("true"===localStorage.getItem(Re)),nl=t("false"!==localStorage.getItem(Ee)),ol=t("false"!==localStorage.getItem(Je)),ul=t(0),cl=t(20),rl=t(!1),dl=t(0),vl=t(null),ml=t(null),pl=t(),fl=t(!1),yl=t(!1),bl=t(!1),gl=t(!1),hl=t(""),xl=t(!1),Cl=t(!1),kl=t(null),wl=t(""),_l=t(!1),Il=t(null),Sl=t(!1);i(Ye,async e=>{localStorage.setItem(Be,e),Ze.value=!0,await new Promise(e=>setTimeout(e,0)),Ze.value=!1}),i(sl,e=>{localStorage.setItem(Re,String(e)),e&&Qe.value.length>0?Xl():e||Yl()}),i(nl,e=>{localStorage.setItem(Ee,String(e)),ul.value=0}),i(ol,e=>{localStorage.setItem(Je,String(e))}),i(sl,e=>{e||["records-desc","records-asc","columns-desc","columns-asc"].includes(ll.value)&&(ll.value="name-asc")}),s(()=>{const e=localStorage.getItem(We);if(e)try{al.value=JSON.parse(e)}catch(l){}}),i(al,e=>{localStorage.setItem(We,JSON.stringify(e))},{deep:!0});const $l=D(e=>{Xe.value=e},150);i(He,e=>{$l(e)}),i(Xe,()=>{tl.value=0,Ul.size>1e3&&Ul.clear()}),i([el,ll],()=>{tl.value=0});const Vl=[{value:"grid",icon:"pi pi-th-large",label:"Сетка"},{value:"list",icon:"pi pi-list",label:"Список"}],jl=n(()=>{const e=[{value:"name-asc",label:"Название (А-Я)"},{value:"name-desc",label:"Название (Я-А)"}];return sl.value?[...e,{value:"records-desc",label:"Больше записей"},{value:"records-asc",label:"Меньше записей"},{value:"columns-desc",label:"Больше колонок"},{value:"columns-asc",label:"Меньше колонок"}]:e}),Tl=n(()=>ml.value?[{label:"Просмотр",icon:"pi pi-eye",command:()=>P.push(`/integram/${Pl.value}/table/${ml.value.id}`)},{label:"Редактировать структуру",icon:"pi pi-pencil",command:()=>P.push(`/integram/${Pl.value}/edit_types?typeId=${ml.value.id}`)},{separator:!0},{label:ql(ml.value.id)?"Убрать из избранного":"Добавить в избранное",icon:ql(ml.value.id)?"pi pi-star-fill":"pi pi-star",command:()=>El(ml.value.id)},{separator:!0},{label:"Клонировать структуру",icon:"pi pi-copy",command:()=>{wl.value=`${ml.value.name} (копия)`,yl.value=!0}},{label:"Переименовать",icon:"pi pi-pencil",command:()=>async function(e){const l=prompt(`Введите новое название для таблицы "${e.name}":`,e.name);if(l&&l!==e.name)try{await T.renameTable(e.id,l),Ne.add({severity:"success",summary:"Таблица переименована",detail:`"${e.name}" → "${l}"`,life:3e3}),await Hl()}catch(a){Ne.add({severity:"error",summary:"Ошибка",detail:a.message||"Не удалось переименовать таблицу",life:5e3})}}(ml.value)},{separator:!0},{label:"Удалить",icon:"pi pi-trash",class:"text-red-500",command:()=>{bl.value=!0}}]:[]),Ul=new Map;function Ll(e,l){if(!l)return 0;const a=`${e}:${l}`;if(Ul.has(a))return Ul.get(a);const t=e.toLowerCase(),i=l.toLowerCase();let s=0;if(t===i)s=1e3;else if(t.startsWith(i))s=900;else if(t.startsWith(i+"_")||t.startsWith(i+" "))s=850;else if(new RegExp(`[_\\s]${i}`,"i").test(t))s=700;else if(t.includes(i))s=500;else{let e=0,l=!0;for(let a of i){if(e=t.indexOf(a,e),-1===e){l=!1;break}e++}s=l?300:0}return Ul.set(a,s),s}const Pl=n(()=>T.getDatabase()||""),Dl=n(()=>{let e=Qe.value;if("favorites"===el.value?e=e.filter(e=>ql(e.id)):"empty"===el.value?e=e.filter(e=>0===e.recordCount):"filled"===el.value&&(e=e.filter(e=>e.recordCount>0)),Xe.value){const l=Xe.value.toLowerCase();e=ol.value?e.map(e=>({...e,_relevance:Ll(e.name,Xe.value)})).filter(e=>e._relevance>0).sort((e,l)=>l._relevance-e._relevance):e.filter(e=>e.name.toLowerCase().includes(l)||String(e.id).includes(l))}return e}),zl=n(()=>{const e=[...Dl.value];if(ol.value&&He.value)return e;const[l,a]=ll.value.split("-");return e.sort((e,t)=>{let i,s;return"name"===l?(i=e.name.toLowerCase(),s=t.name.toLowerCase(),"asc"===a?i.localeCompare(s,"ru"):s.localeCompare(i,"ru")):("records"===l?(i=e.recordCount??0,s=t.recordCount??0):"columns"===l&&(i=e.columnCount??0,s=t.columnCount??0),"name"!==l?"asc"===a?i-s:s-i:0)}),e}),Ol=n(()=>{if(!nl.value)return zl.value;const e=ul.value,l=e+cl.value;return zl.value.slice(e,l)}),Ml=n(()=>Math.ceil(Dl.value.length/cl.value)),Al=n(()=>[{label:"Таблицы",icon:"pi pi-table"}]);function Bl(e){return e?e.replace(/&nbsp;/g," ").replace(/\s+/g," ").trim():""}function Wl(e){return e?Bl(e.alias||e.name):""}function ql(e){return al.value.includes(String(e))}function Rl(e){ul.value=e.first,cl.value=e.rows,window.scrollTo({top:0,behavior:"smooth"})}function El(e){const l=String(e),a=al.value.indexOf(l);a>-1?(al.value.splice(a,1),Ne.add({severity:"info",summary:"Убрано из избранного",life:2e3})):(al.value.push(l),Ne.add({severity:"success",summary:"Добавлено в избранное",life:2e3}))}function Jl(){He.value="",el.value="all"}function Nl(e,l){ml.value=l,pl.value.toggle(e)}function Kl(e){P.push(`/integram/${Pl.value}/table/${e.data.id}`)}function Gl(e){P.push(`/integram/${Pl.value}/table/${e}`)}function Fl(e){const l=Ol.value.length-1;if("ArrowDown"===e.key)e.preventDefault(),tl.value=Math.min(tl.value+1,l),Ql();else if("ArrowUp"===e.key)e.preventDefault(),tl.value=Math.max(tl.value-1,0),Ql();else if("Enter"===e.key){e.preventDefault();const l=Ol.value[tl.value];l&&Gl(l.id)}}function Ql(){setTimeout(()=>{const e=document.querySelector(".table-card-active");e&&e.scrollIntoView({behavior:"smooth",block:"nearest"})},0)}async function Hl(){Ge.value=!0,Fe.value=null;try{const e=await T.getDictionary(),l=Object.entries(e).map(([e,l])=>({id:e,name:l,alias:void 0,recordCount:void 0,columnCount:void 0})).sort((e,l)=>e.name.localeCompare(l.name,"ru"));Qe.value=l,Ge.value=!1,function(e){if(!e)return!1;Qe.value.forEach(l=>{e[l.id]&&(l.recordCount=e[l.id].recordCount,l.columnCount=e[l.id].columnCount,l.alias=e[l.id].alias)})}(function(){try{const e=localStorage.getItem(qe);if(!e)return null;const{timestamp:l,data:a}=JSON.parse(e);return Date.now()-l>3e5?(localStorage.removeItem(qe),null):a}catch(e){return null}}()),Xl()}catch(e){Fe.value=e.message||"Не удалось загрузить список таблиц",Ge.value=!1,Ne.add({severity:"error",summary:"Ошибка",detail:Fe.value,life:5e3})}}async function Xl(){if(!sl.value)return;vl.value&&vl.value.abort(),vl.value=new AbortController;const e=vl.value.signal;rl.value=!0,dl.value=0;try{for(let l=0;l<Qe.value.length;l+=10){if(e.aborted)return;const a=Qe.value.slice(l,l+10);await Promise.allSettled(a.map(async l=>{var a;if(!e.aborted)try{const i=await T.getTypeMetadata(l.id);if(e.aborted||(l.columnCount=(null==(a=i.requisites)?void 0:a.length)||0,l.alias=i.alias||void 0),!e.aborted)try{const e=await T.getObjectCount(l.id);l.recordCount=e.count||0}catch(t){l.recordCount=0}dl.value++}catch(t){l.recordCount=0,l.columnCount=0,dl.value++}})),l+10<Qe.value.length&&!e.aborted&&await new Promise(e=>setTimeout(e,200))}e.aborted||function(){try{const e={};Qe.value.forEach(l=>{void 0===l.recordCount&&void 0===l.columnCount&&void 0===l.alias||(e[l.id]={recordCount:l.recordCount,columnCount:l.columnCount,alias:l.alias})});const l={timestamp:Date.now(),data:e};localStorage.setItem(qe,JSON.stringify(l))}catch(e){}}()}finally{rl.value=!1,vl.value=null}}function Yl(){vl.value&&(vl.value.abort(),vl.value=null,rl.value=!1)}async function Zl(){if(hl.value.trim()){Cl.value=!0,kl.value=null;try{const e=await T.createType({name:hl.value.trim(),baseTypeId:1,unique:xl.value});Ne.add({severity:"success",summary:"Таблица создана",detail:`Таблица "${hl.value}" успешно создана`,life:3e3}),await Hl(),fl.value=!1,hl.value="",xl.value=!1,P.push(`/integram/${Pl.value}/edit_types?typeId=${e.id}`)}catch(e){kl.value=e.message||"Не удалось создать таблицу"}finally{Cl.value=!1}}}async function ea(){if(wl.value.trim()&&ml.value){_l.value=!0,Il.value=null;try{const e=await T.cloneTableStructure(ml.value.id,wl.value.trim());Ne.add({severity:"success",summary:"Таблица клонирована",detail:`Структура скопирована в таблицу "${wl.value}"`,life:3e3}),await Hl(),yl.value=!1,wl.value="",ml.value=null,P.push(`/integram/${Pl.value}/table/${e.id}`)}catch(e){Il.value=e.message||"Не удалось клонировать таблицу"}finally{_l.value=!1}}}async function la(){if(ml.value){Sl.value=!0;try{await T.deleteTableCascade(ml.value.id),Ne.add({severity:"success",summary:"Таблица удалена",detail:`Таблица "${ml.value.name}" удалена`,life:3e3});const e=String(ml.value.id),l=al.value.indexOf(e);l>-1&&al.value.splice(l,1),await Hl(),bl.value=!1,ml.value=null}catch(e){Ne.add({severity:"error",summary:"Ошибка",detail:e.message||"Не удалось удалить таблицу",life:5e3})}finally{Sl.value=!1}}}return s(async()=>{Ke.value?await Hl():P.push("/integram/login?redirect="+encodeURIComponent(L.fullPath))}),c(()=>{Yl()}),(e,l)=>{const a=f("Badge"),t=f("Button"),i=f("InputIcon"),s=f("InputText"),n=f("IconField"),o=f("Chip"),u=f("Dropdown"),c=f("SelectButton"),j=f("ProgressSpinner"),T=f("Message"),L=f("Paginator"),D=f("ProgressBar"),Be=f("Card"),We=f("Column"),qe=f("DataTable"),Re=f("Menu"),Ee=f("Checkbox"),Je=f("Dialog"),Ne=f("ToggleButton"),Ke=b("tooltip");return g(),r("div",z,[d(U,{items:Al.value},null,8,["items"]),rl.value&&sl.value?(g(),r("div",O,[m("div",M,[m("div",A,[l[27]||(l[27]=m("i",{class:"pi pi-spin pi-spinner text-primary"},null,-1)),l[28]||(l[28]=m("span",{class:"font-medium"},"Загрузка метаданных...",-1)),d(a,{value:`${dl.value} / ${Qe.value.length}`,severity:"secondary"},null,8,["value"])]),p(d(t,{icon:"pi pi-times",size:"small",text:"",rounded:"",severity:"secondary",onClick:Yl},null,512),[[Ke,"Остановить загрузку",void 0,{top:!0}]])])])):v("",!0),d(Be,null,{title:y(()=>[m("div",B,[m("div",W,[l[29]||(l[29]=m("span",null,"Таблицы",-1)),Qe.value.length?(g(),h(a,{key:0,value:Qe.value.length,severity:"secondary"},null,8,["value"])):v("",!0)]),m("div",q,[p(d(t,{icon:"pi pi-plus",label:"Создать",size:"small",onClick:l[0]||(l[0]=e=>fl.value=!0)},null,512),[[Ke,"Создать новую таблицу",void 0,{bottom:!0}]]),p(d(t,{icon:"pi pi-cog",size:"small",outlined:"",onClick:l[1]||(l[1]=e=>gl.value=!0)},null,512),[[Ke,"Настройки отображения",void 0,{bottom:!0}]]),p(d(t,{icon:"pi pi-refresh",size:"small",outlined:"",onClick:Hl,loading:Ge.value},null,8,["loading"]),[[Ke,"Обновить",void 0,{bottom:!0}]])])])]),subtitle:y(()=>[...l[30]||(l[30]=[])]),content:y(()=>[m("div",R,[m("div",E,[d(n,{iconPosition:"left",class:"flex-grow-1",style:{"max-width":"400px"}},{default:y(()=>[d(i,{class:"pi pi-search"}),d(s,{ref_key:"searchInput",ref:il,modelValue:He.value,"onUpdate:modelValue":l[2]||(l[2]=e=>He.value=e),placeholder:"Поиск по названию, ID, колонкам...",class:"w-full",onKeydown:Fl},null,8,["modelValue"])]),_:1}),m("div",J,[m("div",N,[d(o,{class:x([{"chip-active":"all"===el.value},"cursor-pointer"]),label:"Все",onClick:l[3]||(l[3]=e=>el.value="all")},null,8,["class"]),d(o,{class:x([{"chip-active":"favorites"===el.value},"cursor-pointer"]),onClick:l[4]||(l[4]=e=>el.value="favorites")},{default:y(()=>[...l[31]||(l[31]=[m("i",{class:"pi pi-star-fill mr-1"},null,-1),C(" Избранные ",-1)])]),_:1},8,["class"]),sl.value?(g(),h(o,{key:0,class:x([{"chip-active":"empty"===el.value},"cursor-pointer"]),onClick:l[5]||(l[5]=e=>el.value="empty")},{default:y(()=>[...l[32]||(l[32]=[m("i",{class:"pi pi-inbox mr-1"},null,-1),C(" Пустые ",-1)])]),_:1},8,["class"])):v("",!0),sl.value?(g(),h(o,{key:1,class:x([{"chip-active":"filled"===el.value},"cursor-pointer"]),onClick:l[6]||(l[6]=e=>el.value="filled")},{default:y(()=>[...l[33]||(l[33]=[m("i",{class:"pi pi-check-circle mr-1"},null,-1),C(" С данными ",-1)])]),_:1},8,["class"])):v("",!0)]),d(u,{modelValue:ll.value,"onUpdate:modelValue":l[7]||(l[7]=e=>ll.value=e),options:jl.value,optionLabel:"label",optionValue:"value",placeholder:"Сортировка",class:"w-10rem"},null,8,["modelValue","options"]),d(c,{modelValue:Ye.value,"onUpdate:modelValue":l[8]||(l[8]=e=>Ye.value=e),options:Vl,optionLabel:"icon",optionValue:"value",allowEmpty:!1},{option:y(({option:e})=>[p(m("i",{class:x(e.icon)},null,2),[[Ke,e.label,void 0,{top:!0}]])]),_:1},8,["modelValue"])])])]),Ge.value?(g(),r("div",K,[d(j)])):Fe.value?(g(),r("div",G,[d(T,{severity:"error",closable:!1},{default:y(()=>[C(k(Fe.value),1)]),_:1})])):(g(),r("div",F,[Ze.value?(g(),r("div",Q,[d(j,{style:{width:"50px",height:"50px"},strokeWidth:"4"}),l[34]||(l[34]=m("span",{class:"ml-3 text-500"},"Переключение режима...",-1))])):(g(),r("div",H,[nl.value?(g(),r("div",X,[m("div",Y," Показано "+k(Ol.value.length)+" из "+k(Dl.value.length)+" таблиц ",1),Ml.value>1?(g(),h(L,{key:0,first:ul.value,"onUpdate:first":l[9]||(l[9]=e=>ul.value=e),rows:cl.value,totalRecords:Dl.value.length,rowsPerPageOptions:[20,50,100],onPage:Rl},null,8,["first","rows","totalRecords"])):v("",!0)])):v("",!0),"grid"===Ye.value?(g(),r("div",Z,[(g(!0),r(w,null,_(Ol.value,(e,i,s,n)=>{const o=[e.id,e.recordCount,e.columnCount,tl.value===i,ql(e.id)];if(n&&n.key===e.id&&I(n,o))return n;const u=(g(),r("div",{key:e.id,class:"col-12 sm:col-6 md:col-4 lg:col-3"},[d(Be,{class:x(["table-card h-full cursor-pointer",{"table-card-active":Xe.value&&tl.value===i}]),onClick:l=>Gl(e.id)},{header:y(()=>[m("div",ee,[p(d(t,{icon:ql(e.id)?"pi pi-star-fill":"pi pi-star",class:x({"favorite-active":ql(e.id)}),text:"",rounded:"",size:"small",onClick:S(l=>El(e.id),["stop"])},null,8,["icon","class","onClick"]),[[Ke,ql(e.id)?"Убрать из избранного":"Добавить в избранное",void 0,{top:!0}]]),d(t,{icon:"pi pi-ellipsis-v",text:"",rounded:"",size:"small",onClick:S(l=>Nl(l,e),["stop"])},null,8,["onClick"])])]),title:y(()=>[m("span",le,k(Wl(e)),1)]),subtitle:y(()=>[m("div",ae,[e.alias?(g(),r("span",te,k(Bl(e.name))+" · ",1)):v("",!0),C("ID: "+k(e.id),1)])]),content:y(()=>[sl.value?(g(),r("div",ie,[void 0!==e.recordCount?(g(),r("div",se,[l[35]||(l[35]=m("i",{class:"pi pi-database text-400"},null,-1)),m("span",null,k(e.recordCount)+" зап.",1)])):v("",!0),void 0!==e.columnCount?(g(),r("div",ne,[l[36]||(l[36]=m("i",{class:"pi pi-bars text-400"},null,-1)),m("span",null,k(e.columnCount)+" кол.",1)])):v("",!0),void 0!==e.recordCount?(g(),h(a,{key:2,severity:e.recordCount>0?"success":"secondary",value:e.recordCount>0?"Заполнена":"Пустая",class:"mt-2"},null,8,["severity","value"])):v("",!0)])):(g(),r("div",oe," Включите метаданные для просмотра статистики ")),e.recordCount>1e3?(g(),r("div",ue,[d(D,{value:Math.min(e.recordCount/1e4*100,100),showValue:!1,style:{height:"4px"}},null,8,["value"]),m("div",ce,k(e.recordCount>1e4?"Большая таблица":"Средняя таблица"),1)])):v("",!0)]),footer:y(()=>[m("div",re,[d(t,{icon:"pi pi-eye",label:"Просмотр",size:"small",outlined:"",onClick:S(l=>$(P).push(`/integram/${Pl.value}/table/${e.id}`),["stop"]),class:"flex-1"},null,8,["onClick"]),d(t,{icon:"pi pi-pencil",label:"Структура",size:"small",outlined:"",onClick:S(l=>$(P).push(`/integram/${Pl.value}/edit_types?typeId=${e.id}`),["stop"]),class:"flex-1"},null,8,["onClick"])])]),_:2},1032,["class","onClick"])]));return u.memo=o,u},l,10),128))])):(g(),h(qe,{key:2,value:Ol.value,stripedRows:"",class:"p-datatable-sm",onRowClick:Kl},{default:y(()=>[d(We,{style:{width:"3rem"}},{body:y(({data:e})=>[d(t,{icon:ql(e.id)?"pi pi-star-fill":"pi pi-star",class:x({"favorite-active":ql(e.id)}),text:"",rounded:"",size:"small",onClick:S(l=>El(e.id),["stop"])},null,8,["icon","class","onClick"])]),_:1}),d(We,{field:"name",header:"Название",sortable:""},{body:y(({data:e})=>[m("div",de,[l[37]||(l[37]=m("i",{class:"pi pi-table text-primary"},null,-1)),m("span",ve,k(Wl(e)),1)])]),_:1}),d(We,{field:"id",header:"ID",sortable:"",style:{width:"8rem"}},{body:y(({data:e})=>[m("code",me,k(e.id),1)]),_:1}),sl.value?(g(),h(We,{key:0,field:"recordCount",header:"Записи",sortable:"",style:{width:"10rem"}},{body:y(({data:e})=>[void 0!==e.recordCount?(g(),r("span",pe,k(e.recordCount),1)):(g(),r("i",fe))]),_:1})):v("",!0),sl.value?(g(),h(We,{key:1,field:"columnCount",header:"Колонки",sortable:"",style:{width:"8rem"}},{body:y(({data:e})=>[void 0!==e.columnCount?(g(),r("span",ye,k(e.columnCount),1)):v("",!0)]),_:1})):v("",!0),sl.value?(g(),h(We,{key:2,header:"Статус",style:{width:"10rem"}},{body:y(({data:e})=>[void 0!==e.recordCount?(g(),h(a,{key:0,severity:e.recordCount>0?"success":"secondary",value:e.recordCount>0?"Заполнена":"Пустая"},null,8,["severity","value"])):v("",!0)]),_:1})):v("",!0),d(We,{style:{width:"10rem"}},{body:y(({data:e})=>[m("div",be,[p(d(t,{icon:"pi pi-eye",size:"small",text:"",rounded:"",onClick:S(l=>$(P).push(`/integram/${Pl.value}/table/${e.id}`),["stop"])},null,8,["onClick"]),[[Ke,"Просмотр",void 0,{top:!0}]]),p(d(t,{icon:"pi pi-pencil",size:"small",text:"",rounded:"",onClick:S(l=>$(P).push(`/integram/${Pl.value}/edit_types?typeId=${e.id}`),["stop"])},null,8,["onClick"]),[[Ke,"Структура",void 0,{top:!0}]]),d(t,{icon:"pi pi-ellipsis-v",size:"small",text:"",rounded:"",onClick:S(l=>Nl(l,e),["stop"])},null,8,["onClick"])])]),_:1})]),_:1},8,["value"])),0===zl.value.length?(g(),r("div",ge,[l[38]||(l[38]=m("i",{class:"pi pi-inbox text-5xl text-color-secondary mb-3"},null,-1)),m("p",he,k("favorites"===el.value?"Нет избранных таблиц":"empty"===el.value?"Нет пустых таблиц":"filled"===el.value?"Нет таблиц с данными":He.value?`Таблицы не найдены по запросу "${He.value}"`:"Нет таблиц"),1),m("div",xe,[He.value||"all"!==el.value?(g(),h(t,{key:0,label:"Сбросить фильтры",icon:"pi pi-times",severity:"secondary",text:"",onClick:Jl})):v("",!0),d(t,{label:"Обновить",icon:"pi pi-refresh",severity:"secondary",outlined:"",loading:Ge.value,onClick:Hl},null,8,["loading"]),d(t,{label:"Создать таблицу",icon:"pi pi-plus",severity:"success",onClick:l[12]||(l[12]=e=>fl.value=!0)})])])):v("",!0)]))]))]),_:1}),d(Re,{ref_key:"tableMenu",ref:pl,model:Tl.value,popup:""},null,8,["model"]),d(Je,{visible:fl.value,"onUpdate:visible":l[16]||(l[16]=e=>fl.value=e),header:"Создать новую таблицу",modal:!0,style:{width:"500px"}},{footer:y(()=>[d(t,{label:"Отмена",icon:"pi pi-times",onClick:l[15]||(l[15]=e=>fl.value=!1),text:""}),d(t,{label:"Создать",icon:"pi pi-check",onClick:Zl,loading:Cl.value,disabled:!hl.value.trim()},null,8,["loading","disabled"])]),default:y(()=>[m("div",Ce,[m("div",ke,[l[39]||(l[39]=m("label",{for:"table-name"},"Название таблицы *",-1)),d(s,{id:"table-name",modelValue:hl.value,"onUpdate:modelValue":l[13]||(l[13]=e=>hl.value=e),placeholder:"Например: Клиенты, Заказы, Продукты...",onKeyup:V(Zl,["enter"])},null,8,["modelValue"])]),m("div",we,[d(Ee,{id:"table-unique",modelValue:xl.value,"onUpdate:modelValue":l[14]||(l[14]=e=>xl.value=e),binary:!0},null,8,["modelValue"]),l[40]||(l[40]=m("label",{for:"table-unique"},"Первая колонка уникальная",-1))]),kl.value?(g(),h(T,{key:0,severity:"error",closable:!1},{default:y(()=>[C(k(kl.value),1)]),_:1})):v("",!0)])]),_:1},8,["visible"]),d(Je,{visible:yl.value,"onUpdate:visible":l[19]||(l[19]=e=>yl.value=e),header:"Клонировать таблицу",modal:!0,style:{width:"500px"}},{footer:y(()=>[d(t,{label:"Отмена",icon:"pi pi-times",onClick:l[18]||(l[18]=e=>yl.value=!1),text:""}),d(t,{label:"Клонировать",icon:"pi pi-copy",onClick:ea,loading:_l.value,disabled:!wl.value.trim()},null,8,["loading","disabled"])]),default:y(()=>{var e;return[m("div",_e,[m("div",Ie,[l[41]||(l[41]=m("label",null,"Исходная таблица",-1)),d(s,{value:null==(e=ml.value)?void 0:e.name,disabled:""},null,8,["value"])]),m("div",Se,[l[42]||(l[42]=m("label",{for:"clone-name"},"Название новой таблицы *",-1)),d(s,{id:"clone-name",modelValue:wl.value,"onUpdate:modelValue":l[17]||(l[17]=e=>wl.value=e),placeholder:"Название...",onKeyup:V(ea,["enter"])},null,8,["modelValue"])]),Il.value?(g(),h(T,{key:0,severity:"error",closable:!1},{default:y(()=>[C(k(Il.value),1)]),_:1})):v("",!0)])]}),_:1},8,["visible"]),d(Je,{visible:bl.value,"onUpdate:visible":l[21]||(l[21]=e=>bl.value=e),header:"Удалить таблицу?",modal:!0,style:{width:"450px"}},{footer:y(()=>[d(t,{label:"Отмена",icon:"pi pi-times",onClick:l[20]||(l[20]=e=>bl.value=!1),text:""}),d(t,{label:"Удалить",icon:"pi pi-trash",severity:"danger",onClick:la,loading:Sl.value},null,8,["loading"])]),default:y(()=>{var e;return[m("div",$e,[l[46]||(l[46]=m("i",{class:"pi pi-exclamation-triangle text-5xl text-orange-500"},null,-1)),m("div",null,[m("p",Ve,[l[43]||(l[43]=C(" Вы действительно хотите удалить таблицу ",-1)),m("strong",null,k(null==(e=ml.value)?void 0:e.name),1),l[44]||(l[44]=C("? ",-1))]),l[45]||(l[45]=m("p",{class:"text-sm text-500"}," Все данные в таблице будут безвозвратно удалены. ",-1))])])]}),_:1},8,["visible"]),d(Je,{visible:gl.value,"onUpdate:visible":l[26]||(l[26]=e=>gl.value=e),header:"Настройки отображения",modal:!0,style:{width:"500px"}},{footer:y(()=>[d(t,{label:"Закрыть",icon:"pi pi-times",onClick:l[25]||(l[25]=e=>gl.value=!1),autofocus:""})]),default:y(()=>[m("div",je,[m("div",Te,[l[48]||(l[48]=m("label",{class:"font-semibold mb-2 block"},"Загрузка данных",-1)),m("div",Ue,[l[47]||(l[47]=m("div",{class:"flex align-items-center gap-2 flex-1"},[m("i",{class:"pi pi-info-circle text-primary"}),m("div",null,[m("div",{class:"font-medium"},"Метаданные таблиц"),m("div",{class:"text-sm text-500"}," Загружать количество записей и колонок ")])],-1)),m("div",Le,[d(Ne,{modelValue:sl.value,"onUpdate:modelValue":l[22]||(l[22]=e=>sl.value=e),onLabel:"Вкл",offLabel:"Выкл",onIcon:"pi pi-check",offIcon:"pi pi-times",class:"w-6rem"},null,8,["modelValue"])])])]),m("div",Pe,[l[50]||(l[50]=m("label",{class:"font-semibold mb-2 block"},"Навигация",-1)),m("div",De,[l[49]||(l[49]=m("div",{class:"flex align-items-center gap-2 flex-1"},[m("i",{class:"pi pi-list text-primary"}),m("div",null,[m("div",{class:"font-medium"},"Пагинация"),m("div",{class:"text-sm text-500"}," Постраничная навигация по таблицам ")])],-1)),m("div",ze,[d(Ne,{modelValue:nl.value,"onUpdate:modelValue":l[23]||(l[23]=e=>nl.value=e),onLabel:"Вкл",offLabel:"Выкл",onIcon:"pi pi-check",offIcon:"pi pi-times",class:"w-6rem"},null,8,["modelValue"])])])]),m("div",Oe,[l[52]||(l[52]=m("label",{class:"font-semibold mb-2 block"},"Поиск",-1)),m("div",Me,[l[51]||(l[51]=m("div",{class:"flex align-items-center gap-2 flex-1"},[m("i",{class:"pi pi-sort-amount-down text-primary"}),m("div",null,[m("div",{class:"font-medium"},"Умный поиск"),m("div",{class:"text-sm text-500"}," Ранжирование по релевантности ")])],-1)),m("div",Ae,[d(Ne,{modelValue:ol.value,"onUpdate:modelValue":l[24]||(l[24]=e=>ol.value=e),onLabel:"Вкл",offLabel:"Выкл",onIcon:"pi pi-check",offIcon:"pi pi-times",class:"w-6rem"},null,8,["modelValue"])])])])])]),_:1},8,["visible"])])}}},[["__scopeId","data-v-9981b16c"]]);export{Ne as default};
