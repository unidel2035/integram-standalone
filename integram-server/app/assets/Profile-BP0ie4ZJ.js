import{_ as E,y as v,c as S,o as p,b as O,i as j,A as _,n as T,d,h as b,w as F,a as t,t as m,F as X,r as J,g as K,L as A,I as x,aX as W}from"./index-BrdfL8RF.js";import{r as q}from"./authStore-VcBwMo7V.js";import"./index-B9ygI19o.js";import"./unifiedAuthService-xCuNj-Bd.js";const G={name:"ComponentLoader",setup(){const n=d(!1),r=Symbol();return q(()=>n.value=!0,()=>n.value=!1,r),{isLoading:n}}},Q={class:"component-loader-wrapper"},Y={key:0,class:"component-loader-overlay"};function Z(n,r,u,e,f,a){const l=v("ProgressSpinner");return p(),S("div",Q,[e.isLoading?(p(),S("div",Y,[_(l,{style:T([{width:"50px",height:"50px"},{color:"var(--primary-color)"}]),strokeWidth:"4",animationDuration:".5s"})])):O("",!0),j(n.$slots,"default",{},void 0,!0)])}const V=E(G,[["render",Z],["__scopeId","data-v-b3555a42"],["__file","/home/hive/integram-standalone/src/components/ComponentLoader.vue"]]),ee={__name:"Profile",setup(n,{expose:r}){const u=A(),e=d(),f=d(!1),a=d({name:"",role:"",userId:null}),l=d({}),y=d(""),g=x(()=>localStorage.getItem("apiBase")||"не указан"),I=x(()=>localStorage.getItem("db")||"не указана"),c={Пользователь:"pi pi-user",Имя:"pi pi-user",Email:"pi pi-envelope",Телефон:"pi pi-phone",Роль:"pi pi-briefcase",Дата:"pi pi-calendar",Примечание:"pi pi-file",Фото:"pi pi-image",Activity:"pi pi-clock",Secret:"pi pi-eye-slash",Password:"pi pi-lock",Token:"pi pi-key",xsrf:"pi pi-shield",Организация:"pi pi-building",Токен:"pi pi-wallet",Репутация:"pi pi-star",Telegram:"pi pi-send","Шаблон задач":"pi pi-list","Задача игрока":"pi pi-check-circle","Субъект РФ":"pi pi-map",Должность:"pi pi-id-card","API Base":"pi pi-server"},U=o=>c[o]||"pi pi-info-circle",z=(o,s)=>s?o==="Дата"||o==="Activity"?w(s):s:"",w=o=>{try{if(o.toString().length===10)return new Date(o*1e3).toLocaleDateString("ru-RU");if(o.toString().length===13)return new Date(o).toLocaleDateString("ru-RU");if(o.toString().length===8){const s=o.toString(),h=s.substring(0,4),L=s.substring(4,6),C=s.substring(6,8);return new Date(`${h}-${L}-${C}`).toLocaleDateString("ru-RU")}return o}catch(s){return console.error("Ошибка форматирования даты:",s),o}},P=async()=>{try{const o=localStorage.getItem("db")||"a2025",s=localStorage.getItem("apiBase")||window.location.hostname,h=localStorage.getItem("token");if(!h){a.value.name="Не авторизован";return}const N=`${s==="localhost"?"http":"https"}://${s==="localhost"?"localhost":s}/${o}/xsrf?JSON_KV=true`,k=await fetch(N,{headers:{"X-Authorization":h}});if(k.ok){const i=await k.json();a.value={name:i.user||"Не указан",role:i.role||"",userId:i.id||null},localStorage.setItem("user",i.user||""),localStorage.setItem("id",i.id||""),l.value={ID:i.id,Роль:i.role},i.id&&B(i.id)}else console.warn("Failed to fetch user data from xsrf endpoint:",k.status),a.value.name=localStorage.getItem("user")||"Не авторизован",a.value.userId=localStorage.getItem("id")}catch(o){console.error("Error fetching user data:",o),a.value.name=localStorage.getItem("user")||"Не авторизован",a.value.userId=localStorage.getItem("id")}},B=async o=>{},H=()=>{f.value=!0,P()},M=()=>{f.value=!1},R=()=>{e.value.hide(),u.push("/profile/edit")},$=()=>{["_xsrf","token","user","id","db","apiBase"].forEach(s=>localStorage.removeItem(s)),["my_token","my_user","my_id","my_xsrf"].forEach(s=>localStorage.removeItem(s)),["ddadmin_token","ddadmin_user","ddadmin_id","ddadmin_xsrf"].forEach(s=>localStorage.removeItem(s)),localStorage.removeItem("integram_session"),localStorage.removeItem("unified_auth_session_id");const o=localStorage.getItem("id");o&&localStorage.removeItem(`userPhoto_${o}`),localStorage.removeItem("currentUserPhoto"),e.value.hide(),u.push("/")};r({toggle:o=>e.value.toggle(o),hide:()=>e.value.hide()});const D={router:u,op:e,isMenuOpen:f,user:a,userInfo:l,userPhoto:y,apiBase:g,dataBase:I,fieldIcons:c,getIconForField:U,formatFieldValue:z,formatDate:w,fetchUserData:P,fetchUserPhoto:B,onMenuShow:H,onMenuHide:M,editProfile:R,logout:$,ref:d,computed:x,get useRouter(){return A},get Popover(){return W},ComponentLoader:V};return Object.defineProperty(D,"__isScriptSetup",{enumerable:!1,value:!0}),D}},oe={class:"profile-content"},te={class:"profile-header p-4 flex align-items-center gap-3"},se={class:"m-0"},re={class:"text-color-secondary"},ae={class:"profile-details p-4"},ie={class:"field-name"},ne={class:"field-key"},le={class:"field-value"},ce={class:"mb-3 flex align-items-center api-base-field"},de={class:"field-name"},pe={class:"field-value"},ue={class:"mb-3 flex align-items-center api-base-field"},me={class:"field-name"},fe={class:"field-value"},_e={class:"profile-actions p-4 flex flex-column gap-3"};function ge(n,r,u,e,f,a){const l=v("Avatar"),y=v("Divider"),g=v("Button");return p(),b(e.Popover,{ref:"op",dismissable:!0,class:"profile-overlay",style:{width:"350px"},onShow:e.onMenuShow,onHide:e.onMenuHide},{default:F(()=>[_(e.ComponentLoader,null,{default:F(()=>[t("div",oe,[t("div",te,[e.userPhoto?(p(),b(l,{key:0,image:e.userPhoto,size:"xlarge",shape:"circle",class:"avatar-large"},null,8,["image"])):(p(),b(l,{key:1,icon:"pi pi-user",size:"xlarge",shape:"circle",class:"avatar-large"})),t("div",null,[t("h3",se,m(e.user.name),1),t("span",re,m(e.user.role),1)])]),t("div",ae,[(p(!0),S(X,null,J(e.userInfo,(I,c)=>(p(),S("div",{key:c,class:"mb-3 flex align-items-center"},[t("span",ie,[t("i",{class:K([e.getIconForField(c),"field-key mr-3"])},null,2),t("span",ne,m(c)+":",1),t("span",le,m(e.formatFieldValue(c,I)),1)])]))),128)),_(y),t("div",ce,[t("span",de,[r[0]||(r[0]=t("i",{class:"pi pi-server field-key mr-3"},null,-1)),r[1]||(r[1]=t("span",{class:"field-key"},"API:",-1)),t("span",pe,m(e.apiBase),1)])]),t("div",ue,[t("span",me,[r[2]||(r[2]=t("i",{class:"pi pi-database field-key mr-3"},null,-1)),r[3]||(r[3]=t("span",{class:"field-key"},"База данных:",-1)),t("span",fe,m(e.dataBase),1)])])]),t("div",_e,[_(g,{label:"Редактировать профиль",icon:"pi pi-pencil",class:"w-full",severity:"secondary",outlined:"",onClick:e.editProfile}),_(g,{label:"Выход",icon:"pi pi-sign-out",class:"w-full",severity:"danger",outlined:"",onClick:e.logout})])])]),_:1})]),_:1},512)}const ke=E(ee,[["render",ge],["__scopeId","data-v-f0cd42dc"],["__file","/home/hive/integram-standalone/src/components/layout/Profile.vue"]]);export{ke as default};
