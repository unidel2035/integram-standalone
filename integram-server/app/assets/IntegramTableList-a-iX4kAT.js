import{as as Re,_ as mt,y as b,u as vt,c as f,A as i,b as p,a as o,j,w as u,K as ze,L as je,D as Ke,ar as We,d as r,U as L,J as Te,I as O,at as qe,o as d,h as D,g as K,f as U,t as w,F as ft,r as gt,au as pt,C as W,P as Qe}from"./index-B4X-KBPT.js";import{u as Ye}from"./useIntegramSession-BdcoOzGP.js";import{i as R}from"./integramApiClient-C3_j8SPw.js";import{I as bt}from"./IntegramBreadcrumb-DHI3pYG8.js";import"./index-B9ygI19o.js";import"./unifiedAuthService-xCuNj-Bd.js";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const Ge=()=>{};function yt(q,l){function T(...e){return new Promise((y,N)=>{Promise.resolve(q(()=>l.apply(this,e),{fn:l,thisArg:this,args:e})).then(y).catch(N)})}return T}function Ct(q,l={}){let T,e,y=Ge;const N=E=>{clearTimeout(E),y(),y=Ge};let F;return E=>{const C=Re(q),k=Re(l.maxWait);return T&&N(T),C<=0||k!==void 0&&k<=0?(e&&(N(e),e=void 0),Promise.resolve(E())):new Promise((_,H)=>{y=l.rejectOnCancel?H:_,F=E,k&&!e&&(e=setTimeout(()=>{T&&N(T),e=void 0,_(F())},k)),T=setTimeout(()=>{e&&N(e),e=void 0,_(E())},C)})}}function Je(q,l=200,T={}){return yt(Ct(l,T),q)}const ke="integram-table-list-view-mode",Ie="integram-table-favorites",ce="integram-table-metadata-cache",He=300*1e3,Se="integram-table-metadata-enabled",De="integram-table-pagination-enabled",Ee="integram-table-smart-search",ht={__name:"IntegramTableList",setup(q,{expose:l}){l();const T=ze(),e=je(),y=Ke(),N=We(),{isAuthenticated:F}=Ye(),m=r(!1),E=r(null),C=r([]),k=r(""),_=r(""),H=r(localStorage.getItem(ke)||"grid"),oe=r(!1),M=r("all"),B=r("name-asc"),V=r([]),A=r(0),se=r(null),I=r(localStorage.getItem(Se)==="true"),ne=r(localStorage.getItem(De)!=="false"),X=r(localStorage.getItem(Ee)!=="false"),Z=r(0),P=r(20),z=r(!1),S=r(0),a=r(null),v=r(null),ue=r(),Q=r(!1),$=r(!1),ee=r(!1),Y=r(!1),ie=r(""),me=r(!1),ve=r(!1),fe=r(null),te=r(""),ge=r(!1),pe=r(null),be=r(!1);L(H,async t=>{localStorage.setItem(ke,t),oe.value=!0,await new Promise(n=>setTimeout(n,0)),oe.value=!1}),L(I,t=>{localStorage.setItem(Se,String(t)),t&&C.value.length>0?_e():t||xe()}),L(ne,t=>{localStorage.setItem(De,String(t)),Z.value=0}),L(X,t=>{localStorage.setItem(Ee,String(t))}),L(I,t=>{t||["records-desc","records-asc","columns-desc","columns-asc"].includes(B.value)&&(B.value="name-asc")}),Te(()=>{const t=localStorage.getItem(Ie);if(t)try{V.value=JSON.parse(t)}catch(n){console.error("Failed to parse favorites:",n)}}),L(V,t=>{localStorage.setItem(Ie,JSON.stringify(t))},{deep:!0});const Me=Je(t=>{_.value=t},150);L(k,t=>{Me(t)}),L(_,()=>{A.value=0,le.size>1e3&&le.clear()}),L([M,B],()=>{A.value=0});const Xe=[{value:"grid",icon:"pi pi-th-large",label:"Сетка"},{value:"list",icon:"pi pi-list",label:"Список"}],Ze=O(()=>{const t=[{value:"name-asc",label:"Название (А-Я)"},{value:"name-desc",label:"Название (Я-А)"}];return I.value?[...t,{value:"records-desc",label:"Больше записей"},{value:"records-asc",label:"Меньше записей"},{value:"columns-desc",label:"Больше колонок"},{value:"columns-asc",label:"Меньше колонок"}]:t}),$e=O(()=>v.value?[{label:"Просмотр",icon:"pi pi-eye",command:()=>e.push(`/integram/${G.value}/table/${v.value.id}`)},{label:"Редактировать структуру",icon:"pi pi-pencil",command:()=>e.push(`/integram/${G.value}/edit_types?typeId=${v.value.id}`)},{separator:!0},{label:re(v.value.id)?"Убрать из избранного":"Добавить в избранное",icon:re(v.value.id)?"pi pi-star-fill":"pi pi-star",command:()=>Be(v.value.id)},{separator:!0},{label:"Клонировать структуру",icon:"pi pi-copy",command:()=>{te.value=`${v.value.name} (копия)`,$.value=!0}},{label:"Переименовать",icon:"pi pi-pencil",command:()=>Oe(v.value)},{separator:!0},{label:"Удалить",icon:"pi pi-trash",class:"text-red-500",command:()=>{ee.value=!0}}]:[]),le=new Map;function Ve(t,n){if(!n)return 0;const s=`${t}:${n}`;if(le.has(s))return le.get(s);const g=t.toLowerCase(),h=n.toLowerCase();let c=0;if(g===h)c=1e3;else if(g.startsWith(h))c=900;else if(g.startsWith(h+"_")||g.startsWith(h+" "))c=850;else if(new RegExp(`[_\\s]${h}`,"i").test(g))c=700;else if(g.includes(h))c=500;else{let x=0,J=!0;for(let de of h){if(x=g.indexOf(de,x),x===-1){J=!1;break}x++}c=J?300:0}return le.set(s,c),c}const G=O(()=>R.getDatabase()||""),ye=O(()=>{let t=C.value;if(M.value==="favorites"?t=t.filter(n=>re(n.id)):M.value==="empty"?t=t.filter(n=>n.recordCount===0):M.value==="filled"&&(t=t.filter(n=>n.recordCount>0)),_.value){const n=_.value.toLowerCase();X.value?t=t.map(s=>({...s,_relevance:Ve(s.name,_.value)})).filter(s=>s._relevance>0).sort((s,g)=>g._relevance-s._relevance):t=t.filter(s=>s.name.toLowerCase().includes(n)||String(s.id).includes(n))}return t}),Ce=O(()=>{const t=[...ye.value];if(X.value&&k.value)return t;const[n,s]=B.value.split("-");return t.sort((g,h)=>{let c,x;return n==="name"?(c=g.name.toLowerCase(),x=h.name.toLowerCase(),s==="asc"?c.localeCompare(x,"ru"):x.localeCompare(c,"ru")):(n==="records"?(c=g.recordCount??0,x=h.recordCount??0):n==="columns"&&(c=g.columnCount??0,x=h.columnCount??0),n!=="name"?s==="asc"?c-x:x-c:0)}),t}),he=O(()=>{if(!ne.value)return Ce.value;const t=Z.value,n=t+P.value;return Ce.value.slice(t,n)}),et=O(()=>Math.ceil(ye.value.length/P.value)),tt=O(()=>[{label:"Таблицы",icon:"pi pi-table"}]);function Fe(t){return t?t.replace(/&nbsp;/g," ").replace(/\s+/g," ").trim():""}function lt(t){if(!t)return"";const n=t.alias||t.name;return Fe(n)}function Ae(){try{const t=localStorage.getItem(ce);if(!t)return null;const{timestamp:n,data:s}=JSON.parse(t);return Date.now()-n>He?(localStorage.removeItem(ce),null):s}catch(t){return console.error("Failed to load metadata cache:",t),null}}function Le(){try{const t={};C.value.forEach(s=>{(s.recordCount!==void 0||s.columnCount!==void 0||s.alias!==void 0)&&(t[s.id]={recordCount:s.recordCount,columnCount:s.columnCount,alias:s.alias})});const n={timestamp:Date.now(),data:t};localStorage.setItem(ce,JSON.stringify(n))}catch(t){console.error("Failed to save metadata cache:",t)}}function Ne(t){if(!t)return!1;let n=0;return C.value.forEach(s=>{t[s.id]&&(s.recordCount=t[s.id].recordCount,s.columnCount=t[s.id].columnCount,s.alias=t[s.id].alias,n++)}),console.log(`Applied cached metadata for ${n} tables`),n>0}function re(t){return V.value.includes(String(t))}function at(t){Z.value=t.first,P.value=t.rows,window.scrollTo({top:0,behavior:"smooth"})}function Be(t){const n=String(t),s=V.value.indexOf(n);s>-1?(V.value.splice(s,1),y.add({severity:"info",summary:"Убрано из избранного",life:2e3})):(V.value.push(n),y.add({severity:"success",summary:"Добавлено в избранное",life:2e3}))}function ot(){return M.value==="favorites"?"Нет избранных таблиц":M.value==="empty"?"Нет пустых таблиц":M.value==="filled"?"Нет таблиц с данными":k.value?`Таблицы не найдены по запросу "${k.value}"`:"Нет таблиц"}function nt(){k.value="",M.value="all"}function it(t,n){v.value=n,ue.value.toggle(t)}function st(t){e.push(`/integram/${G.value}/table/${t.data.id}`)}function Pe(t){e.push(`/integram/${G.value}/table/${t}`)}function rt(t){const n=he.value.length-1;if(t.key==="ArrowDown")t.preventDefault(),A.value=Math.min(A.value+1,n),we();else if(t.key==="ArrowUp")t.preventDefault(),A.value=Math.max(A.value-1,0),we();else if(t.key==="Enter"){t.preventDefault();const s=he.value[A.value];s&&Pe(s.id)}}function we(){setTimeout(()=>{const t=document.querySelector(".table-card-active");t&&t.scrollIntoView({behavior:"smooth",block:"nearest"})},0)}async function ae(){m.value=!0,E.value=null;try{const t=await R.getDictionary(),n=Object.entries(t).map(([h,c])=>({id:h,name:c,alias:void 0,recordCount:void 0,columnCount:void 0})).sort((h,c)=>h.name.localeCompare(c.name,"ru"));C.value=n,m.value=!1;const s=Ae();Ne(s)&&console.log("Using cached metadata, updating in background..."),_e()}catch(t){console.error("Error loading tables:",t),E.value=t.message||"Не удалось загрузить список таблиц",m.value=!1,y.add({severity:"error",summary:"Ошибка",detail:E.value,life:5e3})}}async function _e(){if(!I.value){console.log("Metadata loading disabled in settings");return}a.value&&a.value.abort(),a.value=new AbortController;const t=a.value.signal;z.value=!0,S.value=0;const n=10,s=200;try{for(let g=0;g<C.value.length;g+=n){if(t.aborted){console.log("Metadata loading cancelled");return}const h=C.value.slice(g,g+n);await Promise.allSettled(h.map(async c=>{var x;if(!t.aborted)try{const J=await R.getTypeMetadata(c.id);if(t.aborted||(c.columnCount=((x=J.requisites)==null?void 0:x.length)||0,c.alias=J.alias||void 0),!t.aborted)try{const de=await R.getObjectCount(c.id);c.recordCount=de.count||0}catch{c.recordCount=0}S.value++}catch(J){console.warn(`Failed to load metadata for table ${c.id}:`,J.message),c.recordCount=0,c.columnCount=0,S.value++}})),g+n<C.value.length&&!t.aborted&&await new Promise(c=>setTimeout(c,s))}t.aborted||(Le(),console.log("Metadata cache updated"))}finally{z.value=!1,a.value=null}}function xe(){a.value&&(a.value.abort(),a.value=null,z.value=!1)}async function dt(){if(ie.value.trim()){ve.value=!0,fe.value=null;try{const t=await R.createType({name:ie.value.trim(),baseTypeId:1,unique:me.value});y.add({severity:"success",summary:"Таблица создана",detail:`Таблица "${ie.value}" успешно создана`,life:3e3}),await ae(),Q.value=!1,ie.value="",me.value=!1,e.push(`/integram/${G.value}/edit_types?typeId=${t.id}`)}catch(t){console.error("Error creating table:",t),fe.value=t.message||"Не удалось создать таблицу"}finally{ve.value=!1}}}async function ct(){if(!(!te.value.trim()||!v.value)){ge.value=!0,pe.value=null;try{const t=await R.cloneTableStructure(v.value.id,te.value.trim());y.add({severity:"success",summary:"Таблица клонирована",detail:`Структура скопирована в таблицу "${te.value}"`,life:3e3}),await ae(),$.value=!1,te.value="",v.value=null,e.push(`/integram/${G.value}/table/${t.id}`)}catch(t){console.error("Error cloning table:",t),pe.value=t.message||"Не удалось клонировать таблицу"}finally{ge.value=!1}}}async function ut(){if(v.value){be.value=!0;try{await R.deleteTableCascade(v.value.id),y.add({severity:"success",summary:"Таблица удалена",detail:`Таблица "${v.value.name}" удалена`,life:3e3});const t=String(v.value.id),n=V.value.indexOf(t);n>-1&&V.value.splice(n,1),await ae(),ee.value=!1,v.value=null}catch(t){console.error("Error deleting table:",t),y.add({severity:"error",summary:"Ошибка",detail:t.message||"Не удалось удалить таблицу",life:5e3})}finally{be.value=!1}}}async function Oe(t){const n=prompt(`Введите новое название для таблицы "${t.name}":`,t.name);if(!(!n||n===t.name))try{await R.renameTable(t.id,n),y.add({severity:"success",summary:"Таблица переименована",detail:`"${t.name}" → "${n}"`,life:3e3}),await ae()}catch(s){console.error("Error renaming table:",s),y.add({severity:"error",summary:"Ошибка",detail:s.message||"Не удалось переименовать таблицу",life:5e3})}}Te(async()=>{if(!F.value){e.push("/integram/login?redirect="+encodeURIComponent(T.fullPath));return}await ae()}),qe(()=>{xe()});const Ue={route:T,router:e,toast:y,confirm:N,isAuthenticated:F,VIEW_MODE_STORAGE_KEY:ke,FAVORITES_STORAGE_KEY:Ie,METADATA_CACHE_KEY:ce,METADATA_CACHE_TTL:He,METADATA_ENABLED_KEY:Se,PAGINATION_ENABLED_KEY:De,SMART_SEARCH_KEY:Ee,loading:m,error:E,tables:C,searchQuery:k,debouncedSearchQuery:_,viewMode:H,viewModeTransitioning:oe,activeFilter:M,sortBy:B,favoriteTableIds:V,activeTableIndex:A,searchInput:se,loadMetadataEnabled:I,paginationEnabled:ne,smartSearchEnabled:X,first:Z,pageSize:P,metadataLoading:z,loadedMetadataCount:S,metadataAbortController:a,selectedTable:v,tableMenu:ue,showCreateTableDialog:Q,showCloneDialog:$,showDeleteDialog:ee,showSettingsDialog:Y,newTableName:ie,newTableUnique:me,creatingTable:ve,createTableError:fe,cloneTableName:te,cloningTable:ge,cloneTableError:pe,deletingTable:be,updateDebouncedSearch:Me,viewOptions:Xe,sortOptions:Ze,tableMenuItems:$e,relevanceCache:le,calculateRelevance:Ve,database:G,filteredTables:ye,sortedFilteredTables:Ce,paginatedTables:he,totalPages:et,breadcrumbItems:tt,cleanTableName:Fe,getTableDisplayName:lt,loadMetadataFromCache:Ae,saveMetadataToCache:Le,applyCachedMetadata:Ne,isFavorite:re,onPageChange:at,toggleFavorite:Be,getEmptyStateMessage:ot,resetFilters:nt,showTableMenu:it,handleRowClick:st,navigateToTable:Pe,handleSearchKeydown:rt,scrollToActiveTable:we,loadTables:ae,loadTableMetadataInBackground:_e,cancelMetadataLoading:xe,createTable:dt,cloneTable:ct,deleteTable:ut,renameTable:Oe,ref:r,computed:O,onMounted:Te,onBeforeUnmount:qe,watch:L,get useRoute(){return ze},get useRouter(){return je},get useToast(){return Ke},get useConfirm(){return We},get useIntegramSession(){return Ye},get integramApiClient(){return R},IntegramBreadcrumb:bt,get useDebounceFn(){return Je}};return Object.defineProperty(Ue,"__isScriptSetup",{enumerable:!1,value:!0}),Ue}},wt={class:"integram-table-list"},_t={key:0,class:"metadata-loading-notification mb-3"},xt={class:"flex align-items-center justify-content-between"},Tt={class:"flex align-items-center gap-2"},kt={class:"flex align-items-center justify-content-between"},It={class:"flex align-items-center gap-2"},St={class:"flex gap-2 align-items-center ml-auto"},Dt={class:"toolbar-section mb-3"},Et={class:"flex align-items-center justify-content-between flex-wrap gap-3"},Mt={class:"flex align-items-center gap-2 flex-wrap"},Vt={class:"flex align-items-center gap-2"},Ft={key:0,class:"flex justify-content-center py-5"},At={key:1,class:"text-center py-5"},Lt={key:2},Nt={key:0,class:"flex justify-content-center align-items-center py-5"},Bt={key:1},Pt={key:0,class:"flex align-items-center justify-content-between mb-3"},Ot={class:"text-sm text-500"},Ut={key:1,class:"grid"},Rt={class:"card-header-actions"},zt={class:"table-name"},jt={class:"text-500 text-sm"},Kt={key:0},Wt={key:0,class:"table-stats"},qt={key:0,class:"stat-item"},Qt={key:1,class:"stat-item"},Yt={key:1,class:"text-400 text-sm"},Gt={key:2,class:"mt-2"},Jt={class:"text-xs text-500 mt-1"},Ht={class:"flex gap-2"},Xt={class:"flex align-items-center gap-2"},Zt={class:"font-semibold"},$t={class:"text-sm"},el={key:0},tl={key:1,class:"pi pi-spin pi-spinner text-sm"},ll={key:0},al={class:"flex gap-1"},ol={key:3,class:"text-center py-5"},nl={class:"text-color-secondary text-lg mb-2"},il={class:"flex justify-content-center gap-2 mt-3"},sl={class:"p-fluid"},rl={class:"field"},dl={class:"field-checkbox"},cl={class:"p-fluid"},ul={class:"field"},ml={class:"field"},vl={class:"flex align-items-center gap-3"},fl={class:"mb-2"},gl={class:"p-fluid"},pl={class:"field"},bl={class:"flex align-items-center p-3 border-round surface-50"},yl={class:"flex justify-content-end",style:{"min-width":"6rem"}},Cl={class:"field"},hl={class:"flex align-items-center p-3 border-round surface-50"},wl={class:"flex justify-content-end",style:{"min-width":"6rem"}},_l={class:"field"},xl={class:"flex align-items-center p-3 border-round surface-50"},Tl={class:"flex justify-content-end",style:{"min-width":"6rem"}};function kl(q,l,T,e,y,N){const F=b("Badge"),m=b("Button"),E=b("InputIcon"),C=b("InputText"),k=b("IconField"),_=b("Chip"),H=b("Dropdown"),oe=b("SelectButton"),M=b("ProgressSpinner"),B=b("Message"),V=b("Paginator"),A=b("ProgressBar"),se=b("Card"),I=b("Column"),ne=b("DataTable"),X=b("Menu"),Z=b("Checkbox"),P=b("Dialog"),z=b("ToggleButton"),S=vt("tooltip");return d(),f("div",wt,[i(e.IntegramBreadcrumb,{items:e.breadcrumbItems},null,8,["items"]),e.metadataLoading&&e.loadMetadataEnabled?(d(),f("div",_t,[o("div",xt,[o("div",Tt,[l[27]||(l[27]=o("i",{class:"pi pi-spin pi-spinner text-primary"},null,-1)),l[28]||(l[28]=o("span",{class:"font-medium"},"Загрузка метаданных...",-1)),i(F,{value:`${e.loadedMetadataCount} / ${e.tables.length}`,severity:"secondary"},null,8,["value"])]),j(i(m,{icon:"pi pi-times",size:"small",text:"",rounded:"",severity:"secondary",onClick:e.cancelMetadataLoading},null,512),[[S,"Остановить загрузку",void 0,{top:!0}]])])])):p("",!0),i(se,null,{title:u(()=>[o("div",kt,[o("div",It,[l[29]||(l[29]=o("span",null,"Таблицы",-1)),e.tables.length?(d(),D(F,{key:0,value:e.tables.length,severity:"secondary"},null,8,["value"])):p("",!0)]),o("div",St,[j(i(m,{icon:"pi pi-plus",label:"Создать",size:"small",onClick:l[0]||(l[0]=a=>e.showCreateTableDialog=!0)},null,512),[[S,"Создать новую таблицу",void 0,{bottom:!0}]]),j(i(m,{icon:"pi pi-cog",size:"small",outlined:"",onClick:l[1]||(l[1]=a=>e.showSettingsDialog=!0)},null,512),[[S,"Настройки отображения",void 0,{bottom:!0}]]),j(i(m,{icon:"pi pi-refresh",size:"small",outlined:"",onClick:e.loadTables,loading:e.loading},null,8,["loading"]),[[S,"Обновить",void 0,{bottom:!0}]])])])]),subtitle:u(()=>[...l[30]||(l[30]=[])]),content:u(()=>[o("div",Dt,[o("div",Et,[i(k,{iconPosition:"left",class:"flex-grow-1",style:{"max-width":"400px"}},{default:u(()=>[i(E,{class:"pi pi-search"}),i(C,{ref:"searchInput",modelValue:e.searchQuery,"onUpdate:modelValue":l[2]||(l[2]=a=>e.searchQuery=a),placeholder:"Поиск по названию, ID, колонкам...",class:"w-full",onKeydown:e.handleSearchKeydown},null,8,["modelValue"])]),_:1}),o("div",Mt,[o("div",Vt,[i(_,{class:K([{"chip-active":e.activeFilter==="all"},"cursor-pointer"]),label:"Все",onClick:l[3]||(l[3]=a=>e.activeFilter="all")},null,8,["class"]),i(_,{class:K([{"chip-active":e.activeFilter==="favorites"},"cursor-pointer"]),onClick:l[4]||(l[4]=a=>e.activeFilter="favorites")},{default:u(()=>[...l[31]||(l[31]=[o("i",{class:"pi pi-star-fill mr-1"},null,-1),U(" Избранные ",-1)])]),_:1},8,["class"]),e.loadMetadataEnabled?(d(),D(_,{key:0,class:K([{"chip-active":e.activeFilter==="empty"},"cursor-pointer"]),onClick:l[5]||(l[5]=a=>e.activeFilter="empty")},{default:u(()=>[...l[32]||(l[32]=[o("i",{class:"pi pi-inbox mr-1"},null,-1),U(" Пустые ",-1)])]),_:1},8,["class"])):p("",!0),e.loadMetadataEnabled?(d(),D(_,{key:1,class:K([{"chip-active":e.activeFilter==="filled"},"cursor-pointer"]),onClick:l[6]||(l[6]=a=>e.activeFilter="filled")},{default:u(()=>[...l[33]||(l[33]=[o("i",{class:"pi pi-check-circle mr-1"},null,-1),U(" С данными ",-1)])]),_:1},8,["class"])):p("",!0)]),i(H,{modelValue:e.sortBy,"onUpdate:modelValue":l[7]||(l[7]=a=>e.sortBy=a),options:e.sortOptions,optionLabel:"label",optionValue:"value",placeholder:"Сортировка",class:"w-10rem"},null,8,["modelValue","options"]),i(oe,{modelValue:e.viewMode,"onUpdate:modelValue":l[8]||(l[8]=a=>e.viewMode=a),options:e.viewOptions,optionLabel:"icon",optionValue:"value",allowEmpty:!1},{option:u(({option:a})=>[j(o("i",{class:K(a.icon)},null,2),[[S,a.label,void 0,{top:!0}]])]),_:1},8,["modelValue"])])])]),e.loading?(d(),f("div",Ft,[i(M)])):e.error?(d(),f("div",At,[i(B,{severity:"error",closable:!1},{default:u(()=>[U(w(e.error),1)]),_:1})])):(d(),f("div",Lt,[e.viewModeTransitioning?(d(),f("div",Nt,[i(M,{style:{width:"50px",height:"50px"},strokeWidth:"4"}),l[34]||(l[34]=o("span",{class:"ml-3 text-500"},"Переключение режима...",-1))])):(d(),f("div",Bt,[e.paginationEnabled?(d(),f("div",Pt,[o("div",Ot," Показано "+w(e.paginatedTables.length)+" из "+w(e.filteredTables.length)+" таблиц ",1),e.totalPages>1?(d(),D(V,{key:0,first:e.first,"onUpdate:first":l[9]||(l[9]=a=>e.first=a),rows:e.pageSize,totalRecords:e.filteredTables.length,rowsPerPageOptions:[20,50,100],onPage:e.onPageChange},null,8,["first","rows","totalRecords"])):p("",!0)])):p("",!0),e.viewMode==="grid"?(d(),f("div",Ut,[(d(!0),f(ft,null,gt(e.paginatedTables,(a,v,ue,Q)=>{const $=[a.id,a.recordCount,a.columnCount,e.activeTableIndex===v,e.isFavorite(a.id)];if(Q&&Q.key===a.id&&pt(Q,$))return Q;const ee=(d(),f("div",{key:a.id,class:"col-12 sm:col-6 md:col-4 lg:col-3"},[i(se,{class:K(["table-card h-full cursor-pointer",{"table-card-active":e.debouncedSearchQuery&&e.activeTableIndex===v}]),onClick:Y=>e.navigateToTable(a.id)},{header:u(()=>[o("div",Rt,[j(i(m,{icon:e.isFavorite(a.id)?"pi pi-star-fill":"pi pi-star",class:K({"favorite-active":e.isFavorite(a.id)}),text:"",rounded:"",size:"small",onClick:W(Y=>e.toggleFavorite(a.id),["stop"])},null,8,["icon","class","onClick"]),[[S,e.isFavorite(a.id)?"Убрать из избранного":"Добавить в избранное",void 0,{top:!0}]]),i(m,{icon:"pi pi-ellipsis-v",text:"",rounded:"",size:"small",onClick:W(Y=>e.showTableMenu(Y,a),["stop"])},null,8,["onClick"])])]),title:u(()=>[o("span",zt,w(e.getTableDisplayName(a)),1)]),subtitle:u(()=>[o("div",jt,[a.alias?(d(),f("span",Kt,w(e.cleanTableName(a.name))+" · ",1)):p("",!0),U("ID: "+w(a.id),1)])]),content:u(()=>[e.loadMetadataEnabled?(d(),f("div",Wt,[a.recordCount!==void 0?(d(),f("div",qt,[l[35]||(l[35]=o("i",{class:"pi pi-database text-400"},null,-1)),o("span",null,w(a.recordCount)+" зап.",1)])):p("",!0),a.columnCount!==void 0?(d(),f("div",Qt,[l[36]||(l[36]=o("i",{class:"pi pi-bars text-400"},null,-1)),o("span",null,w(a.columnCount)+" кол.",1)])):p("",!0),a.recordCount!==void 0?(d(),D(F,{key:2,severity:a.recordCount>0?"success":"secondary",value:a.recordCount>0?"Заполнена":"Пустая",class:"mt-2"},null,8,["severity","value"])):p("",!0)])):(d(),f("div",Yt," Включите метаданные для просмотра статистики ")),a.recordCount>1e3?(d(),f("div",Gt,[i(A,{value:Math.min(a.recordCount/1e4*100,100),showValue:!1,style:{height:"4px"}},null,8,["value"]),o("div",Jt,w(a.recordCount>1e4?"Большая таблица":"Средняя таблица"),1)])):p("",!0)]),footer:u(()=>[o("div",Ht,[i(m,{icon:"pi pi-eye",label:"Просмотр",size:"small",outlined:"",onClick:W(Y=>e.router.push(`/integram/${e.database}/table/${a.id}`),["stop"]),class:"flex-1"},null,8,["onClick"]),i(m,{icon:"pi pi-pencil",label:"Структура",size:"small",outlined:"",onClick:W(Y=>e.router.push(`/integram/${e.database}/edit_types?typeId=${a.id}`),["stop"]),class:"flex-1"},null,8,["onClick"])])]),_:2},1032,["class","onClick"])]));return ee.memo=$,ee},l,10),128))])):(d(),D(ne,{key:2,value:e.paginatedTables,stripedRows:"",class:"p-datatable-sm",onRowClick:e.handleRowClick},{default:u(()=>[i(I,{style:{width:"3rem"}},{body:u(({data:a})=>[i(m,{icon:e.isFavorite(a.id)?"pi pi-star-fill":"pi pi-star",class:K({"favorite-active":e.isFavorite(a.id)}),text:"",rounded:"",size:"small",onClick:W(v=>e.toggleFavorite(a.id),["stop"])},null,8,["icon","class","onClick"])]),_:1}),i(I,{field:"name",header:"Название",sortable:""},{body:u(({data:a})=>[o("div",Xt,[l[37]||(l[37]=o("i",{class:"pi pi-table text-primary"},null,-1)),o("span",Zt,w(e.getTableDisplayName(a)),1)])]),_:1}),i(I,{field:"id",header:"ID",sortable:"",style:{width:"8rem"}},{body:u(({data:a})=>[o("code",$t,w(a.id),1)]),_:1}),e.loadMetadataEnabled?(d(),D(I,{key:0,field:"recordCount",header:"Записи",sortable:"",style:{width:"10rem"}},{body:u(({data:a})=>[a.recordCount!==void 0?(d(),f("span",el,w(a.recordCount),1)):(d(),f("i",tl))]),_:1})):p("",!0),e.loadMetadataEnabled?(d(),D(I,{key:1,field:"columnCount",header:"Колонки",sortable:"",style:{width:"8rem"}},{body:u(({data:a})=>[a.columnCount!==void 0?(d(),f("span",ll,w(a.columnCount),1)):p("",!0)]),_:1})):p("",!0),e.loadMetadataEnabled?(d(),D(I,{key:2,header:"Статус",style:{width:"10rem"}},{body:u(({data:a})=>[a.recordCount!==void 0?(d(),D(F,{key:0,severity:a.recordCount>0?"success":"secondary",value:a.recordCount>0?"Заполнена":"Пустая"},null,8,["severity","value"])):p("",!0)]),_:1})):p("",!0),i(I,{style:{width:"10rem"}},{body:u(({data:a})=>[o("div",al,[j(i(m,{icon:"pi pi-eye",size:"small",text:"",rounded:"",onClick:W(v=>e.router.push(`/integram/${e.database}/table/${a.id}`),["stop"])},null,8,["onClick"]),[[S,"Просмотр",void 0,{top:!0}]]),j(i(m,{icon:"pi pi-pencil",size:"small",text:"",rounded:"",onClick:W(v=>e.router.push(`/integram/${e.database}/edit_types?typeId=${a.id}`),["stop"])},null,8,["onClick"]),[[S,"Структура",void 0,{top:!0}]]),i(m,{icon:"pi pi-ellipsis-v",size:"small",text:"",rounded:"",onClick:W(v=>e.showTableMenu(v,a),["stop"])},null,8,["onClick"])])]),_:1})]),_:1},8,["value"])),e.sortedFilteredTables.length===0?(d(),f("div",ol,[l[38]||(l[38]=o("i",{class:"pi pi-inbox text-5xl text-color-secondary mb-3"},null,-1)),o("p",nl,w(e.getEmptyStateMessage()),1),o("div",il,[e.searchQuery||e.activeFilter!=="all"?(d(),D(m,{key:0,label:"Сбросить фильтры",icon:"pi pi-times",severity:"secondary",text:"",onClick:e.resetFilters})):p("",!0),i(m,{label:"Обновить",icon:"pi pi-refresh",severity:"secondary",outlined:"",loading:e.loading,onClick:e.loadTables},null,8,["loading"]),i(m,{label:"Создать таблицу",icon:"pi pi-plus",severity:"success",onClick:l[12]||(l[12]=a=>e.showCreateTableDialog=!0)})])])):p("",!0)]))]))]),_:1}),i(X,{ref:"tableMenu",model:e.tableMenuItems,popup:""},null,8,["model"]),i(P,{visible:e.showCreateTableDialog,"onUpdate:visible":l[16]||(l[16]=a=>e.showCreateTableDialog=a),header:"Создать новую таблицу",modal:!0,style:{width:"500px"}},{footer:u(()=>[i(m,{label:"Отмена",icon:"pi pi-times",onClick:l[15]||(l[15]=a=>e.showCreateTableDialog=!1),text:""}),i(m,{label:"Создать",icon:"pi pi-check",onClick:e.createTable,loading:e.creatingTable,disabled:!e.newTableName.trim()},null,8,["loading","disabled"])]),default:u(()=>[o("div",sl,[o("div",rl,[l[39]||(l[39]=o("label",{for:"table-name"},"Название таблицы *",-1)),i(C,{id:"table-name",modelValue:e.newTableName,"onUpdate:modelValue":l[13]||(l[13]=a=>e.newTableName=a),placeholder:"Например: Клиенты, Заказы, Продукты...",onKeyup:Qe(e.createTable,["enter"])},null,8,["modelValue"])]),o("div",dl,[i(Z,{id:"table-unique",modelValue:e.newTableUnique,"onUpdate:modelValue":l[14]||(l[14]=a=>e.newTableUnique=a),binary:!0},null,8,["modelValue"]),l[40]||(l[40]=o("label",{for:"table-unique"},"Первая колонка уникальная",-1))]),e.createTableError?(d(),D(B,{key:0,severity:"error",closable:!1},{default:u(()=>[U(w(e.createTableError),1)]),_:1})):p("",!0)])]),_:1},8,["visible"]),i(P,{visible:e.showCloneDialog,"onUpdate:visible":l[19]||(l[19]=a=>e.showCloneDialog=a),header:"Клонировать таблицу",modal:!0,style:{width:"500px"}},{footer:u(()=>[i(m,{label:"Отмена",icon:"pi pi-times",onClick:l[18]||(l[18]=a=>e.showCloneDialog=!1),text:""}),i(m,{label:"Клонировать",icon:"pi pi-copy",onClick:e.cloneTable,loading:e.cloningTable,disabled:!e.cloneTableName.trim()},null,8,["loading","disabled"])]),default:u(()=>{var a;return[o("div",cl,[o("div",ul,[l[41]||(l[41]=o("label",null,"Исходная таблица",-1)),i(C,{value:(a=e.selectedTable)==null?void 0:a.name,disabled:""},null,8,["value"])]),o("div",ml,[l[42]||(l[42]=o("label",{for:"clone-name"},"Название новой таблицы *",-1)),i(C,{id:"clone-name",modelValue:e.cloneTableName,"onUpdate:modelValue":l[17]||(l[17]=v=>e.cloneTableName=v),placeholder:"Название...",onKeyup:Qe(e.cloneTable,["enter"])},null,8,["modelValue"])]),e.cloneTableError?(d(),D(B,{key:0,severity:"error",closable:!1},{default:u(()=>[U(w(e.cloneTableError),1)]),_:1})):p("",!0)])]}),_:1},8,["visible"]),i(P,{visible:e.showDeleteDialog,"onUpdate:visible":l[21]||(l[21]=a=>e.showDeleteDialog=a),header:"Удалить таблицу?",modal:!0,style:{width:"450px"}},{footer:u(()=>[i(m,{label:"Отмена",icon:"pi pi-times",onClick:l[20]||(l[20]=a=>e.showDeleteDialog=!1),text:""}),i(m,{label:"Удалить",icon:"pi pi-trash",severity:"danger",onClick:e.deleteTable,loading:e.deletingTable},null,8,["loading"])]),default:u(()=>{var a;return[o("div",vl,[l[46]||(l[46]=o("i",{class:"pi pi-exclamation-triangle text-5xl text-orange-500"},null,-1)),o("div",null,[o("p",fl,[l[43]||(l[43]=U(" Вы действительно хотите удалить таблицу ",-1)),o("strong",null,w((a=e.selectedTable)==null?void 0:a.name),1),l[44]||(l[44]=U("? ",-1))]),l[45]||(l[45]=o("p",{class:"text-sm text-500"}," Все данные в таблице будут безвозвратно удалены. ",-1))])])]}),_:1},8,["visible"]),i(P,{visible:e.showSettingsDialog,"onUpdate:visible":l[26]||(l[26]=a=>e.showSettingsDialog=a),header:"Настройки отображения",modal:!0,style:{width:"500px"}},{footer:u(()=>[i(m,{label:"Закрыть",icon:"pi pi-times",onClick:l[25]||(l[25]=a=>e.showSettingsDialog=!1),autofocus:""})]),default:u(()=>[o("div",gl,[o("div",pl,[l[48]||(l[48]=o("label",{class:"font-semibold mb-2 block"},"Загрузка данных",-1)),o("div",bl,[l[47]||(l[47]=o("div",{class:"flex align-items-center gap-2 flex-1"},[o("i",{class:"pi pi-info-circle text-primary"}),o("div",null,[o("div",{class:"font-medium"},"Метаданные таблиц"),o("div",{class:"text-sm text-500"}," Загружать количество записей и колонок ")])],-1)),o("div",yl,[i(z,{modelValue:e.loadMetadataEnabled,"onUpdate:modelValue":l[22]||(l[22]=a=>e.loadMetadataEnabled=a),onLabel:"Вкл",offLabel:"Выкл",onIcon:"pi pi-check",offIcon:"pi pi-times",class:"w-6rem"},null,8,["modelValue"])])])]),o("div",Cl,[l[50]||(l[50]=o("label",{class:"font-semibold mb-2 block"},"Навигация",-1)),o("div",hl,[l[49]||(l[49]=o("div",{class:"flex align-items-center gap-2 flex-1"},[o("i",{class:"pi pi-list text-primary"}),o("div",null,[o("div",{class:"font-medium"},"Пагинация"),o("div",{class:"text-sm text-500"}," Постраничная навигация по таблицам ")])],-1)),o("div",wl,[i(z,{modelValue:e.paginationEnabled,"onUpdate:modelValue":l[23]||(l[23]=a=>e.paginationEnabled=a),onLabel:"Вкл",offLabel:"Выкл",onIcon:"pi pi-check",offIcon:"pi pi-times",class:"w-6rem"},null,8,["modelValue"])])])]),o("div",_l,[l[52]||(l[52]=o("label",{class:"font-semibold mb-2 block"},"Поиск",-1)),o("div",xl,[l[51]||(l[51]=o("div",{class:"flex align-items-center gap-2 flex-1"},[o("i",{class:"pi pi-sort-amount-down text-primary"}),o("div",null,[o("div",{class:"font-medium"},"Умный поиск"),o("div",{class:"text-sm text-500"}," Ранжирование по релевантности ")])],-1)),o("div",Tl,[i(z,{modelValue:e.smartSearchEnabled,"onUpdate:modelValue":l[24]||(l[24]=a=>e.smartSearchEnabled=a),onLabel:"Вкл",offLabel:"Выкл",onIcon:"pi pi-check",offIcon:"pi pi-times",class:"w-6rem"},null,8,["modelValue"])])])])])]),_:1},8,["visible"])])}const Fl=mt(ht,[["render",kl],["__scopeId","data-v-97a714bf"],["__file","/home/hive/integram-standalone/src/views/pages/Integram/IntegramTableList.vue"]]);export{Fl as default};
