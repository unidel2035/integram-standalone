import{_ as Ol,y as D,u as Sl,c as b,A as c,w,K as Qe,L as Je,D as Ye,ar as Ze,d as f,I as me,J as $e,O as el,U as ll,o as u,b as R,f as O,t as C,a as d,F as ve,r as Ee,g as q,h as x,P as A,j as k,C as Ie}from"./index-B4X-KBPT.js";import{u as al}from"./useIntegramSession-BdcoOzGP.js";import{u as tl}from"./useGrants-uCyYFlTX.js";import{i as I}from"./integramApiClient-C3_j8SPw.js";import{I as Al}from"./IntegramBreadcrumb-DHI3pYG8.js";import"./index-B9ygI19o.js";import"./unifiedAuthService-xCuNj-Bd.js";const Ul={__name:"IntegramObjectView",setup(je,{expose:a}){a();const F=Qe(),e=Je(),h=Ye(),De=Ze(),{isAuthenticated:p}=al(),{grantOptions:Q,loading:fe,formatGrantValue:ye,getGrantSeverity:M,getGrantIcon:H,isSystemGrant:ge,getGrantWarning:_e}=tl(),T=f(F.params.typeId),W=me(()=>F.params.database||I.getDatabase()||""),ne=f(!1),be=f(null),oe=f(!1),pe=f(!1),we=f(!1),se=f(!1),V=f(!1),J=f(!1),he=f(!1),r=f(""),l=f(!1),m=f(null),X=f(!1),Y=f(!1),U=f([]),L=f(!1),g=f(null),Se=f(!1),Fe=f(!1),Z=f({name:"",baseTypeId:3,isDictionary:!1,isMultiSelect:!1}),il=[{id:3,name:"Текст (SHORT)"},{id:2,name:"Длинный текст (LONG)"},{id:13,name:"Число (NUMBER)"},{id:4,name:"Дата и время (DATETIME)"},{id:9,name:"Дата (DATE)"},{id:7,name:"Да/Нет (BOOL)"}],$=f(null),S=f(null),Ae=f(null),ae=f(null),P=f([]),ee=f([]),K=f({}),xe=f({}),Te=f(!1),nl=f("normal"),ol=[{label:"Обычный",value:"normal"},{label:"Компактный",value:"compact"},{label:"Фикс. высота",value:"fixed"},{label:"Фикс. ширина",value:"ultra"}],z=f(25),N=f(1),Ce=f(1),de=f(0),re=f(!1),Ve=f(!1),te=f(!0),sl=f(null),le=f({val:""}),ce=f({value:"",up:"",requisites:{}}),dl=me(()=>{var s;return[{label:"Таблицы",to:`/integram/${W.value}/table`,icon:"pi pi-table"},{label:((s=ae.value)==null?void 0:s.val)||"Объекты",icon:"pi pi-bars"}]}),Ue=me(()=>Object.values(le.value).some(t=>t&&t.length>0)),Ne=me(()=>Z.value.name.trim().length>0&&Z.value.baseTypeId),G=me(()=>Ue.value?ee.value.filter(t=>{if(le.value.val&&!t.val.toLowerCase().includes(le.value.val.toLowerCase()))return!1;for(const s in le.value)if(s.startsWith("req_")&&le.value[s]){const o=s.replace("req_",""),n=Re(t.id,o);if(!n||!n.toLowerCase().includes(le.value[s].toLowerCase()))return!1}return!0}):ee.value);async function B(t=1,s=!1){if(!p.value){e.replace("/integram/login");return}try{s||(ne.value=!0),be.value=null;const o={pg:t,LIMIT:z.value,...F.query};o.pg===t&&(delete o.pg,o.pg=t);const n=await I.getObjectList(T.value,o);if(Ae.value=n,ae.value=n.type,s&&re.value){const i=n.object||[];if(i.length===0)te.value=!1;else{ee.value=[...ee.value,...i];const v=n.reqs||{};K.value={...K.value,...v},i.length<z.value&&(te.value=!1)}}else ee.value=n.object||[],K.value=n.reqs||{},te.value=(n.object||[]).length>=z.value;n.current_page!==void 0&&(N.value=n.current_page),n.total_objects!==void 0?de.value=n.total_objects:(n.object||[]).length>=z.value?de.value=(n.object||[]).length*2:de.value=(n.object||[]).length,n.total_pages!==void 0?Ce.value=n.total_pages:z.value>0&&de.value>0?Ce.value=Math.ceil(de.value/z.value):(n.object||[]).length>=z.value?Ce.value=t+1:Ce.value=t,n.req_type&&n.req_order&&(P.value=n.req_order.map(i=>{var v,y,_,E,j;return{id:i,val:n.req_type[i]||`Req ${i}`,base:((v=n.req_base)==null?void 0:v[i])||"TEXT",baseId:(y=n.req_base_id)==null?void 0:y[i],refType:((_=n.ref_type)==null?void 0:_[i])||null,isMulti:((j=(E=n.req_attrs)==null?void 0:E[i])==null?void 0:j.includes(":MULTI:"))||!1}}))}catch(o){be.value=o.message,h.add({severity:"error",summary:"Ошибка",detail:"Не удалось загрузить объекты: "+o.message,life:5e3})}finally{ne.value=!1}}function Re(t,s){var o;return((o=K.value[t])==null?void 0:o[s])||""}function rl(){le.value={val:""}}function cl(){J.value=!J.value,J.value||Be()}function ul(){V.value=!V.value}function ml(){}function vl(){re.value=!re.value,re.value?(N.value=1,te.value=!0,B(1,!1),window.addEventListener("scroll",ke)):(window.removeEventListener("scroll",ke),B(N.value,!1))}function ke(){if(!re.value||Ve.value||!te.value)return;const t=200,s=window.scrollY||document.documentElement.scrollTop,o=window.innerHeight;document.documentElement.scrollHeight-s-o<t&&Me()}async function Me(){if(Ve.value||!te.value)return;Ve.value=!0;const t=N.value+1;try{await B(t,!0),N.value=t}catch(s){console.error("Failed to load more data:",s)}finally{Ve.value=!1}}function fl(){we.value=!0}function yl(t){}function gl(t){t<1||t===N.value||(N.value=t,e.push({path:F.path,query:{...F.query,pg:t}}),B(t))}function bl(){N.value=1,e.push({path:F.path,query:{...F.query,pg:1,limit:z.value}}),B(1)}async function pl(t,s,o,n,i=null){var v;if(J.value&&s!=="id")if($.value={rowId:t.id,field:s,baseType:n,req:i},i!=null&&i.refType){await Le(i.refType);const y=t.id,_=i.id,E=(v=K.value[y])==null?void 0:v[_];S.value=E||""}else n==="BOOLEAN"?S.value=o==="X":n==="DATE"||n==="DATETIME"?S.value=o?new Date(o):null:n==="NUMBER"||n==="SIGNED"?S.value=o?parseFloat(o):null:S.value=o||""}async function Le(t){if(!(!t||xe.value[t]))try{Te.value=!0;const s=await I.getObjectList(t,{LIMIT:500});xe.value[t]=(s.object||[]).map(o=>({id:o.id,val:o.val,label:o.val,value:o.id}))}catch(s){console.error("Failed to load reference options:",s),xe.value[t]=[]}finally{Te.value=!1}}function Be(){$.value=null,S.value=null}async function wl(t,s=null){if($.value)try{pe.value=!0;let o=S.value;if($.value.baseType==="BOOLEAN"?o=S.value?"X":"":$.value.baseType==="DATE"?S.value?o=new Date(S.value).toISOString().split("T")[0]:o="":$.value.baseType==="DATETIME"&&(S.value?o=new Date(S.value).toISOString():o=""),$.value.field==="val"){const n=K.value[t.id]||{};await I.saveObject(t.id,T.value,o,n);const i=ee.value.findIndex(v=>v.id===t.id);i!==-1&&(ee.value[i].val=o)}else if(s){const n={};n[s]=o,await I.setObjectRequisites(t.id,n),K.value[t.id]||(K.value[t.id]={}),K.value[t.id][s]=o}h.add({severity:"success",summary:"Успешно",detail:"Ячейка обновлена",life:2e3}),Be()}catch(o){h.add({severity:"error",summary:"Ошибка",detail:"Не удалось обновить: "+o.message,life:5e3})}finally{pe.value=!1}}function hl(t){e.push(`/integram/${W.value}/edit_obj/${t}`)}async function Cl(t){try{await I.moveObjectUp(t),h.add({severity:"success",summary:"Объект перемещён",detail:"Объект успешно перемещён вверх",life:2e3}),await B(N.value)}catch(s){h.add({severity:"error",summary:"Ошибка перемещения",detail:s.message||"Не удалось переместить объект",life:5e3})}}async function Vl(t){var s,o;g.value=t,Y.value=!0,L.value=!0,U.value=[];try{const n=await I.getReferences(t.id);if(n&&n.references)U.value=n.references.map(i=>({typeId:i.type_id||i.typeId,typeName:i.type_name||i.typeName||`Тип ${i.type_id}`,objectId:i.object_id||i.objectId,objectName:i.object_name||i.objectName||`Объект ${i.object_id}`,fieldName:i.field_name||i.fieldName||i.requisite_alias||""}));else if(Array.isArray(n))U.value=n.map(i=>({typeId:i.type_id||i.typeId||i.t,typeName:i.type_name||i.typeName||i.type||`Тип ${i.type_id||i.t}`,objectId:i.object_id||i.objectId||i.id,objectName:i.object_name||i.objectName||i.val||`Объект ${i.object_id||i.id}`,fieldName:i.field_name||i.fieldName||i.requisite_alias||""}));else if(n&&typeof n=="object"){const i=n.refs||n.data||[];Array.isArray(i)&&(U.value=i.map(v=>({typeId:v.type_id||v.typeId||v.t,typeName:v.type_name||v.typeName||`Тип ${v.type_id}`,objectId:v.object_id||v.objectId||v.id,objectName:v.object_name||v.objectName||v.val,fieldName:v.field_name||v.fieldName||""})))}}catch(n){console.warn("Failed to load references:",n),U.value=[],((s=n.message)!=null&&s.includes("404")||(o=n.message)!=null&&o.includes("не найден"))&&h.add({severity:"info",summary:"Функция недоступна",detail:"API не поддерживает получение ссылок на объект",life:3e3})}finally{L.value=!1}}function _l(t){const s=t.replace("req_",""),o=P.value.find(n=>n.id===s);return(o==null?void 0:o.val)||s}function xl(){var v;if(!G.value||G.value.length===0){h.add({severity:"warn",summary:"Нет данных",detail:"Нет данных для экспорта",life:3e3});return}const t=["ID","Значение"];P.value.forEach(y=>{t.push(y.val||`Реквизит ${y.id}`)});const s=G.value.map(y=>{const _=[y.id,y.val];return P.value.forEach(E=>{var ue;const j=((ue=y.reqs)==null?void 0:ue[E.id])||"";_.push(typeof j=="string"?j.replace(/"/g,'""'):j)}),_}),o=[t.map(y=>`"${y}"`).join(","),...s.map(y=>y.map(_=>`"${_}"`).join(","))].join(`
`),n=new Blob(["\uFEFF"+o],{type:"text/csv;charset=utf-8;"}),i=document.createElement("a");i.href=URL.createObjectURL(n),i.download=`${((v=ae.value)==null?void 0:v.val)||"export"}_${new Date().toISOString().slice(0,10)}.csv`,i.click(),h.add({severity:"success",summary:"Экспорт завершён",detail:`Экспортировано ${G.value.length} записей`,life:3e3})}function kl(){var i,v;if(!G.value||G.value.length===0){h.add({severity:"warn",summary:"Нет данных",detail:"Нет данных для экспорта",life:3e3});return}const t=[];t.push(`0:${((i=ae.value)==null?void 0:i.val)||"Значение"}:3:`),P.value.forEach(y=>{const _=y.val||`Req${y.id}`,E=y.baseId||"3",j=y.refType||"";t.push(`${y.id}:${_}:${E}:${j}`)});let s="";s+=t.join(";")+`\r
`,s+=`DATA\r
`,G.value.forEach(y=>{const _=[];_.push(`${T.value}::${Oe(y.val)}`),P.value.forEach(E=>{const j=Re(y.id,E.id);_.push(Oe(j))}),s+=_.join(";")+`\r
`});const o=new Blob([s],{type:"application/octet-stream"}),n=document.createElement("a");n.href=URL.createObjectURL(o),n.download=`${((v=ae.value)==null?void 0:v.val)||"export"}_${new Date().toISOString().slice(0,10)}.bki`,n.click(),h.add({severity:"success",summary:"Экспорт BKI завершён",detail:`Экспортировано ${G.value.length} записей`,life:3e3})}function Oe(t){if(t==null)return"";let s=String(t);return s=s.replace(/[\r\n]+/g," "),s=s.replace(/;/g,","),s}function El(){m.value&&m.value.click()}async function Il(t){var o;const s=(o=t.target.files)==null?void 0:o[0];if(s){t.target.value="";try{X.value=!0;const n=await Ke(s);await ze(n)}catch(n){h.add({severity:"error",summary:"Ошибка импорта",detail:n.message||"Не удалось импортировать BKI файл",life:5e3})}finally{X.value=!1}}}function Ke(t){return new Promise((s,o)=>{const n=new FileReader;n.onload=i=>s(i.target.result),n.onerror=()=>o(new Error("Не удалось прочитать файл")),n.readAsText(t)})}async function ze(t){const o=t.replace(/\r\n/g,`
`).replace(/\r/g,`
`).split(`
`).filter(ie=>ie.trim());if(o.length<2)throw new Error("BKI файл пуст или имеет неверный формат");const n=o.findIndex(ie=>ie.trim().toUpperCase()==="DATA");if(n===-1)throw new Error("Не найден маркер DATA в BKI файле");const i=o.slice(0,n),v=i[i.length-1],y=Ge(v),_=o.slice(n+1);if(_.length===0)throw new Error("Нет данных для импорта");const E=He(y);let j=0,ue=0;for(const ie of _)if(ie.trim())try{await We(ie,E),j++}catch(Bl){console.error("Failed to import row:",ie,Bl),ue++}await B(N.value),ue>0?h.add({severity:"warn",summary:"Импорт завершён с ошибками",detail:`Импортировано: ${j}, ошибок: ${ue}`,life:5e3}):h.add({severity:"success",summary:"Импорт BKI завершён",detail:`Импортировано ${j} записей`,life:3e3})}function Ge(t){const s=t.split(";"),o=[];for(const n of s){const i=n.split(":");i.length>=2&&o.push({id:i[0],alias:i[1],baseId:i[2]||"3",refType:i[3]||""})}return o}function He(t){const s={};for(let o=1;o<t.length;o++){const n=t[o],i=P.value.find(v=>v.val.toLowerCase()===n.alias.toLowerCase());i&&(s[o]=i.id)}return s}async function We(t,s){const o=t.split(";");if(o.length===0)return;const i=o[0].split("::"),v=i.length>1?i[1]:i[0];if(!v||!v.trim())throw new Error("Пустое значение");const y={};for(let E=1;E<o.length;E++){const j=s[E];j&&o[E]&&(y[j]=o[E])}const _=F.query.F_U||null;await I.createObject(T.value,v,y,_)}async function jl(){if(r.value!=="УДАЛИТЬ")return;const t=G.value;if(t.length===0){h.add({severity:"warn",summary:"Нет объектов",detail:"Нет объектов для удаления",life:3e3});return}l.value=!0;try{let s=0,o=0;for(const n of t)try{await I.deleteObject(n.id),s++}catch(i){console.error(`Failed to delete object ${n.id}:`,i),o++}he.value=!1,r.value="",o>0?h.add({severity:"warn",summary:"Удаление завершено с ошибками",detail:`Удалено: ${s}, ошибок: ${o}`,life:5e3}):h.add({severity:"success",summary:"Удаление завершено",detail:`Удалено ${s} объектов`,life:3e3}),await B(1)}catch(s){h.add({severity:"error",summary:"Ошибка удаления",detail:s.message||"Произошла ошибка при удалении",life:5e3})}finally{l.value=!1}}async function Dl(){var t;try{oe.value=!0;const s=F.query.F_U||null;if(((t=ae.value)==null?void 0:t.up)!=="0"&&!s){h.add({severity:"error",summary:"Ошибка",detail:"Для создания записи в подчинённой таблице откройте её из родительской записи",life:5e3});return}const o={};Object.keys(ce.value.requisites).length>0&&Object.keys(ce.value.requisites).forEach(i=>{const v=ce.value.requisites[i];if(v!=null&&v!==""){const y=P.value.find(_=>_.id===i);y&&(y.base==="BOOLEAN"?o[i]=v?"X":"":y.base==="DATE"||y.base==="DATETIME"?v instanceof Date&&(o[i]=y.base==="DATE"?v.toISOString().split("T")[0]:v.toISOString()):o[i]=v)}});const n=await I.createObject(T.value,ce.value.value,o,s);h.add({severity:"success",summary:"Успешно",detail:"Объект создан!",life:3e3}),we.value=!1,ce.value={value:"",up:"",requisites:{}},await B(),n.id&&e.push(`/integram/${W.value}/edit_obj/${n.id}`)}catch(s){h.add({severity:"error",summary:"Ошибка",detail:"Не удалось создать объект: "+s.message,life:5e3})}finally{oe.value=!1}}function Fl(t){De.require({message:`Вы уверены, что хотите удалить "${t.val}" (ID: ${t.id})?`,header:"Подтверждение удаления",icon:"pi pi-exclamation-triangle",acceptClass:"p-button-danger",accept:()=>{Xe(t.id)}})}async function Xe(t){try{await I.deleteObject(t),h.add({severity:"success",summary:"Успешно",detail:"Объект удалён!",life:3e3}),await B()}catch(s){h.add({severity:"error",summary:"Ошибка",detail:"Не удалось удалить объект: "+s.message,life:5e3})}}function Pe(){Z.value={name:"",baseTypeId:3,isDictionary:!1,isMultiSelect:!1}}function Tl(){}async function Rl(){if(Ne.value){Fe.value=!0;try{const t=Z.value.name.trim();let s=null;if(Z.value.isDictionary){const o=await I.createType(t,3,!0),n=o.obj||o.id;if(!n)throw new Error("Не удалось создать справочник");await I.createTypeReference(n),s=(await I.addRequisite(T.value,n)).id,Z.value.isMultiSelect&&s&&await I.toggleRequisiteMulti(s),h.add({severity:"success",summary:"Колонка добавлена",detail:`Создан справочник "${t}" и добавлен как колонка`,life:3e3})}else s=(await I.addRequisite(T.value,Z.value.baseTypeId)).id,s&&await I.saveRequisiteAlias(s,t),h.add({severity:"success",summary:"Колонка добавлена",detail:`Колонка "${t}" успешно добавлена`,life:3e3});Se.value=!1,Pe(),await B()}catch(t){console.error("Error adding column:",t),h.add({severity:"error",summary:"Ошибка",detail:"Не удалось добавить колонку: "+(t.message||"Неизвестная ошибка"),life:5e3})}finally{Fe.value=!1}}}$e(async()=>{if(!p.value){e.replace("/integram/login");return}const t=parseInt(F.query.pg)||1,s=parseInt(F.query.LIMIT||F.query.limit)||25;N.value=t,z.value=s,await B(t)}),el(()=>{window.removeEventListener("scroll",ke)}),ll(()=>F.params.typeId,async t=>{t&&t!==T.value&&(T.value=t,await B())});const qe={route:F,router:e,toast:h,confirm:De,isAuthenticated:p,grantOptions:Q,loadingGrants:fe,formatGrantValue:ye,getGrantSeverity:M,getGrantIcon:H,isSystemGrant:ge,getGrantWarning:_e,typeId:T,database:W,loading:ne,error:be,creating:oe,saving:pe,showCreateDialog:we,showFilters:se,showExtraControls:V,inlineEditEnabled:J,showDeleteByFilterDialog:he,deleteByFilterConfirmText:r,deletingByFilter:l,bkiFileInput:m,importingBKI:X,showReferencesDialog:Y,referencesData:U,loadingReferences:L,selectedObjectForReferences:g,showAddColumnDialog:Se,addingColumn:Fe,addColumnForm:Z,columnBaseTypes:il,editingCell:$,editingValue:S,objectsData:Ae,typeData:ae,requisites:P,objectsList:ee,requisitesData:K,referenceOptions:xe,loadingReferenceOptions:Te,compactMode:nl,compactModes:ol,rowsPerPage:z,currentPage:N,totalPages:Ce,totalObjects:de,infiniteScrollEnabled:re,loadingMore:Ve,hasMoreData:te,tableWrapperRef:sl,filters:le,createForm:ce,breadcrumbItems:dl,hasActiveFilters:Ue,isAddColumnFormValid:Ne,filteredObjects:G,loadObjects:B,getRequisiteValue:Re,clearFilters:rl,toggleInlineEdit:cl,toggleExtraControls:ul,applyCompactMode:ml,toggleInfiniteScroll:vl,handleWindowScroll:ke,loadMoreData:Me,addRecord:fl,onRowClick:yl,goToPage:gl,handleRowsPerPageChange:bl,handleCellClick:pl,loadReferenceOptions:Le,cancelEdit:Be,saveEdit:wl,editObject:hl,moveObjectUp:Cl,showReferences:Vl,getRequisiteName:_l,exportToCSV:xl,exportToBKI:kl,escapeValue:Oe,triggerBKIFileInput:El,handleBKIFileSelect:Il,readFileAsText:Ke,importBKI:ze,parseHeaderStructure:Ge,mapRequisites:He,importBKIRow:We,executeDeleteByFilter:jl,handleCreate:Dl,confirmDelete:Fl,handleDelete:Xe,resetAddColumnForm:Pe,validateAddColumnForm:Tl,executeAddColumn:Rl,ref:f,computed:me,onMounted:$e,onUnmounted:el,watch:ll,get useRoute(){return Qe},get useRouter(){return Je},get useToast(){return Ye},get useConfirm(){return Ze},get useIntegramSession(){return al},get useGrants(){return tl},get integramApiClient(){return I},IntegramBreadcrumb:Al};return Object.defineProperty(qe,"__isScriptSetup",{enumerable:!1,value:!0}),qe}},Nl={class:"integram-object-view-container"},Ml={class:"flex align-items-center justify-content-between"},Ll={class:"flex gap-2 align-items-center ml-auto"},Kl={key:0,class:"extra-controls-panel mt-2 p-2 surface-50 border-round flex gap-2 flex-wrap"},zl={key:0,class:"text-center py-5"},Gl={key:1,class:"text-center py-5"},Hl={key:2,ref:"tableWrapperRef",class:"table-wrapper"},Wl={key:0,class:"filter-panel mb-3 p-3 border-round surface-50"},Xl={class:"grid"},Pl={class:"col-12 md:col-3"},ql={class:"text-sm mb-2 block"},Ql={class:"text-color-secondary text-sm"},Jl=["onClick"],Yl=["onClick"],Zl={class:"flex align-items-center gap-2"},$l={key:1},ea={class:"flex gap-1 justify-content-end action-buttons"},la={key:1,class:"mt-3 text-center py-3"},aa={key:2,class:"mt-3 text-center text-color-secondary text-sm py-2"},ta={key:3,class:"mt-3 flex align-items-center justify-content-between flex-wrap gap-3"},ia={class:"text-color-secondary text-sm"},na={key:0},oa={class:"flex gap-2 align-items-center"},sa={class:"text-sm"},da={class:"mt-3 text-color-secondary text-sm"},ra={key:0},ca={key:1},ua={class:"flex flex-column gap-3"},ma={class:"field"},va={key:0,class:"field"},fa={class:"p-inputgroup"},ya={key:0,class:"text-green-500"},ga={key:1,class:"text-orange-500"},ba=["for"],pa={class:"flex align-items-center gap-2"},wa={class:"p-3"},ha={class:"mt-2"},Ca={key:0,class:"mb-3 p-2 surface-100 border-round"},Va={class:"text-sm text-color-secondary"},_a={key:0},xa={key:1,class:"mb-3 p-2 surface-100 border-round"},ka={key:0,class:"text-center py-4"},Ea={key:1,class:"text-center py-4"},Ia={key:2},ja={class:"text-color-secondary"},Da={class:"flex flex-column gap-3 p-2"},Fa={class:"field"},Ta={class:"field"},Ra={class:"field flex align-items-center gap-2"},Ba={key:0,class:"field flex align-items-center gap-2 ml-4"};function Oa(je,a,F,e,h,De){var J,he;const p=D("Button"),Q=D("Dropdown"),fe=D("ProgressSpinner"),ye=D("Message"),M=D("InputText"),H=D("Column"),ge=D("router-link"),_e=D("InputNumber"),T=D("Checkbox"),W=D("Calendar"),ne=D("Textarea"),be=D("Badge"),oe=D("DataTable"),pe=D("Card"),we=D("Divider"),se=D("Dialog"),V=Sl("tooltip");return u(),b("div",Nl,[c(e.IntegramBreadcrumb,{items:e.breadcrumbItems},null,8,["items"]),c(pe,null,{title:w(()=>{var r;return[d("div",Ml,[d("span",null,C(((r=e.typeData)==null?void 0:r.val)||"Загрузка..."),1),d("div",Ll,[k(c(p,{icon:"pi pi-plus",label:"Добавить",size:"small",onClick:e.addRecord,disabled:e.loading},null,8,["disabled"]),[[V,"Добавить запись в таблицу",void 0,{bottom:!0}]]),k(c(p,{icon:"pi pi-filter",size:"small",outlined:"",onClick:a[0]||(a[0]=l=>e.showFilters=!e.showFilters)},null,512),[[V,"Показать/скрыть фильтры",void 0,{bottom:!0}]]),e.hasActiveFilters?k((u(),x(p,{key:0,icon:"pi pi-filter-slash",size:"small",outlined:"",onClick:e.clearFilters},null,512)),[[V,"Очистить фильтры",void 0,{bottom:!0}]]):R("",!0),k(c(p,{icon:"pi pi-refresh",size:"small",outlined:"",onClick:e.loadObjects,loading:e.loading},null,8,["loading"]),[[V,"Обновить",void 0,{bottom:!0}]]),k(c(p,{icon:"pi pi-pencil",size:"small",outlined:"",onClick:e.toggleInlineEdit,class:q({"button-on":e.inlineEditEnabled})},null,8,["class"]),[[V,"Редактировать ячейки",void 0,{bottom:!0}]]),c(Q,{modelValue:e.compactMode,"onUpdate:modelValue":a[1]||(a[1]=l=>e.compactMode=l),options:e.compactModes,optionLabel:"label",optionValue:"value",placeholder:"Режим",size:"small",onChange:e.applyCompactMode},null,8,["modelValue"]),k(c(p,{icon:e.infiniteScrollEnabled?"pi pi-arrows-v":"pi pi-list",size:"small",outlined:!e.infiniteScrollEnabled,onClick:e.toggleInfiniteScroll,class:q({"button-on":e.infiniteScrollEnabled})},null,8,["icon","outlined","class"]),[[V,e.infiniteScrollEnabled?"Infinite Scroll (вкл)":"Обычная пагинация",void 0,{bottom:!0}]]),k(c(p,{icon:"pi pi-ellipsis-h",size:"small",text:"",onClick:e.toggleExtraControls},null,512),[[V,"Ещё",void 0,{bottom:!0}]])])]),e.showExtraControls?(u(),b("div",Kl,[k(c(p,{label:"Скачать CSV",icon:"pi pi-file-export",size:"small",outlined:"",onClick:e.exportToCSV},null,512),[[V,"Скачать данные в формате CSV",void 0,{bottom:!0}]]),k(c(p,{label:"Экспорт BKI",icon:"pi pi-download",size:"small",outlined:"",onClick:e.exportToBKI},null,512),[[V,"Экспортировать в BKI формат",void 0,{bottom:!0}]]),k(c(p,{label:"Импорт BKI",icon:"pi pi-upload",size:"small",outlined:"",onClick:e.triggerBKIFileInput},null,512),[[V,"Импортировать из BKI файла",void 0,{bottom:!0}]]),d("input",{ref:"bkiFileInput",type:"file",accept:".bki",style:{display:"none"},onChange:e.handleBKIFileSelect},null,544),k(c(p,{label:"Удалить по фильтру",icon:"pi pi-trash",size:"small",outlined:"",severity:"danger",onClick:a[2]||(a[2]=l=>e.showDeleteByFilterDialog=!0),disabled:e.filteredObjects.length===0},null,8,["disabled"]),[[V,"Удалить все записи, соответствующие текущему фильтру",void 0,{bottom:!0}]]),k(c(p,{label:"Добавить колонку",icon:"pi pi-plus-circle",size:"small",outlined:"",onClick:a[3]||(a[3]=l=>e.showAddColumnDialog=!0)},null,512),[[V,"Добавить новую колонку в таблицу",void 0,{bottom:!0}]])])):R("",!0)]}),content:w(()=>[e.loading&&!e.objectsData?(u(),b("div",zl,[c(fe)])):e.error?(u(),b("div",Gl,[c(ye,{severity:"error",closable:!1},{default:w(()=>[O(C(e.error),1)]),_:1})])):e.objectsData?(u(),b("div",Hl,[e.showFilters&&e.requisites.length>0?(u(),b("div",Wl,[d("div",Xl,[d("div",Pl,[a[32]||(a[32]=d("label",{class:"text-sm mb-2 block"},"Значение",-1)),c(M,{modelValue:e.filters.val,"onUpdate:modelValue":a[4]||(a[4]=r=>e.filters.val=r),placeholder:"Фильтр по значению",class:"w-full",size:"small"},null,8,["modelValue"])]),(u(!0),b(ve,null,Ee(e.requisites,r=>(u(),b("div",{key:r.id,class:"col-12 md:col-3"},[d("label",ql,C(r.val),1),c(M,{modelValue:e.filters[`req_${r.id}`],"onUpdate:modelValue":l=>e.filters[`req_${r.id}`]=l,placeholder:`Filter by ${r.val}`,class:"w-full",size:"small"},null,8,["modelValue","onUpdate:modelValue","placeholder"])]))),128))])])):R("",!0),c(oe,{value:e.filteredObjects,paginator:!1,sortMode:"multiple",removableSort:"",stripedRows:"",class:q(["integram-table",`mode-${e.compactMode}`]),tableStyle:"min-width: 50rem",onRowClick:e.onRowClick},{empty:w(()=>[...a[33]||(a[33]=[d("div",{class:"text-center py-4"},[d("i",{class:"pi pi-inbox text-4xl text-color-secondary mb-2"}),d("p",{class:"text-color-secondary"},"Объекты не найдены")],-1)])]),default:w(()=>{var r;return[c(H,{field:"ord",header:"N",style:{width:"60px","text-align":"center"},headerStyle:"text-align: center",sortable:""},{body:w(l=>[d("span",Ql,C(l.index+1),1)]),_:1}),c(H,{field:"val",header:((r=e.typeData)==null?void 0:r.val)||"Value",sortable:"",style:{"min-width":"200px"}},{body:w(l=>{var m,X,Y,U;return[d("div",{class:q({"editable-cell":e.inlineEditEnabled,editing:((m=e.editingCell)==null?void 0:m.rowId)===l.data.id&&((X=e.editingCell)==null?void 0:X.field)==="val"}),onClick:L=>e.handleCellClick(l.data,"val",l.data.val,"TEXT")},[((Y=e.editingCell)==null?void 0:Y.rowId)===l.data.id&&((U=e.editingCell)==null?void 0:U.field)==="val"?(u(),x(M,{key:0,modelValue:e.editingValue,"onUpdate:modelValue":a[5]||(a[5]=L=>e.editingValue=L),class:"inline-edit w-full",onBlur:L=>e.saveEdit(l.data),onKeydown:[A(L=>e.saveEdit(l.data),["enter"]),A(e.cancelEdit,["esc"])],autofocus:""},null,8,["modelValue","onBlur","onKeydown"])):(u(),x(ge,{key:1,to:`/integram/${e.database}/edit_obj/${l.data.id}`,class:"value-link"},{default:w(()=>[O(C(l.data.val),1)]),_:2},1032,["to"]))],10,Jl)]}),_:1},8,["header"]),(u(!0),b(ve,null,Ee(e.requisites,l=>(u(),x(H,{key:l.id,field:`req_${l.id}`,header:l.val,sortable:""},{body:w(m=>{var X,Y,U,L;return[d("div",{class:q({"editable-cell":e.inlineEditEnabled,editing:((X=e.editingCell)==null?void 0:X.rowId)===m.data.id&&((Y=e.editingCell)==null?void 0:Y.field)===`req_${l.id}`,"cell-dir":l.refType}),onClick:g=>e.handleCellClick(m.data,`req_${l.id}`,e.getRequisiteValue(m.data.id,l.id),l.base||"TEXT",l)},[((U=e.editingCell)==null?void 0:U.rowId)===m.data.id&&((L=e.editingCell)==null?void 0:L.field)===`req_${l.id}`?(u(),b(ve,{key:0},[l.base==="GRANT"||l.baseId===5?(u(),x(Q,{key:0,modelValue:e.editingValue,"onUpdate:modelValue":a[6]||(a[6]=g=>e.editingValue=g),options:e.grantOptions,optionLabel:"label",optionValue:"value",placeholder:"Select grant...",class:"inline-edit w-full",loading:e.loadingGrants,onChange:g=>e.saveEdit(m.data,l.id),onKeydown:A(e.cancelEdit,["esc"]),filter:"",showClear:"",autofocus:""},{option:w(g=>[d("div",Zl,[d("i",{class:q(g.option.icon)},null,2),d("span",null,C(g.option.label),1)])]),_:2},1032,["modelValue","options","loading","onChange"])):l.refType?(u(),x(Q,{key:1,modelValue:e.editingValue,"onUpdate:modelValue":a[7]||(a[7]=g=>e.editingValue=g),options:e.referenceOptions[l.refType]||[],optionLabel:"val",optionValue:"id",placeholder:"Select...",class:"inline-edit w-full",loading:e.loadingReferenceOptions,onChange:g=>e.saveEdit(m.data,l.id),onKeydown:A(e.cancelEdit,["esc"]),filter:"",showClear:"",autofocus:""},null,8,["modelValue","options","loading","onChange"])):l.base==="NUMBER"||l.base==="SIGNED"?(u(),x(_e,{key:2,modelValue:e.editingValue,"onUpdate:modelValue":a[8]||(a[8]=g=>e.editingValue=g),class:"inline-edit w-full",onBlur:g=>e.saveEdit(m.data,l.id),onKeydown:[A(g=>e.saveEdit(m.data,l.id),["enter"]),A(e.cancelEdit,["esc"])],autofocus:""},null,8,["modelValue","onBlur","onKeydown"])):l.base==="BOOLEAN"?(u(),x(T,{key:3,modelValue:e.editingValue,"onUpdate:modelValue":a[9]||(a[9]=g=>e.editingValue=g),binary:"",onChange:g=>e.saveEdit(m.data,l.id)},null,8,["modelValue","onChange"])):l.base==="DATE"?(u(),x(W,{key:4,modelValue:e.editingValue,"onUpdate:modelValue":a[10]||(a[10]=g=>e.editingValue=g),dateFormat:"yy-mm-dd",class:"inline-edit w-full",onBlur:g=>e.saveEdit(m.data,l.id),onKeydown:[A(g=>e.saveEdit(m.data,l.id),["enter"]),A(e.cancelEdit,["esc"])],autofocus:""},null,8,["modelValue","onBlur","onKeydown"])):l.base==="DATETIME"?(u(),x(W,{key:5,modelValue:e.editingValue,"onUpdate:modelValue":a[11]||(a[11]=g=>e.editingValue=g),showTime:"",dateFormat:"yy-mm-dd",class:"inline-edit w-full",onBlur:g=>e.saveEdit(m.data,l.id),onKeydown:[A(g=>e.saveEdit(m.data,l.id),["enter"]),A(e.cancelEdit,["esc"])],autofocus:""},null,8,["modelValue","onBlur","onKeydown"])):l.base==="MEMO"?(u(),x(ne,{key:6,modelValue:e.editingValue,"onUpdate:modelValue":a[12]||(a[12]=g=>e.editingValue=g),class:"inline-edit w-full",rows:"3",onBlur:g=>e.saveEdit(m.data,l.id),onKeydown:A(e.cancelEdit,["esc"]),autofocus:""},null,8,["modelValue","onBlur"])):(u(),x(M,{key:7,modelValue:e.editingValue,"onUpdate:modelValue":a[13]||(a[13]=g=>e.editingValue=g),class:"inline-edit w-full",onBlur:g=>e.saveEdit(m.data,l.id),onKeydown:[A(g=>e.saveEdit(m.data,l.id),["enter"]),A(e.cancelEdit,["esc"])],autofocus:""},null,8,["modelValue","onBlur","onKeydown"]))],64)):(u(),b(ve,{key:1},[l.base==="GRANT"||l.baseId===5?k((u(),x(be,{key:0,value:e.formatGrantValue(e.getRequisiteValue(m.data.id,l.id)),severity:e.getGrantSeverity(e.getRequisiteValue(m.data.id,l.id))},{default:w(()=>[d("i",{class:q([e.getGrantIcon(e.getRequisiteValue(m.data.id,l.id)),"mr-1"])},null,2),O(" "+C(e.formatGrantValue(e.getRequisiteValue(m.data.id,l.id))),1)]),_:2},1032,["value","severity"])),[[V,e.getGrantWarning(e.getRequisiteValue(m.data.id,l.id)),void 0,{top:!0}]]):l.base==="BOOLEAN"?(u(),b("span",$l,C(e.getRequisiteValue(m.data.id,l.id)==="X"?"✓":""),1)):(u(),b("span",{key:2,class:q({dir:l.refType})},C(e.getRequisiteValue(m.data.id,l.id)),3))],64))],10,Yl)]}),_:2},1032,["field","header"]))),128)),c(H,{header:"",style:{width:"160px"}},{body:w(l=>[d("div",ea,[k(c(p,{icon:"pi pi-arrow-up",text:"",rounded:"",size:"small",severity:"secondary",onClick:Ie(m=>e.moveObjectUp(l.data.id),["stop"])},null,8,["onClick"]),[[V,"Переместить вверх",void 0,{bottom:!0}]]),k(c(p,{icon:"pi pi-link",text:"",rounded:"",size:"small",severity:"secondary",onClick:Ie(m=>e.showReferences(l.data),["stop"])},null,8,["onClick"]),[[V,"Показать ссылки",void 0,{bottom:!0}]]),k(c(p,{icon:"pi pi-pencil",text:"",rounded:"",size:"small",onClick:Ie(m=>e.editObject(l.data.id),["stop"])},null,8,["onClick"]),[[V,"Редактировать",void 0,{bottom:!0}]]),k(c(p,{icon:"pi pi-trash",text:"",rounded:"",size:"small",severity:"danger",onClick:Ie(m=>e.confirmDelete(l.data),["stop"])},null,8,["onClick"]),[[V,"Удалить",void 0,{bottom:!0}]])])]),_:1})]}),_:1},8,["value","class"]),e.infiniteScrollEnabled&&e.loadingMore?(u(),b("div",la,[c(fe,{style:{width:"30px",height:"30px"}}),a[34]||(a[34]=d("span",{class:"ml-2 text-color-secondary"},"Загрузка...",-1))])):R("",!0),e.infiniteScrollEnabled&&!e.hasMoreData&&e.objectsList.length>0?(u(),b("div",aa,[a[35]||(a[35]=d("i",{class:"pi pi-check-circle mr-2"},null,-1)),O("Все данные загружены ("+C(e.objectsList.length)+" записей) ",1)])):R("",!0),!e.infiniteScrollEnabled&&(e.totalPages>1||e.objectsList.length>=e.rowsPerPage)?(u(),b("div",ta,[d("div",ia,[O(" Страница "+C(e.currentPage)+" из "+C(e.totalPages)+" ",1),e.totalObjects?(u(),b("span",na," ("+C(e.totalObjects)+" объектов) ",1)):R("",!0)]),d("div",oa,[k(c(p,{icon:"pi pi-angle-left",size:"small",outlined:"",disabled:e.currentPage===1,onClick:a[14]||(a[14]=r=>e.goToPage(e.currentPage-1))},null,8,["disabled"]),[[V,"Предыдущая",void 0,{bottom:!0}]]),d("span",sa,C(e.currentPage),1),k(c(p,{icon:"pi pi-angle-right",size:"small",outlined:"",disabled:e.currentPage>=e.totalPages||e.objectsList.length<e.rowsPerPage,onClick:a[15]||(a[15]=r=>e.goToPage(e.currentPage+1))},null,8,["disabled"]),[[V,"Следующая",void 0,{bottom:!0}]]),c(Q,{modelValue:e.rowsPerPage,"onUpdate:modelValue":a[16]||(a[16]=r=>e.rowsPerPage=r),options:[10,20,25,50,100],onChange:e.handleRowsPerPageChange,size:"small",class:"w-auto"},null,8,["modelValue"])])])):R("",!0),d("div",da,[O(" Показано "+C(e.filteredObjects.length)+" объектов ",1),e.infiniteScrollEnabled?(u(),b("span",ra," (infinite scroll)")):R("",!0),e.hasActiveFilters?(u(),b("span",ca," (фильтры применены) ")):R("",!0)])],512)):R("",!0)]),_:1}),c(se,{visible:e.showCreateDialog,"onUpdate:visible":a[19]||(a[19]=r=>e.showCreateDialog=r),modal:"",header:"Создать: "+(((J=e.typeData)==null?void 0:J.val)||"Объект"),style:{width:"50rem"},breakpoints:{"960px":"75vw","640px":"95vw"}},{footer:w(()=>{var r;return[c(p,{label:"Отмена",text:"",onClick:a[18]||(a[18]=l=>e.showCreateDialog=!1)}),c(p,{label:"Создать",loading:e.creating,onClick:e.handleCreate,disabled:!e.createForm.value||((r=e.typeData)==null?void 0:r.up)!=="0"&&!e.route.query.F_U},null,8,["loading","disabled"])]}),default:w(()=>{var r;return[d("div",ua,[d("div",ma,[a[36]||(a[36]=d("label",{for:"objectValue"},"Значение *",-1)),c(M,{id:"objectValue",modelValue:e.createForm.value,"onUpdate:modelValue":a[17]||(a[17]=l=>e.createForm.value=l),placeholder:"Введите значение",class:"w-full"},null,8,["modelValue"])]),((r=e.typeData)==null?void 0:r.up)!=="0"?(u(),b("div",va,[a[40]||(a[40]=d("label",null,"Родитель",-1)),d("div",fa,[a[37]||(a[37]=d("span",{class:"p-inputgroup-addon"},[d("i",{class:"pi pi-link"})],-1)),c(M,{value:e.route.query.F_U||"Не указан",disabled:"",class:"w-full"},null,8,["value"])]),e.route.query.F_U?(u(),b("small",ya,[...a[38]||(a[38]=[d("i",{class:"pi pi-check"},null,-1),O(" Родитель определён автоматически из контекста ",-1)])])):(u(),b("small",ga,[...a[39]||(a[39]=[d("i",{class:"pi pi-exclamation-triangle"},null,-1),O(" Откройте таблицу из родительской записи для создания подчинённых объектов ",-1)])]))])):R("",!0),e.requisites.length>0?(u(),x(we,{key:1})):R("",!0),(u(!0),b(ve,null,Ee(e.requisites,l=>(u(),b("div",{key:l.id,class:"field"},[d("label",{for:"req_"+l.id},C(l.val),9,ba),l.base==="GRANT"||l.baseId===5?(u(),x(Q,{key:0,id:"req_"+l.id,modelValue:e.createForm.requisites[l.id],"onUpdate:modelValue":m=>e.createForm.requisites[l.id]=m,options:e.grantOptions,optionLabel:"label",optionValue:"value",placeholder:"Выберите "+l.val,class:"w-full",loading:e.loadingGrants,filter:"",showClear:""},{option:w(m=>[d("div",pa,[d("i",{class:q(m.option.icon)},null,2),d("span",null,C(m.option.label),1)])]),_:1},8,["id","modelValue","onUpdate:modelValue","options","placeholder","loading"])):l.base==="NUMBER"||l.base==="SIGNED"?(u(),x(_e,{key:1,id:"req_"+l.id,modelValue:e.createForm.requisites[l.id],"onUpdate:modelValue":m=>e.createForm.requisites[l.id]=m,placeholder:"Введите "+l.val,class:"w-full"},null,8,["id","modelValue","onUpdate:modelValue","placeholder"])):l.base==="BOOLEAN"?(u(),x(T,{key:2,id:"req_"+l.id,modelValue:e.createForm.requisites[l.id],"onUpdate:modelValue":m=>e.createForm.requisites[l.id]=m,binary:""},null,8,["id","modelValue","onUpdate:modelValue"])):l.base==="DATE"?(u(),x(W,{key:3,id:"req_"+l.id,modelValue:e.createForm.requisites[l.id],"onUpdate:modelValue":m=>e.createForm.requisites[l.id]=m,dateFormat:"yy-mm-dd",class:"w-full"},null,8,["id","modelValue","onUpdate:modelValue"])):l.base==="DATETIME"?(u(),x(W,{key:4,id:"req_"+l.id,modelValue:e.createForm.requisites[l.id],"onUpdate:modelValue":m=>e.createForm.requisites[l.id]=m,showTime:"",dateFormat:"yy-mm-dd",class:"w-full"},null,8,["id","modelValue","onUpdate:modelValue"])):l.base==="MEMO"?(u(),x(ne,{key:5,id:"req_"+l.id,modelValue:e.createForm.requisites[l.id],"onUpdate:modelValue":m=>e.createForm.requisites[l.id]=m,placeholder:"Введите "+l.val,class:"w-full",rows:"3"},null,8,["id","modelValue","onUpdate:modelValue","placeholder"])):(u(),x(M,{key:6,id:"req_"+l.id,modelValue:e.createForm.requisites[l.id],"onUpdate:modelValue":m=>e.createForm.requisites[l.id]=m,placeholder:"Введите "+l.val,class:"w-full"},null,8,["id","modelValue","onUpdate:modelValue","placeholder"]))]))),128))])]}),_:1},8,["visible","header"]),c(se,{visible:e.showDeleteByFilterDialog,"onUpdate:visible":a[22]||(a[22]=r=>e.showDeleteByFilterDialog=r),header:"Удаление по фильтру",style:{width:"450px"},modal:!0,onHide:a[23]||(a[23]=r=>e.deleteByFilterConfirmText="")},{footer:w(()=>[c(p,{label:"Отмена",icon:"pi pi-times",onClick:a[21]||(a[21]=r=>e.showDeleteByFilterDialog=!1),text:""}),c(p,{label:"Удалить",icon:"pi pi-trash",severity:"danger",onClick:e.executeDeleteByFilter,disabled:e.deleteByFilterConfirmText!=="УДАЛИТЬ",loading:e.deletingByFilter},null,8,["disabled","loading"])]),default:w(()=>[d("div",wa,[c(ye,{severity:"warn",closable:!1,class:"mb-3"},{default:w(()=>[a[42]||(a[42]=d("p",{class:"font-bold mb-2"},"⚠️ Внимание!",-1)),a[43]||(a[43]=d("p",null,"Будут удалены все записи, соответствующие текущему фильтру.",-1)),d("p",ha,[a[41]||(a[41]=O("Количество записей для удаления: ",-1)),d("strong",null,C(e.filteredObjects.length),1)])]),_:1}),e.hasActiveFilters?(u(),b("div",Ca,[a[44]||(a[44]=d("p",{class:"text-sm font-medium mb-1"},"Активные фильтры:",-1)),d("p",Va,[e.filters.val?(u(),b("span",_a,'Значение: "'+C(e.filters.val)+'"',1)):R("",!0),je.key.startsWith("req_")&&je.value?(u(!0),b(ve,{key:1},Ee(e.filters,(r,l)=>(u(),b("span",{key:l}," , "+C(e.getRequisiteName(l))+': "'+C(r)+'" ',1))),128)):R("",!0)])])):(u(),b("div",xa,[...a[45]||(a[45]=[d("p",{class:"text-sm text-orange-500 font-bold"},"⚠️ Фильтры не активны - будут удалены ВСЕ записи!",-1)])])),a[46]||(a[46]=d("p",{class:"mb-2"},[O("Для подтверждения введите "),d("strong",null,"УДАЛИТЬ"),O(":")],-1)),c(M,{modelValue:e.deleteByFilterConfirmText,"onUpdate:modelValue":a[20]||(a[20]=r=>e.deleteByFilterConfirmText=r),placeholder:"Введите УДАЛИТЬ",class:"w-full"},null,8,["modelValue"])])]),_:1},8,["visible"]),c(se,{visible:e.showReferencesDialog,"onUpdate:visible":a[25]||(a[25]=r=>e.showReferencesDialog=r),header:"Ссылки на: "+(((he=e.selectedObjectForReferences)==null?void 0:he.val)||""),style:{width:"600px"},modal:!0},{footer:w(()=>[c(p,{label:"Закрыть",icon:"pi pi-times",onClick:a[24]||(a[24]=r=>e.showReferencesDialog=!1),text:""})]),default:w(()=>[e.loadingReferences?(u(),b("div",ka,[c(fe,{style:{width:"50px",height:"50px"}}),a[47]||(a[47]=d("p",{class:"mt-2 text-color-secondary"},"Загрузка ссылок...",-1))])):e.referencesData.length===0?(u(),b("div",Ea,[...a[48]||(a[48]=[d("i",{class:"pi pi-check-circle text-4xl text-green-500 mb-3"},null,-1),d("p",{class:"text-color-secondary"},"На этот объект нет ссылок",-1),d("p",{class:"text-sm text-color-secondary"},"Объект можно безопасно удалить",-1)])])):(u(),b("div",Ia,[c(ye,{severity:"info",closable:!1,class:"mb-3"},{default:w(()=>[O(" Найдено "+C(e.referencesData.length)+" ссылок на этот объект ",1)]),_:1}),c(oe,{value:e.referencesData,paginator:e.referencesData.length>10,rows:10,class:"p-datatable-sm"},{default:w(()=>[c(H,{field:"typeName",header:"Таблица",style:{width:"40%"}},{body:w(r=>[c(ge,{to:`/integram/${e.database}/object/${r.data.typeId}`,class:"text-primary"},{default:w(()=>[O(C(r.data.typeName),1)]),_:2},1032,["to"])]),_:1}),c(H,{field:"objectName",header:"Объект",style:{width:"40%"}},{body:w(r=>[c(ge,{to:`/integram/${e.database}/edit_obj/${r.data.objectId}`,class:"text-primary"},{default:w(()=>[O(C(r.data.objectName),1)]),_:2},1032,["to"])]),_:1}),c(H,{field:"fieldName",header:"Поле",style:{width:"20%"}},{body:w(r=>[d("span",ja,C(r.data.fieldName),1)]),_:1})]),_:1},8,["value","paginator"])]))]),_:1},8,["visible","header"]),c(se,{visible:e.showAddColumnDialog,"onUpdate:visible":a[31]||(a[31]=r=>e.showAddColumnDialog=r),header:"Добавить колонку",style:{width:"450px"},modal:!0,onHide:e.resetAddColumnForm},{footer:w(()=>[c(p,{label:"Отмена",icon:"pi pi-times",onClick:a[30]||(a[30]=r=>e.showAddColumnDialog=!1),text:""}),c(p,{label:"Добавить",icon:"pi pi-plus",onClick:e.executeAddColumn,disabled:!e.isAddColumnFormValid,loading:e.addingColumn},null,8,["disabled","loading"])]),default:w(()=>[d("div",Da,[d("div",Fa,[a[49]||(a[49]=d("label",{class:"font-semibold mb-2 block"},"Название колонки",-1)),c(M,{modelValue:e.addColumnForm.name,"onUpdate:modelValue":a[26]||(a[26]=r=>e.addColumnForm.name=r),placeholder:"Введите название",class:"w-full",onKeyup:e.validateAddColumnForm},null,8,["modelValue"])]),d("div",Ta,[a[50]||(a[50]=d("label",{class:"font-semibold mb-2 block"},"Тип данных",-1)),c(Q,{modelValue:e.addColumnForm.baseTypeId,"onUpdate:modelValue":a[27]||(a[27]=r=>e.addColumnForm.baseTypeId=r),options:e.columnBaseTypes,optionLabel:"name",optionValue:"id",placeholder:"Выберите тип",class:"w-full",onChange:e.validateAddColumnForm},null,8,["modelValue"])]),d("div",Ra,[c(T,{modelValue:e.addColumnForm.isDictionary,"onUpdate:modelValue":a[28]||(a[28]=r=>e.addColumnForm.isDictionary=r),binary:!0,inputId:"isDictionary"},null,8,["modelValue"]),a[51]||(a[51]=d("label",{for:"isDictionary",class:"cursor-pointer"}," Справочник (создать отдельную таблицу для значений) ",-1))]),e.addColumnForm.isDictionary?(u(),b("div",Ba,[c(T,{modelValue:e.addColumnForm.isMultiSelect,"onUpdate:modelValue":a[29]||(a[29]=r=>e.addColumnForm.isMultiSelect=r),binary:!0,inputId:"isMultiSelect"},null,8,["modelValue"]),a[52]||(a[52]=d("label",{for:"isMultiSelect",class:"cursor-pointer"}," Мульти-выбор (можно выбрать несколько значений) ",-1))])):R("",!0)])]),_:1},8,["visible"])])}const za=Ol(Ul,[["render",Oa],["__scopeId","data-v-4d51704a"],["__file","/home/hive/integram-standalone/src/views/pages/Integram/IntegramObjectView.vue"]]);export{za as default};
