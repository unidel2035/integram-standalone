import{_ as Ne,y as x,u as Fe,c as b,o as c,a as l,e as at,F as Ce,r as xe,g as te,A as i,h as X,b as E,j as Z,w as R,t as k,C as Se,f as ee,d as N,I as Y,J as Ie,O as Qe,X as Xe,U as Je,P as Ze,D as Me,E as De,K as $e,L as et}from"./index-B4X-KBPT.js";import{u as tt}from"./useIntegramSession-BdcoOzGP.js";import{i as O}from"./integramApiClient-C3_j8SPw.js";import{I as gt}from"./IntegramBreadcrumb-DHI3pYG8.js";import"./index-B9ygI19o.js";import"./unifiedAuthService-xCuNj-Bd.js";const Tt={__name:"IntegramSchemaLegacy",props:{typesData:{type:Array,default:()=>[]}},emits:["open-table","edit-type"],setup(fe,{expose:t,emit:re}){t();const e=fe,$=re,v=N(null),V=N(null),S=N({}),A=N({}),_=N(""),T=N(new Set),C=N(null),o=N([]),g=N(!1),r=Y(()=>{const u=new Map;return e.typesData.forEach(y=>{u.set(String(y.id),y)}),u}),L=Y(()=>{let u=e.typesData||[];if(_.value){const y=_.value.toLowerCase();u=u.filter(I=>{var U,J;return((U=I.name)==null?void 0:U.toLowerCase().includes(y))||((J=I.requisites)==null?void 0:J.some(F=>{var j;return(j=F.name)==null?void 0:j.toLowerCase().includes(y)}))})}return u.sort((y,I)=>{var F,j;const U=(F=y.requisites)!=null&&F.some(M=>M.isReference)?1:0,J=(j=I.requisites)!=null&&j.some(M=>M.isReference)?1:0;return U!==J?J-U:(y.name||"").localeCompare(I.name||"")})}),B=Y(()=>e.typesData.reduce((u,y)=>{var I;return u+(((I=y.requisites)==null?void 0:I.filter(U=>U.isReference).length)||0)},0));function ue(u,y){y&&(S.value[u]=y)}function me(u,y){y&&(A.value[u]=y)}function _e(u){T.value.has(u)?T.value.delete(u):T.value.add(u),T.value=new Set(T.value)}function z(){}function w(){_.value=""}function be(u){return u.isReferenceTable?"pi pi-book":u.isService?"pi pi-cog":"pi pi-table"}function ae(u){const y=u==null?void 0:u.toLowerCase();return{short:"type-string",chars:"type-string",number:"type-number",signed:"type-number",date:"type-date",datetime:"type-date",boolean:"type-bool",memo:"type-text",reference:"type-ref"}[y]||"type-other"}function a(u){const y=u==null?void 0:u.toLowerCase();return{short:"str",chars:"txt",number:"int",signed:"dec",date:"dt",datetime:"dt",boolean:"bool",memo:"memo",reference:"ref"}[y]||(u==null?void 0:u.slice(0,3))||"?"}function n(u,y,I,U){const J=I>u,F=Math.abs(I-u),j=Math.abs(U-y),M=Math.max(50,Math.min(F/3,150));let oe,le="right";if(J){const de=u+M,K=y,ce=I-M;oe=`M ${u} ${y} C ${de} ${K}, ${ce} ${U}, ${I} ${U}`}else{le="left";const de=Math.max(40,j/4);if(Math.abs(j)<50){const K=u+M,ce=y-de,ie=I-M,pe=U+de;oe=`M ${u} ${y} C ${K} ${ce}, ${ie} ${pe}, ${I} ${U}`}else{const K=u+M,ce=y,ie=I-M;oe=`M ${u} ${y} C ${K} ${ce}, ${ie} ${U}, ${I} ${U}`}}return{path:oe,direction:le}}function m(u,y){if(!y.refTypeId)return;const I=y.refTypeId;C.value=I;const U=A.value[y.id]||S.value[u],J=S.value[I];if(!U||!J||!v.value){console.log("Cannot draw line: missing elements",{sourceEl:!!U,targetEl:!!J});return}const F=v.value.getBoundingClientRect(),j=U.getBoundingClientRect(),M=J.getBoundingClientRect(),oe=v.value.scrollTop||0,le=v.value.scrollLeft||0,de=j.right-F.left+le+5,K=j.top+j.height/2-F.top+oe,ce=M.left+M.width/2>j.right;let ie,pe;ce?(ie=M.left-F.left+le-5,pe=M.top+M.height/2-F.top+oe):(ie=M.right-F.left+le+5,pe=M.top+M.height/2-F.top+oe);const{path:Te,direction:ve}=n(de,K,ie,pe);o.value=[{id:`${u}-${y.id}-${I}`,x1:de,y1:K,x2:ie,y2:pe,path:Te,direction:ve,animated:!0}]}function q(){g.value||(C.value=null,o.value=[])}function se(){g.value=!g.value,g.value?ne():(o.value=[],C.value=null)}async function ne(){var J;await Xe();const u=[],y=(J=v.value)==null?void 0:J.getBoundingClientRect();if(!y)return;const I=v.value.scrollTop||0,U=v.value.scrollLeft||0;e.typesData.forEach(F=>{var oe;const j=S.value[F.id];if(!j)return;const M=j.getBoundingClientRect();(oe=F.requisites)==null||oe.forEach(le=>{if(!le.isReference||!le.refTypeId)return;const de=S.value[le.refTypeId];if(!de)return;const K=de.getBoundingClientRect(),ce=M.right-y.left+U+5,ie=M.top+M.height/2-y.top+I,pe=K.left+K.width/2>M.right;let Te,ve;pe?(Te=K.left-y.left+U-5,ve=K.top+K.height/2-y.top+I):(Te=K.right-y.left+U+5,ve=K.top+K.height/2-y.top+I);const{path:Ue,direction:Ve}=n(ce,ie,Te,ve);u.push({id:`${F.id}-${le.id}-${le.refTypeId}`,x1:ce,y1:ie,x2:Te,y2:ve,path:Ue,direction:Ve,animated:!1})})}),o.value=u}function Re(){e.typesData.forEach(u=>{var y;((y=u.requisites)==null?void 0:y.length)>0&&T.value.add(u.id)}),T.value=new Set(T.value),g.value&&ne()}function we(){T.value.clear(),T.value=new Set(T.value),g.value&&ne()}function Q(u){const y=S.value[u];y&&(y.scrollIntoView({behavior:"smooth",block:"center"}),C.value=u,T.value.has(u)||(T.value.add(u),T.value=new Set(T.value)),setTimeout(()=>{C.value=null},2e3))}function G(){g.value&&ne()}Ie(()=>{e.typesData.slice(0,3).forEach(y=>{var I;((I=y.requisites)==null?void 0:I.length)>0&&T.value.add(y.id)}),v.value&&v.value.addEventListener("scroll",G,{passive:!0});const u=new ResizeObserver(()=>{G()});v.value&&u.observe(v.value)}),Qe(()=>{v.value&&v.value.removeEventListener("scroll",G)});const ge={props:e,emit:$,containerRef:v,svgRef:V,typeRefs:S,reqRefs:A,searchQuery:_,expandedTypes:T,highlightedTypeId:C,visibleLines:o,showAllConnections:g,typeMap:r,filteredTypes:L,totalReferences:B,setTypeRef:ue,setReqRef:me,toggleExpand:_e,filterTypes:z,clearSearch:w,getTypeIcon:be,getReqTypeClass:ae,getReqTypeAbbr:a,calculateBezierPath:n,showConnection:m,hideConnection:q,toggleAllConnections:se,showAllConnectionLines:ne,expandAll:Re,collapseAll:we,scrollToType:Q,handleScrollResize:G,ref:N,computed:Y,onMounted:Ie,onUnmounted:Qe,nextTick:Xe};return Object.defineProperty(ge,"__isScriptSetup",{enumerable:!1,value:!0}),ge}},ht={class:"integram-schema-legacy",ref:"containerRef"},_t={class:"connection-lines",ref:"svgRef"},Rt=["d","stroke-dasharray"],wt=["d","marker-end"],Dt=["cx","cy"],kt={class:"legacy-toolbar"},Et={class:"stats"},Ct={class:"types-container"},xt=["data-type-id"],It=["onClick"],qt={class:"type-icon"},St={class:"type-name"},At={class:"type-badges"},Lt={key:0,class:"badge unique",title:"Уникальный"},Ot={key:1,class:"badge ref",title:"Справочник"},Mt={key:0,class:"type-count"},Nt={key:0,class:"type-requisites"},Ut=["onMouseenter"],Vt={class:"req-name"},Bt=["onClick","title"],Ht={key:1,class:"type-preview"},Pt=["onMouseenter"],Gt={class:"chip-type"},Ft={key:0,class:"chip-ref"},Kt={key:0,class:"more"};function zt(fe,t,re,e,$,v){const V=x("InputIcon"),S=x("InputText"),A=x("IconField"),_=x("Button"),T=x("Tag"),C=Fe("tooltip");return c(),b("div",ht,[(c(),b("svg",_t,[t[2]||(t[2]=at('<defs data-v-611bda19><marker id="arrowhead-right" markerWidth="12" markerHeight="8" refX="10" refY="4" orient="auto" markerUnits="userSpaceOnUse" data-v-611bda19><polygon points="0 0, 12 4, 0 8" fill="#ff9800" data-v-611bda19></polygon></marker><marker id="arrowhead-left" markerWidth="12" markerHeight="8" refX="2" refY="4" orient="auto" markerUnits="userSpaceOnUse" data-v-611bda19><polygon points="12 0, 0 4, 12 8" fill="#ff9800" data-v-611bda19></polygon></marker><filter id="connection-glow" x="-50%" y="-50%" width="200%" height="200%" data-v-611bda19><feGaussianBlur stdDeviation="2" result="blur" data-v-611bda19></feGaussianBlur><feMerge data-v-611bda19><feMergeNode in="blur" data-v-611bda19></feMergeNode><feMergeNode in="SourceGraphic" data-v-611bda19></feMergeNode></feMerge></filter></defs>',1)),(c(!0),b(Ce,null,xe(e.visibleLines,o=>(c(),b("g",{key:o.id,class:"connection-group"},[l("path",{d:o.path,fill:"none",stroke:"rgba(255, 152, 0, 0.3)","stroke-width":"6","stroke-dasharray":o.animated?"8,4":"none"},null,8,Rt),l("path",{d:o.path,fill:"none",stroke:"#ff9800","stroke-width":"2","marker-end":o.direction==="left"?"url(#arrowhead-left)":"url(#arrowhead-right)",class:te(["connection-path",{animated:o.animated}])},null,10,wt),l("circle",{cx:o.x1,cy:o.y1,r:"4",fill:"#ff9800"},null,8,Dt)]))),128))],512)),l("div",kt,[i(A,{iconPosition:"left"},{default:R(()=>[i(V,{class:"pi pi-search"}),i(S,{modelValue:e.searchQuery,"onUpdate:modelValue":t[0]||(t[0]=o=>e.searchQuery=o),placeholder:"Поиск таблиц...",class:"search-input",onInput:e.filterTypes},null,8,["modelValue"])]),_:1}),e.searchQuery?(c(),X(_,{key:0,icon:"pi pi-times",text:"",rounded:"",size:"small",onClick:e.clearSearch})):E("",!0),t[3]||(t[3]=l("div",{class:"toolbar-divider"},null,-1)),Z(i(_,{icon:e.showAllConnections?"pi pi-eye-slash":"pi pi-share-alt",label:e.showAllConnections?"Скрыть связи":"Все связи",severity:e.showAllConnections?"warning":"secondary",size:"small",outlined:"",onClick:e.toggleAllConnections},null,8,["icon","label","severity"]),[[C,"Показать/скрыть все связи между таблицами",void 0,{bottom:!0}]]),Z(i(_,{icon:"pi pi-expand",label:"Развернуть",severity:"secondary",size:"small",outlined:"",onClick:e.expandAll},null,512),[[C,"Развернуть все таблицы",void 0,{bottom:!0}]]),Z(i(_,{icon:"pi pi-minus",label:"Свернуть",severity:"secondary",size:"small",outlined:"",onClick:e.collapseAll},null,512),[[C,"Свернуть все таблицы",void 0,{bottom:!0}]]),l("div",Et,[i(T,{value:`${e.filteredTypes.length} таблиц`,severity:"info"},null,8,["value"]),i(T,{value:`${e.totalReferences} связей`,severity:"warning"},null,8,["value"])])]),l("div",Ct,[(c(!0),b(Ce,null,xe(e.filteredTypes,o=>{var g;return c(),b("div",{key:o.id,ref_for:!0,ref:r=>e.setTypeRef(o.id,r),class:te(["type-card",{highlighted:e.highlightedTypeId===o.id,"is-reference-table":o.isReferenceTable}]),"data-type-id":o.id},[l("div",{class:"type-header",onClick:r=>e.toggleExpand(o.id)},[l("div",qt,[l("i",{class:te(e.getTypeIcon(o))},null,2)]),l("div",St,k(o.name),1),l("div",At,[o.unique?(c(),b("span",Lt,"U")):E("",!0),o.isReferenceTable?(c(),b("span",Ot,"R")):E("",!0)]),(g=o.requisites)!=null&&g.length?(c(),b("div",Mt,k(o.requisites.length),1)):E("",!0),l("div",{class:"type-actions",onClick:t[1]||(t[1]=Se(()=>{},["stop"]))},[Z(i(_,{icon:"pi pi-database",text:"",rounded:"",size:"small",severity:"secondary",onClick:r=>e.emit("open-table",o.id)},null,8,["onClick"]),[[C,"Просмотр данных",void 0,{bottom:!0}]]),Z(i(_,{icon:"pi pi-cog",text:"",rounded:"",size:"small",severity:"secondary",onClick:r=>e.emit("edit-type",o.id)},null,8,["onClick"]),[[C,"Редактировать структуру",void 0,{bottom:!0}]])]),l("i",{class:te(e.expandedTypes.has(o.id)?"pi pi-chevron-up":"pi pi-chevron-down")},null,2)],8,It),e.expandedTypes.has(o.id)?(c(),b("div",Nt,[(c(!0),b(Ce,null,xe(o.requisites,r=>(c(),b("div",{key:r.id,class:te(["requisite-row",{"is-ref":r.isReference}]),onMouseenter:L=>r.isReference&&e.showConnection(o.id,r),onMouseleave:e.hideConnection,ref_for:!0,ref:L=>r.isReference&&e.setReqRef(r.id,L)},[l("span",{class:te(["req-type-badge",e.getReqTypeClass(r.type)])},k(e.getReqTypeAbbr(r.type)),3),l("span",Vt,k(r.name),1),r.isReference&&r.refTypeName?(c(),b("a",{key:0,class:"req-ref-link",onClick:Se(L=>e.scrollToType(r.refTypeId),["stop"]),title:`Перейти к: ${r.refTypeName}`}," → "+k(r.refTypeName),9,Bt)):E("",!0)],42,Ut))),128))])):(c(),b("div",Ht,[(c(!0),b(Ce,null,xe((o.requisites||[]).slice(0,5),r=>(c(),b("span",{key:r.id,class:te(["preview-chip",{"is-ref":r.isReference}]),onMouseenter:L=>r.isReference&&e.showConnection(o.id,r),onMouseleave:e.hideConnection},[l("span",Gt,k(e.getReqTypeAbbr(r.type)),1),ee(" "+k(r.name)+" ",1),r.refTypeName?(c(),b("span",Ft,"("+k(r.refTypeName)+")",1)):E("",!0)],42,Pt))),128)),(o.requisites||[]).length>5?(c(),b("span",Kt," +"+k(o.requisites.length-5),1)):E("",!0)]))],10,xt)}),128))])],512)}const jt=Ne(Tt,[["render",zt],["__scopeId","data-v-611bda19"],["__file","/home/hive/integram-standalone/src/components/integram/IntegramSchemaLegacy.vue"]]),Wt="label",Yt={__name:"IntegramSchemaTree",props:{typesData:{type:Array,default:()=>[]}},emits:["open-table","edit-type"],setup(fe,{expose:t,emit:re}){t();const e=fe,$=re,v=N(""),V=N({}),S=N(null),A=Y(()=>{const a=new Map;return e.typesData.forEach(n=>{a.set(String(n.id),n)}),a}),_=Y(()=>{const a=new Set;return e.typesData.forEach(n=>{var m;(m=n.requisites)==null||m.forEach(q=>{q.isReference&&q.refTypeId&&a.add(String(q.refTypeId))})}),a}),T=Y(()=>e.typesData.filter(a=>{var q;const n=_.value.has(String(a.id)),m=(q=a.requisites)==null?void 0:q.some(se=>se.isReference);return!n||a.isReferenceTable||!m})),C=Y(()=>{const a=[],n=new Set;function m(q,se=0){var Re,we;if(n.has(q.id)||se>10)return null;n.add(q.id);const ne=[];return(Re=q.requisites)==null||Re.forEach(Q=>{const G={key:`req-${Q.id}`,label:Q.name||Q.alias||`Поле ${Q.id}`,type:"requisite",reqType:L(Q.type),isReference:Q.isReference,refTarget:Q.refTypeName,refTargetId:Q.refTypeId,icon:Q.isReference?"pi pi-link":"pi pi-minus",selectable:!1};if(Q.isReference&&Q.refTypeId){const ge=A.value.get(String(Q.refTypeId));if(ge&&!n.has(ge.id)){const u=m(ge,se+1);u&&(G.children=[u])}}ne.push(G)}),{key:`type-${q.id}`,label:q.name,type:"table",typeId:q.id,unique:q.unique,isReferenceTable:q.isReferenceTable,reqCount:((we=q.requisites)==null?void 0:we.length)||0,icon:q.isReferenceTable?"pi pi-book":"pi pi-table",children:ne.length>0?ne:void 0}}return T.value.forEach(q=>{const se=m(q);se&&a.push(se)}),a.sort((q,se)=>(q.label||"").localeCompare(se.label||"")),a}),o=Y(()=>e.typesData.length),g=Y(()=>e.typesData.reduce((a,n)=>{var m;return a+(((m=n.requisites)==null?void 0:m.filter(q=>q.isReference).length)||0)},0));function r(a){return a.type==="table"?a.isReferenceTable?"pi pi-book":"pi pi-table":a.type==="requisite"?a.isReference?"pi pi-link":"pi pi-minus":"pi pi-circle"}function L(a){var m;return{short:"STR",chars:"TXT",number:"INT",signed:"DEC",date:"DATE",datetime:"DT",boolean:"BOOL",memo:"MEMO",reference:"REF",file:"FILE",html:"HTML"}[a==null?void 0:a.toLowerCase()]||((m=a==null?void 0:a.slice(0,4))==null?void 0:m.toUpperCase())||"?"}function B(a){return{STR:"type-string",TXT:"type-string",INT:"type-number",DEC:"type-number",DATE:"type-date",DT:"type-date",BOOL:"type-bool",MEMO:"type-text",REF:"type-ref",FILE:"type-file",HTML:"type-html"}[a]||"type-other"}function ue(){const a={};function n(m){m.forEach(q=>{a[q.key]=!0,q.children&&n(q.children)})}n(C.value),V.value=a}function me(){V.value={}}function _e(){v.value&&ue()}function z(){v.value=""}function w(a){const n=`type-${a}`;V.value={...V.value,[n]:!0},S.value={[n]:!0},setTimeout(()=>{const m=document.querySelector(`[data-pc-section="label"]:has(+ [data-type-id="${a}"])`);m&&m.scrollIntoView({behavior:"smooth",block:"center"})},100)}function be(a){a.type}Je(()=>e.typesData,()=>{if(e.typesData.length>0&&Object.keys(V.value).length===0){const a={};C.value.slice(0,5).forEach(n=>{a[n.key]=!0}),V.value=a}},{immediate:!0});const ae={props:e,emit:$,searchQuery:v,expandedKeys:V,selectedKey:S,filterBy:Wt,typeMap:A,referencedTypeIds:_,rootTables:T,treeNodes:C,totalTables:o,totalReferences:g,getNodeIcon:r,getReqTypeAbbr:L,getReqTypeClass:B,expandAll:ue,collapseAll:me,onSearch:_e,clearSearch:z,scrollToNode:w,onNodeSelect:be,ref:N,computed:Y,watch:Je};return Object.defineProperty(ae,"__isScriptSetup",{enumerable:!1,value:!0}),ae}},Qt={class:"integram-schema-tree"},Xt={class:"tree-toolbar"},Jt={class:"stats"},Zt={class:"tree-legend"},$t={class:"legend-item"},ea={class:"node-label"},ta={class:"node-badges"},aa=["onClick"],la={key:0,class:"node-actions"},ia={key:0,class:"empty-state"};function sa(fe,t,re,e,$,v){const V=x("InputIcon"),S=x("InputText"),A=x("IconField"),_=x("Button"),T=x("Tag"),C=x("Badge"),o=x("Tree"),g=Fe("tooltip");return c(),b("div",Qt,[l("div",Xt,[i(A,{iconPosition:"left"},{default:R(()=>[i(V,{class:"pi pi-search"}),i(S,{modelValue:e.searchQuery,"onUpdate:modelValue":t[0]||(t[0]=r=>e.searchQuery=r),placeholder:"Поиск таблиц...",class:"search-input",onInput:e.onSearch},null,8,["modelValue"])]),_:1}),e.searchQuery?(c(),X(_,{key:0,icon:"pi pi-times",text:"",rounded:"",size:"small",onClick:e.clearSearch})):E("",!0),t[3]||(t[3]=l("div",{class:"toolbar-divider"},null,-1)),i(_,{icon:"pi pi-plus",label:"Развернуть все",severity:"secondary",size:"small",outlined:"",onClick:e.expandAll}),i(_,{icon:"pi pi-minus",label:"Свернуть все",severity:"secondary",size:"small",outlined:"",onClick:e.collapseAll}),l("div",Jt,[i(T,{value:`${e.rootTables.length} корневых`,severity:"info"},null,8,["value"]),i(T,{value:`${e.totalTables} таблиц`,severity:"secondary"},null,8,["value"]),i(T,{value:`${e.totalReferences} связей`,severity:"warning"},null,8,["value"])])]),l("div",Zt,[t[5]||(t[5]=at('<span class="legend-item" data-v-d3ab068d><i class="pi pi-table" style="color:var(--p-primary-color);" data-v-d3ab068d></i> Таблица </span><span class="legend-item" data-v-d3ab068d><i class="pi pi-book" style="color:#ff9800;" data-v-d3ab068d></i> Справочник </span><span class="legend-item" data-v-d3ab068d><i class="pi pi-link" style="color:#9c27b0;" data-v-d3ab068d></i> Ссылка </span>',3)),l("span",$t,[i(C,{value:"U",severity:"info",size:"small"}),t[4]||(t[4]=ee(" Уникальный ",-1))])]),i(o,{expandedKeys:e.expandedKeys,"onUpdate:expandedKeys":t[1]||(t[1]=r=>e.expandedKeys=r),value:e.treeNodes,filter:!!e.searchQuery,filterBy:e.filterBy,filterMode:"lenient",selectionMode:"single",selectionKeys:e.selectedKey,"onUpdate:selectionKeys":t[2]||(t[2]=r=>e.selectedKey=r),class:"schema-tree",onNodeSelect:e.onNodeSelect},{default:R(({node:r})=>[l("div",{class:te(["tree-node-content",{"is-table":r.type==="table","is-reference":r.type==="reference","is-requisite":r.type==="requisite","is-ref-requisite":r.isReference}])},[l("i",{class:te([e.getNodeIcon(r),"node-icon"])},null,2),l("span",ea,k(r.label),1),l("div",ta,[r.reqType?(c(),b("span",{key:0,class:te(["req-type-badge",e.getReqTypeClass(r.reqType)])},k(r.reqType),3)):E("",!0),r.unique?Z((c(),X(C,{key:1,value:"U",severity:"info",size:"small"},null,512)),[[g,"Уникальный",void 0,{top:!0}]]):E("",!0),r.refTarget?(c(),b("span",{key:2,class:"ref-target",onClick:Se(L=>e.scrollToNode(r.refTargetId),["stop"])}," → "+k(r.refTarget),9,aa)):E("",!0),r.reqCount?Z((c(),X(C,{key:3,value:r.reqCount,severity:"secondary",size:"small"},null,8,["value"])),[[g,"Количество полей",void 0,{top:!0}]]):E("",!0)]),r.type==="table"?(c(),b("div",la,[Z(i(_,{icon:"pi pi-database",text:"",rounded:"",size:"small",severity:"secondary",onClick:Se(L=>e.emit("open-table",r.typeId),["stop"])},null,8,["onClick"]),[[g,"Просмотр данных",void 0,{top:!0}]]),Z(i(_,{icon:"pi pi-cog",text:"",rounded:"",size:"small",severity:"secondary",onClick:Se(L=>e.emit("edit-type",r.typeId),["stop"])},null,8,["onClick"]),[[g,"Редактировать",void 0,{top:!0}]])])):E("",!0)],2)]),_:1},8,["expandedKeys","value","filter","selectionKeys"]),e.treeNodes.length===0?(c(),b("div",ia,[...t[6]||(t[6]=[l("i",{class:"pi pi-inbox"},null,-1),l("p",null,"Нет данных для отображения",-1)])])):E("",!0)])}const na=Ne(Yt,[["render",sa],["__scopeId","data-v-d3ab068d"],["__file","/home/hive/integram-standalone/src/components/integram/IntegramSchemaTree.vue"]]),oa={__name:"IntegramTypeEditor",props:{session:{type:Object,required:!0}},emits:["view-table","refresh"],setup(fe,{expose:t,emit:re}){t();const e=fe,$=re,v=Me(),V=N("legacy"),S=[{value:"legacy",label:"Связи",icon:"pi pi-share-alt"},{value:"tree",label:"Дерево",icon:"pi pi-sitemap"},{value:"list",label:"Список",icon:"pi pi-list"}],A=[{value:"SHORT",label:"SHORT",description:"Короткая строка (до 127 символов)",example:"Интеграл"},{value:"CHARS",label:"CHARS",description:"Строка без ограничения длины",example:""},{value:"DATE",label:"DATE",description:"Дата",example:"30.10.2019"},{value:"NUMBER",label:"NUMBER",description:"Целое число",example:"100500"},{value:"SIGNED",label:"SIGNED",description:"Число с десятичной частью",example:"12.50"},{value:"BOOLEAN",label:"BOOLEAN",description:"Логическое значение (Да/Нет)",example:"true"},{value:"MEMO",label:"MEMO",description:"Многострочный текст",example:""},{value:"DATETIME",label:"DATETIME",description:"Дата и время",example:"05.11.2019 13:35:40"},{value:"FILE",label:"FILE",description:"Файл",example:"document.pdf"},{value:"HTML",label:"HTML",description:"HTML-текст",example:"<span>777</span>"},{value:"BUTTON",label:"BUTTON",description:"Действие (кнопка) над записью",example:""},{value:"PWD",label:"PWD",description:"Пароль (маскируется)",example:"******"},{value:"GRANT",label:"GRANT",description:"Объект системы (выбор из таблиц)",example:"",hidden:!0},{value:"CALCULATABLE",label:"CALCULATABLE",description:"Вычисляемое поле (read-only, автозаполнение)",example:"[TODAY], [USER]"},{value:"REPORT_COLUMN",label:"REPORT_COLUMN",description:"Колонка запроса",example:"",hidden:!0},{value:"PATH",label:"PATH",description:"Путь к файлу",example:"/path/to/file"},{value:"0",label:"------------",description:"Разделитель закладок",example:""}],_=A.filter(s=>!s.hidden),T=_,C={HTML:2,SHORT:3,DATETIME:4,GRANT:5,PWD:6,BUTTON:7,CHARS:8,DATE:9,FILE:10,BOOLEAN:11,MEMO:12,NUMBER:13,SIGNED:14,CALCULATABLE:15,REPORT_COLUMN:16,PATH:17,0:0};function o(s){return C[s]||s}const g=De({name:"",baseType:"SHORT",unique:!1}),r=N([]),L=N([]),B=N(""),ue=N(!1),me=N(!1),_e=N(!1),z=De({list:!1,create:!1,delete:!1,createSubordinate:!1,editType:!1}),w=De({visible:!1,mode:"add",typeId:null,data:{id:null,name:"",type:"SHORT",nullable:!0,multi:!1,alias:"",defaultValue:""}}),be={DATE:[{label:"[TODAY] — сегодня",value:"[TODAY]"},{label:"[YESTERDAY] — вчера",value:"[YESTERDAY]"},{label:"[TOMORROW] — завтра",value:"[TOMORROW]"},{label:"[MONTH_AGO] — месяц назад",value:"[MONTH_AGO]"},{label:"[WEEK_AGO] — неделя назад",value:"[WEEK_AGO]"},{label:"[MONTH_PLUS] — месяц вперёд",value:"[MONTH_PLUS]"}],DATETIME:[{label:"[NOW] — текущие дата и время",value:"[NOW]"}],REFERENCE:[{label:"[USER_ID] — ID текущего пользователя",value:"[USER_ID]"}],CALCULATABLE:[{label:"--- Дата/время ---",value:"",disabled:!0},{label:"[TODAY] — сегодня",value:"[TODAY]"},{label:"[NOW] — дата и время",value:"[NOW]"},{label:"[YESTERDAY] — вчера",value:"[YESTERDAY]"},{label:"[TOMORROW] — завтра",value:"[TOMORROW]"},{label:"[MONTH_AGO] — месяц назад",value:"[MONTH_AGO]"},{label:"[WEEK_AGO] — неделя назад",value:"[WEEK_AGO]"},{label:"[MONTH_PLUS] — месяц вперёд",value:"[MONTH_PLUS]"},{label:"--- Пользователь ---",value:"",disabled:!0},{label:"[USER] — логин пользователя",value:"[USER]"},{label:"[USER_ID] — ID пользователя",value:"[USER_ID]"},{label:"[ROLE] — название роли",value:"[ROLE]"},{label:"[ROLE_ID] — ID роли",value:"[ROLE_ID]"},{label:"--- Система ---",value:"",disabled:!0},{label:"[REMOTE_ADDR] — IP адрес",value:"[REMOTE_ADDR]"},{label:"[HTTP_USER_AGENT] — браузер",value:"[HTTP_USER_AGENT]"},{label:"[HTTP_REFERER] — откуда пришёл",value:"[HTTP_REFERER]"},{label:"[HTTP_HOST] — хост сервера",value:"[HTTP_HOST]"},{label:"[REQUEST_URI] — URL запроса",value:"[REQUEST_URI]"},{label:"[TSHIFT] — часовой пояс",value:"[TSHIFT]"}]};function ae(s){return be[s]||[]}const a=De({visible:!1,type:null,item:null,itemName:""}),n=De({visible:!1,parentType:null,name:"",unique:!1}),m=De({visible:!1,type:null,name:"",baseType:"SHORT",unique:!1,originalName:""}),q=Y(()=>g.name&&g.baseType),se=Y(()=>{let s=Array.isArray(r.value)?r.value:[];if(B.value){const f=B.value.toLowerCase();s=s.filter(p=>p.name&&p.name.toLowerCase().includes(f))}return ue.value||(s=s.filter(f=>!f.isService)),me.value||(s=s.filter(f=>!f.isSimple)),s}),ne={0:"tab",1:"short",2:"html",3:"short",4:"datetime",5:"grant",6:"pwd",7:"button",8:"chars",9:"date",10:"file",11:"boolean",12:"memo",13:"number",14:"signed",15:"calculatable",16:"path",17:"report_column",18:"user",19:"connect",20:"time"},Re=new Set(Object.keys(ne));function we(s){return ne[String(s)]||"reference"}function Q(s){const f=String(s);return Re.has(f)||parseInt(f)<=20}async function G(){var s,f;z.list=!0;try{e.session.database&&O.setDatabase(e.session.database);const p=await O.getTypeEditorData();if(p&&p.edit_types){const d=p.edit_types;console.log("[IntegramTypeEditor] DEBUG: editTypes keys:",Object.keys(d)),console.log("[IntegramTypeEditor] DEBUG: Sample data (first 5 rows):"),Object.keys(d).slice(0,10).forEach(h=>{const D=d[h];Array.isArray(D)&&console.log(`  ${h}: [${D.slice(0,5).join(", ")}] (${D.length} items)`)});const Ae=(d[7]||d.req_t||[]).map((h,D)=>({idx:D,val:parseInt(h)||0})).filter(h=>h.val>20).slice(0,5);Ae.length>0?(console.log("[IntegramTypeEditor] DEBUG: Potential reference rows (req_t > 20):"),Ae.forEach(({idx:h,val:D})=>{const H=(d[0]||[])[h],P=(d[4]||[])[h];console.log(`  Row ${h}: typeId=${H}, req_t=${D}, name="${P}"`)})):console.log("[IntegramTypeEditor] DEBUG: No potential references found (all req_t <= 20)");const Le=d[0]||d.id||[],rt=d[1]||d.t||[],dt=d[2]||d.ref_val||[],ct=d[3]||d.uniq||[],ut=d[4]||d.val||[],pt=d[5]||d.ord||[],ft=d[6]||d.req_id||[],mt=d[7]||d.req_t||[],Ul=d[8]||d.attrs||[],yt=d[9]||d.reft||[],ye=new Map,Be=[];for(let h=0;h<Le.length;h++){const D=String(Le[h]),H=rt[h],P=dt[h],Ee=ct[h],He=ut[h]||"",Oe=pt[h],We=ft[h],Vl=yt[h],Ye=Oe!==void 0&&Oe!==""&&Oe!==null;if(!Ye&&!ye.has(D)){Be.push(D);const qe=P&&P!==""&&P!=="0"&&P!==0;ye.set(D,{id:D,name:He,baseType:H,refVal:P,unique:Ee===1||Ee==="1"||Ee===!0,requisites:[],isService:H===0||H==="0",isSimple:!P||P===""||P==="0"||P===0,isReferenceTable:qe})}else if(Ye&&ye.has(D)){const qe=ye.get(D),Pe=mt[h],Ge=Pe&&!Q(Pe),bt=Ge?String(Pe):null;qe.requisites.push({id:We?String(We):`${D}-req-${h}`,name:He,type:Ge?"reference":we(H),baseTypeId:H,refTypeId:bt,isReference:Ge,order:Oe})}else if(!ye.has(D)){Be.push(D);const qe=P&&P!==""&&P!=="0"&&P!==0;ye.set(D,{id:D,name:He,baseType:H,refVal:P,unique:Ee===1||Ee==="1"||Ee===!0,requisites:[],isService:H===0||H==="0",isSimple:!P||P===""||P==="0"||P===0,isReferenceTable:qe})}}ye.forEach(h=>{h.requisites.forEach(D=>{D.refTypeId&&ye.has(D.refTypeId)&&(D.refTypeName=ye.get(D.refTypeId).name)})});const ke=Be.map(h=>ye.get(h));r.value=ke;const vt=ke.reduce((h,D)=>h+D.requisites.length,0),je=ke.reduce((h,D)=>h+D.requisites.filter(H=>H.isReference).length,0);if(console.log(`[IntegramTypeEditor] Loaded ${ke.length} types with ${vt} requisites (${je} are references)`),je>0){console.log("[IntegramTypeEditor] DEBUG: Sample reference requisites:");let h=0;for(const D of ke){for(const H of D.requisites)H.isReference&&h<5&&(console.log(`  ${D.name}.${H.name} -> type ${H.refTypeId} "${H.refTypeName||"NOT FOUND"}"`),h++);if(h>=5)break}}else{console.log("[IntegramTypeEditor] DEBUG: No reference requisites found. Checking raw data...");const h=[];for(const D of ke){for(const H of D.requisites.slice(0,2))h.push(`${D.name}.${H.name}: baseTypeId=${H.baseTypeId}, refTypeId=${H.refTypeId}`);if(h.length>=5)break}console.log("[IntegramTypeEditor] DEBUG: Sample requisites:",h)}}else p&&p.types?r.value=Array.isArray(p.types)?p.types:[]:(console.warn("Unexpected response format:",p),r.value=[])}catch(p){console.error("Error loading types:",p),r.value=[],v.add({severity:"error",summary:"Ошибка",detail:((f=(s=p.response)==null?void 0:s.data)==null?void 0:f.details)||p.message||"Не удалось загрузить типы",life:5e3})}finally{z.list=!1}}async function ge(){var s,f;z.create=!0;try{e.session.database&&O.setDatabase(e.session.database);const p=_.find(he=>he.value===g.baseType),d=p?p.value:g.baseType;await O.createType(g.name,d,g.unique)&&(v.add({severity:"success",summary:"Успешно",detail:`Тип "${g.name}" создан`,life:3e3}),g.name="",g.baseType="SHORT",g.unique=!1,G())}catch(p){console.error("Create type error:",p),v.add({severity:"error",summary:"Ошибка",detail:((f=(s=p.response)==null?void 0:s.data)==null?void 0:f.details)||p.message||"Не удалось создать тип",life:5e3})}finally{z.create=!1}}function u(s){const f=L.value.indexOf(s);f>-1?L.value.splice(f,1):L.value.push(s)}function y(){}function I(){B.value=""}function U(){ue.value=!ue.value}function J(){me.value=!me.value}function F(s){const f=A.find(p=>p.value===s);return f?f.label:s}function j(s){m.type=s,m.name=s.name,m.baseType=s.baseType||s.base||"SHORT",m.unique=s.unique||!1,m.originalName=s.name,m.visible=!0}async function M(){var s,f,p;if(!m.name||!m.type){v.add({severity:"warn",summary:"Ошибка",detail:"Название типа не может быть пустым",life:3e3});return}z.editType=!0;try{e.session.database&&O.setDatabase(e.session.database);let d=m.baseType;const he=((s=(await O.getTypeMetadata(m.type.id)).type)==null?void 0:s.t)||m.type.baseTypeId||3;await O.saveType(m.type.id,m.name,he,m.unique),v.add({severity:"success",summary:"Тип обновлён",detail:`Тип "${m.name}" успешно сохранён`,life:3e3}),m.visible=!1,await G(),$("refresh")}catch(d){console.error("Save type error:",d),v.add({severity:"error",summary:"Ошибка сохранения",detail:((p=(f=d.response)==null?void 0:f.data)==null?void 0:p.details)||d.message||"Не удалось сохранить тип",life:5e3})}finally{z.editType=!1}}function oe(s){$("view-table",s)}function le(s){n.parentType=s,n.name="",n.unique=!1,n.visible=!0}async function de(){var s,f;if(!(!n.name||!n.parentType)){z.createSubordinate=!0;try{e.session.database&&O.setDatabase(e.session.database);const p=n.parentType.id;await O.createType(n.name,p,n.unique)&&(v.add({severity:"success",summary:"Успешно",detail:`Подчинённый тип "${n.name}" создан для "${n.parentType.name}"`,life:3e3}),n.visible=!1,n.name="",n.parentType=null,G())}catch(p){console.error("Create subordinate type error:",p),v.add({severity:"error",summary:"Ошибка",detail:((f=(s=p.response)==null?void 0:s.data)==null?void 0:f.details)||p.message||"Не удалось создать подчинённый тип",life:5e3})}finally{z.createSubordinate=!1}}}async function K(s){var f,p;try{await O.createTypeReference(s.id),v.add({severity:"success",summary:"Ссылка создана",detail:`Тип "${s.name}" теперь можно использовать как справочник в других таблицах`,life:3e3}),await G()}catch(d){console.error("Create type reference error:",d),v.add({severity:"error",summary:"Ошибка",detail:((p=(f=d.response)==null?void 0:f.data)==null?void 0:p.details)||d.message||"Не удалось создать ссылку на тип",life:5e3})}}function ce(s){$("view-table",s)}function ie(s){r.value.find(p=>p.id===s)&&(V.value="list",L.value.includes(s)||L.value.push(s),setTimeout(()=>{const p=document.querySelector(`[data-type-id="${s}"]`);p&&p.scrollIntoView({behavior:"smooth",block:"center"})},100))}function pe(s){a.type="type",a.item=s,a.itemName=s.name,a.visible=!0}async function Te(){a.visible=!1,a.type==="type"?await ve(a.item):a.type==="requisite"&&await Ke(a.item.type,a.item.requisite)}async function ve(s){var f,p;z.delete=!0;try{e.session.database&&O.setDatabase(e.session.database),await O.deleteType(s.id)&&(v.add({severity:"success",summary:"Успешно",detail:`Тип "${s.name}" удален`,life:3e3}),G())}catch(d){console.error("Delete type error:",d),v.add({severity:"error",summary:"Ошибка",detail:((p=(f=d.response)==null?void 0:f.data)==null?void 0:p.details)||d.message||"Не удалось удалить тип",life:5e3})}finally{z.delete=!1}}function Ue(s){w.mode="add",w.typeId=s.id,w.data={id:null,name:"",type:"SHORT",nullable:!0,multi:!1,alias:"",defaultValue:""},w.visible=!0}function Ve(s,f){w.mode="edit",w.typeId=s.id,w.data={...f},w.visible=!0}async function lt(){var s,f;w.visible=!1;try{if(e.session.database&&O.setDatabase(e.session.database),w.mode==="add"){const p=o(w.data.type),d=await O.addRequisite(w.typeId,p);d&&d.id&&w.data.name&&await O.saveRequisiteAlias(d.id,w.data.name),d&&d.id&&!w.data.nullable&&await O.toggleRequisiteNull(d.id),d&&d.id&&w.data.multi&&await O.toggleRequisiteMulti(d.id),d&&d.id&&w.data.defaultValue&&await O.saveRequisiteDefaultValue(d.id,w.data.defaultValue)}else w.data.name&&await O.saveRequisiteAlias(w.data.id,w.data.name),w.data.defaultValue!==void 0&&await O.saveRequisiteDefaultValue(w.data.id,w.data.defaultValue||"");v.add({severity:"success",summary:"Успешно",detail:w.mode==="add"?"Реквизит добавлен":"Реквизит обновлен",life:3e3}),G()}catch(p){console.error("Save requisite error:",p),v.add({severity:"error",summary:"Ошибка",detail:((f=(s=p.response)==null?void 0:s.data)==null?void 0:f.details)||p.message||"Не удалось сохранить реквизит",life:5e3})}}function it(s,f){a.type="requisite",a.item={type:s,requisite:f},a.itemName=f.name,a.visible=!0}async function Ke(s,f){var p,d;try{e.session.database&&O.setDatabase(e.session.database),await O.deleteRequisite(f.id)&&(v.add({severity:"success",summary:"Успешно",detail:`Реквизит "${f.name}" удален`,life:3e3}),G())}catch(W){console.error("Delete requisite error:",W),v.add({severity:"error",summary:"Ошибка",detail:((d=(p=W.response)==null?void 0:p.data)==null?void 0:d.details)||W.message||"Не удалось удалить реквизит",life:5e3})}}async function st(s,f){var p,d;try{await O.moveRequisiteUp(f.id),v.add({severity:"success",summary:"Реквизит перемещён",detail:`"${f.alias||f.name}" перемещён выше`,life:2e3}),await G()}catch(W){console.error("Move requisite up error:",W),v.add({severity:"error",summary:"Ошибка",detail:((d=(p=W.response)==null?void 0:p.data)==null?void 0:d.details)||W.message||"Не удалось переместить реквизит",life:5e3})}}async function nt(s,f){var p,d;try{const W=s.requisites||[],he=W.findIndex(Le=>Le.id===f.id);if(he===-1||he>=W.length-1){v.add({severity:"warn",summary:"Невозможно переместить",detail:"Реквизит уже находится в самом низу",life:2e3});return}const Ae=he+2;await O.setRequisiteOrder(f.id,Ae),v.add({severity:"success",summary:"Реквизит перемещён",detail:`"${f.alias||f.name}" перемещён ниже`,life:2e3}),await G()}catch(W){console.error("Move requisite down error:",W),v.add({severity:"error",summary:"Ошибка",detail:((d=(p=W.response)==null?void 0:p.data)==null?void 0:d.details)||W.message||"Не удалось переместить реквизит",life:5e3})}}function ot(){r.value.some(f=>f.name.toLowerCase()===g.name.toLowerCase().trim()&&f.baseType===g.baseType)&&v.add({severity:"warn",summary:"Дубликат",detail:"Тип с таким именем уже существует",life:2e3})}Ie(()=>{e.session&&e.session.sessionId&&(e.session.database&&O.setDatabase(e.session.database),G())});const ze={props:e,emit:$,toast:v,viewMode:V,viewModeOptions:S,baseTypesAll:A,baseTypes:_,requisiteTypes:T,typeNameToId:C,getTypeIdFromName:o,newType:g,typesList:r,expandedTypes:L,searchQuery:B,showService:ue,showSimple:me,collapseSearch:_e,loading:z,requisiteDialog:w,defaultMacrosByType:be,getDefaultMacros:ae,deleteDialog:a,subordinateTypeDialog:n,editTypeDialog:m,canCreateType:q,filteredTypes:se,baseTypeNameMap:ne,baseTypeIds:Re,getBaseTypeNameFromId:we,isBaseType:Q,loadTypes:G,createType:ge,toggleTypeExpansion:u,filterTypes:y,clearSearch:I,toggleServiceTypes:U,toggleSimpleTypes:J,getBaseTypeName:F,editType:j,saveEditedType:M,viewTable:oe,showSubordinateTypeDialog:le,createSubordinateType:de,createReferenceToType:K,handleOpenTable:ce,handleEditType:ie,confirmDeleteType:pe,executeDelete:Te,deleteType:ve,showAddRequisiteDialog:Ue,editRequisite:Ve,saveRequisite:lt,confirmDeleteRequisite:it,deleteRequisite:Ke,moveRequisiteUp:st,moveRequisiteDown:nt,filterExistingTypes:ot,ref:N,reactive:De,computed:Y,onMounted:Ie,get useToast(){return Me},get integramApiClient(){return O},IntegramSchemaLegacy:jt,IntegramSchemaTree:na};return Object.defineProperty(ze,"__isScriptSetup",{enumerable:!1,value:!0}),ze}},ra={class:"integram-type-editor integram-touch-friendly"},da={class:"flex align-items-center justify-content-between"},ca={class:"flex gap-2 align-items-center ml-auto"},ua={key:0,class:"legacy-view-container"},pa={key:1,class:"tree-view-container"},fa={key:2},ma={class:"integram-badge-legend mb-3"},ya={class:"legend-item"},va={class:"legend-item"},ba={class:"legend-item"},ga={class:"legend-item"},Ta={class:"grid"},ha={class:"col-12 md:col-4"},_a={class:"field"},Ra={class:"col-12 md:col-3"},wa={class:"field"},Da={class:"text-sm text-color-secondary"},ka={class:"col-12 md:col-2 flex align-items-end pb-3"},Ea={class:"flex align-items-center gap-2"},Ca={class:"col-12 md:col-3 flex align-items-end"},xa={key:0},Ia={class:"flex gap-2 align-items-center flex-wrap"},qa={class:"integram-actions"},Sa={key:0,class:"flex justify-content-center p-5"},Aa={key:1,class:"types-list"},La=["data-type-id"],Oa={class:"flex justify-content-between align-items-center"},Ma={class:"flex align-items-center gap-2 flex-wrap"},Na={class:"font-bold"},Ua=["title"],Va={class:"chip-type"},Ba={key:0,class:"ref-name"},Ha={key:3,class:"text-color-secondary text-sm"},Pa={class:"flex gap-2 align-items-center"},Ga={key:0},Fa={class:"grid mb-3"},Ka={class:"col-12 md:col-4"},za={class:"col-12 md:col-4"},ja={class:"col-12 md:col-4"},Wa={class:"integram-actions mb-3"},Ya={class:"flex justify-content-between align-items-center w-full"},Qa={key:0},Xa={key:0,class:"text-sm ml-1"},Ja={class:"flex gap-1"},Za={class:"integram-actions"},$a={key:1,class:"text-center p-4 text-color-secondary"},el={key:0,class:"text-center p-5 text-color-secondary"},tl={class:"flex flex-column gap-3"},al={class:"field"},ll={class:"field"},il={key:0,class:"field-checkbox"},sl={key:1,class:"field-checkbox"},nl={class:"field"},ol={class:"field"},rl={for:"reqDefault"},dl={key:0,class:"flex flex-column gap-2"},cl={class:"p-3 surface-ground border-round"},ul={class:"m-0 pl-4 text-sm"},pl={key:1,class:"flex gap-2"},fl={key:2,class:"text-color-secondary"},ml={class:"integram-actions justify-content-end w-full"},yl={class:"flex align-items-center gap-3"},vl={class:"integram-actions justify-content-end w-full"},bl={class:"flex flex-column gap-3"},gl={class:"p-3 surface-ground border-round"},Tl={class:"text-lg"},hl={class:"field"},_l={class:"field-checkbox"},Rl={class:"integram-actions justify-content-end w-full"},wl={class:"flex flex-column gap-3"},Dl={class:"p-3 surface-ground border-round"},kl={class:"text-lg"},El={class:"text-color-secondary"},Cl={class:"field"},xl={class:"field-checkbox"},Il={class:"integram-actions justify-content-end w-full"};function ql(fe,t,re,e,$,v){const V=x("SelectButton"),S=x("Tag"),A=x("Badge"),_=x("InputText"),T=x("Select"),C=x("Checkbox"),o=x("Button"),g=x("Column"),r=x("DataTable"),L=x("Panel"),B=x("InputIcon"),ue=x("IconField"),me=x("ProgressSpinner"),_e=x("Divider"),z=x("Card"),w=x("Dialog"),be=x("Message"),ae=Fe("tooltip");return c(),b("div",ra,[i(z,{class:"mb-3"},{title:R(()=>[l("div",da,[t[25]||(t[25]=l("span",null,"Структура",-1)),l("div",ca,[i(V,{modelValue:e.viewMode,"onUpdate:modelValue":t[0]||(t[0]=a=>e.viewMode=a),options:e.viewModeOptions,optionLabel:"icon",optionValue:"value",allowEmpty:!1,class:"view-toggle"},{option:R(({option:a})=>[Z(l("i",{class:te(a.icon)},null,2),[[ae,a.label,void 0,{top:!0}]])]),_:1},8,["modelValue"])])])]),content:R(()=>[e.viewMode==="legacy"?(c(),b("div",ua,[i(e.IntegramSchemaLegacy,{"types-data":e.typesList,onOpenTable:e.handleOpenTable,onEditType:e.handleEditType},null,8,["types-data"])])):e.viewMode==="tree"?(c(),b("div",pa,[i(e.IntegramSchemaTree,{"types-data":e.typesList,onOpenTable:e.handleOpenTable,onEditType:e.handleEditType},null,8,["types-data"])])):e.viewMode==="list"?(c(),b("div",fa,[l("div",ma,[l("div",ya,[i(S,{severity:"info",value:"Уникальный"}),t[26]||(t[26]=l("span",{class:"legend-label"},"— первый столбец уникален",-1))]),l("div",va,[i(A,{value:"Служебный",severity:"secondary"}),t[27]||(t[27]=l("span",{class:"legend-label"},"— системный тип",-1))]),l("div",ba,[i(A,{value:"Простой"}),t[28]||(t[28]=l("span",{class:"legend-label"},"— базовый тип данных",-1))]),l("div",ga,[i(A,{value:"5",severity:"secondary"}),t[29]||(t[29]=l("span",{class:"legend-label"},"— количество реквизитов",-1))])]),i(L,{header:"Добавить тип",class:"mb-2"},{default:R(()=>[l("div",Ta,[l("div",ha,[l("div",_a,[t[30]||(t[30]=l("label",{for:"newTypeName"},"Название типа *",-1)),i(_,{id:"newTypeName",modelValue:e.newType.name,"onUpdate:modelValue":t[1]||(t[1]=a=>e.newType.name=a),placeholder:"Новый тип",class:"w-full",onKeyup:e.filterExistingTypes},null,8,["modelValue"])])]),l("div",Ra,[l("div",wa,[t[31]||(t[31]=l("label",{for:"baseType"},"Базовый тип *",-1)),i(T,{id:"baseType",modelValue:e.newType.baseType,"onUpdate:modelValue":t[2]||(t[2]=a=>e.newType.baseType=a),options:e.baseTypes,optionLabel:"label",optionValue:"value",placeholder:"Выберите базовый тип",class:"w-full"},{option:R(({option:a})=>[l("div",null,[l("strong",null,k(a.label),1),l("div",Da,k(a.description),1)])]),_:1},8,["modelValue","options"])])]),l("div",ka,[l("div",Ea,[i(C,{id:"newTypeUnique",modelValue:e.newType.unique,"onUpdate:modelValue":t[3]||(t[3]=a=>e.newType.unique=a),binary:!0},null,8,["modelValue"]),t[32]||(t[32]=l("label",{for:"newTypeUnique"},"Уникальный",-1))])]),l("div",Ca,[i(o,{icon:"pi pi-plus",label:"Добавить",onClick:e.createType,loading:e.loading.create,disabled:!e.canCreateType,class:"w-full","aria-label":"Добавить новый тип"},null,8,["loading","disabled"])])]),i(L,{header:"Описание базовых типов",toggleable:!0,collapsed:!0,class:"mt-3"},{default:R(()=>[i(r,{value:e.baseTypesAll,stripedRows:""},{default:R(()=>[i(g,{field:"label",header:"Тип",style:{width:"150px"}},{body:R(({data:a})=>[l("span",{class:te({"text-color-secondary":a.hidden})},k(a.label),3),a.hidden?(c(),X(S,{key:0,value:"системный",severity:"secondary",class:"ml-2",style:{"font-size":"0.7rem"}})):E("",!0)]),_:1}),i(g,{field:"description",header:"Описание"}),i(g,{field:"example",header:"Пример",style:{width:"200px"}},{body:R(({data:a})=>[a.example?(c(),b("code",xa,k(a.example),1)):E("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),i(L,{header:"Поиск типов",toggleable:!0,collapsed:e.collapseSearch,class:"mb-2"},{default:R(()=>[l("div",Ia,[i(ue,{iconPosition:"left",class:"flex-1"},{default:R(()=>[i(B,{class:"pi pi-search"}),i(_,{modelValue:e.searchQuery,"onUpdate:modelValue":t[4]||(t[4]=a=>e.searchQuery=a),placeholder:"Поиск по названию типа...",class:"w-full",onInput:e.filterTypes,"aria-label":"Поиск типов"},null,8,["modelValue"])]),_:1}),i(o,{icon:"pi pi-times",label:"Очистить",onClick:e.clearSearch,severity:"secondary",outlined:"","aria-label":"Очистить поиск"}),l("div",qa,[i(o,{label:e.showService?"Скрыть служебные":"Показать служебные",onClick:e.toggleServiceTypes,outlined:"","aria-label":"Переключить отображение служебных типов"},null,8,["label"]),i(o,{label:e.showSimple?"Скрыть простые":"Показать простые",onClick:e.toggleSimpleTypes,outlined:"","aria-label":"Переключить отображение простых типов"},null,8,["label"])])])]),_:1},8,["collapsed"]),i(L,{header:"Типы данных",class:"mb-3"},{default:R(()=>[e.loading.list?(c(),b("div",Sa,[i(me)])):(c(),b("div",Aa,[(c(!0),b(Ce,null,xe(e.filteredTypes,a=>(c(),b("div",{key:a.id,class:"type-card mb-3","data-type-id":a.id},[i(z,null,{title:R(()=>{var n;return[l("div",Oa,[l("div",Ma,[a.unique?(c(),X(S,{key:0,severity:"info",value:"Уникальный"})):E("",!0),l("span",Na,k(a.name),1),a.isService?(c(),X(A,{key:1,value:"Служебный",severity:"secondary"})):E("",!0),a.isSimple?(c(),X(A,{key:2,value:"Простой"})):E("",!0),(c(!0),b(Ce,null,xe((a.requisites||[]).slice(0,5),m=>(c(),b("span",{key:m.id,class:te(["requisite-chip",{"ref-chip":m.isReference}]),title:m.refTypeName?`Ссылка на: ${m.refTypeName}`:m.type},[l("span",Va,k(m.type),1),ee(k(m.name)+" ",1),m.refTypeName?(c(),b("span",Ba,"("+k(m.refTypeName)+")",1)):E("",!0)],10,Ua))),128)),(a.requisites||[]).length>5?(c(),b("span",Ha," +"+k(a.requisites.length-5)+" ещё ",1)):E("",!0)]),l("div",Pa,[(n=a.requisites)!=null&&n.length?(c(),X(A,{key:0,value:a.requisites.length,severity:"secondary"},null,8,["value"])):E("",!0),i(o,{icon:e.expandedTypes.includes(a.id)?"pi pi-chevron-up":"pi pi-chevron-down",onClick:m=>e.toggleTypeExpansion(a.id),text:"",rounded:""},null,8,["icon","onClick"])])])]}),content:R(()=>[e.expandedTypes.includes(a.id)?(c(),b("div",Ga,[l("div",Fa,[l("div",Ka,[t[33]||(t[33]=l("span",{class:"font-semibold"},"ID:",-1)),t[34]||(t[34]=ee()),l("code",null,k(a.id),1)]),l("div",za,[t[35]||(t[35]=l("span",{class:"font-semibold"},"Базовый тип:",-1)),ee(" "+k(e.getBaseTypeName(a.baseType)),1)]),l("div",ja,[t[36]||(t[36]=l("span",{class:"font-semibold"},"Реквизитов:",-1)),ee(" "+k((a.requisites||[]).length),1)])]),i(_e),l("div",Wa,[i(o,{icon:"pi pi-pencil",label:"Редактировать тип",onClick:n=>e.editType(a),outlined:"","aria-label":"Редактировать тип"},null,8,["onClick"]),i(o,{icon:"pi pi-eye",label:"Просмотр таблицы",onClick:n=>e.viewTable(a.id),outlined:"","aria-label":"Открыть таблицу"},null,8,["onClick"]),Z(i(o,{icon:"pi pi-sitemap",label:"Создать подчинённый",onClick:n=>e.showSubordinateTypeDialog(a),outlined:"",severity:"secondary","aria-label":"Создать подчинённый тип"},null,8,["onClick"]),[[ae,"Создать подчинённый тип (таблица со ссылкой на родителя)",void 0,{top:!0}]]),Z(i(o,{icon:"pi pi-link",label:"Создать ссылку",onClick:n=>e.createReferenceToType(a),outlined:"",severity:"secondary","aria-label":"Создать ссылку на этот тип"},null,8,["onClick"]),[[ae,"Использовать этот тип как справочник (добавить колонку-ссылку в другой таблице)",void 0,{top:!0}]]),a.hasReferences?E("",!0):(c(),X(o,{key:0,icon:"pi pi-trash",label:"Удалить тип",onClick:n=>e.confirmDeleteType(a),severity:"danger",outlined:"","aria-label":"Удалить тип"},null,8,["onClick"]))]),i(L,{header:"Реквизиты (колонки)",class:"requisites-panel"},{header:R(()=>[l("div",Ya,[t[37]||(t[37]=l("span",null,"Реквизиты (колонки)",-1)),i(o,{icon:"pi pi-plus",label:"Добавить реквизит",onClick:n=>e.showAddRequisiteDialog(a),"aria-label":"Добавить новый реквизит"},null,8,["onClick"])])]),default:R(()=>[a.requisites&&a.requisites.length>0?(c(),b("div",Qa,[i(r,{value:a.requisites,stripedRows:""},{default:R(()=>[i(g,{field:"order",header:"#",style:{width:"50px"}},{body:R(({index:n})=>[ee(k(n+1),1)]),_:1}),i(g,{field:"name",header:"Название"}),i(g,{field:"type",header:"Тип"},{body:R(({data:n})=>[l("span",{class:te({"text-orange-600":n.isReference})},[ee(k(n.type)+" ",1),n.refTypeName?(c(),b("span",Xa," → "+k(n.refTypeName),1)):E("",!0)],2)]),_:2},1024),i(g,{field:"attributes",header:"Атрибуты"},{body:R(({data:n})=>[l("div",Ja,[n.nullable===!1?(c(),X(S,{key:0,severity:"warning",value:"NOT NULL"})):E("",!0),n.multi?(c(),X(S,{key:1,severity:"info",value:"MULTI"})):E("",!0),n.alias?(c(),X(S,{key:2,value:"ALIAS"})):E("",!0)])]),_:1}),i(g,{header:"Действия",style:{width:"180px"}},{body:R(({data:n})=>[l("div",Za,[Z(i(o,{icon:"pi pi-arrow-up",onClick:m=>e.moveRequisiteUp(a,n),text:"",rounded:"","aria-label":"Переместить реквизит выше"},null,8,["onClick"]),[[ae,"Переместить выше",void 0,{top:!0}]]),Z(i(o,{icon:"pi pi-arrow-down",onClick:m=>e.moveRequisiteDown(a,n),text:"",rounded:"","aria-label":"Переместить реквизит ниже"},null,8,["onClick"]),[[ae,"Переместить ниже",void 0,{top:!0}]]),Z(i(o,{icon:"pi pi-pencil",onClick:m=>e.editRequisite(a,n),text:"",rounded:"","aria-label":"Редактировать реквизит"},null,8,["onClick"]),[[ae,"Редактировать",void 0,{top:!0}]]),Z(i(o,{icon:"pi pi-trash",onClick:m=>e.confirmDeleteRequisite(a,n),severity:"danger",text:"",rounded:"","aria-label":"Удалить реквизит",class:"ml-auto"},null,8,["onClick"]),[[ae,"Удалить",void 0,{top:!0}]])])]),_:2},1024)]),_:2},1032,["value"])])):(c(),b("div",$a," Реквизитов пока нет. Добавьте первый реквизит. "))]),_:2},1024)])):E("",!0)]),_:2},1024)],8,La))),128)),e.filteredTypes.length===0?(c(),b("div",el," Типы не найдены ")):E("",!0)]))]),_:1})])):E("",!0)]),_:1}),i(w,{visible:e.requisiteDialog.visible,"onUpdate:visible":t[14]||(t[14]=a=>e.requisiteDialog.visible=a),header:e.requisiteDialog.mode==="add"?"Добавить реквизит":"Редактировать реквизит",modal:!0,style:{width:"600px"}},{footer:R(()=>[l("div",ml,[i(o,{label:"Отмена",icon:"pi pi-times",onClick:t[13]||(t[13]=a=>e.requisiteDialog.visible=!1),text:"","aria-label":"Отменить"}),i(o,{label:e.requisiteDialog.mode==="add"?"Добавить":"Сохранить",icon:"pi pi-check",onClick:e.saveRequisite,disabled:!e.requisiteDialog.data.name||!e.requisiteDialog.data.type||e.requisiteDialog.data.type==="CALCULATABLE"&&!e.requisiteDialog.data.defaultValue,"aria-label":"Сохранить реквизит"},null,8,["label","disabled"])])]),default:R(()=>[l("div",tl,[l("div",al,[t[38]||(t[38]=l("label",{for:"reqName"},"Название реквизита *",-1)),i(_,{id:"reqName",modelValue:e.requisiteDialog.data.name,"onUpdate:modelValue":t[5]||(t[5]=a=>e.requisiteDialog.data.name=a),placeholder:"Название",class:"w-full"},null,8,["modelValue"])]),l("div",ll,[t[39]||(t[39]=l("label",{for:"reqType"},"Тип данных *",-1)),i(T,{id:"reqType",modelValue:e.requisiteDialog.data.type,"onUpdate:modelValue":t[6]||(t[6]=a=>e.requisiteDialog.data.type=a),options:e.requisiteTypes,optionLabel:"label",optionValue:"value",placeholder:"Выберите тип",class:"w-full"},null,8,["modelValue","options"])]),e.requisiteDialog.data.type!=="CALCULATABLE"?(c(),b("div",il,[i(C,{id:"reqNullable",modelValue:e.requisiteDialog.data.nullable,"onUpdate:modelValue":t[7]||(t[7]=a=>e.requisiteDialog.data.nullable=a),binary:!0},null,8,["modelValue"]),t[40]||(t[40]=l("label",{for:"reqNullable",class:"ml-2"},"Разрешить NULL (может быть пустым)",-1))])):E("",!0),e.requisiteDialog.data.type!=="CALCULATABLE"?(c(),b("div",sl,[i(C,{id:"reqMulti",modelValue:e.requisiteDialog.data.multi,"onUpdate:modelValue":t[8]||(t[8]=a=>e.requisiteDialog.data.multi=a),binary:!0},null,8,["modelValue"]),t[41]||(t[41]=l("label",{for:"reqMulti",class:"ml-2"},"MULTI (множественное значение)",-1))])):E("",!0),l("div",nl,[t[42]||(t[42]=l("label",{for:"reqAlias"},"ALIAS (псевдоним)",-1)),i(_,{id:"reqAlias",modelValue:e.requisiteDialog.data.alias,"onUpdate:modelValue":t[9]||(t[9]=a=>e.requisiteDialog.data.alias=a),placeholder:"Псевдоним (опционально)",class:"w-full"},null,8,["modelValue"])]),l("div",ol,[l("label",rl,k(e.requisiteDialog.data.type==="CALCULATABLE"?"Формула (обязательно) *":"Значение по умолчанию"),1),e.requisiteDialog.data.type==="CALCULATABLE"?(c(),b("div",dl,[i(T,{modelValue:e.requisiteDialog.data.defaultValue,"onUpdate:modelValue":t[10]||(t[10]=a=>e.requisiteDialog.data.defaultValue=a),options:e.getDefaultMacros("CALCULATABLE").filter(a=>!a.disabled),optionLabel:"label",optionValue:"value",placeholder:"Выберите формулу",class:te(["w-full",{"p-invalid":!e.requisiteDialog.data.defaultValue}])},null,8,["modelValue","options","class"]),l("div",cl,[t[45]||(t[45]=l("div",{class:"flex align-items-center gap-2 mb-2"},[l("i",{class:"pi pi-info-circle text-primary"}),l("span",{class:"font-semibold"},"CALCULATABLE:")],-1)),l("ul",ul,[t[43]||(t[43]=l("li",null,[ee("Значение вычисляется "),l("strong",null,"один раз"),ee(" при создании записи")],-1)),t[44]||(t[44]=l("li",null,[ee("Поле "),l("strong",null,"нельзя редактировать"),ee(" (read-only)")],-1)),l("li",null,'Пример: [TODAY] → "'+k(new Date().toLocaleDateString("ru-RU"))+'"',1)])])])):(c(),b("div",pl,[i(_,{id:"reqDefault",modelValue:e.requisiteDialog.data.defaultValue,"onUpdate:modelValue":t[11]||(t[11]=a=>e.requisiteDialog.data.defaultValue=a),placeholder:"Значение или макрос",class:"flex-grow-1"},null,8,["modelValue"]),e.getDefaultMacros(e.requisiteDialog.data.type).length>0?(c(),X(T,{key:0,options:e.getDefaultMacros(e.requisiteDialog.data.type),optionLabel:"label",optionValue:"value",placeholder:"Макросы",onChange:t[12]||(t[12]=a=>e.requisiteDialog.data.defaultValue=a.value),class:"w-12rem"},null,8,["options"])):E("",!0)])),e.requisiteDialog.data.type!=="CALCULATABLE"&&e.getDefaultMacros(e.requisiteDialog.data.type).length>0?(c(),b("small",fl," Выберите макрос из списка или введите значение вручную ")):E("",!0)])])]),_:1},8,["visible","header"]),i(w,{visible:e.deleteDialog.visible,"onUpdate:visible":t[16]||(t[16]=a=>e.deleteDialog.visible=a),header:"Подтверждение удаления",modal:!0,style:{width:"450px"}},{footer:R(()=>[l("div",vl,[i(o,{label:"Отмена",icon:"pi pi-times",onClick:t[15]||(t[15]=a=>e.deleteDialog.visible=!1),text:"","aria-label":"Отменить удаление"}),i(o,{label:"Удалить",icon:"pi pi-trash",severity:"danger",onClick:e.executeDelete,"aria-label":"Подтвердить удаление"})])]),default:R(()=>[l("div",yl,[t[48]||(t[48]=l("i",{class:"pi pi-exclamation-triangle text-4xl text-warning"},null,-1)),l("span",null,[t[46]||(t[46]=ee(" Вы уверены, что хотите удалить ",-1)),l("strong",null,k(e.deleteDialog.itemName),1),t[47]||(t[47]=ee("? ",-1))])])]),_:1},8,["visible"]),i(w,{visible:e.subordinateTypeDialog.visible,"onUpdate:visible":t[20]||(t[20]=a=>e.subordinateTypeDialog.visible=a),header:"Создать подчинённый тип",modal:!0,style:{width:"500px"}},{footer:R(()=>[l("div",Rl,[i(o,{label:"Отмена",icon:"pi pi-times",onClick:t[19]||(t[19]=a=>e.subordinateTypeDialog.visible=!1),text:"","aria-label":"Отменить"}),i(o,{label:"Создать",icon:"pi pi-plus",onClick:e.createSubordinateType,disabled:!e.subordinateTypeDialog.name,loading:e.loading.createSubordinate,"aria-label":"Создать подчинённый тип"},null,8,["disabled","loading"])])]),default:R(()=>{var a;return[l("div",bl,[l("div",gl,[t[49]||(t[49]=l("div",{class:"flex align-items-center gap-2 mb-2"},[l("i",{class:"pi pi-info-circle text-primary"}),l("span",{class:"font-semibold"},"Родительский тип:")],-1)),l("div",Tl,k((a=e.subordinateTypeDialog.parentType)==null?void 0:a.name),1),t[50]||(t[50]=l("small",{class:"text-color-secondary"}," Подчинённый тип будет связан с записями родительского типа ",-1))]),l("div",hl,[t[51]||(t[51]=l("label",{for:"subordinateTypeName"},"Название подчинённого типа *",-1)),i(_,{id:"subordinateTypeName",modelValue:e.subordinateTypeDialog.name,"onUpdate:modelValue":t[17]||(t[17]=n=>e.subordinateTypeDialog.name=n),placeholder:"Например: Детали заказа",class:"w-full",onKeyup:Ze(e.createSubordinateType,["enter"])},null,8,["modelValue"])]),l("div",_l,[i(C,{id:"subordinateTypeUnique",modelValue:e.subordinateTypeDialog.unique,"onUpdate:modelValue":t[18]||(t[18]=n=>e.subordinateTypeDialog.unique=n),binary:!0},null,8,["modelValue"]),t[52]||(t[52]=l("label",{for:"subordinateTypeUnique",class:"ml-2"},"Уникальный (первый столбец)",-1))])])]}),_:1},8,["visible"]),i(w,{visible:e.editTypeDialog.visible,"onUpdate:visible":t[24]||(t[24]=a=>e.editTypeDialog.visible=a),header:"Редактировать тип",modal:!0,style:{width:"500px"}},{footer:R(()=>[l("div",Il,[i(o,{label:"Отмена",icon:"pi pi-times",onClick:t[23]||(t[23]=a=>e.editTypeDialog.visible=!1),text:"","aria-label":"Отменить"}),i(o,{label:"Сохранить",icon:"pi pi-check",onClick:e.saveEditedType,disabled:!e.editTypeDialog.name,loading:e.loading.editType,"aria-label":"Сохранить изменения"},null,8,["disabled","loading"])])]),default:R(()=>{var a;return[l("div",wl,[l("div",Dl,[t[53]||(t[53]=l("div",{class:"flex align-items-center gap-2 mb-2"},[l("i",{class:"pi pi-pencil text-primary"}),l("span",{class:"font-semibold"},"Редактирование типа:")],-1)),l("div",kl,k(e.editTypeDialog.originalName),1),l("small",El," ID: "+k((a=e.editTypeDialog.type)==null?void 0:a.id),1)]),l("div",Cl,[t[54]||(t[54]=l("label",{for:"editTypeName"},"Название типа *",-1)),i(_,{id:"editTypeName",modelValue:e.editTypeDialog.name,"onUpdate:modelValue":t[21]||(t[21]=n=>e.editTypeDialog.name=n),placeholder:"Название типа",class:"w-full",onKeyup:Ze(e.saveEditedType,["enter"])},null,8,["modelValue"])]),l("div",xl,[i(C,{id:"editTypeUnique",modelValue:e.editTypeDialog.unique,"onUpdate:modelValue":t[22]||(t[22]=n=>e.editTypeDialog.unique=n),binary:!0},null,8,["modelValue"]),t[55]||(t[55]=l("label",{for:"editTypeUnique",class:"ml-2"},"Уникальный (первый столбец)",-1))]),i(be,{severity:"info",closable:!1,class:"mt-2"},{default:R(()=>[...t[56]||(t[56]=[l("small",null," Базовый тип нельзя изменить после создания. Для изменения базового типа создайте новый тип и перенесите данные. ",-1)])]),_:1})])]}),_:1},8,["visible"])])}const Sl=Ne(oa,[["render",ql],["__scopeId","data-v-c53c2018"],["__file","/home/hive/integram-standalone/src/components/integram/IntegramTypeEditor.vue"]]),Al={__name:"IntegramTypeEditor",setup(fe,{expose:t}){t();const re=$e(),e=et(),$=Me(),{isAuthenticated:v,database:V}=tt(),S=N(!1),A=N(""),_=N(null),T=Y(()=>V.value||"integram"),C=Y(()=>re.query.typeId),o=Y(()=>[{label:"Структура",icon:"pi pi-sitemap"}]);function g(B){e.push(`/integram/${T.value}/object/${B}`)}async function r(){const B=e.currentRoute.value.fullPath;await e.replace("/integram-reload-placeholder"),await e.replace(B)}Ie(async()=>{try{if(!v.value){A.value="Не авторизован. Требуется вход в систему.",setTimeout(()=>{e.replace("/integram/login")},2e3);return}const B=O.getAuthInfo();if(!B||!B.token){A.value="Сессия истекла. Требуется повторный вход.",setTimeout(()=>{e.replace("/integram/login")},2e3);return}_.value={sessionId:B.token,database:B.database||T.value,user:B.user},S.value=!0,C.value&&$.add({severity:"info",summary:"Редактирование типа",detail:`Тип ID: ${C.value}. Найдите его в списке ниже.`,life:5e3})}catch(B){console.error("Session initialization error:",B),A.value=B.message||"Ошибка инициализации сессии"}});const L={route:re,router:e,toast:$,isAuthenticated:v,sessionDatabase:V,sessionReady:S,errorMessage:A,sessionData:_,database:T,initialTypeId:C,breadcrumbItems:o,viewTable:g,refresh:r,ref:N,computed:Y,onMounted:Ie,get useRoute(){return $e},get useRouter(){return et},get useToast(){return Me},get useIntegramSession(){return tt},get integramApiClient(){return O},IntegramTypeEditorComponent:Sl,IntegramBreadcrumb:gt};return Object.defineProperty(L,"__isScriptSetup",{enumerable:!1,value:!0}),L}},Ll={class:"integram-type-editor-page"},Ol={class:"text-center py-5"},Ml={class:"text-center py-5"};function Nl(fe,t,re,e,$,v){const V=x("ProgressSpinner"),S=x("Card"),A=x("Message"),_=x("Button");return c(),b("div",Ll,[i(e.IntegramBreadcrumb,{items:e.breadcrumbItems},null,8,["items"]),e.sessionReady?e.errorMessage?(c(),X(S,{key:1},{content:R(()=>[l("div",Ml,[i(A,{severity:"error",closable:!1},{default:R(()=>[ee(k(e.errorMessage),1)]),_:1}),i(_,{label:"Вернуться к списку таблиц",icon:"pi pi-arrow-left",class:"mt-3",onClick:t[0]||(t[0]=T=>e.router.push(`/integram/${e.database}/dict`))})])]),_:1})):(c(),X(e.IntegramTypeEditorComponent,{key:2,session:e.sessionData,onViewTable:e.viewTable,onRefresh:e.refresh},null,8,["session"])):(c(),X(S,{key:0},{content:R(()=>[l("div",Ol,[i(V),t[1]||(t[1]=l("p",{class:"mt-3"},"Инициализация сессии...",-1))])]),_:1}))])}const zl=Ne(Al,[["render",Nl],["__scopeId","data-v-d808c674"],["__file","/home/hive/integram-standalone/src/views/pages/Integram/IntegramTypeEditor.vue"]]);export{zl as default};
