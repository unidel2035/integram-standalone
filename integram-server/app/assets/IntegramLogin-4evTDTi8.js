import{D as e,r as a,J as l,U as s,K as t,N as o,c as r,a as n,b as i,e as u,A as c,C as d,I as v,t as m,F as g,d as p,a1 as b,G as f,h as w,a2 as h,g as y,H as k,V as x,a3 as L,w as S,a4 as C,a5 as I,L as V,u as T,o as P,j as _,f as D}from"./index-m6PXRYQN.js";import{i as G}from"./integramApiClient-BsYdo77J.js";import{i as j}from"./integramService-BCsancml.js";import{g as U}from"./redirectValidation-bZ15dJ-D.js";import{_ as R}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./index-CcrxTH1M.js";import"./unifiedAuthService-6fZILgG8.js";const A={class:"integram-login-page flex align-items-center justify-content-center min-h-screen"},N={class:"surface-card p-5 shadow-2 border-round",style:{"max-width":"450px",width:"100%"}},E={class:"flex align-items-center mb-4",style:{width:"100%","justify-content":"space-between"}},M={class:"flex gap-1"},z={key:0,class:"databases-section mb-4"},O={class:"db-category-card mb-3"},$={class:"category-header"},H={class:"flex flex-wrap gap-2 justify-content-center"},q={key:0,class:"db-category-card"},B={class:"category-header secondary"},K={class:"flex flex-wrap gap-2 justify-content-center"},Q={class:"mt-3"},W={class:"text-center mb-4"},F={key:0,class:"field mb-3"},Y={for:"server",class:"block text-sm font-medium mb-2"},Z={class:"text-center mb-3"},J={class:"field mb-3"},X={for:"database",class:"block text-sm font-medium mb-2"},ee={key:0,class:"p-error"},ae={class:"field mb-3"},le={for:"login",class:"block text-sm font-medium mb-2"},se={key:0,class:"p-error"},te={class:"field mb-3"},oe={for:"password",class:"block text-sm font-medium mb-2"},re={key:0,class:"p-error"},ne={class:"flex text-sm mb-3",style:{"justify-content":"space-between"}},ie={class:"text-center"},ue={class:"text-center mb-4"},ce={class:"field mb-3"},de={for:"email",class:"block text-sm font-medium mb-2"},ve={key:0,class:"p-error"},me={class:"field mb-3"},ge={for:"regPassword",class:"block text-sm font-medium mb-2"},pe={key:0,class:"p-error"},be={class:"field mb-3"},fe={for:"regPassword2",class:"block text-sm font-medium mb-2"},we={key:0,class:"p-error"},he={class:"flex align-items-center gap-2 mb-3"},ye={for:"agree",class:"text-sm"},ke={class:"text-center"},xe={class:"text-center mb-4"},Le={class:"text-sm text-color-secondary mb-3"},Se={class:"field mb-3"},Ce={for:"resetDb",class:"block text-sm font-medium mb-2"},Ie={class:"field mb-3"},Ve={for:"resetLogin",class:"block text-sm font-medium mb-2"},Te={key:0,class:"p-error"},Pe={class:"text-center"},_e={key:4,class:"mt-4 pt-4 border-top-1 surface-border"},De={class:"text-center mb-3"},Ge={class:"text-center text-sm mb-3"},je={class:"flex justify-content-center gap-2 mb-3"},Ue={key:0,class:"text-sm text-color-secondary"},Re=["innerHTML"],Ae=["innerHTML"],Ne={class:"text-center mt-3"},Ee=R({__name:"IntegramLogin",setup(R){const Ee=V(),Me=o(),ze=e(),Oe=a("login"),$e=a(!1),He=a(null),qe=a(!1),Be=a(!1),Ke=a(!1),Qe=a(null),We=a("ru"),Fe=a({}),Ye=a(!1),Ze=a([{label:"dronedoc.ru",value:"https://dronedoc.ru"},{label:"integram.io",value:"https://integram.io"},{label:"app.integram.io",value:"https://app.integram.io"}]),Je={my:"https://dronedoc.ru",a2025:"https://dronedoc.ru",andy:"https://app.integram.io"},Xe=a({server:"https://dronedoc.ru",database:"my",login:"",password:""}),ea=a({email:"",password:"",password2:"",agree:!1}),aa=a({database:"",login:""}),la=l(()=>{const e=[];for(const[a,l]of Object.entries(G.databases))e.push({name:a,userName:l.userName,userRole:l.userRole,isPrimary:"my"===a});return e.sort((e,a)=>"my"===e.name?-1:"my"===a.name?1:e.name.localeCompare(a.name))}),sa=l(()=>{const e=G.databases.my;return e&&e.ownedDatabases?e.ownedDatabases.filter(e=>!G.databases[e]):[]});s(()=>Xe.value.database,e=>{Je[e]&&(Xe.value.server=Je[e])});const ta={en:{loginTitle:"Sign in",registerTitle:"Create account",resetPasswordTitle:"Reset password",server:"Server",showServerInput:"Change server",hideServerInput:"Hide server",database:"Database",loginLabel:"Login",password:"Password",signIn:"Sign in",resetPassword:"Forgot password?",cantLogin:"Can't login?",createAccount:"Create account",wrongCredentials:"Invalid credentials",email:"Email",repeatPassword:"Repeat password",acceptTerms:"I accept the",termsLink:"Terms of Service",register:"Register",haveAccount:"Already have an account?",resetInstructions:"Enter your database name and login or email to receive a new password.",loginOrEmail:"Login / Email",sendPassword:"Send password",cancel:"Cancel",registrationSuccess:"Registration successful! Check your email.",resetSuccess:"New password sent to your email",signInWithGoogle:"Sign in with Google",helpTitle:"Login help",helpQuestion:"Did you register with Google?",yes:"Yes",no:"No",dontRemember:"Don't remember",helpGoogle:"If you registered with a different Google account, try signing in with that account.",helpNoGoogle:"Check your email for the registration link. You can also reset your password.",helpUnknown:"Try signing in with Google or contact us in Telegram.",backToLogin:"Back to login",activeDatabases:"Active Databases",ownedDatabases:"Owned databases",enterDatabase:"Enter",logout:"Logout"},ru:{loginTitle:"Вход",registerTitle:"Регистрация",resetPasswordTitle:"Сброс пароля",server:"Сервер",showServerInput:"Сменить сервер",hideServerInput:"Скрыть",database:"База данных",loginLabel:"Логин",password:"Пароль",signIn:"Войти",resetPassword:"Забыли пароль?",cantLogin:"Не могу войти",createAccount:"Регистрация",wrongCredentials:"Неверный логин или пароль",email:"Email",repeatPassword:"Повторите пароль",acceptTerms:"Я принимаю",termsLink:"условия использования",register:"Зарегистрироваться",haveAccount:"Уже есть аккаунт?",resetInstructions:"Введите название базы и логин или email для получения нового пароля.",loginOrEmail:"Логин / Email",sendPassword:"Отправить пароль",cancel:"Отмена",registrationSuccess:"Регистрация успешна! Проверьте почту.",resetSuccess:"Новый пароль отправлен на почту",signInWithGoogle:"Войти через Google",helpTitle:"Помощь",helpQuestion:"Вы регистрировались через Google?",yes:"Да",no:"Нет",dontRemember:"Не помню",helpGoogle:"Попробуйте войти под другой учётной записью Google.",helpNoGoogle:"Проверьте почту с регистрацией. Также можно сбросить пароль.",helpUnknown:"Попробуйте войти через Google или напишите нам в Telegram.",backToLogin:"Назад",activeDatabases:"Активные базы данных",ownedDatabases:"Доступные БД",enterDatabase:"Войти",logout:"Выйти"}},oa=e=>{var a;return(null==(a=ta[We.value])?void 0:a[e])||e};async function ra(e){try{await G.switchDatabase(e),ze.add({severity:"success",summary:oa("enterDatabase"),detail:e,life:2e3}),Ee.push(`/integram/${e}/`)}catch(a){ze.add({severity:"error",summary:"Ошибка",detail:a.message,life:5e3})}}async function na(){try{G.databases={},ze.add({severity:"info",summary:oa("logout"),detail:"Вы вышли из всех баз данных",life:2e3}),Xe.value={server:"https://dronedoc.ru",database:"my",login:"",password:""}}catch(e){}}async function ia(){if(Fe.value={},Xe.value.login||(Fe.value.login="Обязательное поле"),Xe.value.password||(Fe.value.password="Обязательное поле"),0===Object.keys(Fe.value).length)try{$e.value=!0,He.value=null,Xe.value.database||(Xe.value.database="my");const e=Xe.value.server||"https://dronedoc.ru";G.setServer(e);const a=await G.authenticate(Xe.value.database,Xe.value.login,Xe.value.password);if(!a.success)throw new Error("Authentication failed");{j.setServer(e),j.setDatabase(Xe.value.database),j.authToken=a.token,j.xsrfToken=a.xsrf,j.userId=a.userId,j.userName=a.userName,j.userRole=a.userRole,j.authDatabase=Xe.value.database,j.saveSession(),localStorage.setItem("token",a.token),localStorage.setItem("_xsrf",a.xsrf||""),localStorage.setItem("user",a.userName||Xe.value.login),localStorage.setItem("id",a.userId||""),localStorage.setItem("db",Xe.value.database),localStorage.setItem("session_timestamp",Date.now().toString()),ze.add({severity:"success",summary:"Успешно",detail:"Вход выполнен",life:3e3});const l=`/integram/${Xe.value.database}/`,s=U(Me.query.redirect,l);Ee.push(s)}}catch(e){He.value=e.message}finally{$e.value=!1}}async function ua(){if(Fe.value={},ea.value.email||(Fe.value.email="Обязательное поле"),(!ea.value.password||ea.value.password.length<6)&&(Fe.value.regPassword="Минимум 6 символов"),ea.value.password!==ea.value.password2&&(Fe.value.regPassword2="Пароли не совпадают"),ea.value.agree||(Fe.value.agree=!0),0===Object.keys(Fe.value).length)try{$e.value=!0,He.value=null;const e=Xe.value.server||"https://dronedoc.ru";G.setServer(e),(await G.register({email:ea.value.email,password:ea.value.password,agree:ea.value.agree})).success&&(qe.value=!0,setTimeout(()=>{Oe.value="login",qe.value=!1,ea.value={email:"",password:"",password2:"",agree:!1}},3e3))}catch(e){He.value=e.message}finally{$e.value=!1}}async function ca(){if(Fe.value={},aa.value.login||(Fe.value.resetLogin="Обязательное поле"),0===Object.keys(Fe.value).length)try{$e.value=!0,He.value=null;const e=Xe.value.server||"https://dronedoc.ru";G.setServer(e),(await G.resetPassword({database:aa.value.database,login:aa.value.login})).success&&(Be.value=!0,setTimeout(()=>{Oe.value="login",Be.value=!1,aa.value={database:"",login:""}},3e3))}catch(e){He.value=e.message}finally{$e.value=!1}}function da(){const e=`${window.location.origin}/auth.asp`,a=Xe.value.database||"",l=`https://accounts.google.com/o/oauth2/auth?client_id=315358679657-oiaca19e5b44p73a5fl20e4q60sa7q4m.apps.googleusercontent.com&redirect_uri=${e}&response_type=code&scope=${encodeURIComponent("https://www.googleapis.com/auth/userinfo.email https://www.googleapis.com/auth/userinfo.profile")}&state=${a}`;window.location.href=l}return t(()=>{G.tryRestoreSession();const e=localStorage.getItem("integram_locale");e?We.value=e:(We.value="ru",localStorage.setItem("integram_locale","ru"));const a=localStorage.getItem("integram_server")||G.getServer();a&&"https://dronedoc.ru"!==a&&(Ye.value=!0,Xe.value.server=a),"#reg"===Me.hash?Oe.value="register":"#change"===Me.hash&&(Oe.value="reset")}),s(We,e=>localStorage.setItem("integram_locale",e)),(e,a)=>{const l=T("tooltip");return P(),r("div",A,[n("div",N,[n("div",E,[a[22]||(a[22]=u('<div class="flex align-items-center gap-2" data-v-accbd12f><svg width="40" height="34" viewBox="0 0 40 34" fill="none" xmlns="http://www.w3.org/2000/svg" class="integram-logo flex-shrink-0" data-v-accbd12f><g clip-path="url(#clip0_login)" data-v-accbd12f><path d="M21.0983 12.4256L19.5194 14.1254L22.2153 17.0289L13.4346 26.3889L2.28812 22.7817V11.2779L13.4346 7.67068L15.452 9.87038L17.0454 8.19038L14.1005 5L0 9.56361V24.4959L14.1005 29.0595L25.3877 17.0289L21.0983 12.4256Z" fill="currentColor" data-v-accbd12f></path><path d="M15.4718 21.634L17.0489 19.9341L14.3548 17.0307L23.1356 7.67068L34.2802 11.2779V22.7817L23.1356 26.3889L21.1127 24.1838L19.5193 25.8656L22.4679 29.0595L36.5683 24.4977V9.56361L22.4679 5L11.1807 17.0307L15.4718 21.634Z" fill="currentColor" data-v-accbd12f></path></g><defs data-v-accbd12f><clipPath id="clip0_login" data-v-accbd12f><rect width="36.6316" height="24" fill="white" transform="translate(0 5)" data-v-accbd12f></rect></clipPath></defs></svg><span class="text-2xl font-semibold" data-v-accbd12f>Integram</span></div>',1)),n("div",M,[c(d(v),{label:"RU",severity:"ru"===We.value?"primary":"secondary",size:"small",onClick:a[0]||(a[0]=e=>We.value="ru"),text:"ru"!==We.value},null,8,["severity","text"]),c(d(v),{label:"EN",severity:"en"===We.value?"primary":"secondary",size:"small",onClick:a[1]||(a[1]=e=>We.value="en"),text:"en"!==We.value},null,8,["severity","text"])])]),la.value.length>0&&"login"===Oe.value?(P(),r("div",z,[n("div",O,[n("div",$,[a[23]||(a[23]=n("i",{class:"pi pi-check-circle"},null,-1)),n("span",null,m(oa("activeDatabases")),1)]),n("div",H,[(P(!0),r(g,null,p(la.value,e=>_((P(),w(d(v),{key:e.name,label:e.name,severity:"success",outlined:"",onClick:a=>ra(e.name)},{icon:S(()=>[...a[24]||(a[24]=[n("i",{class:"pi pi-database mr-2"},null,-1)])]),_:1},8,["label","onClick"])),[[l,`${oa("enterDatabase")}: ${e.name}`,void 0,{top:!0}]])),128))])]),sa.value.length>0?(P(),r("div",q,[n("div",B,[a[25]||(a[25]=n("i",{class:"pi pi-server"},null,-1)),n("span",null,m(oa("ownedDatabases")),1)]),n("div",K,[(P(!0),r(g,null,p(sa.value,e=>(P(),w(d(v),{key:e,label:e,size:"small",outlined:"",onClick:a=>ra(e)},{icon:S(()=>[...a[26]||(a[26]=[n("i",{class:"pi pi-database mr-2"},null,-1)])]),_:1},8,["label","onClick"]))),128))])])):i("",!0),c(d(b)),n("div",Q,[c(d(v),{label:oa("logout"),icon:"pi pi-sign-out",severity:"danger",size:"small",class:"w-full",onClick:na},null,8,["label"])])])):i("",!0),"login"===Oe.value?(P(),r("form",{key:1,onSubmit:f(ia,["prevent"])},[n("h4",W,m(oa("loginTitle")),1),Ye.value?(P(),r("div",F,[n("label",Y,m(oa("server")),1),c(d(h),{id:"server",modelValue:Xe.value.server,"onUpdate:modelValue":a[2]||(a[2]=e=>Xe.value.server=e),options:Ze.value,optionLabel:"label",optionValue:"value",class:"w-full"},null,8,["modelValue","options"])])):i("",!0),n("div",Z,[n("a",{href:"#",onClick:a[3]||(a[3]=f(e=>Ye.value=!Ye.value,["prevent"])),class:"text-sm text-primary"},m(Ye.value?oa("hideServerInput"):oa("showServerInput")),1)]),n("div",J,[n("label",X,m(oa("database")),1),c(d(k),{id:"database",modelValue:Xe.value.database,"onUpdate:modelValue":a[4]||(a[4]=e=>Xe.value.database=e),class:y(["w-full",{"p-invalid":Fe.value.database}])},null,8,["modelValue","class"]),Fe.value.database?(P(),r("small",ee,m(Fe.value.database),1)):i("",!0)]),n("div",ae,[n("label",le,m(oa("loginLabel")),1),c(d(k),{id:"login",modelValue:Xe.value.login,"onUpdate:modelValue":a[5]||(a[5]=e=>Xe.value.login=e),class:y(["w-full",{"p-invalid":Fe.value.login}]),onKeyup:x(ia,["enter"])},null,8,["modelValue","class"]),Fe.value.login?(P(),r("small",se,m(Fe.value.login),1)):i("",!0)]),n("div",te,[n("label",oe,m(oa("password")),1),c(d(L),{id:"password",modelValue:Xe.value.password,"onUpdate:modelValue":a[6]||(a[6]=e=>Xe.value.password=e),feedback:!1,toggleMask:"",class:y(["w-full",{"p-invalid":Fe.value.password}]),inputClass:"w-full",onKeyup:x(ia,["enter"])},null,8,["modelValue","class"]),Fe.value.password?(P(),r("small",re,m(Fe.value.password),1)):i("",!0)]),He.value?(P(),w(d(C),{key:1,severity:"error",closable:!1,class:"mb-3"},{default:S(()=>[D(m(oa("wrongCredentials")),1)]),_:1})):i("",!0),c(d(v),{type:"submit",label:oa("signIn"),loading:$e.value,class:"w-full mb-3"},null,8,["label","loading"]),n("div",ne,[n("a",{href:"#",onClick:a[7]||(a[7]=f(e=>Oe.value="reset",["prevent"])),class:"text-primary"},m(oa("resetPassword")),1),n("a",{href:"#",onClick:a[8]||(a[8]=f(e=>Ke.value=!0,["prevent"])),class:"text-primary"},m(oa("cantLogin")),1)]),c(d(b)),c(d(v),{label:oa("signInWithGoogle"),icon:"pi pi-google",outlined:"",class:"w-full mb-3",onClick:da},null,8,["label"]),n("div",ie,[n("a",{href:"#",onClick:a[9]||(a[9]=f(e=>Oe.value="register",["prevent"])),class:"text-primary"},m(oa("createAccount")),1)])],32)):"register"===Oe.value?(P(),r("form",{key:2,onSubmit:f(ua,["prevent"])},[n("h4",ue,m(oa("registerTitle")),1),n("div",ce,[n("label",de,m(oa("email")),1),c(d(k),{id:"email",modelValue:ea.value.email,"onUpdate:modelValue":a[10]||(a[10]=e=>ea.value.email=e),type:"email",class:y(["w-full",{"p-invalid":Fe.value.email}])},null,8,["modelValue","class"]),Fe.value.email?(P(),r("small",ve,m(Fe.value.email),1)):i("",!0)]),n("div",me,[n("label",ge,m(oa("password")),1),c(d(L),{id:"regPassword",modelValue:ea.value.password,"onUpdate:modelValue":a[11]||(a[11]=e=>ea.value.password=e),feedback:!0,toggleMask:"",class:y(["w-full",{"p-invalid":Fe.value.regPassword}]),inputClass:"w-full"},null,8,["modelValue","class"]),Fe.value.regPassword?(P(),r("small",pe,m(Fe.value.regPassword),1)):i("",!0)]),n("div",be,[n("label",fe,m(oa("repeatPassword")),1),c(d(L),{id:"regPassword2",modelValue:ea.value.password2,"onUpdate:modelValue":a[12]||(a[12]=e=>ea.value.password2=e),feedback:!1,toggleMask:"",class:y(["w-full",{"p-invalid":Fe.value.regPassword2}]),inputClass:"w-full"},null,8,["modelValue","class"]),Fe.value.regPassword2?(P(),r("small",we,m(Fe.value.regPassword2),1)):i("",!0)]),n("div",he,[c(d(I),{id:"agree",modelValue:ea.value.agree,"onUpdate:modelValue":a[13]||(a[13]=e=>ea.value.agree=e),binary:!0,class:y({"p-invalid":Fe.value.agree})},null,8,["modelValue","class"]),n("label",ye,m(oa("acceptTerms"))+" "+m(oa("termsLink")),1)]),qe.value?(P(),w(d(C),{key:0,severity:"success",closable:!1,class:"mb-3"},{default:S(()=>[D(m(oa("registrationSuccess")),1)]),_:1})):i("",!0),He.value?(P(),w(d(C),{key:1,severity:"error",closable:!1,class:"mb-3"},{default:S(()=>[D(m(He.value),1)]),_:1})):i("",!0),qe.value?i("",!0):(P(),w(d(v),{key:2,type:"submit",label:oa("register"),loading:$e.value,class:"w-full mb-3"},null,8,["label","loading"])),n("div",ke,[n("a",{href:"#",onClick:a[14]||(a[14]=f(e=>Oe.value="login",["prevent"])),class:"text-primary"},m(oa("haveAccount")),1)])],32)):"reset"===Oe.value?(P(),r("form",{key:3,onSubmit:f(ca,["prevent"])},[n("h4",xe,m(oa("resetPasswordTitle")),1),n("p",Le,m(oa("resetInstructions")),1),n("div",Se,[n("label",Ce,m(oa("database")),1),c(d(k),{id:"resetDb",modelValue:aa.value.database,"onUpdate:modelValue":a[15]||(a[15]=e=>aa.value.database=e),class:y(["w-full",{"p-invalid":Fe.value.resetDb}])},null,8,["modelValue","class"])]),n("div",Ie,[n("label",Ve,m(oa("loginOrEmail")),1),c(d(k),{id:"resetLogin",modelValue:aa.value.login,"onUpdate:modelValue":a[16]||(a[16]=e=>aa.value.login=e),class:y(["w-full",{"p-invalid":Fe.value.resetLogin}])},null,8,["modelValue","class"]),Fe.value.resetLogin?(P(),r("small",Te,m(Fe.value.resetLogin),1)):i("",!0)]),Be.value?(P(),w(d(C),{key:0,severity:"success",closable:!1,class:"mb-3"},{default:S(()=>[D(m(oa("resetSuccess")),1)]),_:1})):i("",!0),He.value?(P(),w(d(C),{key:1,severity:"error",closable:!1,class:"mb-3"},{default:S(()=>[D(m(He.value),1)]),_:1})):i("",!0),Be.value?i("",!0):(P(),w(d(v),{key:2,type:"submit",label:oa("sendPassword"),loading:$e.value,class:"w-full mb-3"},null,8,["label","loading"])),n("div",Pe,[n("a",{href:"#",onClick:a[17]||(a[17]=f(e=>Oe.value="login",["prevent"])),class:"text-primary"},m(oa("cancel")),1)])],32)):i("",!0),Ke.value?(P(),r("div",_e,[n("h5",De,m(oa("helpTitle")),1),n("p",Ge,m(oa("helpQuestion")),1),n("div",je,[c(d(v),{label:oa("yes"),outlined:"",size:"small",onClick:a[18]||(a[18]=e=>Qe.value="google")},null,8,["label"]),c(d(v),{label:oa("no"),outlined:"",size:"small",onClick:a[19]||(a[19]=e=>Qe.value="noGoogle")},null,8,["label"]),c(d(v),{label:oa("dontRemember"),outlined:"",size:"small",onClick:a[20]||(a[20]=e=>Qe.value="unknown")},null,8,["label"])]),"google"===Qe.value?(P(),r("p",Ue,m(oa("helpGoogle")),1)):i("",!0),"noGoogle"===Qe.value?(P(),r("p",{key:1,class:"text-sm text-color-secondary",innerHTML:oa("helpNoGoogle")},null,8,Re)):i("",!0),"unknown"===Qe.value?(P(),r("p",{key:2,class:"text-sm text-color-secondary",innerHTML:oa("helpUnknown")},null,8,Ae)):i("",!0),n("div",Ne,[n("a",{href:"#",onClick:a[21]||(a[21]=f(e=>{Ke.value=!1,Qe.value=null},["prevent"])),class:"text-primary"},m(oa("backToLogin")),1)])])):i("",!0)])])}}},[["__scopeId","data-v-accbd12f"]]);export{Ee as default};
