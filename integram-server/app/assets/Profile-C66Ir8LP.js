import{y as e,c as a,o as i,b as l,i as s,A as t,n as r,r as o,L as n,J as c,h as p,w as d,a as u,t as m,F as g,d as v,g as f,C as h,aY as y}from"./index-DSwq2M__.js";import{r as S}from"./authStore-DwmLxo7g.js";import{_ as I}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./index-CcrxTH1M.js";import"./unifiedAuthService-6fZILgG8.js";const _={class:"component-loader-wrapper"},k={key:0,class:"component-loader-overlay"},x=I({name:"ComponentLoader",setup(){const e=o(!1),a=Symbol();return S(()=>e.value=!0,()=>e.value=!1,a),{isLoading:e}}},[["render",function(o,n,c,p,d,u){const m=e("ProgressSpinner");return i(),a("div",_,[p.isLoading?(i(),a("div",k,[t(m,{style:r([{width:"50px",height:"50px"},{color:"var(--primary-color)"}]),strokeWidth:"4",animationDuration:".5s"})])):l("",!0),s(o.$slots,"default",{},void 0,!0)])}],["__scopeId","data-v-8510030a"]]),b={class:"profile-content"},w={class:"profile-header p-4 flex align-items-center gap-3"},D={class:"m-0"},A={class:"text-color-secondary"},$={class:"profile-details p-4"},L={class:"field-name"},P={class:"field-key"},j={class:"field-value"},B={class:"mb-3 flex align-items-center api-base-field"},C={class:"field-name"},E={class:"field-value"},U={class:"mb-3 flex align-items-center api-base-field"},z={class:"field-name"},R={class:"field-value"},J={class:"profile-actions p-4 flex flex-column gap-3"},T=I({__name:"Profile",setup(l,{expose:s}){const r=n(),S=o(),I=o(!1),_=o({name:"",role:"",userId:null}),k=o({}),T=o(""),F=c(()=>localStorage.getItem("apiBase")||"не указан"),H=c(()=>localStorage.getItem("db")||"не указана"),K={"Пользователь":"pi pi-user","Имя":"pi pi-user",Email:"pi pi-envelope","Телефон":"pi pi-phone","Роль":"pi pi-briefcase","Дата":"pi pi-calendar","Примечание":"pi pi-file","Фото":"pi pi-image",Activity:"pi pi-clock",Secret:"pi pi-eye-slash",Password:"pi pi-lock",Token:"pi pi-key",xsrf:"pi pi-shield","Организация":"pi pi-building","Токен":"pi pi-wallet","Репутация":"pi pi-star",Telegram:"pi pi-send","Шаблон задач":"pi pi-list","Задача игрока":"pi pi-check-circle","Субъект РФ":"pi pi-map","Должность":"pi pi-id-card","API Base":"pi pi-server"},N=(e,a)=>a?"Дата"===e||"Activity"===e?O(a):a:"",O=e=>{try{if(10===e.toString().length)return new Date(1e3*e).toLocaleDateString("ru-RU");if(13===e.toString().length)return new Date(e).toLocaleDateString("ru-RU");if(8===e.toString().length){const a=e.toString(),i=a.substring(0,4),l=a.substring(4,6),s=a.substring(6,8);return new Date(`${i}-${l}-${s}`).toLocaleDateString("ru-RU")}return e}catch(a){return e}},V=()=>{I.value=!0,(async()=>{try{const e=localStorage.getItem("db")||"a2025",a=localStorage.getItem("apiBase")||window.location.hostname,i=localStorage.getItem("token");if(!i)return void(_.value.name="Не авторизован");const l=`${"localhost"===a?"http":"https"}://${"localhost"===a?"localhost":a}/${e}/xsrf?JSON_KV=true`,s={"X-Authorization":i},t=await fetch(l,{headers:s});if(t.ok){const e=await t.json();_.value={name:e.user||"Не указан",role:e.role||"",userId:e.id||null},localStorage.setItem("user",e.user||""),localStorage.setItem("id",e.id||""),k.value={ID:e.id,"Роль":e.role},e.id&&(async()=>{})(e.id)}else _.value.name=localStorage.getItem("user")||"Не авторизован",_.value.userId=localStorage.getItem("id")}catch(e){_.value.name=localStorage.getItem("user")||"Не авторизован",_.value.userId=localStorage.getItem("id")}})()},W=()=>{I.value=!1},X=()=>{S.value.hide(),r.push("/profile/edit")},Y=()=>{["_xsrf","token","user","id","db","apiBase"].forEach(e=>localStorage.removeItem(e)),["my_token","my_user","my_id","my_xsrf"].forEach(e=>localStorage.removeItem(e)),["ddadmin_token","ddadmin_user","ddadmin_id","ddadmin_xsrf"].forEach(e=>localStorage.removeItem(e)),localStorage.removeItem("integram_session"),localStorage.removeItem("unified_auth_session_id");const e=localStorage.getItem("id");e&&localStorage.removeItem(`userPhoto_${e}`),localStorage.removeItem("currentUserPhoto"),S.value.hide(),r.push("/")};return s({toggle:e=>S.value.toggle(e),hide:()=>S.value.hide()}),(l,s)=>{const r=e("Avatar"),o=e("Divider"),n=e("Button");return i(),p(h(y),{ref_key:"op",ref:S,dismissable:!0,class:"profile-overlay",style:{width:"350px"},onShow:V,onHide:W},{default:d(()=>[t(x,null,{default:d(()=>[u("div",b,[u("div",w,[T.value?(i(),p(r,{key:0,image:T.value,size:"xlarge",shape:"circle",class:"avatar-large"},null,8,["image"])):(i(),p(r,{key:1,icon:"pi pi-user",size:"xlarge",shape:"circle",class:"avatar-large"})),u("div",null,[u("h3",D,m(_.value.name),1),u("span",A,m(_.value.role),1)])]),u("div",$,[(i(!0),a(g,null,v(k.value,(e,l)=>{return i(),a("div",{key:l,class:"mb-3 flex align-items-center"},[u("span",L,[u("i",{class:f([(s=l,K[s]||"pi pi-info-circle"),"field-key mr-3"])},null,2),u("span",P,m(l)+":",1),u("span",j,m(N(l,e)),1)])]);var s}),128)),t(o),u("div",B,[u("span",C,[s[0]||(s[0]=u("i",{class:"pi pi-server field-key mr-3"},null,-1)),s[1]||(s[1]=u("span",{class:"field-key"},"API:",-1)),u("span",E,m(F.value),1)])]),u("div",U,[u("span",z,[s[2]||(s[2]=u("i",{class:"pi pi-database field-key mr-3"},null,-1)),s[3]||(s[3]=u("span",{class:"field-key"},"База данных:",-1)),u("span",R,m(H.value),1)])])]),u("div",J,[t(n,{label:"Редактировать профиль",icon:"pi pi-pencil",class:"w-full",severity:"secondary",outlined:"",onClick:X}),t(n,{label:"Выход",icon:"pi pi-sign-out",class:"w-full",severity:"danger",outlined:"",onClick:Y})])])]),_:1})]),_:1},512)}}},[["__scopeId","data-v-2157f05d"]]);export{T as default};
