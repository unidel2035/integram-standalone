import{D as e,r as l,J as a,K as o,c as t,A as n,a as u,y as i,w as s,L as d,u as r,o as c,b as p,h as m,F as v,d as f,C as b,j as h,t as g,f as V}from"./index-UE8Rfyf2.js";import{I as y}from"./IntegramBreadcrumb-CucIfBJX.js";import{i as x}from"./integramService-BCsancml.js";import{l as U}from"./logger-DLAyPY85.js";import{_ as $}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./integramApiClient-BsYdo77J.js";import"./index-CcrxTH1M.js";import"./unifiedAuthService-6fZILgG8.js";const N={class:"integram-query-builder-container"},w={class:"mb-3"},C={class:"flex align-items-center justify-content-between"},I={class:"flex gap-2 align-items-center ml-auto"},O={class:"query-builder-form"},L={class:"form-section mb-4"},k={class:"flex gap-2 mb-2"},T={key:0,class:"custom-expressions"},A={key:1,class:"aggregate-functions mt-3"},R={class:"flex gap-2 mt-2"},j={class:"form-section mb-4"},E={class:"form-section mb-4"},S={class:"flex justify-content-between align-items-center mb-2"},z={key:0},F={class:"flex gap-2 mb-2"},D={class:"flex gap-2"},_={class:"form-section mb-4"},G={class:"flex justify-content-between align-items-center mb-2"},M={key:0},B={class:"form-section mb-4"},J={class:"form-section mb-4"},q={class:"flex justify-content-between align-items-center mb-2"},P={key:0},H={key:1,class:"text-color-secondary"},K={class:"form-section mb-4"},Q={class:"flex justify-content-between align-items-center mb-2"},W={key:0,class:"set-expressions"},Y={class:"form-section mb-4"},X={class:"flex justify-content-between align-items-center mb-2"},Z={key:0},ee={class:"form-section mb-4"},le={class:"sql-preview-section mt-4"},ae={class:"flex justify-content-between align-items-center mb-3"},oe={class:"sql-preview-box"},te={key:0,class:"query-results-section mt-4"},ne={class:"mt-2 text-sm text-muted"},ue={class:"flex flex-column gap-3"},ie=$({__name:"IntegramQueryBuilder",setup($){const ie=d(),se=e(),de=l(null),re=l([]),ce=l([]),pe=l([]),me=l([]),ve=l([]),fe=l([]),be=l([]),he=l([]),ge=l([]),Ve=l(100),ye=l([]),xe=l([]),Ue=l(!1),$e=l(null),Ne=l(null),we=l(!1),Ce=l(""),Ie=l(""),Oe=l(!1),Le=Object.freeze(["INNER JOIN","LEFT JOIN","RIGHT JOIN","FULL JOIN"]),ke=Object.freeze(["=","!=",">","<",">=","<=","LIKE","IN","NOT IN","IS NULL","IS NOT NULL"]),Te=Object.freeze([{value:"COUNT",label:"COUNT - Количество"},{value:"COUNT_ALL",label:"COUNT(*) - Всего записей"},{value:"SUM",label:"SUM - Сумма"},{value:"AVG",label:"AVG - Среднее"},{value:"MAX",label:"MAX - Максимум"},{value:"MIN",label:"MIN - Минимум"},{value:"GROUP_CONCAT",label:"GROUP_CONCAT - Объединить"}]),Ae=Object.freeze([{value:"",label:"По умолчанию"},{value:"number",label:"Число"},{value:"decimal2",label:"Десятичное (2 знака)"},{value:"decimal4",label:"Десятичное (4 знака)"},{value:"currency",label:"Валюта (₽)"},{value:"percent",label:"Процент (%)"},{value:"date",label:"Дата"},{value:"datetime",label:"Дата и время"},{value:"time",label:"Время"},{value:"bool",label:"Да/Нет"}]),Re=Object.freeze({value:"*",label:"* (все колонки)"}),je=Object.freeze([Object.freeze({label:"Конструктор запросов",icon:"pi pi-sliders-h"})]),Ee=a(()=>je),Se=a(()=>de.value&&(re.value.length>0||pe.value.length>0)),ze=a(()=>[Re,...xe.value]),Fe=a(()=>pe.value.map((e,l)=>{let a="";return a="COUNT_ALL"===e.func?"COUNT(*)":`${e.func}(${e.column||"*"})`,e.alias&&(a+=` AS ${e.alias}`),{value:l,label:a}})),De=a(()=>{if(!de.value)return"-- Выберите таблицу для начала";let e="SELECT ";const l=[];if(re.value.length>0&&l.push(...re.value),ce.value.forEach(e=>{e.expression&&l.push(e.alias?`${e.expression} AS ${e.alias}`:e.expression)}),pe.value.forEach(e=>{if(e.func){let a="";a="COUNT_ALL"===e.func?"COUNT(*)":"GROUP_CONCAT"===e.func?`GROUP_CONCAT(${e.column||"*"})`:`${e.func}(${e.column||"*"})`,e.alias&&(a+=` AS ${e.alias}`),l.push(a)}}),0===l.length?e+="*":e+=l.join(", "),e+=`\nFROM ${de.value}`,me.value.forEach(l=>{l.table&&l.onLeft&&l.onRight&&(e+=`\n${l.type||"INNER JOIN"} ${l.table} ON ${l.onLeft} = ${l.onRight}`)}),ve.value.length>0){e+="\nWHERE ";const l=ve.value.map((e,l)=>{let a="";return l>0&&e.logic&&(a+=`${e.logic} `),"IS NULL"===e.operator||"IS NOT NULL"===e.operator?a+=`${e.field} ${e.operator}`:"IN"===e.operator||"NOT IN"===e.operator?a+=`${e.field} ${e.operator} (${e.value})`:"LIKE"===e.operator?a+=`${e.field} LIKE '%${e.value}%'`:a+=`${e.field} ${e.operator} '${e.value}'`,a}).join(" ");e+=l}if(fe.value.length>0&&(e+=`\nGROUP BY ${fe.value.join(", ")}`),be.value.length>0&&pe.value.length>0){e+="\nHAVING ";const l=be.value.map((e,l)=>{let a="";l>0&&e.logic&&(a+=`${e.logic} `);const o=e.aggregate,t=pe.value[o];if(t){let l="";l="COUNT_ALL"===t.func?"COUNT(*)":`${t.func}(${t.column||"*"})`,e.valueTo&&e.valueFrom?a+=`${l} BETWEEN ${e.valueFrom} AND ${e.valueTo}`:e.valueFrom&&(a+=`${l} ${e.operator||">"} ${e.valueFrom}`)}return a}).filter(e=>e).join(" ");l?e+=l:e=e.replace("\nHAVING ","")}if(ge.value.length>0){const l=ge.value.map(e=>`${e.column} ${e.direction||"ASC"}`).join(", ");e+=`\nORDER BY ${l}`}return Ve.value&&(e+=`\nLIMIT ${Ve.value}`),e});async function _e(){if(de.value)try{const e=ye.value.find(e=>e.value===de.value);if(!e)return;const l=parseInt(e.label.match(/ID: (\d+)/)[1]),a=await x.getMetadata(l);a&&a.reqs&&(xe.value=a.reqs.map(e=>({value:e.name||e.val,label:e.name||e.val})))}catch(e){U.error("Failed to load columns:",e),se.add({severity:"warn",summary:"Предупреждение",detail:"Не удалось загрузить колонки таблицы",life:3e3})}}function Ge(){ce.value.push({expression:"",alias:""})}function Me(){pe.value.push({func:"COUNT",column:"*",alias:"",format:""})}function Be(){me.value.push({type:"INNER JOIN",table:null,onLeft:"",onRight:""})}function Je(){ve.value.push({logic:"AND",field:"",operator:"=",value:""})}function qe(){ge.value.push({column:"",direction:"ASC"})}function Pe(){0!==pe.value.length?be.value.push({logic:"AND",aggregate:0,operator:">",valueFrom:"",valueTo:""}):se.add({severity:"warn",summary:"Предупреждение",detail:"Сначала добавьте хотя бы одну агрегатную функцию",life:3e3})}function He(){he.value.push({column:"",expression:""})}async function Ke(){if(Se.value){Ue.value=!0,Ne.value=null,$e.value=null;try{const e=await x.post("sql",{query:De.value,JSON:!0});if(e&&e.data){const l=e.columns||Object.keys(e.data[0]||{});$e.value={columns:l.map(e=>({field:e,header:e})),rows:e.data,total:e.total||e.data.length},se.add({severity:"success",summary:"Успех",detail:`Запрос выполнен. Получено ${$e.value.rows.length} записей`,life:3e3})}}catch(e){U.error("Query execution failed:",e),Ne.value="Ошибка выполнения запроса: "+e.message,se.add({severity:"error",summary:"Ошибка",detail:Ne.value,life:5e3})}finally{Ue.value=!1}}else se.add({severity:"warn",summary:"Предупреждение",detail:"Заполните обязательные поля",life:3e3})}function Qe(){navigator.clipboard.writeText(De.value).then(()=>{se.add({severity:"success",summary:"Скопировано",detail:"SQL запрос скопирован в буфер обмена",life:2e3})})}function We(){de.value=null,re.value=[],ce.value=[],pe.value=[],me.value=[],ve.value=[],fe.value=[],be.value=[],he.value=[],ge.value=[],Ve.value=100,$e.value=null,Ne.value=null,xe.value=[]}function Ye(){we.value=!0}async function Xe(){var e,l;if(Ce.value.trim()){Oe.value=!0;try{let a="";ve.value.length>0&&(a=ve.value.map((e,l)=>{let a="";return l>0&&e.logic&&(a+=`${e.logic} `),"IS NULL"===e.operator||"IS NOT NULL"===e.operator?a+=`${e.field} ${e.operator}`:"IN"===e.operator||"NOT IN"===e.operator?a+=`${e.field} ${e.operator} (${e.value})`:"LIKE"===e.operator?a+=`${e.field} LIKE '%${e.value}%'`:a+=`${e.field} ${e.operator} '${e.value}'`,a}).join(" "));let o="";ge.value.length>0&&(o=ge.value.map(e=>`${e.column} ${e.direction||"ASC"}`).join(", "));let t="";be.value.length>0&&pe.value.length>0&&(t=be.value.map((e,l)=>{let a="";l>0&&e.logic&&(a+=`${e.logic} `);const o=pe.value[e.aggregate];if(o){let l="COUNT_ALL"===o.func?"COUNT(*)":`${o.func}(${o.column||"*"})`;e.valueTo&&e.valueFrom?a+=`${l} BETWEEN ${e.valueFrom} AND ${e.valueTo}`:e.valueFrom&&(a+=`${l} ${e.operator||">"} ${e.valueFrom}`)}return a}).filter(e=>e).join(" "));const n=await x.createReport(Ce.value,{where:a||void 0,having:t||void 0,orderBy:o||void 0,limit:Ve.value?String(Ve.value):void 0});if(!n||!n.id)throw new Error("Failed to create report");const u=n.id;if(U.info(`Created report ${u}: ${Ce.value}`),de.value){const l=ye.value.find(e=>e.value===de.value);if(l){const a=parseInt(null==(e=l.label.match(/ID: (\d+)/))?void 0:e[1]);a&&(await x.addReportFrom(u,a,"t1"),U.info(`Added FROM table ${a} to report ${u}`))}}for(let e=0;e<me.value.length;e++){const a=me.value[e];if(a.table){const o=ye.value.find(e=>e.value===a.table);if(o){const t=parseInt(null==(l=o.label.match(/ID: (\d+)/))?void 0:l[1]);if(t){const l=`t${e+2}`,o=a.onLeft&&a.onRight?`${a.onLeft} = ${a.onRight}`:null;await x.addReportFrom(u,t,l,o),U.info(`Added JOIN table ${t} to report ${u}`)}}}}for(const e of re.value)xe.value.find(l=>l.value===e)&&(await x.addReportColumn(u,{fieldId:0,nameInReport:e,formula:e}),U.info(`Added column ${e} to report ${u}`));for(const e of ce.value)e.expression&&(await x.addReportColumn(u,{fieldId:0,nameInReport:e.alias||e.expression,formula:e.expression,set:e.expression}),U.info(`Added expression ${e.expression} to report ${u}`));se.add({severity:"success",summary:"Успех",detail:"Отчет успешно сохранен",life:3e3}),we.value=!1,Ce.value="",Ie.value="",ie.push(`/integram/smartq?reportId=${u}`)}catch(a){U.error("Failed to save report:",a),se.add({severity:"error",summary:"Ошибка",detail:"Не удалось сохранить отчет: "+a.message,life:5e3})}finally{Oe.value=!1}}else se.add({severity:"warn",summary:"Предупреждение",detail:"Введите название отчета",life:3e3})}return o(()=>{!async function(){try{const e=await x.getDictionary();e&&e.types&&(ye.value=Object.entries(e.types).map(([e,l])=>({value:l.val,label:`${l.val} (ID: ${e})`})))}catch(e){U.error("Failed to load tables:",e),Ne.value="Не удалось загрузить список таблиц"}}()}),(e,l)=>{const a=i("Toast"),o=i("Button"),d=i("MultiSelect"),x=i("InputText"),U=i("Dropdown"),$=i("InputNumber"),ie=i("Divider"),se=i("Column"),Re=i("DataTable"),je=i("Message"),Ze=i("Card"),el=i("Textarea"),ll=i("Dialog"),al=r("tooltip");return c(),t("div",N,[n(a),u("div",w,[n(y,{items:Ee.value},null,8,["items"])]),n(Ze,null,{title:s(()=>[u("div",C,[l[9]||(l[9]=u("span",null,"Конструктор запросов",-1)),u("div",I,[n(o,{label:"Выполнить",icon:"pi pi-play",onClick:Ke,loading:Ue.value,disabled:!Se.value,size:"small"},null,8,["loading","disabled"]),h(n(o,{icon:"pi pi-save",onClick:Ye,disabled:!Se.value,outlined:"",rounded:"",size:"small"},null,8,["disabled"]),[[al,"Сохранить как отчет",void 0,{bottom:!0}]]),h(n(o,{icon:"pi pi-times",onClick:We,outlined:"",rounded:"",size:"small",severity:"secondary"},null,512),[[al,"Очистить",void 0,{bottom:!0}]])])])]),content:s(()=>[u("div",O,[u("div",L,[l[11]||(l[11]=u("label",{class:"form-label font-semibold"}," SELECT (Выбрать колонки) ",-1)),u("div",k,[n(d,{modelValue:re.value,"onUpdate:modelValue":l[0]||(l[0]=e=>re.value=e),options:xe.value,optionLabel:"label",optionValue:"value",placeholder:"Выберите колонки",filter:!0,class:"flex-1",display:"chip"},null,8,["modelValue","options"]),n(o,{label:"Добавить выражение",icon:"pi pi-plus",onClick:Ge,outlined:"",size:"small"})]),ce.value.length>0?(c(),t("div",T,[(c(!0),t(v,null,f(ce.value,(e,l)=>(c(),t("div",{key:l,class:"flex gap-2 mb-2"},[n(x,{modelValue:e.expression,"onUpdate:modelValue":l=>e.expression=l,placeholder:"Выражение (например: COUNT(*), SUM(column))",class:"flex-1"},null,8,["modelValue","onUpdate:modelValue"]),n(x,{modelValue:e.alias,"onUpdate:modelValue":l=>e.alias=l,placeholder:"Алиас",style:{width:"150px"}},null,8,["modelValue","onUpdate:modelValue"]),n(o,{icon:"pi pi-trash",onClick:e=>function(e){ce.value.splice(e,1)}(l),text:"",rounded:"",severity:"danger",size:"small"},null,8,["onClick"])]))),128))])):p("",!0),pe.value.length>0?(c(),t("div",A,[l[10]||(l[10]=u("label",{class:"form-label text-sm text-color-secondary mb-2"},"Агрегатные функции",-1)),(c(!0),t(v,null,f(pe.value,(e,l)=>(c(),t("div",{key:"agg-"+l,class:"flex gap-2 mb-2 p-2 surface-ground border-round flex-wrap"},[n(U,{modelValue:e.func,"onUpdate:modelValue":l=>e.func=l,options:b(Te),optionLabel:"label",optionValue:"value",placeholder:"Функция",class:"w-auto",style:{"min-width":"130px"}},null,8,["modelValue","onUpdate:modelValue","options"]),n(U,{modelValue:e.column,"onUpdate:modelValue":l=>e.column=l,options:ze.value,optionLabel:"label",optionValue:"value",placeholder:"Колонка",filter:!0,class:"flex-1",style:{"min-width":"120px"},disabled:"COUNT_ALL"===e.func},null,8,["modelValue","onUpdate:modelValue","options","disabled"]),n(x,{modelValue:e.alias,"onUpdate:modelValue":l=>e.alias=l,placeholder:"Алиас",style:{width:"120px"}},null,8,["modelValue","onUpdate:modelValue"]),n(U,{modelValue:e.format,"onUpdate:modelValue":l=>e.format=l,options:b(Ae),optionLabel:"label",optionValue:"value",placeholder:"Формат",class:"w-auto",style:{"min-width":"130px"}},null,8,["modelValue","onUpdate:modelValue","options"]),n(o,{icon:"pi pi-trash",onClick:e=>function(e){pe.value.splice(e,1)}(l),text:"",rounded:"",severity:"danger",size:"small"},null,8,["onClick"])]))),128))])):p("",!0),u("div",R,[n(o,{label:"Добавить функцию",icon:"pi pi-calculator",onClick:Me,outlined:"",size:"small",severity:"info"})])]),u("div",j,[l[12]||(l[12]=u("label",{class:"form-label font-semibold"},"FROM (Таблица)",-1)),n(U,{modelValue:de.value,"onUpdate:modelValue":l[1]||(l[1]=e=>de.value=e),options:ye.value,optionLabel:"label",optionValue:"value",placeholder:"Выберите таблицу",filter:!0,class:"w-full",onChange:_e},null,8,["modelValue","options"])]),u("div",E,[u("div",S,[l[13]||(l[13]=u("label",{class:"form-label font-semibold"},"JOIN (Связи)",-1)),n(o,{label:"Добавить JOIN",icon:"pi pi-plus",onClick:Be,outlined:"",size:"small"})]),me.value.length>0?(c(),t("div",z,[(c(!0),t(v,null,f(me.value,(e,a)=>(c(),t("div",{key:a,class:"join-row mb-3 p-3 border-1 surface-border border-round"},[u("div",F,[n(U,{modelValue:e.type,"onUpdate:modelValue":l=>e.type=l,options:b(Le),placeholder:"Тип JOIN",class:"w-full"},null,8,["modelValue","onUpdate:modelValue","options"]),n(U,{modelValue:e.table,"onUpdate:modelValue":l=>e.table=l,options:ye.value,optionLabel:"label",optionValue:"value",placeholder:"Таблица",filter:!0,class:"w-full"},null,8,["modelValue","onUpdate:modelValue","options"]),n(o,{icon:"pi pi-trash",onClick:e=>function(e){me.value.splice(e,1)}(a),text:"",rounded:"",severity:"danger",size:"small"},null,8,["onClick"])]),u("div",D,[n(x,{modelValue:e.onLeft,"onUpdate:modelValue":l=>e.onLeft=l,placeholder:"Левое поле",class:"flex-1"},null,8,["modelValue","onUpdate:modelValue"]),l[14]||(l[14]=u("span",{class:"flex align-items-center"},"=",-1)),n(x,{modelValue:e.onRight,"onUpdate:modelValue":l=>e.onRight=l,placeholder:"Правое поле",class:"flex-1"},null,8,["modelValue","onUpdate:modelValue"])])]))),128))])):p("",!0)]),u("div",_,[u("div",G,[l[15]||(l[15]=u("label",{class:"form-label font-semibold"},"WHERE (Условия)",-1)),n(o,{label:"Добавить условие",icon:"pi pi-plus",onClick:Je,outlined:"",size:"small"})]),ve.value.length>0?(c(),t("div",M,[(c(!0),t(v,null,f(ve.value,(e,l)=>(c(),t("div",{key:l,class:"condition-row mb-2 flex gap-2"},[l>0?(c(),m(U,{key:0,modelValue:e.logic,"onUpdate:modelValue":l=>e.logic=l,options:["AND","OR"],placeholder:"Логика",class:"w-auto",style:{width:"100px"}},null,8,["modelValue","onUpdate:modelValue"])):p("",!0),n(x,{modelValue:e.field,"onUpdate:modelValue":l=>e.field=l,placeholder:"Поле",class:"flex-1"},null,8,["modelValue","onUpdate:modelValue"]),n(U,{modelValue:e.operator,"onUpdate:modelValue":l=>e.operator=l,options:b(ke),placeholder:"Оператор",class:"w-auto",style:{width:"120px"}},null,8,["modelValue","onUpdate:modelValue","options"]),n(x,{modelValue:e.value,"onUpdate:modelValue":l=>e.value=l,placeholder:"Значение",class:"flex-1"},null,8,["modelValue","onUpdate:modelValue"]),n(o,{icon:"pi pi-trash",onClick:e=>function(e){ve.value.splice(e,1)}(l),text:"",rounded:"",severity:"danger",size:"small"},null,8,["onClick"])]))),128))])):p("",!0)]),u("div",B,[l[16]||(l[16]=u("label",{class:"form-label font-semibold"},"GROUP BY (Группировка)",-1)),n(d,{modelValue:fe.value,"onUpdate:modelValue":l[2]||(l[2]=e=>fe.value=e),options:re.value,placeholder:"Выберите колонки для группировки",class:"w-full",display:"chip"},null,8,["modelValue","options"])]),u("div",J,[u("div",q,[l[17]||(l[17]=u("label",{class:"form-label font-semibold"},"HAVING (Условия группировки)",-1)),h(n(o,{label:"Добавить условие",icon:"pi pi-plus",onClick:Pe,outlined:"",size:"small",disabled:0===pe.value.length},null,8,["disabled"]),[[al,0===pe.value.length?"Сначала добавьте агрегатную функцию":"",void 0,{bottom:!0}]])]),be.value.length>0?(c(),t("div",P,[(c(!0),t(v,null,f(be.value,(e,l)=>(c(),t("div",{key:"having-"+l,class:"having-row mb-2 flex gap-2 p-2 surface-ground border-round"},[l>0?(c(),m(U,{key:0,modelValue:e.logic,"onUpdate:modelValue":l=>e.logic=l,options:["AND","OR"],placeholder:"Логика",class:"w-auto",style:{width:"100px"}},null,8,["modelValue","onUpdate:modelValue"])):p("",!0),n(U,{modelValue:e.aggregate,"onUpdate:modelValue":l=>e.aggregate=l,options:Fe.value,optionLabel:"label",optionValue:"value",placeholder:"Агрегатная функция",class:"flex-1"},null,8,["modelValue","onUpdate:modelValue","options"]),n(U,{modelValue:e.operator,"onUpdate:modelValue":l=>e.operator=l,options:b(ke),placeholder:"Оператор",class:"w-auto",style:{width:"120px"}},null,8,["modelValue","onUpdate:modelValue","options"]),n(x,{modelValue:e.valueFrom,"onUpdate:modelValue":l=>e.valueFrom=l,placeholder:"От",class:"w-auto",style:{width:"100px"}},null,8,["modelValue","onUpdate:modelValue"]),n(x,{modelValue:e.valueTo,"onUpdate:modelValue":l=>e.valueTo=l,placeholder:"До (опционально)",class:"w-auto",style:{width:"120px"}},null,8,["modelValue","onUpdate:modelValue"]),n(o,{icon:"pi pi-trash",onClick:e=>function(e){be.value.splice(e,1)}(l),text:"",rounded:"",severity:"danger",size:"small"},null,8,["onClick"])]))),128))])):p("",!0),0===pe.value.length?(c(),t("small",H," HAVING используется после GROUP BY для фильтрации агрегированных результатов ")):p("",!0)]),u("div",K,[u("div",Q,[l[18]||(l[18]=u("label",{class:"form-label font-semibold"},"SET (Вычисляемые присваивания)",-1)),n(o,{label:"Добавить SET",icon:"pi pi-plus",onClick:He,outlined:"",size:"small"})]),he.value.length>0?(c(),t("div",W,[(c(!0),t(v,null,f(he.value,(e,a)=>(c(),t("div",{key:"set-"+a,class:"flex gap-2 mb-2 p-2 surface-ground border-round"},[n(U,{modelValue:e.column,"onUpdate:modelValue":l=>e.column=l,options:xe.value,optionLabel:"label",optionValue:"value",placeholder:"Колонка",filter:!0,class:"w-auto",style:{"min-width":"150px"}},null,8,["modelValue","onUpdate:modelValue","options"]),l[19]||(l[19]=u("span",{class:"flex align-items-center"},"=",-1)),n(x,{modelValue:e.expression,"onUpdate:modelValue":l=>e.expression=l,placeholder:"Выражение (например: RAND(), колонка*2, IF(...))",class:"flex-1"},null,8,["modelValue","onUpdate:modelValue"]),n(o,{icon:"pi pi-trash",onClick:e=>function(e){he.value.splice(e,1)}(a),text:"",rounded:"",severity:"danger",size:"small"},null,8,["onClick"])]))),128)),l[20]||(l[20]=u("small",{class:"text-color-secondary"}," SET используется для вычисления новых значений. Примеры: RAND(), POWER(val,2), IF(val>0,'Да','Нет') ",-1))])):p("",!0)]),u("div",Y,[u("div",X,[l[21]||(l[21]=u("label",{class:"form-label font-semibold"},"ORDER BY (Сортировка)",-1)),n(o,{label:"Добавить сортировку",icon:"pi pi-plus",onClick:qe,outlined:"",size:"small"})]),ge.value.length>0?(c(),t("div",Z,[(c(!0),t(v,null,f(ge.value,(e,l)=>(c(),t("div",{key:l,class:"flex gap-2 mb-2"},[n(U,{modelValue:e.column,"onUpdate:modelValue":l=>e.column=l,options:re.value,placeholder:"Колонка",class:"flex-1"},null,8,["modelValue","onUpdate:modelValue","options"]),n(U,{modelValue:e.direction,"onUpdate:modelValue":l=>e.direction=l,options:["ASC","DESC"],placeholder:"Направление",class:"w-auto",style:{width:"120px"}},null,8,["modelValue","onUpdate:modelValue"]),n(o,{icon:"pi pi-trash",onClick:e=>function(e){ge.value.splice(e,1)}(l),text:"",rounded:"",severity:"danger",size:"small"},null,8,["onClick"])]))),128))])):p("",!0)]),u("div",ee,[l[22]||(l[22]=u("label",{class:"form-label font-semibold"},"LIMIT (Лимит записей)",-1)),n($,{modelValue:Ve.value,"onUpdate:modelValue":l[3]||(l[3]=e=>Ve.value=e),placeholder:"Количество записей",min:1,max:1e4,showButtons:""},null,8,["modelValue"])])]),u("div",le,[n(ie),u("div",ae,[l[23]||(l[23]=u("h4",{class:"m-0"},"Сгенерированный SQL",-1)),n(o,{label:"Копировать",icon:"pi pi-copy",onClick:Qe,outlined:"",size:"small"})]),u("div",oe,[u("pre",null,g(De.value),1)])]),$e.value?(c(),t("div",te,[n(ie),l[24]||(l[24]=u("h4",null,"Результаты запроса",-1)),n(Re,{value:$e.value.rows,paginator:!0,rows:20,stripedRows:"",showGridlines:"",responsiveLayout:"scroll"},{default:s(()=>[(c(!0),t(v,null,f($e.value.columns,e=>(c(),m(se,{key:e.field,field:e.field,header:e.header},null,8,["field","header"]))),128))]),_:1},8,["value"]),u("div",ne," Всего записей: "+g($e.value.total||$e.value.rows.length),1)])):p("",!0),Ne.value?(c(),m(je,{key:1,severity:"error",onClose:l[4]||(l[4]=e=>Ne.value=null),closable:"",class:"mt-4"},{default:s(()=>[V(g(Ne.value),1)]),_:1})):p("",!0)]),_:1}),n(ll,{visible:we.value,"onUpdate:visible":l[8]||(l[8]=e=>we.value=e),header:"Сохранить как отчет",modal:!0,style:{width:"500px"}},{footer:s(()=>[n(o,{label:"Отмена",icon:"pi pi-times",onClick:l[7]||(l[7]=e=>we.value=!1),text:""}),n(o,{label:"Сохранить",icon:"pi pi-check",onClick:Xe,loading:Oe.value},null,8,["loading"])]),default:s(()=>[u("div",ue,[u("div",null,[l[25]||(l[25]=u("label",{for:"reportName",class:"form-label"},"Название отчета",-1)),n(x,{id:"reportName",modelValue:Ce.value,"onUpdate:modelValue":l[5]||(l[5]=e=>Ce.value=e),placeholder:"Введите название отчета",class:"w-full"},null,8,["modelValue"])]),u("div",null,[l[26]||(l[26]=u("label",{for:"reportDescription",class:"form-label"},"Описание (опционально)",-1)),n(el,{id:"reportDescription",modelValue:Ie.value,"onUpdate:modelValue":l[6]||(l[6]=e=>Ie.value=e),placeholder:"Описание отчета",autoResize:!0,rows:"3",class:"w-full"},null,8,["modelValue"])])])]),_:1},8,["visible"])])}}},[["__scopeId","data-v-38814ed7"]]);export{ie as default};
