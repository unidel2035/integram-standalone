import{D as e,J as l,r as a,E as i,c as o,A as t,h as s,b as n,w as d,y as r,u as c,o as u,a as v,f as m,t as p,j as f,F as b,d as y,n as g}from"./index-B7VcSS8y.js";import{a as w}from"./index-CcrxTH1M.js";import{I as h}from"./IntegramBreadcrumb-mb_J6t4E.js";import{_ as C}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./integramApiClient-BsYdo77J.js";import"./unifiedAuthService-6fZILgG8.js";const x={class:"integram-form-builder-page integram-touch-friendly"},_={class:"flex align-items-center justify-content-between"},k={class:"flex gap-2 align-items-center ml-auto"},V={class:"text-primary"},A={class:"flex gap-1"},$={key:1,class:"text-center p-4 text-muted"},I={class:"flex align-items-center justify-content-between"},U={class:"flex gap-2 align-items-center ml-auto"},j={class:"grid mb-3"},T={class:"col-12"},F={class:"field"},z={class:"mb-4"},R={class:"flex justify-content-between align-items-center mb-3"},O={key:0,class:"flex flex-column gap-2"},N={class:"flex justify-content-between align-items-center"},S={class:"flex align-items-center gap-2"},B={class:"flex gap-1"},D={class:"grid"},P={class:"col-12 md:col-6"},L={class:"text-sm"},q={class:"mb-2"},E={key:0,class:"mb-2"},H={key:1,class:"mb-2"},M={key:2,class:"mb-2"},J={class:"col-12 md:col-6"},Z={class:"text-sm"},W={key:0,class:"mb-2"},Q={class:"inline-flex align-items-center gap-2"},G={key:1,class:"mb-2"},X={class:"inline-flex align-items-center gap-2"},K={class:"mb-3"},Y={class:"flex justify-content-between align-items-center mb-2"},ee={key:0},le={class:"flex gap-1"},ae={key:1,class:"text-muted text-sm"},ie={key:0,class:"mb-3"},oe={class:"flex justify-content-between align-items-center mb-2"},te={class:"flex gap-1"},se={key:0,class:"surface-ground border-round p-2 text-sm"},ne={class:"grid"},de={class:"col-6 md:col-3"},re={class:"col-6 md:col-3"},ce={class:"col-6 md:col-3"},ue={class:"col-6 md:col-3"},ve={class:"flex justify-content-between align-items-center mb-2"},me={key:0},pe={class:"flex gap-1"},fe={key:1,class:"text-muted text-sm"},be={key:1,class:"text-center p-4 text-muted surface-ground border-round"},ye={class:"flex flex-column gap-3"},ge={class:"field"},we={class:"flex flex-column gap-3"},he={class:"field"},Ce={class:"grid"},xe={class:"col-12 md:col-6"},_e={class:"field"},ke={class:"col-12 md:col-6"},Ve={class:"field"},Ae={class:"grid"},$e={class:"col-12 md:col-6"},Ie={class:"field"},Ue={class:"col-12 md:col-6"},je={class:"field"},Te={class:"field"},Fe={class:"field"},ze={class:"flex flex-column gap-3"},Re={class:"field"},Oe={class:"field"},Ne={class:"field"},Se={class:"flex flex-column gap-3"},Be={class:"field"},De={class:"field"},Pe={class:"field"},Le={class:"flex flex-column gap-3"},qe={class:"field"},Ee={key:0,class:"flex flex-wrap gap-2"},He={key:1,class:"text-muted"},Me={class:"field"},Je={class:"field"},Ze={class:"field"},We={class:"grid"},Qe={class:"col-12 md:col-6"},Ge={class:"field"},Xe={class:"col-12 md:col-6"},Ke={class:"field"},Ye={class:"grid"},el={class:"col-12 md:col-6"},ll={class:"field"},al={class:"flex gap-3"},il={class:"flex align-items-center"},ol={class:"flex align-items-center"},tl={class:"flex align-items-center"},sl={class:"col-12 md:col-6"},nl={class:"field"},dl={class:"flex gap-3"},rl={class:"flex align-items-center"},cl={class:"flex align-items-center"},ul={class:"flex gap-4"},vl={class:"flex align-items-center"},ml={class:"flex align-items-center"},pl=C({__name:"IntegramFormBuilder",props:{session:{type:Object,required:!0}},emits:["view-table"],setup(C,{emit:pl}){const fl=C,bl=e(),yl=l(()=>[{label:"Конструктор форм",icon:"pi pi-sliders-h",to:void 0}]),gl=a([]),wl=a(null),hl=a([]),Cl=i({formsList:!1,createForm:!1,savePanel:!1,saveField:!1,saveButton:!1,savePivot:!1,pivotFields:!1}),xl=a(!1),_l=a(!1),kl=a(!1),Vl=a(!1),Al=a(!1),$l=a(null),Il=a(null),Ul=a(null),jl=a(null),Tl=a(null),Fl=a(null),zl=a([]),Rl=i({rows:[],cols:[],vals:[],aggregatorName:"Count",rendererName:"Table",rowOrder:"key_a_to_z",colOrder:"key_a_to_z",showTotals:!0,enableFiltering:!0}),Ol=[{value:"Count",label:"Количество (Count)"},{value:"Count Unique Values",label:"Уникальные значения"},{value:"List Unique Values",label:"Список уникальных"},{value:"Sum",label:"Сумма (Sum)"},{value:"Integer Sum",label:"Целая сумма"},{value:"Average",label:"Среднее (Avg)"},{value:"Median",label:"Медиана"},{value:"Sample Variance",label:"Дисперсия"},{value:"Sample Standard Deviation",label:"Станд. отклонение"},{value:"Minimum",label:"Минимум"},{value:"Maximum",label:"Максимум"},{value:"First",label:"Первое значение"},{value:"Last",label:"Последнее значение"},{value:"Sum over Sum",label:"Сумма/Сумма"},{value:"80% Upper Bound",label:"80% верхняя граница"},{value:"80% Lower Bound",label:"80% нижняя граница"},{value:"Sum as Fraction of Total",label:"Доля от общего"},{value:"Sum as Fraction of Rows",label:"Доля от строки"},{value:"Sum as Fraction of Columns",label:"Доля от столбца"},{value:"Count as Fraction of Total",label:"Кол-во от общего"},{value:"Count as Fraction of Rows",label:"Кол-во от строки"},{value:"Count as Fraction of Columns",label:"Кол-во от столбца"}],Nl=[{value:"Table",label:"Таблица"},{value:"Table Barchart",label:"Таблица с барами"},{value:"Heatmap",label:"Тепловая карта"},{value:"Row Heatmap",label:"Тепловая карта (строки)"},{value:"Col Heatmap",label:"Тепловая карта (столбцы)"},{value:"Line Chart",label:"Линейный график"},{value:"Bar Chart",label:"Столбчатая диаграмма"},{value:"Stacked Bar Chart",label:"Накопительная диаграмма"},{value:"Horizontal Bar Chart",label:"Горизонтальные бары"},{value:"Horizontal Stacked Bar Chart",label:"Горизонтальные накоп."},{value:"Area Chart",label:"Область"},{value:"Scatter Chart",label:"Точечная диаграмма"},{value:"Treemap",label:"Древовидная карта"}],Sl=i({name:""}),Bl=i({name:"",typeId:"",reportId:"",bgcolor:"",color:"",filter:"",nextAction:""}),Dl=i({fieldId:"",fieldAlias:"",fieldValue:""}),Pl=i({buttonAlias:"",buttonAction:"",buttonClass:""}),Ll=l(()=>`http://localhost:8081/api/integram/${fl.session.database}`),ql=()=>({"X-Authorization":fl.session.sessionId});async function El(){Cl.formsList=!0;try{const e=await w.get(`${Ll.value}/object/137`,{headers:ql()});if(e.data&&e.data["&main.a.&uni_obj.&uni_obj_all"]){const l=e.data["&main.a.&uni_obj.&uni_obj_all"];gl.value=l.id.map((e,a)=>({id:e,val:l.val[a]})),bl.add({severity:"success",summary:"Успешно",detail:`Загружено форм: ${gl.value.length}`,life:3e3})}}catch(e){bl.add({severity:"error",summary:"Ошибка",detail:"Не удалось загрузить список форм",life:3e3})}finally{Cl.formsList=!1}}async function Hl(){Cl.createForm=!0;try{await w.post(`${Ll.value}/_m_new`,`typ=137&t100=${encodeURIComponent(Sl.name)}`,{headers:{...ql(),"Content-Type":"application/x-www-form-urlencoded"}}),bl.add({severity:"success",summary:"Успешно",detail:"Форма создана",life:3e3}),xl.value=!1,Sl.name="",await El()}catch(e){bl.add({severity:"error",summary:"Ошибка",detail:"Не удалось создать форму",life:3e3})}finally{Cl.createForm=!1}}async function Ml(e){try{const l=await w.get(`${Ll.value}/object/138?F_U=${e}`,{headers:ql()});if(l.data&&l.data["&main.a.&uni_obj.&uni_obj_all"]){const e=l.data["&main.a.&uni_obj.&uni_obj_all"],a=l.data["&object_reqs"];hl.value=e.id.map((l,i)=>{let o=null;if(a[l]&&a[l][225])try{o="string"==typeof a[l][225]?JSON.parse(a[l][225]):a[l][225]}catch(t){}return{id:l,val:e.val[i],type:a[l]?a[l][0]:"",typeName:a[l]?a[l][0]:"",report:a[l]?a[l][1]:"",bgcolor:a[l]?a[l][5]:"",color:a[l]?a[l][4]:"",nextAction:a[l]?a[l][6]:"",filter:a[l]?a[l][7]:"",pivotConfig:o,fields:[],buttons:[]}});for(const l of hl.value)await Jl(l),await Zl(l)}}catch(l){}}async function Jl(e){try{const l=await w.get(`${Ll.value}/object/139?F_U=${e.id}`,{headers:ql()});if(l.data&&l.data["&main.a.&uni_obj.&uni_obj_all"]){const a=l.data["&main.a.&uni_obj.&uni_obj_all"],i=l.data["&object_reqs"];e.fields=a.id.map((e,l)=>({id:e,fieldName:i[e]?i[e][0]:"",fieldAlias:a.val[l],fieldValue:i[e]?i[e][1]:""}))}}catch(l){}}async function Zl(e){try{const l=await w.get(`${Ll.value}/object/150?F_U=${e.id}`,{headers:ql()});if(l.data&&l.data["&main.a.&uni_obj.&uni_obj_all"]){const a=l.data["&main.a.&uni_obj.&uni_obj_all"],i=l.data["&object_reqs"];e.buttons=a.id.map((e,l)=>({id:e,buttonAlias:a.val[l],buttonAction:i[e]?i[e][0]:"",buttonClass:i[e]?i[e][1]:""}))}}catch(l){}}function Wl(){wl.value=null,hl.value=[]}async function Ql(){if(wl.value)try{await w.post(`${Ll.value}/_m_save/${wl.value.id}`,`t100=${encodeURIComponent(wl.value.val)}`,{headers:{...ql(),"Content-Type":"application/x-www-form-urlencoded"}}),bl.add({severity:"success",summary:"Сохранено",detail:"Название формы обновлено",life:3e3})}catch(e){}}async function Gl(){Cl.savePanel=!0;try{$l.value?await w.post(`${Ll.value}/_m_save/${$l.value.id}`,`t100=${encodeURIComponent(Bl.name)}&t102=${Bl.typeId}`,{headers:{...ql(),"Content-Type":"application/x-www-form-urlencoded"}}):await w.post(`${Ll.value}/_m_new`,`typ=138&t100=${encodeURIComponent(Bl.name)}&t101=${wl.value.id}&t102=${Bl.typeId}`,{headers:{...ql(),"Content-Type":"application/x-www-form-urlencoded"}}),bl.add({severity:"success",summary:"Успешно",detail:$l.value?"Панель обновлена":"Панель добавлена",life:3e3}),Xl(),await Ml(wl.value.id)}catch(e){bl.add({severity:"error",summary:"Ошибка",detail:"Не удалось сохранить панель",life:3e3})}finally{Cl.savePanel=!1}}function Xl(){_l.value=!1,$l.value=null,Object.assign(Bl,{name:"",typeId:"",reportId:"",bgcolor:"",color:"",filter:"",nextAction:""})}async function Kl(){Cl.saveField=!0;try{Il.value?await w.post(`${Ll.value}/_m_save/${Il.value.id}`,`t100=${encodeURIComponent(Dl.fieldAlias)}&t102=${Dl.fieldId}&t103=${encodeURIComponent(Dl.fieldValue)}`,{headers:{...ql(),"Content-Type":"application/x-www-form-urlencoded"}}):await w.post(`${Ll.value}/_m_new`,`typ=139&t100=${encodeURIComponent(Dl.fieldAlias)}&t101=${jl.value.id}&t102=${Dl.fieldId}&t103=${encodeURIComponent(Dl.fieldValue)}`,{headers:{...ql(),"Content-Type":"application/x-www-form-urlencoded"}}),bl.add({severity:"success",summary:"Успешно",detail:Il.value?"Поле обновлено":"Поле добавлено",life:3e3}),Yl(),await Ml(wl.value.id)}catch(e){bl.add({severity:"error",summary:"Ошибка",detail:"Не удалось сохранить поле",life:3e3})}finally{Cl.saveField=!1}}function Yl(){kl.value=!1,Il.value=null,jl.value=null,Object.assign(Dl,{fieldId:"",fieldAlias:"",fieldValue:""})}async function ea(){Cl.saveButton=!0;try{Ul.value?await w.post(`${Ll.value}/_m_save/${Ul.value.id}`,`t100=${encodeURIComponent(Pl.buttonAlias)}&t102=${encodeURIComponent(Pl.buttonAction)}&t103=${encodeURIComponent(Pl.buttonClass)}`,{headers:{...ql(),"Content-Type":"application/x-www-form-urlencoded"}}):await w.post(`${Ll.value}/_m_new`,`typ=150&t100=${encodeURIComponent(Pl.buttonAlias)}&t101=${Tl.value.id}&t102=${encodeURIComponent(Pl.buttonAction)}&t103=${encodeURIComponent(Pl.buttonClass)}`,{headers:{...ql(),"Content-Type":"application/x-www-form-urlencoded"}}),bl.add({severity:"success",summary:"Успешно",detail:Ul.value?"Кнопка обновлена":"Кнопка добавлена",life:3e3}),la(),await Ml(wl.value.id)}catch(e){bl.add({severity:"error",summary:"Ошибка",detail:"Не удалось сохранить кнопку",life:3e3})}finally{Cl.saveButton=!1}}function la(){Vl.value=!1,Ul.value=null,Tl.value=null,Object.assign(Pl,{buttonAlias:"",buttonAction:"",buttonClass:""})}function aa(){Al.value=!1,Fl.value=null,zl.value=[]}async function ia(){var e,l;if(null==(e=Fl.value)?void 0:e.report){Cl.pivotFields=!0;try{const e=await w.get(`${Ll.value}/report/${Fl.value.report}?LIMIT=1`,{headers:ql()});if(e.data){const a=e.data,i=Object.keys(a).find(e=>e.startsWith("&rep."));if(i&&(null==(l=a[i])?void 0:l.col))zl.value=a[i].col.filter(e=>e&&e.trim()),bl.add({severity:"success",summary:"Загружено",detail:`Найдено полей: ${zl.value.length}`,life:3e3});else{const e=Object.keys(a).filter(e=>!e.startsWith("&"));e.length>0?zl.value=e:bl.add({severity:"warn",summary:"Внимание",detail:"Не удалось извлечь поля из отчета",life:3e3})}}}catch(a){bl.add({severity:"error",summary:"Ошибка",detail:"Не удалось загрузить поля отчета",life:3e3})}finally{Cl.pivotFields=!1}}else bl.add({severity:"warn",summary:"Внимание",detail:"У панели не указан отчет",life:3e3})}async function oa(){if(Fl.value){Cl.savePivot=!0;try{const e={rows:Rl.rows,cols:Rl.cols,vals:Rl.vals,aggregatorName:Rl.aggregatorName,rendererName:Rl.rendererName,rowOrder:Rl.rowOrder,colOrder:Rl.colOrder,showTotals:Rl.showTotals,enableFiltering:Rl.enableFiltering,rendererOptions:{localeStrings:{renderError:"Ошибка отрисовки сводной таблицы.",computeError:"Ошибка вычисления сводной таблицы.",uiRenderError:"Ошибка отрисовки интерфейса сводной таблицы.",selectAll:"Выбрать все",selectNone:"Снять выбор",tooMany:"(слишком много для отображения)",filterResults:"Фильтровать результаты",apply:"Применить",cancel:"Отмена",totals:"Итого",vs:"vs",by:"по"}}},l=JSON.stringify(e);await w.post(`${Ll.value}/_m_set/${Fl.value.id}?t225=${encodeURIComponent(l)}`,"",{headers:{...ql(),"Content-Type":"application/x-www-form-urlencoded"}}),Fl.value.pivotConfig=e,bl.add({severity:"success",summary:"Успешно",detail:"Конфигурация Pivot сохранена",life:3e3}),aa()}catch(e){bl.add({severity:"error",summary:"Ошибка",detail:"Не удалось сохранить конфигурацию Pivot",life:3e3})}finally{Cl.savePivot=!1}}}return(e,l)=>{const a=r("Message"),i=r("Button"),C=r("Column"),pl=r("DataTable"),fl=r("Card"),Jl=r("InputText"),Zl=r("Divider"),ta=r("Badge"),sa=r("Tag"),na=r("Dialog"),da=r("Textarea"),ra=r("Chip"),ca=r("Chips"),ua=r("Select"),va=r("RadioButton"),ma=r("Checkbox"),pa=c("tooltip");return u(),o("div",x,[t(h,{items:yl.value},null,8,["items"]),t(a,{severity:"info",closable:!1,class:"mb-2"},{default:d(()=>[...l[35]||(l[35]=[v("strong",null,"Конструктор форм (myform)",-1),m(" - Полная реализация функционала создания и редактирования пользовательских форм с панелями, полями и кнопками ",-1)])]),_:1}),t(fl,{class:"mb-3"},{title:d(()=>[v("div",_,[l[36]||(l[36]=v("span",null,"Конструктор форм",-1)),v("div",k,[f(t(i,{icon:"pi pi-refresh",onClick:El,loading:Cl.formsList,outlined:"",rounded:"",size:"small"},null,8,["loading"]),[[pa,"Обновить",void 0,{bottom:!0}]]),t(i,{label:"Создать",icon:"pi pi-plus",onClick:l[0]||(l[0]=e=>xl.value=!0),severity:"primary",size:"small"})])])]),content:d(()=>[gl.value.length>0?(u(),s(pl,{key:0,value:gl.value,paginator:!0,rows:10,rowsPerPageOptions:[5,10,20,50],stripedRows:"",showGridlines:""},{default:d(()=>[t(C,{field:"id",header:"ID",sortable:"",style:{width:"100px"}},{body:d(({data:e})=>[v("code",V,p(e.id),1)]),_:1}),t(C,{field:"val",header:"Название формы",sortable:""}),t(C,{header:"Действия",style:{width:"150px"}},{body:d(({data:e})=>[v("div",A,[f(t(i,{icon:"pi pi-pencil",size:"small",text:"",severity:"info",onClick:l=>async function(e){try{const l=await w.get(`${Ll.value}/object/${e}`,{headers:ql()});l.data&&l.data.obj&&(wl.value=l.data.obj,await Ml(e))}catch(l){bl.add({severity:"error",summary:"Ошибка",detail:"Не удалось загрузить форму",life:3e3})}}(e.id)},null,8,["onClick"]),[[pa,"Редактировать"]]),f(t(i,{icon:"pi pi-eye",size:"small",text:"",severity:"success",onClick:l=>{return a=e.id,void bl.add({severity:"info",summary:"Просмотр формы",detail:`Форма ID: ${a}`,life:3e3});var a}},null,8,["onClick"]),[[pa,"Просмотр"]]),f(t(i,{icon:"pi pi-trash",size:"small",text:"",severity:"danger",onClick:l=>async function(e){if(confirm("Удалить форму?"))try{await w.post(`${Ll.value}/_m_delete/${e}`,"_xsrf=",{headers:{...ql(),"Content-Type":"application/x-www-form-urlencoded"}}),bl.add({severity:"success",summary:"Успешно",detail:"Форма удалена",life:3e3}),await El()}catch(l){bl.add({severity:"error",summary:"Ошибка",detail:"Не удалось удалить форму",life:3e3})}}(e.id)},null,8,["onClick"]),[[pa,"Удалить"]])])]),_:1})]),_:1},8,["value"])):(u(),o("div",$," Нет форм. Создайте новую форму. "))]),_:1}),wl.value?(u(),s(fl,{key:0,class:"mb-3"},{title:d(()=>[v("div",I,[v("span",null,p(wl.value.val),1),v("div",U,[f(t(i,{icon:"pi pi-arrow-left",onClick:Wl,size:"small",outlined:"",rounded:""},null,512),[[pa,"Назад к списку",void 0,{bottom:!0}]])])])]),content:d(()=>[v("div",j,[v("div",T,[v("div",F,[l[37]||(l[37]=v("label",{for:"formName"},"Название формы",-1)),t(Jl,{id:"formName",modelValue:wl.value.val,"onUpdate:modelValue":l[1]||(l[1]=e=>wl.value.val=e),class:"w-full",onBlur:Ql},null,8,["modelValue"])])])]),t(Zl),v("div",z,[v("div",R,[l[38]||(l[38]=v("h4",{class:"m-0"},"Панели формы",-1)),t(i,{label:"Добавить панель",icon:"pi pi-plus",onClick:l[2]||(l[2]=e=>_l.value=!0),size:"small",severity:"success"})]),hl.value.length>0?(u(),o("div",O,[(u(!0),o(b,null,y(hl.value,(e,a)=>(u(),s(fl,{key:e.id,class:"surface-border"},{title:d(()=>[v("div",N,[v("div",S,[t(ta,{value:a+1,severity:"info"},null,8,["value"]),v("span",null,p(e.val),1)]),v("div",B,[f(t(i,{icon:"pi pi-arrow-up",size:"small",text:"",onClick:e=>function(e){if(e>0){const l=hl.value[e];hl.value[e]=hl.value[e-1],hl.value[e-1]=l}}(a),disabled:0===a},null,8,["onClick","disabled"]),[[pa,"Вверх"]]),f(t(i,{icon:"pi pi-arrow-down",size:"small",text:"",onClick:e=>function(e){if(e<hl.value.length-1){const l=hl.value[e];hl.value[e]=hl.value[e+1],hl.value[e+1]=l}}(a),disabled:a===hl.value.length-1},null,8,["onClick","disabled"]),[[pa,"Вниз"]]),f(t(i,{icon:"pi pi-pencil",size:"small",text:"",severity:"info",onClick:l=>function(e){$l.value=e,Bl.name=e.val,Bl.typeId=e.type,Bl.reportId=e.report,Bl.bgcolor=e.bgcolor,Bl.color=e.color,Bl.filter=e.filter,Bl.nextAction=e.nextAction,_l.value=!0}(e)},null,8,["onClick"]),[[pa,"Редактировать"]]),f(t(i,{icon:"pi pi-trash",size:"small",text:"",severity:"danger",onClick:l=>async function(e){if(confirm("Удалить панель?"))try{await w.post(`${Ll.value}/_m_delete/${e}`,"_xsrf=",{headers:{...ql(),"Content-Type":"application/x-www-form-urlencoded"}}),bl.add({severity:"success",summary:"Успешно",detail:"Панель удалена",life:3e3}),await Ml(wl.value.id)}catch(l){bl.add({severity:"error",summary:"Ошибка",detail:"Не удалось удалить панель",life:3e3})}}(e.id)},null,8,["onClick"]),[[pa,"Удалить"]])])])]),content:d(()=>{var a,r,c;return[v("div",D,[v("div",P,[v("div",L,[v("div",q,[l[39]||(l[39]=v("strong",null,"Тип объекта:",-1)),m(" "+p(e.typeName||e.type),1)]),e.report?(u(),o("div",E,[l[40]||(l[40]=v("strong",null,"Отчет:",-1)),m(" "+p(e.report),1)])):n("",!0),e.filter?(u(),o("div",H,[l[41]||(l[41]=v("strong",null,"Фильтр:",-1)),l[42]||(l[42]=m()),v("code",null,p(e.filter),1)])):n("",!0),e.nextAction?(u(),o("div",M,[l[43]||(l[43]=v("strong",null,"Действие после submit:",-1)),m(" "+p(e.nextAction),1)])):n("",!0)])]),v("div",J,[v("div",Z,[e.bgcolor?(u(),o("div",W,[l[44]||(l[44]=v("strong",null,"Цвет фона:",-1)),v("span",Q,[v("span",{class:"inline-block",style:g({width:"20px",height:"20px",backgroundColor:e.bgcolor,border:"1px solid #ccc"})},null,4),m(" "+p(e.bgcolor),1)])])):n("",!0),e.color?(u(),o("div",G,[l[45]||(l[45]=v("strong",null,"Цвет текста:",-1)),v("span",X,[v("span",{class:"inline-block",style:g({width:"20px",height:"20px",backgroundColor:e.color,border:"1px solid #ccc"})},null,4),m(" "+p(e.color),1)])])):n("",!0)])])]),t(Zl),v("div",K,[v("div",Y,[l[46]||(l[46]=v("h6",{class:"m-0"},"Поля панели",-1)),t(i,{label:"Добавить поле",icon:"pi pi-plus",size:"small",text:"",onClick:l=>function(e){jl.value=e,kl.value=!0}(e)},null,8,["onClick"])]),e.fields&&e.fields.length>0?(u(),o("div",ee,[t(pl,{value:e.fields,size:"small",stripedRows:""},{default:d(()=>[t(C,{header:"#",style:{width:"50px"}},{body:d(({index:e})=>[m(p(e+1),1)]),_:2},1024),t(C,{field:"fieldName",header:"Поле"}),t(C,{field:"fieldAlias",header:"Псевдоним"}),t(C,{field:"fieldValue",header:"Значение по умолчанию"}),t(C,{header:"Действия",style:{width:"100px"}},{body:d(({data:l})=>[v("div",le,[f(t(i,{icon:"pi pi-pencil",size:"small",text:"",onClick:a=>function(e,l){jl.value=e,Il.value=l,Dl.fieldId=l.fieldName,Dl.fieldAlias=l.fieldAlias,Dl.fieldValue=l.fieldValue,kl.value=!0}(e,l)},null,8,["onClick"]),[[pa,"Редактировать"]]),f(t(i,{icon:"pi pi-trash",size:"small",text:"",severity:"danger",onClick:e=>async function(e,l){if(confirm("Удалить поле?"))try{await w.post(`${Ll.value}/_m_delete/${l}`,"_xsrf=",{headers:{...ql(),"Content-Type":"application/x-www-form-urlencoded"}}),bl.add({severity:"success",summary:"Успешно",detail:"Поле удалено",life:3e3}),await Ml(wl.value.id)}catch(a){bl.add({severity:"error",summary:"Ошибка",detail:"Не удалось удалить поле",life:3e3})}}(0,l.id)},null,8,["onClick"]),[[pa,"Удалить"]])])]),_:2},1024)]),_:2},1032,["value"])])):(u(),o("div",ae," Полей пока нет "))]),e.report?(u(),o("div",ie,[v("div",oe,[l[47]||(l[47]=v("h6",{class:"m-0"},[v("i",{class:"pi pi-table mr-2"}),m("Сводная таблица (Pivot) ")],-1)),v("div",te,[e.pivotConfig?(u(),s(sa,{key:0,severity:"success",value:"Настроено",class:"mr-2"})):n("",!0),t(i,{label:e.pivotConfig?"Изменить":"Настроить",icon:e.pivotConfig?"pi pi-pencil":"pi pi-cog",size:"small",severity:e.pivotConfig?"info":"secondary",text:"",onClick:l=>function(e){Fl.value=e,zl.value=[],e.pivotConfig?Object.assign(Rl,{rows:e.pivotConfig.rows||[],cols:e.pivotConfig.cols||[],vals:e.pivotConfig.vals||[],aggregatorName:e.pivotConfig.aggregatorName||"Count",rendererName:e.pivotConfig.rendererName||"Table",rowOrder:e.pivotConfig.rowOrder||"key_a_to_z",colOrder:e.pivotConfig.colOrder||"key_a_to_z",showTotals:!1!==e.pivotConfig.showTotals,enableFiltering:!1!==e.pivotConfig.enableFiltering}):Object.assign(Rl,{rows:[],cols:[],vals:[],aggregatorName:"Count",rendererName:"Table",rowOrder:"key_a_to_z",colOrder:"key_a_to_z",showTotals:!0,enableFiltering:!0}),Al.value=!0}(e)},null,8,["label","icon","severity","onClick"]),e.pivotConfig?f((u(),s(i,{key:1,icon:"pi pi-trash",size:"small",severity:"danger",text:"",onClick:l=>async function(e){if(confirm("Очистить настройки сводной таблицы?"))try{await w.post(`${Ll.value}/_m_set/${e.id}?t225=`,"",{headers:{...ql(),"Content-Type":"application/x-www-form-urlencoded"}}),e.pivotConfig=null,bl.add({severity:"success",summary:"Успешно",detail:"Настройки Pivot очищены",life:3e3})}catch(l){bl.add({severity:"error",summary:"Ошибка",detail:"Не удалось очистить настройки Pivot",life:3e3})}}(e)},null,8,["onClick"])),[[pa,"Очистить настройки"]]):n("",!0)])]),e.pivotConfig?(u(),o("div",se,[v("div",ne,[v("div",de,[l[48]||(l[48]=v("strong",null,"Строки:",-1)),m(" "+p((null==(a=e.pivotConfig.rows)?void 0:a.join(", "))||"—"),1)]),v("div",re,[l[49]||(l[49]=v("strong",null,"Столбцы:",-1)),m(" "+p((null==(r=e.pivotConfig.cols)?void 0:r.join(", "))||"—"),1)]),v("div",ce,[l[50]||(l[50]=v("strong",null,"Значения:",-1)),m(" "+p((null==(c=e.pivotConfig.vals)?void 0:c.join(", "))||"—"),1)]),v("div",ue,[l[51]||(l[51]=v("strong",null,"Агрегация:",-1)),m(" "+p(e.pivotConfig.aggregatorName||"Count"),1)])])])):n("",!0)])):n("",!0),e.report?(u(),s(Zl,{key:1})):n("",!0),v("div",null,[v("div",ve,[l[52]||(l[52]=v("h6",{class:"m-0"},"Кнопки панели",-1)),t(i,{label:"Добавить кнопку",icon:"pi pi-plus",size:"small",text:"",onClick:l=>function(e){Tl.value=e,Vl.value=!0}(e)},null,8,["onClick"])]),e.buttons&&e.buttons.length>0?(u(),o("div",me,[t(pl,{value:e.buttons,size:"small",stripedRows:""},{default:d(()=>[t(C,{header:"#",style:{width:"50px"}},{body:d(({index:e})=>[m(p(e+1),1)]),_:2},1024),t(C,{field:"buttonAlias",header:"Название кнопки"}),t(C,{field:"buttonAction",header:"Действие"}),t(C,{field:"buttonClass",header:"CSS класс"}),t(C,{header:"Действия",style:{width:"100px"}},{body:d(({data:l})=>[v("div",pe,[f(t(i,{icon:"pi pi-pencil",size:"small",text:"",onClick:a=>function(e,l){Tl.value=e,Ul.value=l,Pl.buttonAlias=l.buttonAlias,Pl.buttonAction=l.buttonAction,Pl.buttonClass=l.buttonClass,Vl.value=!0}(e,l)},null,8,["onClick"]),[[pa,"Редактировать"]]),f(t(i,{icon:"pi pi-trash",size:"small",text:"",severity:"danger",onClick:e=>async function(e,l){if(confirm("Удалить кнопку?"))try{await w.post(`${Ll.value}/_m_delete/${l}`,"_xsrf=",{headers:{...ql(),"Content-Type":"application/x-www-form-urlencoded"}}),bl.add({severity:"success",summary:"Успешно",detail:"Кнопка удалена",life:3e3}),await Ml(wl.value.id)}catch(a){bl.add({severity:"error",summary:"Ошибка",detail:"Не удалось удалить кнопку",life:3e3})}}(0,l.id)},null,8,["onClick"]),[[pa,"Удалить"]])])]),_:2},1024)]),_:2},1032,["value"])])):(u(),o("div",fe," Кнопок пока нет "))])]}),_:2},1024))),128))])):(u(),o("div",be," Панелей пока нет. Добавьте первую панель к форме. "))])]),_:1})):n("",!0),t(na,{visible:xl.value,"onUpdate:visible":l[5]||(l[5]=e=>xl.value=e),header:"Создать новую форму",modal:!0,style:{width:"500px"}},{footer:d(()=>[t(i,{label:"Отмена",icon:"pi pi-times",onClick:l[4]||(l[4]=e=>xl.value=!1),text:""}),t(i,{label:"Создать",icon:"pi pi-check",onClick:Hl,loading:Cl.createForm,disabled:!Sl.name},null,8,["loading","disabled"])]),default:d(()=>[v("div",ye,[v("div",ge,[l[53]||(l[53]=v("label",{for:"newFormName"},"Название формы *",-1)),t(Jl,{id:"newFormName",modelValue:Sl.name,"onUpdate:modelValue":l[3]||(l[3]=e=>Sl.name=e),class:"w-full",placeholder:"Введите название формы"},null,8,["modelValue"])])])]),_:1},8,["visible"]),t(na,{visible:_l.value,"onUpdate:visible":l[13]||(l[13]=e=>_l.value=e),header:$l.value?"Редактировать панель":"Добавить панель",modal:!0,style:{width:"700px"}},{footer:d(()=>[t(i,{label:"Отмена",icon:"pi pi-times",onClick:Xl,text:""}),t(i,{label:$l.value?"Сохранить":"Добавить",icon:"pi pi-check",onClick:Gl,loading:Cl.savePanel,disabled:!Bl.name||!Bl.typeId},null,8,["label","loading","disabled"])]),default:d(()=>[v("div",we,[v("div",he,[l[54]||(l[54]=v("label",{for:"panelName"},"Название панели *",-1)),t(Jl,{id:"panelName",modelValue:Bl.name,"onUpdate:modelValue":l[6]||(l[6]=e=>Bl.name=e),class:"w-full",placeholder:"Введите название панели"},null,8,["modelValue"])]),v("div",Ce,[v("div",xe,[v("div",_e,[l[55]||(l[55]=v("label",{for:"panelType"},"Тип объекта (ID) *",-1)),t(Jl,{id:"panelType",modelValue:Bl.typeId,"onUpdate:modelValue":l[7]||(l[7]=e=>Bl.typeId=e),class:"w-full",placeholder:"ID типа"},null,8,["modelValue"])])]),v("div",ke,[v("div",Ve,[l[56]||(l[56]=v("label",{for:"panelReport"},"ID отчета (опционально)",-1)),t(Jl,{id:"panelReport",modelValue:Bl.reportId,"onUpdate:modelValue":l[8]||(l[8]=e=>Bl.reportId=e),class:"w-full",placeholder:"ID отчета"},null,8,["modelValue"])])])]),v("div",Ae,[v("div",$e,[v("div",Ie,[l[57]||(l[57]=v("label",{for:"panelBgColor"},"Цвет фона",-1)),t(Jl,{id:"panelBgColor",modelValue:Bl.bgcolor,"onUpdate:modelValue":l[9]||(l[9]=e=>Bl.bgcolor=e),class:"w-full",placeholder:"#ffffff"},null,8,["modelValue"])])]),v("div",Ue,[v("div",je,[l[58]||(l[58]=v("label",{for:"panelTextColor"},"Цвет текста",-1)),t(Jl,{id:"panelTextColor",modelValue:Bl.color,"onUpdate:modelValue":l[10]||(l[10]=e=>Bl.color=e),class:"w-full",placeholder:"#000000"},null,8,["modelValue"])])])]),v("div",Te,[l[59]||(l[59]=v("label",{for:"panelFilter"},"Фильтр (SQL WHERE условие)",-1)),t(da,{id:"panelFilter",modelValue:Bl.filter,"onUpdate:modelValue":l[11]||(l[11]=e=>Bl.filter=e),class:"w-full",rows:"2",placeholder:"Например: status='active'"},null,8,["modelValue"])]),v("div",Fe,[l[60]||(l[60]=v("label",{for:"panelNextAction"},"Действие после submit",-1)),t(Jl,{id:"panelNextAction",modelValue:Bl.nextAction,"onUpdate:modelValue":l[12]||(l[12]=e=>Bl.nextAction=e),class:"w-full",placeholder:"URL или путь"},null,8,["modelValue"])])])]),_:1},8,["visible","header"]),t(na,{visible:kl.value,"onUpdate:visible":l[17]||(l[17]=e=>kl.value=e),header:Il.value?"Редактировать поле":"Добавить поле",modal:!0,style:{width:"600px"}},{footer:d(()=>[t(i,{label:"Отмена",icon:"pi pi-times",onClick:Yl,text:""}),t(i,{label:Il.value?"Сохранить":"Добавить",icon:"pi pi-check",onClick:Kl,loading:Cl.saveField,disabled:!Dl.fieldId},null,8,["label","loading","disabled"])]),default:d(()=>[v("div",ze,[v("div",Re,[l[61]||(l[61]=v("label",{for:"fieldRequisite"},"Реквизит (ID или название) *",-1)),t(Jl,{id:"fieldRequisite",modelValue:Dl.fieldId,"onUpdate:modelValue":l[14]||(l[14]=e=>Dl.fieldId=e),class:"w-full",placeholder:"ID реквизита"},null,8,["modelValue"])]),v("div",Oe,[l[62]||(l[62]=v("label",{for:"fieldAlias"},"Псевдоним поля",-1)),t(Jl,{id:"fieldAlias",modelValue:Dl.fieldAlias,"onUpdate:modelValue":l[15]||(l[15]=e=>Dl.fieldAlias=e),class:"w-full",placeholder:"Отображаемое название"},null,8,["modelValue"])]),v("div",Ne,[l[63]||(l[63]=v("label",{for:"fieldValue"},"Значение по умолчанию",-1)),t(Jl,{id:"fieldValue",modelValue:Dl.fieldValue,"onUpdate:modelValue":l[16]||(l[16]=e=>Dl.fieldValue=e),class:"w-full",placeholder:"Значение"},null,8,["modelValue"])])])]),_:1},8,["visible","header"]),t(na,{visible:Vl.value,"onUpdate:visible":l[21]||(l[21]=e=>Vl.value=e),header:Ul.value?"Редактировать кнопку":"Добавить кнопку",modal:!0,style:{width:"600px"}},{footer:d(()=>[t(i,{label:"Отмена",icon:"pi pi-times",onClick:la,text:""}),t(i,{label:Ul.value?"Сохранить":"Добавить",icon:"pi pi-check",onClick:ea,loading:Cl.saveButton,disabled:!Pl.buttonAlias||!Pl.buttonAction},null,8,["label","loading","disabled"])]),default:d(()=>[v("div",Se,[v("div",Be,[l[64]||(l[64]=v("label",{for:"buttonAlias"},"Название кнопки *",-1)),t(Jl,{id:"buttonAlias",modelValue:Pl.buttonAlias,"onUpdate:modelValue":l[18]||(l[18]=e=>Pl.buttonAlias=e),class:"w-full",placeholder:"Текст на кнопке"},null,8,["modelValue"])]),v("div",De,[l[65]||(l[65]=v("label",{for:"buttonAction"},"Действие (URL или JavaScript) *",-1)),t(da,{id:"buttonAction",modelValue:Pl.buttonAction,"onUpdate:modelValue":l[19]||(l[19]=e=>Pl.buttonAction=e),class:"w-full",rows:"2",placeholder:"Например: /save или javascript:doSomething()"},null,8,["modelValue"])]),v("div",Pe,[l[66]||(l[66]=v("label",{for:"buttonClass"},"CSS класс",-1)),t(Jl,{id:"buttonClass",modelValue:Pl.buttonClass,"onUpdate:modelValue":l[20]||(l[20]=e=>Pl.buttonClass=e),class:"w-full",placeholder:"btn btn-primary"},null,8,["modelValue"])])])]),_:1},8,["visible","header"]),t(na,{visible:Al.value,"onUpdate:visible":l[34]||(l[34]=e=>Al.value=e),header:"Настройка сводной таблицы (Pivot)",modal:!0,style:{width:"800px"}},{footer:d(()=>[t(i,{label:"Отмена",icon:"pi pi-times",onClick:aa,text:""}),t(i,{label:"Сохранить",icon:"pi pi-check",onClick:oa,loading:Cl.savePivot},null,8,["loading"])]),default:d(()=>[v("div",Le,[t(a,{severity:"info",closable:!1},{default:d(()=>[...l[67]||(l[67]=[m(" Настройте параметры сводной таблицы для данных отчета. Конфигурация будет сохранена в реквизите 225 панели. ",-1)])]),_:1}),v("div",qe,[l[68]||(l[68]=v("label",{class:"font-semibold mb-2 block"},"Доступные поля отчета",-1)),zl.value.length>0?(u(),o("div",Ee,[(u(!0),o(b,null,y(zl.value,e=>f((u(),s(ra,{key:e,label:e,class:"cursor-pointer",onClick:l=>function(e){Rl.rows.includes(e)||Rl.cols.includes(e)?bl.add({severity:"info",summary:"Информация",detail:`Поле "${e}" уже добавлено`,life:2e3}):(0===Rl.rows.length?Rl.rows.push(e):0===Rl.cols.length?Rl.cols.push(e):Rl.vals.includes(e)||Rl.vals.push(e),bl.add({severity:"success",summary:"Добавлено",detail:`Поле "${e}" добавлено`,life:2e3}))}(e)},null,8,["label","onClick"])),[[pa,"Клик для добавления в строки/столбцы"]])),128))])):(u(),o("div",He,[t(i,{label:"Загрузить поля отчета",icon:"pi pi-download",onClick:ia,loading:Cl.pivotFields,outlined:"",size:"small"},null,8,["loading"])]))]),t(Zl),v("div",Me,[l[69]||(l[69]=v("label",{for:"pivotRows",class:"font-semibold mb-2 block"},[v("i",{class:"pi pi-bars mr-2"}),m("Строки (группировка по строкам) ")],-1)),t(ca,{id:"pivotRows",modelValue:Rl.rows,"onUpdate:modelValue":l[22]||(l[22]=e=>Rl.rows=e),allowDuplicate:!1,class:"w-full",placeholder:"Введите название поля или выберите из доступных"},null,8,["modelValue"]),l[70]||(l[70]=v("small",{class:"text-muted"},"Поля, по которым будут группироваться данные по строкам",-1))]),v("div",Je,[l[71]||(l[71]=v("label",{for:"pivotCols",class:"font-semibold mb-2 block"},[v("i",{class:"pi pi-table mr-2"}),m("Столбцы (группировка по столбцам) ")],-1)),t(ca,{id:"pivotCols",modelValue:Rl.cols,"onUpdate:modelValue":l[23]||(l[23]=e=>Rl.cols=e),allowDuplicate:!1,class:"w-full",placeholder:"Введите название поля или выберите из доступных"},null,8,["modelValue"]),l[72]||(l[72]=v("small",{class:"text-muted"},"Поля, по которым будут группироваться данные по столбцам",-1))]),v("div",Ze,[l[73]||(l[73]=v("label",{for:"pivotVals",class:"font-semibold mb-2 block"},[v("i",{class:"pi pi-calculator mr-2"}),m("Значения (агрегируемые поля) ")],-1)),t(ca,{id:"pivotVals",modelValue:Rl.vals,"onUpdate:modelValue":l[24]||(l[24]=e=>Rl.vals=e),allowDuplicate:!1,class:"w-full",placeholder:"Поля для агрегации (суммирования, подсчета и т.д.)"},null,8,["modelValue"])]),v("div",We,[v("div",Qe,[v("div",Ge,[l[74]||(l[74]=v("label",{for:"pivotAggregator",class:"font-semibold mb-2 block"},"Функция агрегации",-1)),t(ua,{id:"pivotAggregator",modelValue:Rl.aggregatorName,"onUpdate:modelValue":l[25]||(l[25]=e=>Rl.aggregatorName=e),options:Ol,optionLabel:"label",optionValue:"value",class:"w-full",placeholder:"Выберите функцию"},null,8,["modelValue"])])]),v("div",Xe,[v("div",Ke,[l[75]||(l[75]=v("label",{for:"pivotRenderer",class:"font-semibold mb-2 block"},"Тип отображения",-1)),t(ua,{id:"pivotRenderer",modelValue:Rl.rendererName,"onUpdate:modelValue":l[26]||(l[26]=e=>Rl.rendererName=e),options:Nl,optionLabel:"label",optionValue:"value",class:"w-full",placeholder:"Выберите тип"},null,8,["modelValue"])])])]),v("div",Ye,[v("div",el,[v("div",ll,[l[79]||(l[79]=v("label",{class:"font-semibold mb-2 block"},"Сортировка строк",-1)),v("div",al,[v("div",il,[t(va,{modelValue:Rl.rowOrder,"onUpdate:modelValue":l[27]||(l[27]=e=>Rl.rowOrder=e),inputId:"rowAsc",value:"key_a_to_z"},null,8,["modelValue"]),l[76]||(l[76]=v("label",{for:"rowAsc",class:"ml-2"},"A → Z",-1))]),v("div",ol,[t(va,{modelValue:Rl.rowOrder,"onUpdate:modelValue":l[28]||(l[28]=e=>Rl.rowOrder=e),inputId:"rowDesc",value:"key_z_to_a"},null,8,["modelValue"]),l[77]||(l[77]=v("label",{for:"rowDesc",class:"ml-2"},"Z → A",-1))]),v("div",tl,[t(va,{modelValue:Rl.rowOrder,"onUpdate:modelValue":l[29]||(l[29]=e=>Rl.rowOrder=e),inputId:"rowVal",value:"value_z_to_a"},null,8,["modelValue"]),l[78]||(l[78]=v("label",{for:"rowVal",class:"ml-2"},"По значению ↓",-1))])])])]),v("div",sl,[v("div",nl,[l[82]||(l[82]=v("label",{class:"font-semibold mb-2 block"},"Сортировка столбцов",-1)),v("div",dl,[v("div",rl,[t(va,{modelValue:Rl.colOrder,"onUpdate:modelValue":l[30]||(l[30]=e=>Rl.colOrder=e),inputId:"colAsc",value:"key_a_to_z"},null,8,["modelValue"]),l[80]||(l[80]=v("label",{for:"colAsc",class:"ml-2"},"A → Z",-1))]),v("div",cl,[t(va,{modelValue:Rl.colOrder,"onUpdate:modelValue":l[31]||(l[31]=e=>Rl.colOrder=e),inputId:"colDesc",value:"key_z_to_a"},null,8,["modelValue"]),l[81]||(l[81]=v("label",{for:"colDesc",class:"ml-2"},"Z → A",-1))])])])])]),v("div",ul,[v("div",vl,[t(ma,{modelValue:Rl.showTotals,"onUpdate:modelValue":l[32]||(l[32]=e=>Rl.showTotals=e),inputId:"showTotals",binary:!0},null,8,["modelValue"]),l[83]||(l[83]=v("label",{for:"showTotals",class:"ml-2"},"Показывать итоги",-1))]),v("div",ml,[t(ma,{modelValue:Rl.enableFiltering,"onUpdate:modelValue":l[33]||(l[33]=e=>Rl.enableFiltering=e),inputId:"enableFiltering",binary:!0},null,8,["modelValue"]),l[84]||(l[84]=v("label",{for:"enableFiltering",class:"ml-2"},"Включить фильтрацию",-1))])])])]),_:1},8,["visible"])])}}},[["__scopeId","data-v-ef704e4f"]]);export{pl as default};
