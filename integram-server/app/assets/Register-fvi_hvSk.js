import{r as e,D as a,K as t,L as l,c as s,A as o,a as r,y as n,G as i,b as d,f as u,w as c,t as m,F as v,o as p}from"./index-B7VcSS8y.js";import{a as g}from"./index-CcrxTH1M.js";import{_ as h}from"./_plugin-vue_export-helper-BCo6x5W8.js";const w={class:"bg-surface-50 dark:bg-surface-950",style:{display:"flex","align-items":"center","justify-content":"center","min-height":"100vh",overflow:"hidden"}},y={style:{display:"flex","flex-direction":"column","align-items":"center","justify-content":"center"}},f={style:{"border-radius":"56px",padding:"0.3rem",background:"linear-gradient(\n            180deg,\n            var(--primary-color) 10%,\n            rgba(33, 150, 243, 0) 30%\n          )"}},b={class:"w-full bg-surface-0 dark:bg-surface-900",style:{"border-radius":"53px",width:"450px",padding:"2rem 2.5rem"}},x={style:{"margin-bottom":"1.5rem"}},k={style:{"margin-bottom":"1.5rem"}},T={class:"flex items-start gap-2 mb-3"},C={for:"agreeToTerms",class:"text-xs text-surface-700 dark:text-surface-200"},_={key:0,class:"text-red-500 text-center text-sm mb-2"},I={class:"mt-4"},V={class:"oauth-buttons-row"},S=["disabled"],$={key:0,class:"oauth-icon oauth-icon-lg",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},M={key:1,class:"pi pi-spin pi-spinner"},U=["disabled"],z={key:0,class:"oauth-icon",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},A={key:1,class:"pi pi-spin pi-spinner"},E=["disabled"],R={key:0,class:"oauth-icon",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg"},B={key:1,class:"pi pi-spin pi-spinner"},L=["disabled"],j={key:0,class:"oauth-icon",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},H={key:1,class:"pi pi-spin pi-spinner"},N={class:"text-center mt-3"},F="/api/auth",P=h({__name:"Register",setup(h){const P=e(""),D=e(""),G=e(""),q=e(""),J=e(!1),K=e(!1),O=e(""),W=e(null),Q=a(),X=l(),Y=e({yandex:!1,vk:!1,google:!1,telegram:!1}),Z=["info@drondoc.ru","admin@drondoc.ru","support@drondoc.ru","sales@drondoc.ru","noreply@drondoc.ru","contact@drondoc.ru","help@drondoc.ru"];t(()=>{const e=new URLSearchParams(window.location.search).get("ref");e&&(W.value=e);const a=window.location.hash;if(a&&a.includes("tgAuthResult="))try{const e=a.split("tgAuthResult=")[1],t=JSON.parse(decodeURIComponent(e));ee(t),window.history.replaceState(null,"",window.location.pathname)}catch(t){}});const ee=async e=>{var a,t;Y.value.telegram=!0;try{const a=await g.post(`${F}/oauth/telegram`,e);if(a.data.success){const{accessToken:e,refreshToken:t,username:l,displayName:s}=a.data.data;localStorage.setItem("accessToken",e),localStorage.setItem("refreshToken",t),Q.add({severity:"success",summary:"Успешно",detail:`Добро пожаловать, ${s||l}!`,life:3e3}),window.opener?(window.opener.postMessage({type:"telegram_auth_success",data:a.data.data},"*"),window.close()):setTimeout(()=>X.push("/welcome"),1e3)}}catch(l){Q.add({severity:"error",summary:"Ошибка авторизации",detail:(null==(t=null==(a=l.response)?void 0:a.data)?void 0:t.error)||"Не удалось войти через Telegram",life:5e3})}finally{Y.value.telegram=!1}},ae=async()=>{if(P.value&&D.value&&G.value&&q.value?Z.includes(D.value.toLowerCase())?G.value!==q.value?(O.value="Пароли не совпадают",0):G.value.length<8?(O.value="Пароль должен содержать минимум 8 символов",0):J.value||(O.value="Вы должны согласиться с условиями использования",0):(O.value=`Email должен быть одним из: ${Z.join(", ")}`,0):(O.value="Все поля должны быть заполнены",0)){K.value=!0,O.value="";try{await async function({email:e,password:a,username:t,referralCode:l}){var s,o,r,n;try{return(await g.post("/api/auth/register/email",{email:e,password:a,username:t,referralCode:l})).data}catch(i){throw new Error((null==(o=null==(s=i.response)?void 0:s.data)?void 0:o.message)||(null==(n=null==(r=i.response)?void 0:r.data)?void 0:n.error)||"Failed to register with email")}}({username:P.value,email:D.value,password:G.value,displayName:P.value,referralCode:W.value}),Q.add({severity:"success",summary:"Проверьте Email",detail:"Письмо с подтверждением отправлено на "+D.value,life:8e3}),setTimeout(()=>{X.push(`/email-verify?email=${encodeURIComponent(D.value)}`)},2e3)}catch(e){O.value=e.message||"Ошибка регистрации",Q.add({severity:"error",summary:"Ошибка регистрации",detail:O.value,life:5e3})}finally{K.value=!1}}else Q.add({severity:"error",summary:"Ошибка валидации",detail:O.value,life:3e3})},te=async e=>{Y.value[e]=!0;try{const a=await g.get(`${F}/oauth/${e}`);a.data.success&&(window.location.href=a.data.data.authUrl)}catch(a){Q.add({severity:"error",summary:"Ошибка авторизации",detail:`Не удалось подключиться к ${e}`,life:3e3}),Y.value[e]=!1}};window.onTelegramAuth=async e=>{var a,t;Y.value.telegram=!0;try{const a=await g.post(`${F}/oauth/telegram`,e);a.data.success&&(localStorage.setItem("accessToken",a.data.data.accessToken),localStorage.setItem("refreshToken",a.data.data.refreshToken),localStorage.setItem("user",a.data.data.username||a.data.data.displayName),localStorage.setItem("id",a.data.data.userId),localStorage.setItem("session_timestamp",Date.now().toString()),Q.add({severity:"success",summary:"Успешная авторизация",detail:"Вход через Telegram выполнен",life:3e3}),setTimeout(()=>{X.push("/")},1e3))}catch(l){Q.add({severity:"error",summary:"Ошибка Telegram",detail:(null==(t=null==(a=l.response)?void 0:a.data)?void 0:t.error)||"Не удалось войти через Telegram",life:3e3})}finally{Y.value.telegram=!1}};const le=()=>{Y.value.telegram=!0;const e=window.location.origin,a=(window.innerWidth-550)/2,t=(window.innerHeight-470)/2,l=window.open(`https://oauth.telegram.org/auth?bot_id=8383750910&origin=${encodeURIComponent(e)}&request_access=write&return_to=${encodeURIComponent(e+"/register")}`,"telegram_login",`width=550,height=470,left=${a},top=${t}`);if(!l)return Y.value.telegram=!1,void Q.add({severity:"warn",summary:"Popup заблокирован",detail:"Разрешите popup-окна для авторизации через Telegram",life:5e3});const s=e=>{var a;if("telegram_auth_success"===(null==(a=e.data)?void 0:a.type)){window.removeEventListener("message",s),Y.value.telegram=!1;const{accessToken:a,refreshToken:t,username:l,displayName:o}=e.data.data;localStorage.setItem("accessToken",a),localStorage.setItem("refreshToken",t),Q.add({severity:"success",summary:"Успешно",detail:`Добро пожаловать, ${o||l}!`,life:3e3}),setTimeout(()=>X.push("/welcome"),1e3)}};window.addEventListener("message",s);const o=setInterval(()=>{l.closed&&(clearInterval(o),window.removeEventListener("message",s),Y.value.telegram=!1)},500);setTimeout(()=>{clearInterval(o),window.removeEventListener("message",s),Y.value.telegram=!1},12e4)};return(e,a)=>{const t=n("Toast"),l=n("InputText"),g=n("Password"),h=n("Checkbox"),F=n("router-link"),D=n("Button");return p(),s(v,null,[o(t),r("div",w,[r("div",y,[r("div",f,[r("div",b,[a[18]||(a[18]=r("div",{style:{"text-align":"center","margin-bottom":"1.5rem"}},[r("div",{class:"text-2xl font-bold text-surface-900 dark:text-surface-0 mb-1"},"Создать аккаунт"),r("span",{class:"text-muted-color text-sm"},"Начните работу с платформой")],-1)),r("div",null,[r("form",{onSubmit:i(ae,["prevent"])},[o(l,{id:"login",type:"text",placeholder:"Логин",class:"w-full",style:{"margin-bottom":"1.5rem"},modelValue:P.value,"onUpdate:modelValue":a[0]||(a[0]=e=>P.value=e)},null,8,["modelValue"]),r("div",x,[o(g,{id:"password",modelValue:G.value,"onUpdate:modelValue":a[1]||(a[1]=e=>G.value=e),placeholder:"Пароль",toggleMask:!0,feedback:!1,inputClass:"w-full",fluid:""},null,8,["modelValue"])]),r("div",k,[o(g,{id:"confirmPassword",modelValue:q.value,"onUpdate:modelValue":a[2]||(a[2]=e=>q.value=e),placeholder:"Повторите пароль",toggleMask:!0,feedback:!1,inputClass:"w-full",fluid:""},null,8,["modelValue"])]),r("div",T,[o(h,{modelValue:J.value,"onUpdate:modelValue":a[3]||(a[3]=e=>J.value=e),binary:!0,inputId:"agreeToTerms"},null,8,["modelValue"]),r("label",C,[a[9]||(a[9]=u(" Согласен с ",-1)),o(F,{to:"/legal/terms-of-service",target:"_blank",class:"text-primary font-semibold no-underline hover:underline"},{default:c(()=>[...a[7]||(a[7]=[u("условиями",-1)])]),_:1}),a[10]||(a[10]=u(" и ",-1)),o(F,{to:"/legal/privacy-policy",target:"_blank",class:"text-primary font-semibold no-underline hover:underline"},{default:c(()=>[...a[8]||(a[8]=[u("политикой",-1)])]),_:1})])]),o(D,{label:"Зарегистрироваться",class:"w-full mb-3",type:"submit",loading:K.value},null,8,["loading"]),O.value?(p(),s("div",_,m(O.value),1)):d("",!0),r("div",I,[a[15]||(a[15]=r("div",{class:"divider"},[r("span",null,"или через")],-1)),r("div",V,[r("button",{onClick:a[4]||(a[4]=e=>te("yandex")),disabled:Y.value.yandex,class:"oauth-btn oauth-yandex",type:"button",title:"Яндекс"},[Y.value.yandex?(p(),s("i",M)):(p(),s("svg",$,[...a[11]||(a[11]=[r("path",{d:"M14.14 7.88h-.57c-.81 0-1.35.41-1.35 1.16 0 .66.32 1.05 1.19 1.6l.72.46-2.16 3.4H10.4l1.85-2.91c-1.13-.77-1.73-1.57-1.73-2.7 0-1.54 1.13-2.7 2.96-2.7h2.24v8.32h-1.58V7.88z",fill:"currentColor"},null,-1)])]))],8,S),r("button",{onClick:a[5]||(a[5]=e=>te("google")),disabled:Y.value.google,class:"oauth-btn oauth-google",type:"button",title:"Google"},[Y.value.google?(p(),s("i",A)):(p(),s("svg",z,[...a[12]||(a[12]=[r("path",{d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z",fill:"#4285F4"},null,-1),r("path",{d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z",fill:"#34A853"},null,-1),r("path",{d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z",fill:"#FBBC05"},null,-1),r("path",{d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z",fill:"#EA4335"},null,-1)])]))],8,U),r("button",{onClick:a[6]||(a[6]=e=>te("vk")),disabled:Y.value.vk,class:"oauth-btn oauth-vk",type:"button",title:"ВКонтакте"},[Y.value.vk?(p(),s("i",B)):(p(),s("svg",R,[...a[13]||(a[13]=[r("path",{d:"M25.54 34.58c-10.94 0-17.18-7.5-17.44-19.98h5.48c.18 9.16 4.22 13.04 7.42 13.84V14.6h5.16v7.9c3.16-.34 6.48-3.94 7.6-7.9h5.16c-.86 4.88-4.46 8.48-7.02 9.96 2.56 1.2 6.66 4.36 8.22 10.02h-5.68c-1.22-3.8-4.26-6.74-8.28-7.14v7.14h-.62z",fill:"currentColor"},null,-1)])]))],8,E),r("button",{onClick:le,disabled:Y.value.telegram,class:"oauth-btn oauth-telegram",type:"button",title:"Telegram"},[Y.value.telegram?(p(),s("i",H)):(p(),s("svg",j,[...a[14]||(a[14]=[r("path",{d:"M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z",fill:"currentColor"},null,-1)])]))],8,L)])]),r("div",N,[a[17]||(a[17]=r("span",{class:"text-muted-color text-sm"},"Уже есть аккаунт? ",-1)),o(F,{to:"/login",class:"text-primary font-semibold no-underline hover:underline text-sm"},{default:c(()=>[...a[16]||(a[16]=[u(" Войти ",-1)])]),_:1})])],32)])])])])])],64)}}},[["__scopeId","data-v-be8eaa51"]]);export{P as default};
