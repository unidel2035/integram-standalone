import{r as e,y as l,c as a,o as t,b as i,A as d,a as n,t as s,w as u,J as o,u as r,h as c,j as m,D as v,U as p,K as y,f,F as b,d as g,g as V,N as $,L as h,aW as k,k as T,n as _}from"./index-m6PXRYQN.js";import{u as A}from"./useIntegramSession-Bx_TCvff.js";import{i as x}from"./integramService-BCsancml.js";import{i as w}from"./integramApiClient-BsYdo77J.js";import{R as I}from"./ReferenceField-DQkxIbaW.js";import{_ as U}from"./_plugin-vue_export-helper-BCo6x5W8.js";import{I as D}from"./IntegramBreadcrumb-Br9bSfo2.js";import"./index-CcrxTH1M.js";import"./unifiedAuthService-6fZILgG8.js";const j={class:"file-field"},q={key:0,class:"mb-2"},M={class:"flex align-items-center gap-2"},E=["href"],O={__name:"FileField",props:{id:String,modelValue:[String,File],currentFile:String},emits:["update:modelValue","delete"],setup(o,{emit:r}){const c=r,m=e(!1);function v(e){const l=e.files[0];c("update:modelValue",l)}function p(){c("delete"),m.value=!1}return(e,r)=>{const c=l("Button"),y=l("FileUpload"),f=l("Dialog");return t(),a("div",j,[o.currentFile?(t(),a("div",q,[n("div",M,[n("a",{href:o.currentFile,target:"_blank",class:"text-primary"},s(o.currentFile.split("/").pop()),9,E),d(c,{icon:"pi pi-trash",onClick:r[0]||(r[0]=e=>m.value=!0),size:"small",text:"",rounded:"",severity:"danger"})])])):i("",!0),d(y,{id:o.id,mode:"basic","choose-label":o.currentFile?"–ó–∞–º–µ–Ω–∏—Ç—å —Ñ–∞–π–ª":"–í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª",onSelect:v,auto:!1,"custom-upload":!0,class:"p-button-outlined"},null,8,["id","choose-label"]),d(f,{visible:m.value,"onUpdate:visible":r[2]||(r[2]=e=>m.value=e),header:"–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ",style:{width:"350px"},modal:""},{footer:u(()=>[d(c,{label:"–û—Ç–º–µ–Ω–∞",onClick:r[1]||(r[1]=e=>m.value=!1),text:""}),d(c,{label:"–£–¥–∞–ª–∏—Ç—å",onClick:p,severity:"danger"})]),default:u(()=>[r[3]||(r[3]=n("p",null,"–£–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª?",-1))]),_:1},8,["visible"])])}}},C={class:"date-field"},F={class:"flex gap-2"},N={__name:"DateField",props:{id:String,modelValue:[String,Date],mode:{type:String,default:"calendar"}},emits:["update:modelValue","toggle-mode"],setup(i,{emit:s}){const u=i,v=s,p=e(),y=e([{label:"[TODAY] - –°–µ–≥–æ–¥–Ω—è—à–Ω–∏–π –¥–µ–Ω—å",command:()=>g("[TODAY]")},{label:"[YESTERDAY] - –í—á–µ—Ä–∞—à–Ω–∏–π –¥–µ–Ω—å",command:()=>g("[YESTERDAY]")},{label:"[TOMORROW] - –ó–∞–≤—Ç—Ä–∞—à–Ω–∏–π –¥–µ–Ω—å",command:()=>g("[TOMORROW]")},{label:"[MONTH_AGO] - –î–µ–Ω—å –º–µ—Å—è—Ü –Ω–∞–∑–∞–¥",command:()=>g("[MONTH_AGO]")}]),f=o(()=>"string"==typeof u.modelValue&&u.modelValue.startsWith("[")?function(e){const l=new Date;switch(l.setHours(0,0,0,0),e){case"[TODAY]":default:return l;case"[YESTERDAY]":{const e=new Date(l);return e.setDate(e.getDate()-1),e}case"[TOMORROW]":{const e=new Date(l);return e.setDate(e.getDate()+1),e}case"[MONTH_AGO]":{const e=new Date(l);return e.setMonth(e.getMonth()-1),e}}}(u.modelValue):u.modelValue);function b(e){p.value.toggle(e)}function g(e){v("update:modelValue",e)}function V(e){v("update:modelValue",e)}function $(e){if("string"==typeof e&&e.startsWith("["))v("update:modelValue",e);else{if("string"==typeof e){const l=e.split(".");if(3===l.length){const e=parseInt(l[0]),a=parseInt(l[1])-1,t=parseInt(l[2]);if(!isNaN(e)&&!isNaN(a)&&!isNaN(t)){const l=new Date(t,a,e);return void v("update:modelValue",l)}}}v("update:modelValue",e)}}return(e,s)=>{const u=l("Calendar"),o=l("InputText"),g=l("Button"),h=l("Menu"),k=r("tooltip");return t(),a("div",C,[n("div",F,["calendar"===i.mode?(t(),c(u,{key:0,id:i.id,modelValue:f.value,"onUpdate:modelValue":V,dateFormat:"dd.mm.yy",class:"flex-1"},null,8,["id","modelValue"])):(t(),c(o,{key:1,id:i.id,modelValue:i.modelValue,"onUpdate:modelValue":$,placeholder:"–¥–¥.–º–º.–≥–≥–≥–≥ –∏–ª–∏ [TODAY], [YESTERDAY], –∏ —Ç.–¥.",class:"flex-1"},null,8,["id","modelValue"])),m(d(g,{icon:"pi pi-pencil",onClick:s[0]||(s[0]=e=>v("toggle-mode")),size:"small",text:"",rounded:""},null,512),[[k,"–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ä–µ–∂–∏–º –≤–≤–æ–¥–∞",void 0,{top:!0}]]),m(d(g,{icon:"pi pi-calendar-plus",onClick:b,size:"small",text:"",rounded:""},null,512),[[k,"–°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è",void 0,{top:!0}]])]),d(h,{ref_key:"menu",ref:p,model:y.value,popup:!0},null,8,["model"])])}}},R={class:"datetime-field"},S={class:"flex gap-2"},L=U({__name:"DateTimeField",props:{id:String,modelValue:[String,Date]},emits:["update:modelValue"],setup(i,{emit:s}){const u=i,c=s,v=e(),p=e([{label:"[NOW] - –¢–µ–∫—É—â–∏–µ –¥–∞—Ç–∞ –∏ –≤—Ä–µ–º—è",command:()=>{c("update:modelValue","[NOW]")}}]),y=o(()=>"string"==typeof u.modelValue&&"[NOW]"===u.modelValue?new Date:u.modelValue);function f(e){v.value.toggle(e)}function b(e){c("update:modelValue",e)}return(e,s)=>{const u=l("Calendar"),o=l("Button"),c=l("Menu"),g=r("tooltip");return t(),a("div",R,[n("div",S,[d(u,{id:i.id,modelValue:y.value,"onUpdate:modelValue":b,showTime:"",hourFormat:"24",showSeconds:!0,dateFormat:"dd.mm.yy",class:"flex-1"},null,8,["id","modelValue"]),m(d(o,{icon:"pi pi-clock",onClick:f,size:"small",text:"",rounded:""},null,512),[[g,"–°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è",void 0,{top:!0}]])]),d(c,{ref_key:"menu",ref:v,model:p.value,popup:!0},null,8,["model"])])}}},[["__scopeId","data-v-4f5c550e"]]),B={class:"password-field"},z={class:"flex gap-2"},H={__name:"PasswordField",props:{id:String,modelValue:String,showGenerator:{type:Boolean,default:!1}},emits:["update:modelValue","generate","copy-invite"],setup(e,{emit:s}){const u=s;return(s,o)=>{const r=l("Password"),m=l("Button");return t(),a("div",B,[n("div",z,[d(r,{id:e.id,modelValue:e.modelValue,"onUpdate:modelValue":o[0]||(o[0]=e=>u("update:modelValue",e)),toggleMask:"",feedback:!1,class:"flex-1"},null,8,["id","modelValue"]),e.showGenerator?(t(),c(m,{key:0,icon:"pi pi-refresh",onClick:o[1]||(o[1]=e=>u("generate")),size:"small",outlined:"",rounded:"",title:"–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ä–æ–ª—å"})):i("",!0),e.showGenerator?(t(),c(m,{key:1,icon:"pi pi-envelope",onClick:o[2]||(o[2]=e=>u("copy-invite")),size:"small",outlined:"",rounded:"",title:"–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ"})):i("",!0)])])}}},G={class:"integram-enhanced-editor integram-touch-friendly"},W={key:0,class:"text-center py-5"},P={class:"flex align-items-center justify-content-between"},Y={class:"flex align-items-center gap-2"},J={class:"flex gap-2 align-items-center ml-auto"},K={class:"integram-field"},Q=["for"],X={key:0,class:"text-red-500 mr-1"},Z={key:0},ee={key:1},le={class:"flex gap-2 align-items-center"},ae={key:2},te={key:3},ie={key:4},de={key:5},ne={key:6},se=["name"],ue={key:7},oe={key:8},re={key:9},ce={key:10},me={key:11},ve={class:"p-3 surface-100 border-round"},pe={key:12},ye={key:13,class:"block mt-1 text-500"},fe={class:"integram-field"},be=["for"],ge={key:0,class:"text-red-500 mr-1"},Ve={key:0},$e={key:1},he={class:"flex gap-2 align-items-center"},ke={key:1,class:"text-500"},Te={key:2},_e={key:3},Ae={key:4},xe={key:5},we={key:6},Ie=["name"],Ue={key:7},De={key:8},je={key:9},qe={key:10},Me={key:11},Ee={key:12},Oe={class:"p-3 surface-100 border-round"},Ce={key:13},Fe={key:14,class:"block mt-1 text-500"},Ne={key:2,class:"mt-4 flex gap-2"},Re={class:"mt-4 integram-actions"},Se={key:3,class:"mt-3 p-3 surface-border border-1 border-round"},Le={class:"font-semibold mb-3"},Be={class:"flex gap-2"},ze=U({__name:"IntegramEnhancedObjectEditor",props:{database:{type:String,required:!0},objectId:{type:[String,Number],required:!0}},emits:["objectLoaded"],setup(k,{emit:T}){const _=k,A=T,U=$(),D=h(),j=v(),q=e(!0),M=e(!1),E=e(!1),C=e(null),F=e(null),R=e(null),S=e([]),B=e([]),z=e([]),ze=e({}),He=e({}),Ge=e(!1),We=e(0),Pe=e(!1),Ye=e(!1);async function Je(){var e;try{q.value=!0;const t=w.getAuthInfo();t&&t.token&&x.setSession({token:t.token,xsrf:t.xsrf,database:_.database}),x.setDatabase(_.database);const i=await x.getEditObject(_.objectId,U.query.tab);if(!i||!i.obj)throw new Error(`–û–±—ä–µ–∫—Ç #${_.objectId} –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –æ—Ç–≤–µ—Ç –ø—É—Å—Ç–æ–π`);if(C.value=i.obj,R.value=i.metadata,!C.value.typ)throw new Error(`–û–±—ä–µ–∫—Ç #${_.objectId} –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–∏–ø (typ)`);const d=await x.getMetadata(C.value.typ),n=i.arr_type||{};if(d&&d.reqs){const e=d.reqs.map(e=>{const l="4"===e.type,a=!l&&void 0!==e.ref;let t=null,d=null,s=null,u=[];const o=i.reqs?i.reqs[e.id]:void 0,r=e.attrs&&e.attrs.includes(":MULTI:");if(void 0!==o)if(Array.isArray(o))r?(u=o.map(e=>({id:e.ref||e.id,text:e.val||e.name||String(e.ref||e.id),msId:e.id,ord:e.ord||0})),t=u.map(e=>e.id)):t=o;else if(r&&a&&null!==o&&"object"==typeof o&&"multiselect"in o){const e=o.multiselect;e&&e.id&&Array.isArray(e.id)&&e.val&&Array.isArray(e.val)&&e.ref_val&&Array.isArray(e.ref_val)?(u=e.id.map((l,a)=>({id:e.val[a],text:e.ref_val[a]||`#${e.val[a]}`,msId:l,ord:e.ord?e.ord[a]:a+1})),t=u.map(e=>e.id)):t=null}else if(r&&a&&"string"==typeof o&&o.length>0){const l=i.reqs?i.reqs[`ref_${e.id}`]:void 0;if(l&&"string"==typeof l){const e=l.match(/^(\d+):(.+)$/);if(e){e[1];const l=e[2].split(","),a=o.split(",");u=l.map((e,l)=>({id:e.trim(),text:a[l]?a[l].trim():`#${e.trim()}`,msId:null,ord:l+1})),t=u.map(e=>e.id)}else t=o}else t=o}else null!==o&&"object"==typeof o?("value"in o?t=o.value:"id"in o&&"val"in o?(t=o.id,s=o.val):t="val"in o?o.val:"id"in o?o.id:o,o.file&&(d=o.file)):t=o;let c=null;return c=l?n[e.id]||e.arr||e.arr_id||e.ref||null:e.ref||null,{id:e.id,name:e.val,baseType:(v=e.type,{3:"SHORT",8:"CHARS",9:"DATE",4:"DATETIME",13:"SIGNED",14:"NUMBER",11:"BOOLEAN",12:"MEMO",10:"FILE",15:"HTML",6:"PWD",16:"CALCULATABLE",17:"BUTTON",18:"PATH",19:"REPORT_COLUMN"}[v]||"SHORT"),required:e.attrs&&e.attrs.includes(":!NULL:"),multi:e.attrs&&e.attrs.includes(":MULTI:"),isReference:a,isArray:l,refTypeId:c,restrict:e.ref_restrict,allowCreate:e.attrs&&e.attrs.includes(":!CREATE:"),currentValue:t,currentDisplayName:s,currentFile:d,multiselectItems:u,count:i.arrCounts?i.arrCounts[e.id]:0,hint:(m=e.attrs,m?m.includes("[TODAY]")?"–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: —Å–µ–≥–æ–¥–Ω—è":m.includes("[NOW]")?"–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è":"":""),tabId:e.tab||null};var m,v});for(const a of e)if(a.isReference&&a.currentValue&&!a.currentDisplayName&&!a.isArray)try{const e=await x.getReferenceOptions(a.id,_.objectId,a.restrict,"");e&&e[a.currentValue]&&(a.currentDisplayName=e[a.currentValue].toString())}catch(l){}S.value=e}if(i.reqs)for(const[e,l]of Object.entries(i.reqs))Array.isArray(l)?ze.value[`t${e}`]=l.map(e=>"object"==typeof e&&null!==e?e.ref||("value"in e?e.value:"id"in e&&"val"in e?e.id:"val"in e?e.val:"id"in e?e.id:JSON.stringify(e)):e):null!==l&&"object"==typeof l?"multiselect"in l&&l.multiselect&&l.multiselect.val&&Array.isArray(l.multiselect.val)?ze.value[`t${e}`]=l.multiselect.val:ze.value[`t${e}`]="value"in l?l.value:"id"in l&&"val"in l?l.id:"val"in l?l.val:"id"in l?l.id:"":ze.value[`t${e}`]=l;if(i.tabs&&(B.value=i.tabs),i.buttons&&(z.value=i.buttons),C.value.up&&"0"!==C.value.up)try{F.value=await x.getMetadata(C.value.up)}catch(a){}A("objectLoaded",{objectData:C.value,parentType:F.value,typeName:null==(e=C.value)?void 0:e.typ_name})}catch(l){j.add({severity:"error",summary:"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",detail:l.message,life:5e3})}finally{q.value=!1}}function Ke(e){return Ge.value||"MEMO"===e.baseType||"HTML"===e.baseType?"col-12":"FILE"===e.baseType?"col-12 md:col-8 lg:col-6":["DATE","DATETIME"].includes(e.baseType)||["SIGNED","NUMBER"].includes(e.baseType)||"BOOLEAN"===e.baseType?"col-12 md:col-6 lg:col-4":"SHORT"===e.baseType||"CHARS"===e.baseType||e.isReference?"col-12 md:col-6":"col-12"}async function Qe(e,l){const a=S.value.filter(l=>l.restrict===e);if(a.length>0)for(const t of a)ze.value[`t${t.id}`]=null}function Xe(){Ge.value=!Ge.value,document.cookie=`gridMode${C.value.typ}=${Ge.value?"1":"0"}; path=/`,j.add({severity:"info",summary:Ge.value?"–†–µ–∂–∏–º: –°–ø–∏—Å–æ–∫":"–†–µ–∂–∏–º: –°–µ—Ç–∫–∞",detail:Ge.value?"–í—Å–µ –ø–æ–ª—è –≤ –æ–¥–∏–Ω —Å—Ç–æ–ª–±–µ—Ü":"–ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è —Å–µ—Ç–∫–∞ –ø–æ–ª–µ–π",life:2e3})}function Ze(e){He.value[e]="text"===He.value[e]?"calendar":"text"}function el(e){const l=Math.random().toString(36).replace(/\./g,"").substr(1,8)+Math.random().toString(36).replace(/\./g,"").substr(1,8);ze.value[`t${e}`]=l,navigator.clipboard.writeText(l),j.add({severity:"success",summary:"–ü–∞—Ä–æ–ª—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω",detail:"–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞",life:3e3})}function ll(){const e=ze.value.t18||"",l=ze.value.t20||"",a=`–°—Å—ã–ª–∫–∞ –¥–ª—è –≤—Ö–æ–¥–∞: https://${window.location.host}/${_.database}?u=${e}\n–ø–∞—Ä–æ–ª—å: ${l}`;navigator.clipboard.writeText(a),j.add({severity:"success",summary:"–ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ",detail:"–û—Ç–ø—Ä–∞–≤—å—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é",life:3e3})}async function al(){try{M.value=!0;const e=S.value.filter(e=>e.required&&!ze.value[`t${e.id}`]);if(e.length>0)return void j.add({severity:"warn",summary:"–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è",detail:e.map(e=>e.name).join(", "),life:5e3});(await x.saveObject(_.objectId,ze.value)).id&&(j.add({severity:"success",summary:"–û–±—ä–µ–∫—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω",life:3e3}),await Je())}catch(e){j.add({severity:"error",summary:"–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è",detail:e.message,life:5e3})}finally{M.value=!1}}async function tl(){try{const e=await x.createObject(C.value.typ,`${C.value.val} (copy)`,C.value.up,ze.value);e.id&&(j.add({severity:"success",summary:"–û–±—ä–µ–∫—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω",detail:`ID: ${e.id}`,life:3e3}),D.push(`/integram/${_.database}/edit/${e.id}`))}catch(e){j.add({severity:"error",summary:"–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è",detail:e.message,life:5e3})}}async function il(){try{E.value=!0,await x.deleteObject(_.objectId),j.add({severity:"success",summary:"–û–±—ä–µ–∫—Ç —É–¥–∞–ª–µ–Ω",life:3e3}),D.push(`/integram/${_.database}/object/${C.value.typ}`)}catch(e){j.add({severity:"error",summary:"–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è",detail:e.message,life:5e3})}finally{E.value=!1}}async function dl(e){try{await x.setRequisites(_.objectId,{[`t${e}`]:""}),j.add({severity:"success",summary:"–§–∞–π–ª —É–¥–∞–ª–µ–Ω",life:3e3}),await Je()}catch(l){j.add({severity:"error",summary:"–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ñ–∞–π–ª–∞",detail:l.message,life:5e3})}}function nl(){D.push(`/integram/${_.database}/object/${C.value.typ}`)}function sl(e){D.push({path:`/integram/${_.database}/object/${e.refTypeId}`,query:{F_U:_.objectId,action:"add"}})}return o(()=>S.value.some(e=>e.isArray)),p(()=>_.objectId,()=>{Je()}),y(()=>{Je()}),p(()=>{var e;return null==(e=C.value)?void 0:e.typ},e=>{if(e){const l=document.cookie.split(";").find(l=>l.trim().startsWith(`gridMode${e}=`));if(l){const e=l.split("=")[1];Ge.value="1"===e}}}),(e,o)=>{const v=l("ProgressSpinner"),p=l("Badge"),y=l("Button"),$=l("Message"),h=l("router-link"),T=l("InputText"),A=l("Checkbox"),x=l("Editor"),w=l("Textarea"),U=l("InputNumber"),j=l("TabPanel"),F=l("TabView"),R=l("Card"),Je=r("tooltip");return t(),a("div",G,[q.value?(t(),a("div",W,[d(v)])):C.value?(t(),c(R,{key:1},{title:u(()=>[n("div",P,[n("div",Y,[n("span",null,s(C.value.val),1),d(p,{value:C.value.typ_name,severity:"secondary",class:"text-xs"},null,8,["value"]),m((t(),a("span",{class:"text-500 text-sm cursor-pointer",onClick:o[0]||(o[0]=e=>{return l=C.value.id,navigator.clipboard.writeText(l.toString()),Ye.value=!0,void setTimeout(()=>{Ye.value=!1},2500);var l})},[f(" #"+s(C.value.id),1)])),[[Je,"–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å ID",void 0,{right:!0}]])]),n("div",J,[m(d(y,{icon:Ge.value?"pi pi-list":"pi pi-th-large",onClick:Xe,size:"small",rounded:"",outlined:!Ge.value,severity:Ge.value?"primary":"secondary"},null,8,["icon","outlined","severity"]),[[Je,Ge.value?"–°–ø–∏—Å–æ–∫":"–°–µ—Ç–∫–∞",void 0,{bottom:!0}]])])])]),content:u(()=>[d($,{severity:"secondary",closable:!0,class:"mb-3 text-sm"},{default:u(()=>[...o[4]||(o[4]=[f(" –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –æ—Ç–º–µ—á–µ–Ω—ã ",-1),n("span",{class:"text-red-500 font-bold"},"*",-1)])]),_:1}),B.value.length>0?(t(),c(F,{key:0,activeIndex:We.value,"onUpdate:activeIndex":o[1]||(o[1]=e=>We.value=e)},{default:u(()=>[(t(!0),a(b,null,g(B.value,e=>(t(),c(j,{key:e.id,header:e.name},{default:u(()=>{return[n("div",{class:V(["grid gap-3",{"grid-list-mode":Ge.value}])},[(t(!0),a(b,null,g((l=e.id,S.value.filter(e=>e.tabId===l)),e=>(t(),a("div",{key:e.id,class:V(Ge.value?"col-12":Ke(e))},[n("div",K,[n("label",{for:`req_${e.id}`,class:"block mb-2"},[e.required?(t(),a("span",X,"*")):i("",!0),f(" "+s(e.name),1)],8,Q),e.isReference?(t(),a("div",Z,[d(I,{id:`req_${e.id}`,modelValue:ze.value[`t${e.id}`],"onUpdate:modelValue":[l=>ze.value[`t${e.id}`]=l,l=>Qe(e.id)],"req-id":e.id,"ref-type-id":e.refTypeId,database:k.database,"object-id":C.value.id,multi:e.multi,"allow-create":e.allowCreate,restrict:e.restrict,"current-display-name":e.currentDisplayName,"initial-multiselect-items":e.multiselectItems},null,8,["id","modelValue","onUpdate:modelValue","req-id","ref-type-id","database","object-id","multi","allow-create","restrict","current-display-name","initial-multiselect-items"])])):e.isArray?(t(),a("div",ee,[n("div",le,[e.refTypeId?(t(),c(h,{key:0,to:`/integram/${k.database}/object/${e.refTypeId}?F_U=${C.value.id}`,class:"text-primary font-semibold"},{default:u(()=>[d(p,{value:e.count||0},null,8,["value"]),o[5]||(o[5]=f(" –ü–µ—Ä–µ–π—Ç–∏ –∫ —Å–ø–∏—Å–∫—É ",-1))]),_:2},1032,["to"])):i("",!0),e.refTypeId?m((t(),c(y,{key:1,icon:"pi pi-plus",label:"–î–æ–±–∞–≤–∏—Ç—å",onClick:l=>sl(e),size:"small",outlined:""},null,8,["onClick"])),[[Je,"–î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å –≤ –ø–æ–¥—á–∏–Ω–µ–Ω–Ω—É—é —Ç–∞–±–ª–∏—Ü—É",void 0,{top:!0}]]):i("",!0)]),e.showValue?(t(),c(T,{key:0,modelValue:ze.value[`t${e.id}`],"onUpdate:modelValue":l=>ze.value[`t${e.id}`]=l,class:"w-full mt-2"},null,8,["modelValue","onUpdate:modelValue"])):i("",!0)])):"FILE"===e.baseType?(t(),a("div",ae,[d(O,{id:`req_${e.id}`,modelValue:ze.value[`t${e.id}`],"onUpdate:modelValue":l=>ze.value[`t${e.id}`]=l,"current-file":e.currentFile,"object-id":C.value.id,"req-id":e.id,database:k.database,onDelete:l=>dl(e.id)},null,8,["id","modelValue","onUpdate:modelValue","current-file","object-id","req-id","database","onDelete"])])):"DATE"===e.baseType?(t(),a("div",te,[d(N,{id:`req_${e.id}`,modelValue:ze.value[`t${e.id}`],"onUpdate:modelValue":l=>ze.value[`t${e.id}`]=l,mode:He.value[e.id]||"calendar",onToggleMode:l=>Ze(e.id)},null,8,["id","modelValue","onUpdate:modelValue","mode","onToggleMode"])])):"DATETIME"===e.baseType?(t(),a("div",ie,[d(L,{id:`req_${e.id}`,modelValue:ze.value[`t${e.id}`],"onUpdate:modelValue":l=>ze.value[`t${e.id}`]=l},null,8,["id","modelValue","onUpdate:modelValue"])])):"PWD"===e.baseType?(t(),a("div",de,[d(H,{id:`req_${e.id}`,modelValue:ze.value[`t${e.id}`],"onUpdate:modelValue":l=>ze.value[`t${e.id}`]=l,"show-generator":!0,onGenerate:l=>el(e.id),onCopyInvite:ll},null,8,["id","modelValue","onUpdate:modelValue","onGenerate"])])):"BOOLEAN"===e.baseType?(t(),a("div",ne,[d(A,{id:`req_${e.id}`,modelValue:ze.value[`t${e.id}`],"onUpdate:modelValue":l=>ze.value[`t${e.id}`]=l,binary:!0},null,8,["id","modelValue","onUpdate:modelValue"]),n("input",{type:"hidden",name:`b${e.id}`,value:"1"},null,8,se)])):"HTML"===e.baseType?(t(),a("div",ue,[d(x,{id:`req_${e.id}`,modelValue:ze.value[`t${e.id}`],"onUpdate:modelValue":l=>ze.value[`t${e.id}`]=l,editorStyle:"height: 200px"},null,8,["id","modelValue","onUpdate:modelValue"])])):"MEMO"===e.baseType?(t(),a("div",oe,[d(w,{id:`req_${e.id}`,modelValue:ze.value[`t${e.id}`],"onUpdate:modelValue":l=>ze.value[`t${e.id}`]=l,rows:"5",class:"w-full"},null,8,["id","modelValue","onUpdate:modelValue"])])):"SHORT"===e.baseType?(t(),a("div",re,[d(T,{id:`req_${e.id}`,modelValue:ze.value[`t${e.id}`],"onUpdate:modelValue":l=>ze.value[`t${e.id}`]=l,class:"w-full"},null,8,["id","modelValue","onUpdate:modelValue"])])):["NUMBER","SIGNED"].includes(e.baseType)?(t(),a("div",ce,[d(U,{id:`req_${e.id}`,modelValue:ze.value[`t${e.id}`],"onUpdate:modelValue":l=>ze.value[`t${e.id}`]=l,"min-fraction-digits":"NUMBER"===e.baseType?2:0,"max-fraction-digits":"NUMBER"===e.baseType?2:0,class:"w-full"},null,8,["id","modelValue","onUpdate:modelValue","min-fraction-digits","max-fraction-digits"])])):"CALCULATABLE"===e.baseType?(t(),a("div",me,[n("div",ve,s(ze.value[`t${e.id}`]),1)])):(t(),a("div",pe,[d(T,{id:`req_${e.id}`,modelValue:ze.value[`t${e.id}`],"onUpdate:modelValue":l=>ze.value[`t${e.id}`]=l,class:"w-full"},null,8,["id","modelValue","onUpdate:modelValue"])])),e.hint?(t(),a("small",ye,s(e.hint),1)):i("",!0)])],2))),128))],2)];var l}),_:2},1032,["header"]))),128))]),_:1},8,["activeIndex"])):(t(),a("div",{key:1,class:V(["grid gap-3",{"grid-list-mode":Ge.value}])},[(t(!0),a(b,null,g(S.value,e=>(t(),a("div",{key:e.id,class:V(Ge.value?"col-12":Ke(e))},[n("div",fe,[n("label",{for:`req_${e.id}`,class:"block mb-2"},[e.required?(t(),a("span",ge,"*")):i("",!0),f(" "+s(e.name),1)],8,be),e.isReference?(t(),a("div",Ve,[d(I,{id:`req_${e.id}`,modelValue:ze.value[`t${e.id}`],"onUpdate:modelValue":[l=>ze.value[`t${e.id}`]=l,l=>Qe(e.id)],"req-id":e.id,"ref-type-id":e.refTypeId,database:k.database,"object-id":C.value.id,multi:e.multi,"allow-create":e.allowCreate,restrict:e.restrict,"current-display-name":e.currentDisplayName,"initial-multiselect-items":e.multiselectItems},null,8,["id","modelValue","onUpdate:modelValue","req-id","ref-type-id","database","object-id","multi","allow-create","restrict","current-display-name","initial-multiselect-items"])])):e.isArray?(t(),a("div",$e,[n("div",he,[e.refTypeId?(t(),c(h,{key:0,to:`/integram/${k.database}/object/${e.refTypeId}?F_U=${C.value.id}`,class:"text-primary font-semibold"},{default:u(()=>[d(p,{value:e.count||0},null,8,["value"]),o[6]||(o[6]=f(" –ü–µ—Ä–µ–π—Ç–∏ –∫ —Å–ø–∏—Å–∫—É ",-1))]),_:2},1032,["to"])):(t(),a("div",ke,[d(p,{value:e.count||0},null,8,["value"]),o[7]||(o[7]=f(" –ü–æ–¥—á–∏–Ω–µ–Ω–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ (—Ç–∏–ø –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω) ",-1))])),e.refTypeId?m((t(),c(y,{key:2,icon:"pi pi-plus",label:"–î–æ–±–∞–≤–∏—Ç—å",onClick:l=>sl(e),size:"small",outlined:""},null,8,["onClick"])),[[Je,"–î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å –≤ –ø–æ–¥—á–∏–Ω–µ–Ω–Ω—É—é —Ç–∞–±–ª–∏—Ü—É",void 0,{top:!0}]]):i("",!0)]),e.showValue?(t(),c(T,{key:0,modelValue:ze.value[`t${e.id}`],"onUpdate:modelValue":l=>ze.value[`t${e.id}`]=l,class:"w-full mt-2"},null,8,["modelValue","onUpdate:modelValue"])):i("",!0)])):"FILE"===e.baseType?(t(),a("div",Te,[d(O,{id:`req_${e.id}`,modelValue:ze.value[`t${e.id}`],"onUpdate:modelValue":l=>ze.value[`t${e.id}`]=l,"current-file":e.currentFile,"object-id":C.value.id,"req-id":e.id,database:k.database,onDelete:l=>dl(e.id)},null,8,["id","modelValue","onUpdate:modelValue","current-file","object-id","req-id","database","onDelete"])])):"DATE"===e.baseType?(t(),a("div",_e,[d(N,{id:`req_${e.id}`,modelValue:ze.value[`t${e.id}`],"onUpdate:modelValue":l=>ze.value[`t${e.id}`]=l,mode:He.value[e.id]||"calendar",onToggleMode:l=>Ze(e.id)},null,8,["id","modelValue","onUpdate:modelValue","mode","onToggleMode"])])):"DATETIME"===e.baseType?(t(),a("div",Ae,[d(L,{id:`req_${e.id}`,modelValue:ze.value[`t${e.id}`],"onUpdate:modelValue":l=>ze.value[`t${e.id}`]=l},null,8,["id","modelValue","onUpdate:modelValue"])])):"PWD"===e.baseType?(t(),a("div",xe,[d(H,{id:`req_${e.id}`,modelValue:ze.value[`t${e.id}`],"onUpdate:modelValue":l=>ze.value[`t${e.id}`]=l,"show-generator":!0,onGenerate:l=>el(e.id),onCopyInvite:ll},null,8,["id","modelValue","onUpdate:modelValue","onGenerate"])])):"BOOLEAN"===e.baseType?(t(),a("div",we,[d(A,{id:`req_${e.id}`,modelValue:ze.value[`t${e.id}`],"onUpdate:modelValue":l=>ze.value[`t${e.id}`]=l,binary:!0},null,8,["id","modelValue","onUpdate:modelValue"]),n("input",{type:"hidden",name:`b${e.id}`,value:"1"},null,8,Ie)])):"HTML"===e.baseType?(t(),a("div",Ue,[d(x,{id:`req_${e.id}`,modelValue:ze.value[`t${e.id}`],"onUpdate:modelValue":l=>ze.value[`t${e.id}`]=l,editorStyle:"height: 200px"},null,8,["id","modelValue","onUpdate:modelValue"])])):"MEMO"===e.baseType?(t(),a("div",De,[d(w,{id:`req_${e.id}`,modelValue:ze.value[`t${e.id}`],"onUpdate:modelValue":l=>ze.value[`t${e.id}`]=l,rows:"5",class:"w-full"},null,8,["id","modelValue","onUpdate:modelValue"])])):"SHORT"===e.baseType?(t(),a("div",je,[d(T,{id:`req_${e.id}`,modelValue:ze.value[`t${e.id}`],"onUpdate:modelValue":l=>ze.value[`t${e.id}`]=l,class:"w-full"},null,8,["id","modelValue","onUpdate:modelValue"])])):"CHARS"===e.baseType?(t(),a("div",qe,[d(T,{id:`req_${e.id}`,modelValue:ze.value[`t${e.id}`],"onUpdate:modelValue":l=>ze.value[`t${e.id}`]=l,class:"w-full"},null,8,["id","modelValue","onUpdate:modelValue"])])):["NUMBER","SIGNED"].includes(e.baseType)?(t(),a("div",Me,[d(U,{id:`req_${e.id}`,modelValue:ze.value[`t${e.id}`],"onUpdate:modelValue":l=>ze.value[`t${e.id}`]=l,"min-fraction-digits":"NUMBER"===e.baseType?2:0,"max-fraction-digits":"NUMBER"===e.baseType?2:0,class:"w-full"},null,8,["id","modelValue","onUpdate:modelValue","min-fraction-digits","max-fraction-digits"])])):"CALCULATABLE"===e.baseType?(t(),a("div",Ee,[n("div",Oe,s(ze.value[`t${e.id}`]),1)])):(t(),a("div",Ce,[d(T,{id:`req_${e.id}`,modelValue:ze.value[`t${e.id}`],"onUpdate:modelValue":l=>ze.value[`t${e.id}`]=l,class:"w-full"},null,8,["id","modelValue","onUpdate:modelValue"])])),e.hint?(t(),a("small",Fe,s(e.hint),1)):i("",!0)])],2))),128))],2)),z.value.length>0?(t(),a("div",Ne,[(t(!0),a(b,null,g(z.value,e=>(t(),c(y,{key:e.id,label:e.label,class:V(e.class),onClick:l=>function(e){D.push(`/integram/${_.database}/${e.action}`)}(e)},null,8,["label","class","onClick"]))),128))])):i("",!0),n("div",Re,[d(y,{label:"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å",icon:"pi pi-save",onClick:al,loading:M.value,severity:"primary"},null,8,["loading"]),d(y,{label:"–î—É–±–ª–∏—Ä–æ–≤–∞—Ç—å",icon:"pi pi-copy",onClick:tl,outlined:""}),d(y,{label:"–û—Ç–º–µ–Ω–∞",icon:"pi pi-times",onClick:nl,outlined:""}),Pe.value?i("",!0):m((t(),c(y,{key:0,label:"–£–¥–∞–ª–∏—Ç—å",icon:"pi pi-trash",onClick:o[2]||(o[2]=e=>Pe.value=!0),severity:"danger",outlined:""},null,512)),[[Je,"–£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å",void 0,{top:!0}]])]),Pe.value?(t(),a("div",Se,[n("p",Le," –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ —É–¥–∞–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏: "+s(C.value.val),1),n("div",Be,[d(y,{label:"–î–∞, —É–¥–∞–ª–∏—Ç—å",icon:"pi pi-trash",onClick:il,loading:E.value,severity:"danger"},null,8,["loading"]),d(y,{label:"–û—Ç–º–µ–Ω–∞",onClick:o[3]||(o[3]=e=>Pe.value=!1),outlined:""})])])):i("",!0)]),_:1})):i("",!0)])}}},[["__scopeId","data-v-3634417b"]]),He={class:"integram-object-edit-page integram-touch-friendly"},Ge={class:"text-center py-5"},We={class:"mt-3"},Pe={class:"text-center py-5"},Ye={key:2},Je={class:"flex align-items-center justify-content-between"},Ke={class:"flex gap-2 align-items-center ml-auto"},Qe={class:"text-sm"},Xe={class:"editable-cell-content"},Ze={class:"editable-cell-content"},el={key:0,class:"multiselect-badges"},ll={key:0,class:"text-sm text-500"},al={class:"integram-actions"},tl={class:"flex justify-content-between align-items-center"},il={class:"text-sm"},dl={key:0,class:"text-sm text-color-secondary"},nl={class:"mt-2"},sl={class:"flex align-items-center gap-3"},ul={class:"integram-actions justify-content-end w-full"},ol=U({__name:"IntegramObjectEdit",setup(p){const I=$(),U=h(),j=v(),{isAuthenticated:q,database:M}=A(),E=e(!1),O=e(!0),C=e(""),F=e("–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ—Å—Å–∏–∏..."),N=e(!1),R=e(null),S=e(null),L=e([]),B=e(!1),z=e({}),H=e(null),G=e(null),W=e(null),P=e(!1),Y=e(20),J=e(null),K=e({id:{value:null,matchMode:k.CONTAINS},val:{value:null,matchMode:k.CONTAINS}}),Q=e({visible:!1,objectId:null,loading:!1}),X=o(()=>I.params.objectId),Z=o(()=>I.params.database||M.value||"integram"),ee=o(()=>{var e;const l=[{label:"–¢–∞–±–ª–∏—Ü—ã",to:`/integram/${Z.value}/dict`,icon:"pi pi-table"}];return N.value&&(null==(e=S.value)?void 0:e.val)?l.push({label:S.value.val,icon:"pi pi-bars"}):!N.value&&H.value?(G.value&&W.value&&l.push({label:G.value,to:`/integram/${Z.value}/object/${W.value}`,icon:"pi pi-bars"}),l.push({label:H.value.val||`#${H.value.id}`,icon:"pi pi-pencil"})):N.value||l.push({label:"–ó–∞–≥—Ä—É–∑–∫–∞...",icon:"pi pi-spin pi-spinner"}),l}),le=o(()=>R.value&&R.value.req_order?R.value.req_order:[]);function ae(e){return R.value&&R.value.req_type&&R.value.req_type[e]||`–†–µ–∫–≤–∏–∑–∏—Ç ${e}`}function te(e){return R.value&&R.value.req_base&&R.value.req_base[e]||"SHORT"}function ie(e){return z.value[e]||{isReference:!1,isMulti:!1,refTypeId:null}}function de(e){const l=["#78AAD2","#78AAFF","#78D2AA","#78D2FF","#78FFAA","#78FFD2","#AA78D2","#AA78FF","#AAD278","#AAD2FF","#AAFF78","#AAFFD2","#D278AA","#D278FF","#D2AA78","#D2AAFF","#D2FF78","#D2FFAA","#FF78AA","#FF78D2","#FFAA78","#FFAAD2","#FFD278","#FFD2AA"],a=parseInt(e)||0;return l[Math.abs(a)%l.length]}function ne(e){switch(te(e)){case"SIGNED":case"NUMBER":default:return InputText;case"BOOLEAN":return"Checkbox";case"DATE":case"DATETIME":return"Calendar";case"MEMO":case"HTML":return"Textarea"}}function se(e,l){if(null==e||""===e)return"‚Äî";const a=ie(l),t=te(l);return a.isReference?a.isMulti&&Array.isArray(e)?0===e.length?"‚Äî":e:e&&"object"==typeof e&&"val"in e?e.val:e:"BOOLEAN"===t?e?"‚úì":"‚úó":e}function ue(){P.value=!P.value,j.add({severity:"info",summary:P.value?"–†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤–∫–ª—é—á–µ–Ω":"–†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤—ã–∫–ª—é—á–µ–Ω",detail:P.value?"–ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ —è—á–µ–π–∫—É –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è":"–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–∫–ª—é—á–µ–Ω–æ",life:3e3})}async function oe(e){const{data:l,newValue:a,field:t,index:i}=e;if(a!==l[t]){L.value[i][t]=a;try{B.value=!0;const e={};"val"===t?await w.saveObject(l.id,X.value,a,{}):t.startsWith("req_")?(e[t.replace("req_","")]=a,await w.setObjectRequisites(l.id,e)):(e[t]=a,await w.setObjectRequisites(l.id,e)),J.value=(new Date).toLocaleTimeString("ru-RU"),j.add({severity:"success",summary:"–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ",detail:"–ò–∑–º–µ–Ω–µ–Ω–∏—è —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã",life:2e3})}catch(d){j.add({severity:"error",summary:"–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è",detail:d.message||"–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è",life:5e3}),await pe()}finally{B.value=!1}}}async function re(){try{const e=I.query.F_U||null,l=await w.createObject(X.value,"–ù–æ–≤–∞—è –∑–∞–ø–∏—Å—å",{},e);j.add({severity:"success",summary:"–°–æ–∑–¥–∞–Ω–æ",detail:`–ù–æ–≤–∞—è –∑–∞–ø–∏—Å—å #${l.id||""} —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞`,life:3e3}),await pe()}catch(e){j.add({severity:"error",summary:"–û—à–∏–±–∫–∞",detail:e.message||"–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –∑–∞–ø–∏—Å—å",life:5e3})}}async function ce(){try{Q.value.loading=!0,await w.deleteObject(Q.value.objectId),j.add({severity:"success",summary:"–£–¥–∞–ª–µ–Ω–æ",detail:"–ó–∞–ø–∏—Å—å —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–∞",life:3e3}),Q.value.visible=!1,Q.value.objectId=null,await pe()}catch(e){j.add({severity:"error",summary:"–û—à–∏–±–∫–∞",detail:e.message||"–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å",life:5e3})}finally{Q.value.loading=!1}}function me(){U.push(`/integram/${Z.value}/edit_types?typeId=${X.value}`)}function ve(e){var l;H.value=e.objectData,G.value=e.typeName,W.value=null==(l=e.objectData)?void 0:l.typ}async function pe(){try{B.value=!0,F.value="–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...";const l=await x.getObjects(X.value);if(l&&l.list){N.value=!0,R.value=l,S.value=l.type;try{const e=await x.getMetadata(X.value);if(e&&e.reqs){const l={};e.reqs.forEach(e=>{const a="4"===e.type,t=!a&&void 0!==e.ref,i=e.attrs&&e.attrs.includes(":MULTI:");l[e.id]={isReference:t,isArray:a,isMulti:i,refTypeId:e.ref||null,baseType:e.type||null}}),z.value=l}}catch(e){}L.value=l.list.map(e=>{const a={id:e.id,val:e.val,up:e.up};return l.req_order&&l.req_order.forEach(l=>{const t=z.value[l];if(t&&t.isMulti&&t.isReference){const t=e[`ref_${l}`],i=e[l];if(t&&i){const e=t.match(/^(\d+):(.+)$/);if(e){e[1];const t=e[2].split(","),d=i.split(","),n=t.map((e,l)=>({id:null,ref:e.trim(),val:d[l]?d[l].trim():`#${e.trim()}`,ord:l+1}));a[`req_${l}`]=n}else a[`req_${l}`]=i||""}else a[`req_${l}`]=[]}else a[`req_${l}`]=e[l]||""}),a}),F.value=""}else N.value=!1}catch(l){N.value=!1}finally{B.value=!1,O.value=!1}}return q.value||U.replace("/integram/login"),y(async()=>{try{if(F.value="–ü—Ä–æ–≤–µ—Ä–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏...",!q.value)throw new Error("–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω. –¢—Ä–µ–±—É–µ—Ç—Å—è –≤—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É.");const e=w.getAuthInfo();if(!e||!e.token)throw new Error("–°–µ—Å—Å–∏—è –∏—Å—Ç–µ–∫–ª–∞. –¢—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –≤—Ö–æ–¥.");e.database&&x.setDatabase(e.database),E.value=!0,await pe()}catch(e){C.value=e.message,O.value=!1,setTimeout(()=>{U.replace("/integram/login")},2e3)}}),(e,o)=>{const v=l("ProgressSpinner"),p=l("Card"),y=l("Message"),$=l("Button"),h=l("InputText"),k=l("Column"),A=l("DataTable"),x=l("router-link"),w=l("Dialog"),I=r("tooltip");return t(),a("div",He,[d(D,{items:ee.value},null,8,["items"]),O.value?(t(),c(p,{key:0},{content:u(()=>[n("div",Ge,[d(v),n("p",We,s(F.value),1)])]),_:1})):C.value?(t(),c(p,{key:1},{content:u(()=>[n("div",Pe,[d(y,{severity:"error",closable:!1},{default:u(()=>[f(s(C.value),1)]),_:1})])]),_:1})):N.value&&R.value?(t(),a("div",Ye,[d(p,null,{title:u(()=>{var e;return[n("div",Je,[n("span",null,s((null==(e=S.value)?void 0:e.val)||"–û–±—ä–µ–∫—Ç—ã"),1),n("div",Ke,[m(d($,{icon:"pi pi-plus",label:"–°–æ–∑–¥–∞—Ç—å",onClick:re,size:"small"},null,512),[[I,"–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å",void 0,{bottom:!0}]]),m(d($,{icon:"pi pi-pencil",outlined:!P.value,severity:P.value?"success":"secondary",onClick:ue,size:"small",rounded:""},null,8,["outlined","severity"]),[[I,P.value?"–†–µ–∂–∏–º –ø—Ä–∞–≤–∫–∏ –≤–∫–ª.":"–í–∫–ª—é—á–∏—Ç—å –ø—Ä–∞–≤–∫—É",void 0,{bottom:!0}]]),m(d($,{icon:"pi pi-cog",outlined:"",rounded:"",size:"small",onClick:me},null,512),[[I,"–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã",void 0,{bottom:!0}]]),m(d($,{icon:"pi pi-refresh",outlined:"",rounded:"",size:"small",onClick:pe},null,512),[[I,"–û–±–Ω–æ–≤–∏—Ç—å",void 0,{bottom:!0}]])])])]}),content:u(()=>[P.value?(t(),c(y,{key:1,severity:"success",closable:!1,class:"mb-3"},{default:u(()=>[...o[4]||(o[4]=[n("div",{class:"flex align-items-center gap-2"},[n("i",{class:"pi pi-check-circle text-2xl"}),n("div",null,[n("p",{class:"m-0"},[n("strong",null,"‚úÖ –†–ï–ñ–ò–ú –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–Ø –ê–ö–¢–ò–í–ï–ù"),f(" - –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –ª—é–±—É—é —è—á–µ–π–∫—É –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏—è")])])],-1)])]),_:1})):(t(),c(y,{key:0,severity:"info",closable:!0,class:"mb-3"},{default:u(()=>[...o[3]||(o[3]=[n("div",{class:"flex align-items-center gap-2"},[n("i",{class:"pi pi-info-circle text-2xl"}),n("div",null,[n("p",{class:"m-0 mb-2"},[n("strong",null,"üéØ –ò–ù–°–¢–†–£–ö–¶–ò–Ø: –ö–∞–∫ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è –≤ —Ç–∞–±–ª–∏—Ü–µ")]),n("ul",{class:"m-0 pl-4"},[n("li",{class:"mb-1"},[n("strong",null,"–ë—ã—Å—Ç—Ä–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Ç–∞–±–ª–∏—Ü–µ:"),f(" –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "),n("strong",null,'"–í–∫–ª—é—á–∏—Ç—å –ø—Ä–∞–≤–∫—É"'),f(" –≤—ã—à–µ, –∑–∞—Ç–µ–º –∫–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –ª—é–±—É—é —è—á–µ–π–∫—É –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è")]),n("li",{class:"mb-1"},[n("strong",null,"–î–µ—Ç–∞–ª—å–Ω–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏:"),f(" –ù–∞–∂–º–∏—Ç–µ "),n("i",{class:"pi pi-pencil"}),f(" –≤ —Å—Ç—Ä–æ–∫–µ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è —Ñ–æ—Ä–º—ã —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ –≤—Å–µ–º–∏ —Ç–∏–ø–∞–º–∏ –ø–æ–ª–µ–π")]),n("li",{class:"mb-1"},[n("strong",null,"–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ç–∞–±–ª–∏—Ü—ã:"),f(" –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "),n("strong",null,'"–°—Ç—Ä—É–∫—Ç—É—Ä–∞"'),f(" –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/—É–¥–∞–ª–µ–Ω–∏—è –∫–æ–ª–æ–Ω–æ–∫, –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö")]),n("li",{class:"mb-1"},[n("strong",null,"–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –∑–∞–ø–∏—Å–µ–π:"),f(" –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "),n("strong",null,'"–î–æ–±–∞–≤–∏—Ç—å"'),f(" –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–π –∑–∞–ø–∏—Å–∏")])]),n("div",{class:"mt-2 p-2 surface-50 border-round"},[n("small",{class:"text-600"},[n("i",{class:"pi pi-lightbulb mr-1"}),n("strong",null,"–°–æ–≤–µ—Ç:"),f(" –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ –∏–∑ —è—á–µ–π–∫–∏. –ü–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤–Ω–∏–∑—É —Ç–∞–±–ª–∏—Ü—ã. ")])])])],-1)])]),_:1})),d(A,{filters:K.value,"onUpdate:filters":o[0]||(o[0]=e=>K.value=e),value:L.value,paginator:!0,rows:Y.value,rowsPerPageOptions:[10,20,50,100],editMode:P.value?"cell":null,onCellEditComplete:oe,loading:B.value,showGridlines:"",stripedRows:"",resizableColumns:"",columnResizeMode:"expand",filterDisplay:"row",class:"editable-integram-table",dataKey:"id"},{footer:u(()=>[n("div",tl,[n("span",il,"–í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π: "+s(L.value.length),1),J.value?(t(),a("span",dl," –ü–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ: "+s(J.value),1)):i("",!0)])]),default:u(()=>[d(k,{field:"id",header:"ID",sortable:!0,style:{"min-width":"80px"}},{body:u(({data:e})=>[n("code",Qe,s(e.id),1)]),filter:u(({filterModel:e,filterCallback:l})=>[d(h,{modelValue:e.value,"onUpdate:modelValue":l=>e.value=l,onInput:e=>l(),placeholder:"–ü–æ–∏—Å–∫ –ø–æ ID",class:"p-column-filter",size:"small"},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:1}),d(k,{field:"val",header:"–ó–Ω–∞—á–µ–Ω–∏–µ",sortable:!0,style:{"min-width":"200px"}},{body:u(({data:e})=>[n("div",Xe,s(e.val),1)]),editor:u(({data:e,field:l})=>[d(h,{modelValue:e[l],"onUpdate:modelValue":a=>e[l]=a,autofocus:"",class:"w-full"},null,8,["modelValue","onUpdate:modelValue"])]),filter:u(({filterModel:e,filterCallback:l})=>[d(h,{modelValue:e.value,"onUpdate:modelValue":l=>e.value=l,onInput:e=>l(),placeholder:"–ü–æ–∏—Å–∫",class:"p-column-filter",size:"small"},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:1}),(t(!0),a(b,null,g(le.value,e=>(t(),c(k,{key:e,field:`req_${e}`,header:ae(e),sortable:!0,style:{"min-width":"150px"}},{body:u(({data:l})=>[n("div",Ze,[ie(e).isMulti&&Array.isArray(se(l[`req_${e}`],e))?(t(),a("div",el,[(t(!0),a(b,null,g(se(l[`req_${e}`],e),e=>(t(),a("span",{key:e.id||e.ref,class:"badge badge-pill text-sm px-2 py-1 mr-1 mb-1",style:_({backgroundColor:de(e.ref||e.id)})},s(e.val||e.name||`#${e.ref||e.id}`),5))),128))])):(t(),a(b,{key:1},[f(s(se(l[`req_${e}`],e)),1)],64))])]),editor:u(({data:l,field:i})=>[ie(e).isReference?(t(),a("div",ll,[...o[5]||(o[5]=[n("i",{class:"pi pi-info-circle mr-1"},null,-1),f(" –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ —Ñ–æ—Ä–º–µ ",-1)])])):(t(),c(T(ne(e)),{key:1,modelValue:l[i],"onUpdate:modelValue":e=>l[i]=e,class:V({"w-full":!0}),autofocus:""},null,8,["modelValue","onUpdate:modelValue"]))]),filter:u(({filterModel:l,filterCallback:a})=>[d(h,{modelValue:l.value,"onUpdate:modelValue":e=>l.value=e,onInput:e=>a(),placeholder:`–ü–æ–∏—Å–∫ –ø–æ ${ae(e)}`,class:"p-column-filter",size:"small"},null,8,["modelValue","onUpdate:modelValue","onInput","placeholder"])]),_:2},1032,["field","header"]))),128)),d(k,{header:"–î–µ–π—Å—Ç–≤–∏—è",frozen:!0,alignFrozen:"right",style:{"min-width":"140px"}},{body:u(({data:e})=>[n("div",al,[m(d($,{icon:"pi pi-pencil",onClick:l=>{return a=e.id,void U.push(`/integram/${Z.value}/edit_obj/${a}`);var a},size:"small",text:"",rounded:"",severity:"info","aria-label":"–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å"},null,8,["onClick"]),[[I,"–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ —Ñ–æ—Ä–º–µ",void 0,{top:!0}]]),m(d($,{icon:"pi pi-trash",onClick:l=>{return a=e.id,Q.value.objectId=a,void(Q.value.visible=!0);var a},size:"small",text:"",rounded:"",severity:"danger","aria-label":"–£–¥–∞–ª–∏—Ç—å",class:"ml-auto"},null,8,["onClick"]),[[I,"–£–¥–∞–ª–∏—Ç—å",void 0,{top:!0}]])])]),_:1})]),_:1},8,["filters","value","rows","editMode","loading"])]),_:1})])):!N.value&&Z.value&&X.value?(t(),c(ze,{key:3,database:Z.value,objectId:X.value,onObjectLoaded:ve},null,8,["database","objectId"])):O.value||N.value?i("",!0):(t(),c(p,{key:4},{content:u(()=>[d(y,{severity:"warn",closable:!1},{default:u(()=>[n("p",null,"–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –æ–±—ä–µ–∫—Ç #"+s(X.value),1),n("p",nl,[d(x,{to:`/integram/${Z.value}/dict`},{default:u(()=>[...o[6]||(o[6]=[f(" –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å–ø–∏—Å–∫—É —Ç–∞–±–ª–∏—Ü ",-1)])]),_:1},8,["to"])])]),_:1})]),_:1})),d(w,{visible:Q.value.visible,"onUpdate:visible":o[2]||(o[2]=e=>Q.value.visible=e),header:"–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è",modal:!0,style:{width:"450px"}},{footer:u(()=>[n("div",ul,[d($,{label:"–û—Ç–º–µ–Ω–∞",icon:"pi pi-times",onClick:o[1]||(o[1]=e=>Q.value.visible=!1),text:"","aria-label":"–û—Ç–º–µ–Ω–∏—Ç—å —É–¥–∞–ª–µ–Ω–∏–µ"}),d($,{label:"–£–¥–∞–ª–∏—Ç—å",icon:"pi pi-trash",severity:"danger",onClick:ce,loading:Q.value.loading,"aria-label":"–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —É–¥–∞–ª–µ–Ω–∏–µ"},null,8,["loading"])])]),default:u(()=>[n("div",sl,[o[9]||(o[9]=n("i",{class:"pi pi-exclamation-triangle text-4xl text-warning"},null,-1)),n("span",null,[o[7]||(o[7]=f("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å —Å ID ",-1)),n("strong",null,s(Q.value.objectId),1),o[8]||(o[8]=f("?",-1))])])]),_:1},8,["visible"])])}}},[["__scopeId","data-v-8626db78"]]);export{ol as default};
