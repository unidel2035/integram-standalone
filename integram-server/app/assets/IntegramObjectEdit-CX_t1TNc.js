import{_ as de,y as I,c as m,o,b as $,A as n,a as i,t as B,w as F,d as v,u as ye,h as U,j as W,I as K,f as O,F as ae,r as ne,g as ie,K as fe,L as pe,D as ve,U as Oe,J as _e,aV as Ue,k as Be,n as Le}from"./index-B4X-KBPT.js";import{u as Re}from"./useIntegramSession-BdcoOzGP.js";import{i as H}from"./integramService-BbyM5pB3.js";import{i as Z}from"./integramApiClient-C3_j8SPw.js";import{R as Pe}from"./ReferenceField-C-VKx3NB.js";import{I as $e}from"./IntegramBreadcrumb-DHI3pYG8.js";import"./index-B9ygI19o.js";import"./unifiedAuthService-xCuNj-Bd.js";const ze={__name:"FileField",props:{id:String,modelValue:[String,File],currentFile:String},emits:["update:modelValue","delete"],setup(z,{expose:d,emit:b}){d();const e=z,k=b,R=v(!1);function M(T){const C=T.files[0];k("update:modelValue",C)}function _(){k("delete"),R.value=!1}const g={props:e,emit:k,confirmDeleteFile:R,onFileSelect:M,deleteFile:_,ref:v};return Object.defineProperty(g,"__isScriptSetup",{enumerable:!1,value:!0}),g}},He={class:"file-field"},Ge={key:0,class:"mb-2"},Ye={class:"flex align-items-center gap-2"},We=["href"];function Je(z,d,b,e,k,R){const M=I("Button"),_=I("FileUpload"),g=I("Dialog");return o(),m("div",He,[b.currentFile?(o(),m("div",Ge,[i("div",Ye,[i("a",{href:b.currentFile,target:"_blank",class:"text-primary"},B(b.currentFile.split("/").pop()),9,We),n(M,{icon:"pi pi-trash",onClick:d[0]||(d[0]=T=>e.confirmDeleteFile=!0),size:"small",text:"",rounded:"",severity:"danger"})])])):$("",!0),n(_,{id:b.id,mode:"basic","choose-label":b.currentFile?"–ó–∞–º–µ–Ω–∏—Ç—å —Ñ–∞–π–ª":"–í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª",onSelect:e.onFileSelect,auto:!1,"custom-upload":!0,class:"p-button-outlined"},null,8,["id","choose-label"]),n(g,{visible:e.confirmDeleteFile,"onUpdate:visible":d[2]||(d[2]=T=>e.confirmDeleteFile=T),header:"–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ",style:{width:"350px"},modal:""},{footer:F(()=>[n(M,{label:"–û—Ç–º–µ–Ω–∞",onClick:d[1]||(d[1]=T=>e.confirmDeleteFile=!1),text:""}),n(M,{label:"–£–¥–∞–ª–∏—Ç—å",onClick:e.deleteFile,severity:"danger"})]),default:F(()=>[d[3]||(d[3]=i("p",null,"–£–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª?",-1))]),_:1},8,["visible"])])}const Ke=de(ze,[["render",Je],["__file","/home/hive/integram-standalone/src/components/integram/fields/FileField.vue"]]),Qe={__name:"DateField",props:{id:String,modelValue:[String,Date],mode:{type:String,default:"calendar"}},emits:["update:modelValue","toggle-mode"],setup(z,{expose:d,emit:b}){d();const e=z,k=b,R=v(),M=v([{label:"[TODAY] - –°–µ–≥–æ–¥–Ω—è—à–Ω–∏–π –¥–µ–Ω—å",command:()=>T("[TODAY]")},{label:"[YESTERDAY] - –í—á–µ—Ä–∞—à–Ω–∏–π –¥–µ–Ω—å",command:()=>T("[YESTERDAY]")},{label:"[TOMORROW] - –ó–∞–≤—Ç—Ä–∞—à–Ω–∏–π –¥–µ–Ω—å",command:()=>T("[TOMORROW]")},{label:"[MONTH_AGO] - –î–µ–Ω—å –º–µ—Å—è—Ü –Ω–∞–∑–∞–¥",command:()=>T("[MONTH_AGO]")}]),_=K(()=>typeof e.modelValue=="string"&&e.modelValue.startsWith("[")?C(e.modelValue):e.modelValue);function g(D){R.value.toggle(D)}function T(D){k("update:modelValue",D)}function C(D){const c=new Date;switch(c.setHours(0,0,0,0),D){case"[TODAY]":return c;case"[YESTERDAY]":{const u=new Date(c);return u.setDate(u.getDate()-1),u}case"[TOMORROW]":{const u=new Date(c);return u.setDate(u.getDate()+1),u}case"[MONTH_AGO]":{const u=new Date(c);return u.setMonth(u.getMonth()-1),u}default:return c}}function p(D){if(!D)return"";if(typeof D=="string")return D;const c=new Date(D),u=String(c.getDate()).padStart(2,"0"),V=String(c.getMonth()+1).padStart(2,"0"),A=c.getFullYear();return`${u}.${V}.${A}`}function E(D){k("update:modelValue",D)}function G(D){if(typeof D=="string"&&D.startsWith("[")){k("update:modelValue",D);return}if(typeof D=="string"){const c=D.split(".");if(c.length===3){const u=parseInt(c[0]),V=parseInt(c[1])-1,A=parseInt(c[2]);if(!isNaN(u)&&!isNaN(V)&&!isNaN(A)){const a=new Date(A,V,u);k("update:modelValue",a);return}}}k("update:modelValue",D)}const L={props:e,emit:k,menu:R,specialValueItems:M,computedModelValue:_,toggleSpecialValues:g,setSpecialValue:T,resolveSpecialValue:C,formatDateForText:p,handleCalendarInput:E,handleTextInput:G,ref:v,computed:K};return Object.defineProperty(L,"__isScriptSetup",{enumerable:!1,value:!0}),L}},Xe={class:"date-field"},Ze={class:"flex gap-2"};function qe(z,d,b,e,k,R){const M=I("Calendar"),_=I("InputText"),g=I("Button"),T=I("Menu"),C=ye("tooltip");return o(),m("div",Xe,[i("div",Ze,[b.mode==="calendar"?(o(),U(M,{key:0,id:b.id,modelValue:e.computedModelValue,"onUpdate:modelValue":e.handleCalendarInput,dateFormat:"dd.mm.yy",class:"flex-1"},null,8,["id","modelValue"])):(o(),U(_,{key:1,id:b.id,modelValue:b.modelValue,"onUpdate:modelValue":e.handleTextInput,placeholder:"–¥–¥.–º–º.–≥–≥–≥–≥ –∏–ª–∏ [TODAY], [YESTERDAY], –∏ —Ç.–¥.",class:"flex-1"},null,8,["id","modelValue"])),W(n(g,{icon:"pi pi-pencil",onClick:d[0]||(d[0]=p=>e.emit("toggle-mode")),size:"small",text:"",rounded:""},null,512),[[C,"–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ä–µ–∂–∏–º –≤–≤–æ–¥–∞",void 0,{top:!0}]]),W(n(g,{icon:"pi pi-calendar-plus",onClick:e.toggleSpecialValues,size:"small",text:"",rounded:""},null,512),[[C,"–°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è",void 0,{top:!0}]])]),n(T,{ref:"menu",model:e.specialValueItems,popup:!0},null,8,["model"])])}const et=de(Qe,[["render",qe],["__file","/home/hive/integram-standalone/src/components/integram/fields/DateField.vue"]]),tt={__name:"DateTimeField",props:{id:String,modelValue:[String,Date]},emits:["update:modelValue"],setup(z,{expose:d,emit:b}){d();const e=z,k=b,R=v(),M=v([{label:"[NOW] - –¢–µ–∫—É—â–∏–µ –¥–∞—Ç–∞ –∏ –≤—Ä–µ–º—è",command:()=>T("[NOW]")}]),_=K(()=>typeof e.modelValue=="string"&&e.modelValue==="[NOW]"?new Date:e.modelValue);function g(E){R.value.toggle(E)}function T(E){k("update:modelValue",E)}function C(E){k("update:modelValue",E)}const p={props:e,emit:k,menu:R,specialValueItems:M,computedModelValue:_,toggleSpecialValues:g,setSpecialValue:T,handleCalendarInput:C,ref:v,computed:K};return Object.defineProperty(p,"__isScriptSetup",{enumerable:!1,value:!0}),p}},at={class:"datetime-field"},lt={class:"flex gap-2"};function ot(z,d,b,e,k,R){const M=I("Calendar"),_=I("Button"),g=I("Menu"),T=ye("tooltip");return o(),m("div",at,[i("div",lt,[n(M,{id:b.id,modelValue:e.computedModelValue,"onUpdate:modelValue":e.handleCalendarInput,showTime:"",hourFormat:"24",showSeconds:!0,dateFormat:"dd.mm.yy",class:"flex-1"},null,8,["id","modelValue"]),W(n(_,{icon:"pi pi-clock",onClick:e.toggleSpecialValues,size:"small",text:"",rounded:""},null,512),[[T,"–°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è",void 0,{top:!0}]])]),n(g,{ref:"menu",model:e.specialValueItems,popup:!0},null,8,["model"])])}const it=de(tt,[["render",ot],["__scopeId","data-v-3d8ff050"],["__file","/home/hive/integram-standalone/src/components/integram/fields/DateTimeField.vue"]]),nt={__name:"PasswordField",props:{id:String,modelValue:String,showGenerator:{type:Boolean,default:!1}},emits:["update:modelValue","generate","copy-invite"],setup(z,{expose:d,emit:b}){d();const k={emit:b};return Object.defineProperty(k,"__isScriptSetup",{enumerable:!1,value:!0}),k}},dt={class:"password-field"},st={class:"flex gap-2"};function rt(z,d,b,e,k,R){const M=I("Password"),_=I("Button");return o(),m("div",dt,[i("div",st,[n(M,{id:b.id,modelValue:b.modelValue,"onUpdate:modelValue":d[0]||(d[0]=g=>e.emit("update:modelValue",g)),toggleMask:"",feedback:!1,class:"flex-1"},null,8,["id","modelValue"]),b.showGenerator?(o(),U(_,{key:0,icon:"pi pi-refresh",onClick:d[1]||(d[1]=g=>e.emit("generate")),size:"small",outlined:"",rounded:"",title:"–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ä–æ–ª—å"})):$("",!0),b.showGenerator?(o(),U(_,{key:1,icon:"pi pi-envelope",onClick:d[2]||(d[2]=g=>e.emit("copy-invite")),size:"small",outlined:"",rounded:"",title:"–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ"})):$("",!0)])])}const ct=de(nt,[["render",rt],["__file","/home/hive/integram-standalone/src/components/integram/fields/PasswordField.vue"]]),ut={__name:"IntegramEnhancedObjectEditor",props:{database:{type:String,required:!0},objectId:{type:[String,Number],required:!0}},emits:["objectLoaded"],setup(z,{expose:d,emit:b}){d();const e=z,k=b,R=fe(),M=pe(),_=ve(),g=v(!0),T=v(!1),C=v(!1),p=v(null),E=v(null),G=v(null),L=v([]),D=v([]),c=v([]),u=v({}),V=v({}),A=v(!1),a=v(0),t=v(!1),w=v(!1),ge=K(()=>L.value.some(r=>r.isArray));async function Y(){var r;try{g.value=!0;const S=Z.getAuthInfo();S&&S.token&&H.setSession({token:S.token,xsrf:S.xsrf,database:e.database}),H.setDatabase(e.database);const l=await H.getEditObject(e.objectId,R.query.tab);if(!l||!l.obj)throw new Error(`–û–±—ä–µ–∫—Ç #${e.objectId} –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –æ—Ç–≤–µ—Ç –ø—É—Å—Ç–æ–π`);if(p.value=l.obj,G.value=l.metadata,!p.value.typ)throw new Error(`–û–±—ä–µ–∫—Ç #${e.objectId} –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–∏–ø (typ)`);const f=await H.getMetadata(p.value.typ),N=l.arr_type||{};if(f&&f.reqs){const y=f.reqs.map(s=>{const h=s.type==="4",J=!h&&s.ref!==void 0;let P=null,Ee=null,ue=null,Q=[];const x=l.reqs?l.reqs[s.id]:void 0,le=s.attrs&&s.attrs.includes(":MULTI:");if(x!==void 0)if(Array.isArray(x))le?(Q=x.map(j=>({id:j.ref||j.id,text:j.val||j.name||String(j.ref||j.id),msId:j.id,ord:j.ord||0})),P=Q.map(j=>j.id)):P=x;else if(le&&J&&x!==null&&typeof x=="object"&&"multiselect"in x){const j=x.multiselect;j&&j.id&&Array.isArray(j.id)&&j.val&&Array.isArray(j.val)&&j.ref_val&&Array.isArray(j.ref_val)?(Q=j.id.map((te,oe)=>({id:j.val[oe],text:j.ref_val[oe]||`#${j.val[oe]}`,msId:te,ord:j.ord?j.ord[oe]:oe+1})),P=Q.map(te=>te.id)):(console.warn(`[IntegramEnhancedObjectEditor] Invalid multiselect structure for req ${s.id}:`,x),P=null)}else if(le&&J&&typeof x=="string"&&x.length>0){const j=l.reqs?l.reqs[`ref_${s.id}`]:void 0;if(j&&typeof j=="string"){const te=j.match(/^(\d+):(.+)$/);if(te){const oe=te[1],Ne=te[2].split(","),Se=x.split(",");Q=Ne.map((me,Ce)=>({id:me.trim(),text:Se[Ce]?Se[Ce].trim():`#${me.trim()}`,msId:null,ord:Ce+1})),P=Q.map(me=>me.id)}else P=x,console.warn(`[IntegramEnhancedObjectEditor] Could not parse ref field format for req ${s.id}:`,j)}else P=x,console.warn(`[IntegramEnhancedObjectEditor] Multiselect req ${s.id} has string value but no ref_ field:`,x)}else x!==null&&typeof x=="object"?("value"in x?P=x.value:"id"in x&&"val"in x?(P=x.id,ue=x.val):"val"in x?P=x.val:"id"in x?P=x.id:P=x,x.file&&(Ee=x.file)):P=x;let ee=null;return h?ee=N[s.id]||s.arr||s.arr_id||s.ref||null:ee=s.ref||null,{id:s.id,name:s.val,baseType:X(s.type),required:s.attrs&&s.attrs.includes(":!NULL:"),multi:s.attrs&&s.attrs.includes(":MULTI:"),isReference:J,isArray:h,refTypeId:ee,restrict:s.ref_restrict,allowCreate:s.attrs&&s.attrs.includes(":!CREATE:"),currentValue:P,currentDisplayName:ue,currentFile:Ee,multiselectItems:Q,count:l.arrCounts?l.arrCounts[s.id]:0,hint:q(s.attrs),tabId:s.tab||null}});for(const s of y)if(s.isReference&&s.currentValue&&!s.currentDisplayName&&!s.isArray)try{const h=await H.getReferenceOptions(s.id,e.objectId,s.restrict,"");h&&h[s.currentValue]&&(s.currentDisplayName=h[s.currentValue].toString())}catch(h){console.warn(`Failed to load display name for REF field ${s.id}:`,h)}L.value=y}if(l.reqs)for(const[y,s]of Object.entries(l.reqs))Array.isArray(s)?u.value[`t${y}`]=s.map(h=>typeof h=="object"&&h!==null?h.ref||("value"in h?h.value:"id"in h&&"val"in h?h.id:"val"in h?h.val:"id"in h?h.id:JSON.stringify(h)):h):s!==null&&typeof s=="object"?"multiselect"in s&&s.multiselect&&s.multiselect.val&&Array.isArray(s.multiselect.val)?u.value[`t${y}`]=s.multiselect.val:"value"in s?u.value[`t${y}`]=s.value:"id"in s&&"val"in s?u.value[`t${y}`]=s.id:"val"in s?u.value[`t${y}`]=s.val:"id"in s?u.value[`t${y}`]=s.id:(console.warn(`Unknown value format for requisite ${y}:`,s),u.value[`t${y}`]=""):u.value[`t${y}`]=s;if(l.tabs&&(D.value=l.tabs),l.buttons&&(c.value=l.buttons),p.value.up&&p.value.up!=="0")try{E.value=await H.getMetadata(p.value.up)}catch(y){console.warn("Could not load parent type:",y)}k("objectLoaded",{objectData:p.value,parentType:E.value,typeName:(r=p.value)==null?void 0:r.typ_name})}catch(S){_.add({severity:"error",summary:"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",detail:S.message,life:5e3})}finally{g.value=!1}}function X(r){return{3:"SHORT",8:"CHARS",9:"DATE",4:"DATETIME",13:"SIGNED",14:"NUMBER",11:"BOOLEAN",12:"MEMO",10:"FILE",15:"HTML",6:"PWD",16:"CALCULATABLE",17:"BUTTON",18:"PATH",19:"REPORT_COLUMN"}[r]||"SHORT"}function q(r){return r?r.includes("[TODAY]")?"–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: —Å–µ–≥–æ–¥–Ω—è":r.includes("[NOW]")?"–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è":"":""}function be(r){return L.value.filter(S=>S.tabId===r)}function De(r){return A.value||r.baseType==="MEMO"||r.baseType==="HTML"?"col-12":r.baseType==="FILE"?"col-12 md:col-8 lg:col-6":["DATE","DATETIME"].includes(r.baseType)||["SIGNED","NUMBER"].includes(r.baseType)||r.baseType==="BOOLEAN"?"col-12 md:col-6 lg:col-4":r.baseType==="SHORT"||r.baseType==="CHARS"||r.isReference?"col-12 md:col-6":"col-12"}async function he(r,S){const l=L.value.filter(f=>f.restrict===r);if(l.length>0)for(const f of l)u.value[`t${f.id}`]=null}function se(){A.value=!A.value,document.cookie=`gridMode${p.value.typ}=${A.value?"1":"0"}; path=/`,_.add({severity:"info",summary:A.value?"–†–µ–∂–∏–º: –°–ø–∏—Å–æ–∫":"–†–µ–∂–∏–º: –°–µ—Ç–∫–∞",detail:A.value?"–í—Å–µ –ø–æ–ª—è –≤ –æ–¥–∏–Ω —Å—Ç–æ–ª–±–µ—Ü":"–ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è —Å–µ—Ç–∫–∞ –ø–æ–ª–µ–π",life:2e3})}function re(r){V.value[r]=V.value[r]==="text"?"calendar":"text"}function Ve(r){navigator.clipboard.writeText(r.toString()),w.value=!0,setTimeout(()=>{w.value=!1},2500)}function Te(r){const S=Math.random().toString(36).replace(/\./g,"").substr(1,8)+Math.random().toString(36).replace(/\./g,"").substr(1,8);u.value[`t${r}`]=S,navigator.clipboard.writeText(S),_.add({severity:"success",summary:"–ü–∞—Ä–æ–ª—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω",detail:"–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞",life:3e3})}function we(){const r=u.value.t18||"",S=u.value.t20||"",l=`–°—Å—ã–ª–∫–∞ –¥–ª—è –≤—Ö–æ–¥–∞: https://${window.location.host}/${e.database}?u=${r}
–ø–∞—Ä–æ–ª—å: ${S}`;navigator.clipboard.writeText(l),_.add({severity:"success",summary:"–ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ",detail:"–û—Ç–ø—Ä–∞–≤—å—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é",life:3e3})}async function ke(){try{T.value=!0;const r=L.value.filter(l=>l.required&&!u.value[`t${l.id}`]);if(r.length>0){_.add({severity:"warn",summary:"–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è",detail:r.map(l=>l.name).join(", "),life:5e3});return}(await H.saveObject(e.objectId,u.value)).id&&(_.add({severity:"success",summary:"–û–±—ä–µ–∫—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω",life:3e3}),await Y())}catch(r){_.add({severity:"error",summary:"–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è",detail:r.message,life:5e3})}finally{T.value=!1}}async function Ie(){try{const r=await H.createObject(p.value.typ,`${p.value.val} (copy)`,p.value.up,u.value);r.id&&(_.add({severity:"success",summary:"–û–±—ä–µ–∫—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω",detail:`ID: ${r.id}`,life:3e3}),M.push(`/integram/${e.database}/edit/${r.id}`))}catch(r){_.add({severity:"error",summary:"–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è",detail:r.message,life:5e3})}}async function xe(){try{C.value=!0,await H.deleteObject(e.objectId),_.add({severity:"success",summary:"–û–±—ä–µ–∫—Ç —É–¥–∞–ª–µ–Ω",life:3e3}),M.push(`/integram/${e.database}/object/${p.value.typ}`)}catch(r){_.add({severity:"error",summary:"–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è",detail:r.message,life:5e3})}finally{C.value=!1}}async function Fe(r){try{await H.setRequisites(e.objectId,{[`t${r}`]:""}),_.add({severity:"success",summary:"–§–∞–π–ª —É–¥–∞–ª–µ–Ω",life:3e3}),await Y()}catch(S){_.add({severity:"error",summary:"–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ñ–∞–π–ª–∞",detail:S.message,life:5e3})}}function Me(r){M.push(`/integram/${e.database}/${r.action}`)}function Ae(){M.push(`/integram/${e.database}/object/${p.value.typ}`)}function je(r){M.push({path:`/integram/${e.database}/object/${r.refTypeId}`,query:{F_U:e.objectId,action:"add"}})}Oe(()=>e.objectId,()=>{Y()}),_e(()=>{Y()}),Oe(()=>{var r;return(r=p.value)==null?void 0:r.typ},r=>{if(r){const l=document.cookie.split(";").find(f=>f.trim().startsWith(`gridMode${r}=`));if(l){const f=l.split("=")[1];A.value=f==="1"}}});const ce={props:e,emit:k,route:R,router:M,toast:_,loading:g,saving:T,deleting:C,objectData:p,parentType:E,metadata:G,requisites:L,tabs:D,customButtons:c,formData:u,dateMode:V,gridMode:A,activeTab:a,confirmDelete:t,idCopied:w,hasArrayFields:ge,loadObject:Y,getBaseType:X,getHintFromAttrs:q,getRequisitesForTab:be,getFieldClass:De,onReferenceChange:he,toggleGridMode:se,toggleDateMode:re,copyId:Ve,generatePassword:Te,copyInvite:we,saveObject:ke,duplicateObject:Ie,deleteObject:xe,deleteFile:Fe,executeButtonAction:Me,cancel:Ae,addSubordinateItem:je,ref:v,computed:K,onMounted:_e,watch:Oe,get useRoute(){return fe},get useRouter(){return pe},get useToast(){return ve},get integramService(){return H},get integramApiClient(){return Z},ReferenceField:Pe,FileField:Ke,DateField:et,DateTimeField:it,PasswordField:ct};return Object.defineProperty(ce,"__isScriptSetup",{enumerable:!1,value:!0}),ce}},mt={class:"integram-enhanced-editor integram-touch-friendly"},ft={key:0,class:"text-center py-5"},pt={class:"flex align-items-center justify-content-between"},vt={class:"flex align-items-center gap-2"},_t={class:"flex gap-2 align-items-center ml-auto"},yt={class:"integram-field"},gt=["for"],bt={key:0,class:"text-red-500 mr-1"},Dt={key:0},ht={key:1},Vt={class:"flex gap-2 align-items-center"},Tt={key:2},wt={key:3},kt={key:4},It={key:5},xt={key:6},Ft=["name"],Mt={key:7},At={key:8},jt={key:9},Et={key:10},Ct={key:11},Ot={class:"p-3 surface-100 border-round"},Ut={key:12},St={key:13,class:"block mt-1 text-500"},Rt={class:"integram-field"},Nt=["for"],Bt={key:0,class:"text-red-500 mr-1"},Lt={key:0},Pt={key:1},$t={class:"flex gap-2 align-items-center"},zt={key:1,class:"text-500"},Ht={key:2},Gt={key:3},Yt={key:4},Wt={key:5},Jt={key:6},Kt=["name"],Qt={key:7},Xt={key:8},Zt={key:9},qt={key:10},ea={key:11},ta={key:12},aa={class:"p-3 surface-100 border-round"},la={key:13},oa={key:14,class:"block mt-1 text-500"},ia={key:2,class:"mt-4 flex gap-2"},na={class:"mt-4 integram-actions"},da={key:3,class:"mt-3 p-3 surface-border border-1 border-round"},sa={class:"font-semibold mb-3"},ra={class:"flex gap-2"};function ca(z,d,b,e,k,R){const M=I("ProgressSpinner"),_=I("Badge"),g=I("Button"),T=I("Message"),C=I("router-link"),p=I("InputText"),E=I("Checkbox"),G=I("Editor"),L=I("Textarea"),D=I("InputNumber"),c=I("TabPanel"),u=I("TabView"),V=I("Card"),A=ye("tooltip");return o(),m("div",mt,[e.loading?(o(),m("div",ft,[n(M)])):e.objectData?(o(),U(V,{key:1},{title:F(()=>[i("div",pt,[i("div",vt,[i("span",null,B(e.objectData.val),1),n(_,{value:e.objectData.typ_name,severity:"secondary",class:"text-xs"},null,8,["value"]),W((o(),m("span",{class:"text-500 text-sm cursor-pointer",onClick:d[0]||(d[0]=a=>e.copyId(e.objectData.id))},[O(" #"+B(e.objectData.id),1)])),[[A,"–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å ID",void 0,{right:!0}]])]),i("div",_t,[W(n(g,{icon:e.gridMode?"pi pi-list":"pi pi-th-large",onClick:e.toggleGridMode,size:"small",rounded:"",outlined:!e.gridMode,severity:e.gridMode?"primary":"secondary"},null,8,["icon","outlined","severity"]),[[A,e.gridMode?"–°–ø–∏—Å–æ–∫":"–°–µ—Ç–∫–∞",void 0,{bottom:!0}]])])])]),content:F(()=>[n(T,{severity:"secondary",closable:!0,class:"mb-3 text-sm"},{default:F(()=>[...d[4]||(d[4]=[O(" –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –æ—Ç–º–µ—á–µ–Ω—ã ",-1),i("span",{class:"text-red-500 font-bold"},"*",-1)])]),_:1}),e.tabs.length>0?(o(),U(u,{key:0,activeIndex:e.activeTab,"onUpdate:activeIndex":d[1]||(d[1]=a=>e.activeTab=a)},{default:F(()=>[(o(!0),m(ae,null,ne(e.tabs,a=>(o(),U(c,{key:a.id,header:a.name},{default:F(()=>[i("div",{class:ie(["grid gap-3",{"grid-list-mode":e.gridMode}])},[(o(!0),m(ae,null,ne(e.getRequisitesForTab(a.id),t=>(o(),m("div",{key:t.id,class:ie(e.gridMode?"col-12":e.getFieldClass(t))},[i("div",yt,[i("label",{for:`req_${t.id}`,class:"block mb-2"},[t.required?(o(),m("span",bt,"*")):$("",!0),O(" "+B(t.name),1)],8,gt),t.isReference?(o(),m("div",Dt,[n(e.ReferenceField,{id:`req_${t.id}`,modelValue:e.formData[`t${t.id}`],"onUpdate:modelValue":[w=>e.formData[`t${t.id}`]=w,w=>e.onReferenceChange(t.id,w)],"req-id":t.id,"ref-type-id":t.refTypeId,database:b.database,"object-id":e.objectData.id,multi:t.multi,"allow-create":t.allowCreate,restrict:t.restrict,"current-display-name":t.currentDisplayName,"initial-multiselect-items":t.multiselectItems},null,8,["id","modelValue","onUpdate:modelValue","req-id","ref-type-id","database","object-id","multi","allow-create","restrict","current-display-name","initial-multiselect-items"])])):t.isArray?(o(),m("div",ht,[i("div",Vt,[t.refTypeId?(o(),U(C,{key:0,to:`/integram/${b.database}/object/${t.refTypeId}?F_U=${e.objectData.id}`,class:"text-primary font-semibold"},{default:F(()=>[n(_,{value:t.count||0},null,8,["value"]),d[5]||(d[5]=O(" –ü–µ—Ä–µ–π—Ç–∏ –∫ —Å–ø–∏—Å–∫—É ",-1))]),_:2},1032,["to"])):$("",!0),t.refTypeId?W((o(),U(g,{key:1,icon:"pi pi-plus",label:"–î–æ–±–∞–≤–∏—Ç—å",onClick:w=>e.addSubordinateItem(t),size:"small",outlined:""},null,8,["onClick"])),[[A,"–î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å –≤ –ø–æ–¥—á–∏–Ω–µ–Ω–Ω—É—é —Ç–∞–±–ª–∏—Ü—É",void 0,{top:!0}]]):$("",!0)]),t.showValue?(o(),U(p,{key:0,modelValue:e.formData[`t${t.id}`],"onUpdate:modelValue":w=>e.formData[`t${t.id}`]=w,class:"w-full mt-2"},null,8,["modelValue","onUpdate:modelValue"])):$("",!0)])):t.baseType==="FILE"?(o(),m("div",Tt,[n(e.FileField,{id:`req_${t.id}`,modelValue:e.formData[`t${t.id}`],"onUpdate:modelValue":w=>e.formData[`t${t.id}`]=w,"current-file":t.currentFile,"object-id":e.objectData.id,"req-id":t.id,database:b.database,onDelete:w=>e.deleteFile(t.id)},null,8,["id","modelValue","onUpdate:modelValue","current-file","object-id","req-id","database","onDelete"])])):t.baseType==="DATE"?(o(),m("div",wt,[n(e.DateField,{id:`req_${t.id}`,modelValue:e.formData[`t${t.id}`],"onUpdate:modelValue":w=>e.formData[`t${t.id}`]=w,mode:e.dateMode[t.id]||"calendar",onToggleMode:w=>e.toggleDateMode(t.id)},null,8,["id","modelValue","onUpdate:modelValue","mode","onToggleMode"])])):t.baseType==="DATETIME"?(o(),m("div",kt,[n(e.DateTimeField,{id:`req_${t.id}`,modelValue:e.formData[`t${t.id}`],"onUpdate:modelValue":w=>e.formData[`t${t.id}`]=w},null,8,["id","modelValue","onUpdate:modelValue"])])):t.baseType==="PWD"?(o(),m("div",It,[n(e.PasswordField,{id:`req_${t.id}`,modelValue:e.formData[`t${t.id}`],"onUpdate:modelValue":w=>e.formData[`t${t.id}`]=w,"show-generator":!0,onGenerate:w=>e.generatePassword(t.id),onCopyInvite:e.copyInvite},null,8,["id","modelValue","onUpdate:modelValue","onGenerate"])])):t.baseType==="BOOLEAN"?(o(),m("div",xt,[n(E,{id:`req_${t.id}`,modelValue:e.formData[`t${t.id}`],"onUpdate:modelValue":w=>e.formData[`t${t.id}`]=w,binary:!0},null,8,["id","modelValue","onUpdate:modelValue"]),i("input",{type:"hidden",name:`b${t.id}`,value:"1"},null,8,Ft)])):t.baseType==="HTML"?(o(),m("div",Mt,[n(G,{id:`req_${t.id}`,modelValue:e.formData[`t${t.id}`],"onUpdate:modelValue":w=>e.formData[`t${t.id}`]=w,editorStyle:"height: 200px"},null,8,["id","modelValue","onUpdate:modelValue"])])):t.baseType==="MEMO"?(o(),m("div",At,[n(L,{id:`req_${t.id}`,modelValue:e.formData[`t${t.id}`],"onUpdate:modelValue":w=>e.formData[`t${t.id}`]=w,rows:"5",class:"w-full"},null,8,["id","modelValue","onUpdate:modelValue"])])):t.baseType==="SHORT"?(o(),m("div",jt,[n(p,{id:`req_${t.id}`,modelValue:e.formData[`t${t.id}`],"onUpdate:modelValue":w=>e.formData[`t${t.id}`]=w,class:"w-full"},null,8,["id","modelValue","onUpdate:modelValue"])])):["NUMBER","SIGNED"].includes(t.baseType)?(o(),m("div",Et,[n(D,{id:`req_${t.id}`,modelValue:e.formData[`t${t.id}`],"onUpdate:modelValue":w=>e.formData[`t${t.id}`]=w,"min-fraction-digits":t.baseType==="NUMBER"?2:0,"max-fraction-digits":t.baseType==="NUMBER"?2:0,class:"w-full"},null,8,["id","modelValue","onUpdate:modelValue","min-fraction-digits","max-fraction-digits"])])):t.baseType==="CALCULATABLE"?(o(),m("div",Ct,[i("div",Ot,B(e.formData[`t${t.id}`]),1)])):(o(),m("div",Ut,[n(p,{id:`req_${t.id}`,modelValue:e.formData[`t${t.id}`],"onUpdate:modelValue":w=>e.formData[`t${t.id}`]=w,class:"w-full"},null,8,["id","modelValue","onUpdate:modelValue"])])),t.hint?(o(),m("small",St,B(t.hint),1)):$("",!0)])],2))),128))],2)]),_:2},1032,["header"]))),128))]),_:1},8,["activeIndex"])):(o(),m("div",{key:1,class:ie(["grid gap-3",{"grid-list-mode":e.gridMode}])},[(o(!0),m(ae,null,ne(e.requisites,a=>(o(),m("div",{key:a.id,class:ie(e.gridMode?"col-12":e.getFieldClass(a))},[i("div",Rt,[i("label",{for:`req_${a.id}`,class:"block mb-2"},[a.required?(o(),m("span",Bt,"*")):$("",!0),O(" "+B(a.name),1)],8,Nt),a.isReference?(o(),m("div",Lt,[n(e.ReferenceField,{id:`req_${a.id}`,modelValue:e.formData[`t${a.id}`],"onUpdate:modelValue":[t=>e.formData[`t${a.id}`]=t,t=>e.onReferenceChange(a.id,t)],"req-id":a.id,"ref-type-id":a.refTypeId,database:b.database,"object-id":e.objectData.id,multi:a.multi,"allow-create":a.allowCreate,restrict:a.restrict,"current-display-name":a.currentDisplayName,"initial-multiselect-items":a.multiselectItems},null,8,["id","modelValue","onUpdate:modelValue","req-id","ref-type-id","database","object-id","multi","allow-create","restrict","current-display-name","initial-multiselect-items"])])):a.isArray?(o(),m("div",Pt,[i("div",$t,[a.refTypeId?(o(),U(C,{key:0,to:`/integram/${b.database}/object/${a.refTypeId}?F_U=${e.objectData.id}`,class:"text-primary font-semibold"},{default:F(()=>[n(_,{value:a.count||0},null,8,["value"]),d[6]||(d[6]=O(" –ü–µ—Ä–µ–π—Ç–∏ –∫ —Å–ø–∏—Å–∫—É ",-1))]),_:2},1032,["to"])):(o(),m("div",zt,[n(_,{value:a.count||0},null,8,["value"]),d[7]||(d[7]=O(" –ü–æ–¥—á–∏–Ω–µ–Ω–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ (—Ç–∏–ø –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω) ",-1))])),a.refTypeId?W((o(),U(g,{key:2,icon:"pi pi-plus",label:"–î–æ–±–∞–≤–∏—Ç—å",onClick:t=>e.addSubordinateItem(a),size:"small",outlined:""},null,8,["onClick"])),[[A,"–î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å –≤ –ø–æ–¥—á–∏–Ω–µ–Ω–Ω—É—é —Ç–∞–±–ª–∏—Ü—É",void 0,{top:!0}]]):$("",!0)]),a.showValue?(o(),U(p,{key:0,modelValue:e.formData[`t${a.id}`],"onUpdate:modelValue":t=>e.formData[`t${a.id}`]=t,class:"w-full mt-2"},null,8,["modelValue","onUpdate:modelValue"])):$("",!0)])):a.baseType==="FILE"?(o(),m("div",Ht,[n(e.FileField,{id:`req_${a.id}`,modelValue:e.formData[`t${a.id}`],"onUpdate:modelValue":t=>e.formData[`t${a.id}`]=t,"current-file":a.currentFile,"object-id":e.objectData.id,"req-id":a.id,database:b.database,onDelete:t=>e.deleteFile(a.id)},null,8,["id","modelValue","onUpdate:modelValue","current-file","object-id","req-id","database","onDelete"])])):a.baseType==="DATE"?(o(),m("div",Gt,[n(e.DateField,{id:`req_${a.id}`,modelValue:e.formData[`t${a.id}`],"onUpdate:modelValue":t=>e.formData[`t${a.id}`]=t,mode:e.dateMode[a.id]||"calendar",onToggleMode:t=>e.toggleDateMode(a.id)},null,8,["id","modelValue","onUpdate:modelValue","mode","onToggleMode"])])):a.baseType==="DATETIME"?(o(),m("div",Yt,[n(e.DateTimeField,{id:`req_${a.id}`,modelValue:e.formData[`t${a.id}`],"onUpdate:modelValue":t=>e.formData[`t${a.id}`]=t},null,8,["id","modelValue","onUpdate:modelValue"])])):a.baseType==="PWD"?(o(),m("div",Wt,[n(e.PasswordField,{id:`req_${a.id}`,modelValue:e.formData[`t${a.id}`],"onUpdate:modelValue":t=>e.formData[`t${a.id}`]=t,"show-generator":!0,onGenerate:t=>e.generatePassword(a.id),onCopyInvite:e.copyInvite},null,8,["id","modelValue","onUpdate:modelValue","onGenerate"])])):a.baseType==="BOOLEAN"?(o(),m("div",Jt,[n(E,{id:`req_${a.id}`,modelValue:e.formData[`t${a.id}`],"onUpdate:modelValue":t=>e.formData[`t${a.id}`]=t,binary:!0},null,8,["id","modelValue","onUpdate:modelValue"]),i("input",{type:"hidden",name:`b${a.id}`,value:"1"},null,8,Kt)])):a.baseType==="HTML"?(o(),m("div",Qt,[n(G,{id:`req_${a.id}`,modelValue:e.formData[`t${a.id}`],"onUpdate:modelValue":t=>e.formData[`t${a.id}`]=t,editorStyle:"height: 200px"},null,8,["id","modelValue","onUpdate:modelValue"])])):a.baseType==="MEMO"?(o(),m("div",Xt,[n(L,{id:`req_${a.id}`,modelValue:e.formData[`t${a.id}`],"onUpdate:modelValue":t=>e.formData[`t${a.id}`]=t,rows:"5",class:"w-full"},null,8,["id","modelValue","onUpdate:modelValue"])])):a.baseType==="SHORT"?(o(),m("div",Zt,[n(p,{id:`req_${a.id}`,modelValue:e.formData[`t${a.id}`],"onUpdate:modelValue":t=>e.formData[`t${a.id}`]=t,class:"w-full"},null,8,["id","modelValue","onUpdate:modelValue"])])):a.baseType==="CHARS"?(o(),m("div",qt,[n(p,{id:`req_${a.id}`,modelValue:e.formData[`t${a.id}`],"onUpdate:modelValue":t=>e.formData[`t${a.id}`]=t,class:"w-full"},null,8,["id","modelValue","onUpdate:modelValue"])])):["NUMBER","SIGNED"].includes(a.baseType)?(o(),m("div",ea,[n(D,{id:`req_${a.id}`,modelValue:e.formData[`t${a.id}`],"onUpdate:modelValue":t=>e.formData[`t${a.id}`]=t,"min-fraction-digits":a.baseType==="NUMBER"?2:0,"max-fraction-digits":a.baseType==="NUMBER"?2:0,class:"w-full"},null,8,["id","modelValue","onUpdate:modelValue","min-fraction-digits","max-fraction-digits"])])):a.baseType==="CALCULATABLE"?(o(),m("div",ta,[i("div",aa,B(e.formData[`t${a.id}`]),1)])):(o(),m("div",la,[n(p,{id:`req_${a.id}`,modelValue:e.formData[`t${a.id}`],"onUpdate:modelValue":t=>e.formData[`t${a.id}`]=t,class:"w-full"},null,8,["id","modelValue","onUpdate:modelValue"])])),a.hint?(o(),m("small",oa,B(a.hint),1)):$("",!0)])],2))),128))],2)),e.customButtons.length>0?(o(),m("div",ia,[(o(!0),m(ae,null,ne(e.customButtons,a=>(o(),U(g,{key:a.id,label:a.label,class:ie(a.class),onClick:t=>e.executeButtonAction(a)},null,8,["label","class","onClick"]))),128))])):$("",!0),i("div",na,[n(g,{label:"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å",icon:"pi pi-save",onClick:e.saveObject,loading:e.saving,severity:"primary"},null,8,["loading"]),n(g,{label:"–î—É–±–ª–∏—Ä–æ–≤–∞—Ç—å",icon:"pi pi-copy",onClick:e.duplicateObject,outlined:""}),n(g,{label:"–û—Ç–º–µ–Ω–∞",icon:"pi pi-times",onClick:e.cancel,outlined:""}),e.confirmDelete?$("",!0):W((o(),U(g,{key:0,label:"–£–¥–∞–ª–∏—Ç—å",icon:"pi pi-trash",onClick:d[2]||(d[2]=a=>e.confirmDelete=!0),severity:"danger",outlined:""},null,512)),[[A,"–£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å",void 0,{top:!0}]])]),e.confirmDelete?(o(),m("div",da,[i("p",sa," –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ —É–¥–∞–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏: "+B(e.objectData.val),1),i("div",ra,[n(g,{label:"–î–∞, —É–¥–∞–ª–∏—Ç—å",icon:"pi pi-trash",onClick:e.deleteObject,loading:e.deleting,severity:"danger"},null,8,["loading"]),n(g,{label:"–û—Ç–º–µ–Ω–∞",onClick:d[3]||(d[3]=a=>e.confirmDelete=!1),outlined:""})])])):$("",!0)]),_:1})):$("",!0)])}const ua=de(ut,[["render",ca],["__scopeId","data-v-1cfb0ed8"],["__file","/home/hive/integram-standalone/src/components/integram/IntegramEnhancedObjectEditor.vue"]]),ma={__name:"IntegramObjectEdit",setup(z,{expose:d}){d();const b=fe(),e=pe(),k=ve(),{isAuthenticated:R,database:M}=Re(),_=v(!1),g=v(!0),T=v(""),C=v("–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ—Å—Å–∏–∏..."),p=v(!1),E=v(null),G=v(null),L=v([]),D=v(!1),c=v({}),u=v(null),V=v(null),A=v(null),a=v(!1),t=v(20),w=v(null),ge=v({id:{value:null,matchMode:Ue.CONTAINS},val:{value:null,matchMode:Ue.CONTAINS}}),Y=v({visible:!1,objectId:null,loading:!1}),X=K(()=>b.params.objectId),q=K(()=>b.params.database||M.value||"integram"),be=K(()=>{var f;const l=[{label:"–¢–∞–±–ª–∏—Ü—ã",to:`/integram/${q.value}/dict`,icon:"pi pi-table"}];return p.value&&((f=G.value)!=null&&f.val)?l.push({label:G.value.val,icon:"pi pi-bars"}):!p.value&&u.value?(V.value&&A.value&&l.push({label:V.value,to:`/integram/${q.value}/object/${A.value}`,icon:"pi pi-bars"}),l.push({label:u.value.val||`#${u.value.id}`,icon:"pi pi-pencil"})):p.value||l.push({label:"–ó–∞–≥—Ä—É–∑–∫–∞...",icon:"pi pi-spin pi-spinner"}),l}),De=K(()=>!E.value||!E.value.req_order?[]:E.value.req_order);function he(l){return!E.value||!E.value.req_type?`–†–µ–∫–≤–∏–∑–∏—Ç ${l}`:E.value.req_type[l]||`–†–µ–∫–≤–∏–∑–∏—Ç ${l}`}function se(l){return!E.value||!E.value.req_base?"SHORT":E.value.req_base[l]||"SHORT"}function re(l){return c.value[l]||{isReference:!1,isMulti:!1,refTypeId:null}}function Ve(l){const f=["#78AAD2","#78AAFF","#78D2AA","#78D2FF","#78FFAA","#78FFD2","#AA78D2","#AA78FF","#AAD278","#AAD2FF","#AAFF78","#AAFFD2","#D278AA","#D278FF","#D2AA78","#D2AAFF","#D2FF78","#D2FFAA","#FF78AA","#FF78D2","#FFAA78","#FFAAD2","#FFD278","#FFD2AA"],N=parseInt(l)||0,y=Math.abs(N)%f.length;return f[y]}function Te(l){switch(se(l)){case"SIGNED":case"NUMBER":return InputText;case"BOOLEAN":return"Checkbox";case"DATE":case"DATETIME":return"Calendar";case"MEMO":case"HTML":return"Textarea";default:return InputText}}function we(l,f){if(l==null||l==="")return"‚Äî";const N=re(f),y=se(f);if(N.isReference)return N.isMulti&&Array.isArray(l)?l.length===0?"‚Äî":l:l&&typeof l=="object"&&"val"in l?l.val:l;switch(y){case"BOOLEAN":return l?"‚úì":"‚úó";case"DATE":case"DATETIME":return l;default:return l}}function ke(){a.value=!a.value,k.add({severity:"info",summary:a.value?"–†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤–∫–ª—é—á–µ–Ω":"–†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤—ã–∫–ª—é—á–µ–Ω",detail:a.value?"–ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ —è—á–µ–π–∫—É –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è":"–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–∫–ª—é—á–µ–Ω–æ",life:3e3})}async function Ie(l){const{data:f,newValue:N,field:y,index:s}=l;if(N!==f[y]){L.value[s][y]=N;try{D.value=!0;const h={};if(y==="val")await Z.saveObject(f.id,X.value,N,{});else if(y.startsWith("req_")){const J=y.replace("req_","");h[J]=N,await Z.setObjectRequisites(f.id,h)}else h[y]=N,await Z.setObjectRequisites(f.id,h);w.value=new Date().toLocaleTimeString("ru-RU"),k.add({severity:"success",summary:"–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ",detail:"–ò–∑–º–µ–Ω–µ–Ω–∏—è —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã",life:2e3})}catch(h){console.error("Error saving cell:",h),k.add({severity:"error",summary:"–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è",detail:h.message||"–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è",life:5e3}),await r()}finally{D.value=!1}}}async function xe(){try{const l=b.query.F_U||null,f=await Z.createObject(X.value,"–ù–æ–≤–∞—è –∑–∞–ø–∏—Å—å",{},l);k.add({severity:"success",summary:"–°–æ–∑–¥–∞–Ω–æ",detail:`–ù–æ–≤–∞—è –∑–∞–ø–∏—Å—å #${f.id||""} —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞`,life:3e3}),await r()}catch(l){console.error("Error creating row:",l),k.add({severity:"error",summary:"–û—à–∏–±–∫–∞",detail:l.message||"–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –∑–∞–ø–∏—Å—å",life:5e3})}}function Fe(l){Y.value.objectId=l,Y.value.visible=!0}async function Me(){try{Y.value.loading=!0,await Z.deleteObject(Y.value.objectId),k.add({severity:"success",summary:"–£–¥–∞–ª–µ–Ω–æ",detail:"–ó–∞–ø–∏—Å—å —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–∞",life:3e3}),Y.value.visible=!1,Y.value.objectId=null,await r()}catch(l){console.error("Error deleting row:",l),k.add({severity:"error",summary:"–û—à–∏–±–∫–∞",detail:l.message||"–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å",life:5e3})}finally{Y.value.loading=!1}}function Ae(l){e.push(`/integram/${q.value}/edit_obj/${l}`)}function je(){e.push(`/integram/${q.value}/edit_types?typeId=${X.value}`)}function ce(l){var f;u.value=l.objectData,V.value=l.typeName,A.value=(f=l.objectData)==null?void 0:f.typ}async function r(){try{D.value=!0,C.value="–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...";const l=await H.getObjects(X.value);if(l&&l.list){p.value=!0,E.value=l,G.value=l.type;try{const f=await H.getMetadata(X.value);if(f&&f.reqs){const N={};f.reqs.forEach(y=>{const s=y.type==="4",h=!s&&y.ref!==void 0,J=y.attrs&&y.attrs.includes(":MULTI:");N[y.id]={isReference:h,isArray:s,isMulti:J,refTypeId:y.ref||null,baseType:y.type||null}}),c.value=N}}catch(f){console.warn("Could not load type metadata:",f)}L.value=l.list.map(f=>{const N={id:f.id,val:f.val,up:f.up};return l.req_order&&l.req_order.forEach(y=>{const s=c.value[y];if(s&&s.isMulti&&s.isReference){const h=f[`ref_${y}`],J=f[y];if(h&&J){const P=h.match(/^(\d+):(.+)$/);if(P){const Ee=P[1],ue=P[2].split(","),Q=J.split(","),x=ue.map((le,ee)=>({id:null,ref:le.trim(),val:Q[ee]?Q[ee].trim():`#${le.trim()}`,ord:ee+1}));N[`req_${y}`]=x}else N[`req_${y}`]=J||""}else N[`req_${y}`]=[]}else N[`req_${y}`]=f[y]||""}),N}),C.value=""}else p.value=!1}catch(l){console.error("Error loading as TYPE:",l),p.value=!1}finally{D.value=!1,g.value=!1}}R.value||e.replace("/integram/login"),_e(async()=>{try{if(C.value="–ü—Ä–æ–≤–µ—Ä–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏...",!R.value)throw new Error("–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω. –¢—Ä–µ–±—É–µ—Ç—Å—è –≤—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É.");const l=Z.getAuthInfo();if(!l||!l.token)throw new Error("–°–µ—Å—Å–∏—è –∏—Å—Ç–µ–∫–ª–∞. –¢—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –≤—Ö–æ–¥.");l.database&&H.setDatabase(l.database),_.value=!0,await r()}catch(l){console.error("Initialization error:",l),T.value=l.message,g.value=!1,setTimeout(()=>{e.replace("/integram/login")},2e3)}});const S={route:b,router:e,toast:k,isAuthenticated:R,sessionDatabase:M,sessionReady:_,loading:g,errorMessage:T,loadingMessage:C,isType:p,objectsData:E,typeData:G,tableData:L,tableLoading:D,requisitesMetadata:c,singleObjectData:u,singleObjectTypeName:V,singleObjectTypeId:A,inlineEditMode:a,rowsPerPage:t,lastSaved:w,filters:ge,deleteDialog:Y,objectId:X,database:q,breadcrumbItems:be,requisiteColumns:De,getRequisiteName:he,getRequisiteBase:se,getRequisiteMetadata:re,getBadgeColor:Ve,getEditorComponent:Te,formatCellValue:we,toggleInlineEdit:ke,onCellEditComplete:Ie,addNewRow:xe,confirmDeleteRow:Fe,deleteRow:Me,editObjectForm:Ae,editTypeStructure:je,onObjectLoaded:ce,loadData:r,ref:v,computed:K,onMounted:_e,get useRoute(){return fe},get useRouter(){return pe},get useToast(){return ve},get FilterMatchMode(){return Ue},get useIntegramSession(){return Re},get integramService(){return H},get integramApiClient(){return Z},IntegramEnhancedObjectEditor:ua,IntegramBreadcrumb:$e};return Object.defineProperty(S,"__isScriptSetup",{enumerable:!1,value:!0}),S}},fa={class:"integram-object-edit-page integram-touch-friendly"},pa={class:"text-center py-5"},va={class:"mt-3"},_a={class:"text-center py-5"},ya={key:2},ga={class:"flex align-items-center justify-content-between"},ba={class:"flex gap-2 align-items-center ml-auto"},Da={class:"text-sm"},ha={class:"editable-cell-content"},Va={class:"editable-cell-content"},Ta={key:0,class:"multiselect-badges"},wa={key:0,class:"text-sm text-500"},ka={class:"integram-actions"},Ia={class:"flex justify-content-between align-items-center"},xa={class:"text-sm"},Fa={key:0,class:"text-sm text-color-secondary"},Ma={class:"mt-2"},Aa={class:"flex align-items-center gap-3"},ja={class:"integram-actions justify-content-end w-full"};function Ea(z,d,b,e,k,R){const M=I("ProgressSpinner"),_=I("Card"),g=I("Message"),T=I("Button"),C=I("InputText"),p=I("Column"),E=I("DataTable"),G=I("router-link"),L=I("Dialog"),D=ye("tooltip");return o(),m("div",fa,[n(e.IntegramBreadcrumb,{items:e.breadcrumbItems},null,8,["items"]),e.loading?(o(),U(_,{key:0},{content:F(()=>[i("div",pa,[n(M),i("p",va,B(e.loadingMessage),1)])]),_:1})):e.errorMessage?(o(),U(_,{key:1},{content:F(()=>[i("div",_a,[n(g,{severity:"error",closable:!1},{default:F(()=>[O(B(e.errorMessage),1)]),_:1})])]),_:1})):e.isType&&e.objectsData?(o(),m("div",ya,[n(_,null,{title:F(()=>{var c;return[i("div",ga,[i("span",null,B(((c=e.typeData)==null?void 0:c.val)||"–û–±—ä–µ–∫—Ç—ã"),1),i("div",ba,[W(n(T,{icon:"pi pi-plus",label:"–°–æ–∑–¥–∞—Ç—å",onClick:e.addNewRow,size:"small"},null,512),[[D,"–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å",void 0,{bottom:!0}]]),W(n(T,{icon:"pi pi-pencil",outlined:!e.inlineEditMode,severity:e.inlineEditMode?"success":"secondary",onClick:e.toggleInlineEdit,size:"small",rounded:""},null,8,["outlined","severity"]),[[D,e.inlineEditMode?"–†–µ–∂–∏–º –ø—Ä–∞–≤–∫–∏ –≤–∫–ª.":"–í–∫–ª—é—á–∏—Ç—å –ø—Ä–∞–≤–∫—É",void 0,{bottom:!0}]]),W(n(T,{icon:"pi pi-cog",outlined:"",rounded:"",size:"small",onClick:e.editTypeStructure},null,512),[[D,"–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã",void 0,{bottom:!0}]]),W(n(T,{icon:"pi pi-refresh",outlined:"",rounded:"",size:"small",onClick:e.loadData},null,512),[[D,"–û–±–Ω–æ–≤–∏—Ç—å",void 0,{bottom:!0}]])])])]}),content:F(()=>[e.inlineEditMode?(o(),U(g,{key:1,severity:"success",closable:!1,class:"mb-3"},{default:F(()=>[...d[4]||(d[4]=[i("div",{class:"flex align-items-center gap-2"},[i("i",{class:"pi pi-check-circle text-2xl"}),i("div",null,[i("p",{class:"m-0"},[i("strong",null,"‚úÖ –†–ï–ñ–ò–ú –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–Ø –ê–ö–¢–ò–í–ï–ù"),O(" - –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –ª—é–±—É—é —è—á–µ–π–∫—É –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏—è")])])],-1)])]),_:1})):(o(),U(g,{key:0,severity:"info",closable:!0,class:"mb-3"},{default:F(()=>[...d[3]||(d[3]=[i("div",{class:"flex align-items-center gap-2"},[i("i",{class:"pi pi-info-circle text-2xl"}),i("div",null,[i("p",{class:"m-0 mb-2"},[i("strong",null,"üéØ –ò–ù–°–¢–†–£–ö–¶–ò–Ø: –ö–∞–∫ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è –≤ —Ç–∞–±–ª–∏—Ü–µ")]),i("ul",{class:"m-0 pl-4"},[i("li",{class:"mb-1"},[i("strong",null,"–ë—ã—Å—Ç—Ä–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Ç–∞–±–ª–∏—Ü–µ:"),O(" –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "),i("strong",null,'"–í–∫–ª—é—á–∏—Ç—å –ø—Ä–∞–≤–∫—É"'),O(" –≤—ã—à–µ, –∑–∞—Ç–µ–º –∫–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –ª—é–±—É—é —è—á–µ–π–∫—É –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è")]),i("li",{class:"mb-1"},[i("strong",null,"–î–µ—Ç–∞–ª—å–Ω–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏:"),O(" –ù–∞–∂–º–∏—Ç–µ "),i("i",{class:"pi pi-pencil"}),O(" –≤ —Å—Ç—Ä–æ–∫–µ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è —Ñ–æ—Ä–º—ã —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ –≤—Å–µ–º–∏ —Ç–∏–ø–∞–º–∏ –ø–æ–ª–µ–π")]),i("li",{class:"mb-1"},[i("strong",null,"–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ç–∞–±–ª–∏—Ü—ã:"),O(" –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "),i("strong",null,'"–°—Ç—Ä—É–∫—Ç—É—Ä–∞"'),O(" –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/—É–¥–∞–ª–µ–Ω–∏—è –∫–æ–ª–æ–Ω–æ–∫, –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö")]),i("li",{class:"mb-1"},[i("strong",null,"–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –∑–∞–ø–∏—Å–µ–π:"),O(" –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "),i("strong",null,'"–î–æ–±–∞–≤–∏—Ç—å"'),O(" –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–π –∑–∞–ø–∏—Å–∏")])]),i("div",{class:"mt-2 p-2 surface-50 border-round"},[i("small",{class:"text-600"},[i("i",{class:"pi pi-lightbulb mr-1"}),i("strong",null,"–°–æ–≤–µ—Ç:"),O(" –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ –∏–∑ —è—á–µ–π–∫–∏. –ü–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤–Ω–∏–∑—É —Ç–∞–±–ª–∏—Ü—ã. ")])])])],-1)])]),_:1})),n(E,{filters:e.filters,"onUpdate:filters":d[0]||(d[0]=c=>e.filters=c),value:e.tableData,paginator:!0,rows:e.rowsPerPage,rowsPerPageOptions:[10,20,50,100],editMode:e.inlineEditMode?"cell":null,onCellEditComplete:e.onCellEditComplete,loading:e.tableLoading,showGridlines:"",stripedRows:"",resizableColumns:"",columnResizeMode:"expand",filterDisplay:"row",class:"editable-integram-table",dataKey:"id"},{footer:F(()=>[i("div",Ia,[i("span",xa,"–í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π: "+B(e.tableData.length),1),e.lastSaved?(o(),m("span",Fa," –ü–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ: "+B(e.lastSaved),1)):$("",!0)])]),default:F(()=>[n(p,{field:"id",header:"ID",sortable:!0,style:{"min-width":"80px"}},{body:F(({data:c})=>[i("code",Da,B(c.id),1)]),filter:F(({filterModel:c,filterCallback:u})=>[n(C,{modelValue:c.value,"onUpdate:modelValue":V=>c.value=V,onInput:V=>u(),placeholder:"–ü–æ–∏—Å–∫ –ø–æ ID",class:"p-column-filter",size:"small"},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:1}),n(p,{field:"val",header:"–ó–Ω–∞—á–µ–Ω–∏–µ",sortable:!0,style:{"min-width":"200px"}},{body:F(({data:c})=>[i("div",ha,B(c.val),1)]),editor:F(({data:c,field:u})=>[n(C,{modelValue:c[u],"onUpdate:modelValue":V=>c[u]=V,autofocus:"",class:"w-full"},null,8,["modelValue","onUpdate:modelValue"])]),filter:F(({filterModel:c,filterCallback:u})=>[n(C,{modelValue:c.value,"onUpdate:modelValue":V=>c.value=V,onInput:V=>u(),placeholder:"–ü–æ–∏—Å–∫",class:"p-column-filter",size:"small"},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:1}),(o(!0),m(ae,null,ne(e.requisiteColumns,c=>(o(),U(p,{key:c,field:`req_${c}`,header:e.getRequisiteName(c),sortable:!0,style:{"min-width":"150px"}},{body:F(({data:u})=>[i("div",Va,[e.getRequisiteMetadata(c).isMulti&&Array.isArray(e.formatCellValue(u[`req_${c}`],c))?(o(),m("div",Ta,[(o(!0),m(ae,null,ne(e.formatCellValue(u[`req_${c}`],c),V=>(o(),m("span",{key:V.id||V.ref,class:"badge badge-pill text-sm px-2 py-1 mr-1 mb-1",style:Le({backgroundColor:e.getBadgeColor(V.ref||V.id)})},B(V.val||V.name||`#${V.ref||V.id}`),5))),128))])):(o(),m(ae,{key:1},[O(B(e.formatCellValue(u[`req_${c}`],c)),1)],64))])]),editor:F(({data:u,field:V})=>[e.getRequisiteMetadata(c).isReference?(o(),m("div",wa,[...d[5]||(d[5]=[i("i",{class:"pi pi-info-circle mr-1"},null,-1),O(" –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ —Ñ–æ—Ä–º–µ ",-1)])])):(o(),U(Be(e.getEditorComponent(c)),{key:1,modelValue:u[V],"onUpdate:modelValue":A=>u[V]=A,class:ie({"w-full":!0}),autofocus:""},null,8,["modelValue","onUpdate:modelValue"]))]),filter:F(({filterModel:u,filterCallback:V})=>[n(C,{modelValue:u.value,"onUpdate:modelValue":A=>u.value=A,onInput:A=>V(),placeholder:`–ü–æ–∏—Å–∫ –ø–æ ${e.getRequisiteName(c)}`,class:"p-column-filter",size:"small"},null,8,["modelValue","onUpdate:modelValue","onInput","placeholder"])]),_:2},1032,["field","header"]))),128)),n(p,{header:"–î–µ–π—Å—Ç–≤–∏—è",frozen:!0,alignFrozen:"right",style:{"min-width":"140px"}},{body:F(({data:c})=>[i("div",ka,[W(n(T,{icon:"pi pi-pencil",onClick:u=>e.editObjectForm(c.id),size:"small",text:"",rounded:"",severity:"info","aria-label":"–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å"},null,8,["onClick"]),[[D,"–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ —Ñ–æ—Ä–º–µ",void 0,{top:!0}]]),W(n(T,{icon:"pi pi-trash",onClick:u=>e.confirmDeleteRow(c.id),size:"small",text:"",rounded:"",severity:"danger","aria-label":"–£–¥–∞–ª–∏—Ç—å",class:"ml-auto"},null,8,["onClick"]),[[D,"–£–¥–∞–ª–∏—Ç—å",void 0,{top:!0}]])])]),_:1})]),_:1},8,["filters","value","rows","editMode","loading"])]),_:1})])):!e.isType&&e.database&&e.objectId?(o(),U(e.IntegramEnhancedObjectEditor,{key:3,database:e.database,objectId:e.objectId,onObjectLoaded:e.onObjectLoaded},null,8,["database","objectId"])):!e.loading&&!e.isType?(o(),U(_,{key:4},{content:F(()=>[n(g,{severity:"warn",closable:!1},{default:F(()=>[i("p",null,"–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –æ–±—ä–µ–∫—Ç #"+B(e.objectId),1),i("p",Ma,[n(G,{to:`/integram/${e.database}/dict`},{default:F(()=>[...d[6]||(d[6]=[O(" –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å–ø–∏—Å–∫—É —Ç–∞–±–ª–∏—Ü ",-1)])]),_:1},8,["to"])])]),_:1})]),_:1})):$("",!0),n(L,{visible:e.deleteDialog.visible,"onUpdate:visible":d[2]||(d[2]=c=>e.deleteDialog.visible=c),header:"–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è",modal:!0,style:{width:"450px"}},{footer:F(()=>[i("div",ja,[n(T,{label:"–û—Ç–º–µ–Ω–∞",icon:"pi pi-times",onClick:d[1]||(d[1]=c=>e.deleteDialog.visible=!1),text:"","aria-label":"–û—Ç–º–µ–Ω–∏—Ç—å —É–¥–∞–ª–µ–Ω–∏–µ"}),n(T,{label:"–£–¥–∞–ª–∏—Ç—å",icon:"pi pi-trash",severity:"danger",onClick:e.deleteRow,loading:e.deleteDialog.loading,"aria-label":"–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —É–¥–∞–ª–µ–Ω–∏–µ"},null,8,["loading"])])]),default:F(()=>[i("div",Aa,[d[9]||(d[9]=i("i",{class:"pi pi-exclamation-triangle text-4xl text-warning"},null,-1)),i("span",null,[d[7]||(d[7]=O("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å —Å ID ",-1)),i("strong",null,B(e.deleteDialog.objectId),1),d[8]||(d[8]=O("?",-1))])])]),_:1},8,["visible"])])}const $a=de(ma,[["render",Ea],["__scopeId","data-v-fa3013bd"],["__file","/home/hive/integram-standalone/src/views/pages/Integram/IntegramObjectEdit.vue"]]);export{$a as default};
