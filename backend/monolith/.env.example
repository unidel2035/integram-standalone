# Server Configuration
# Port for the monolithic backend API
PORT=8081
# Host binding (use 0.0.0.0 to bind to all interfaces, or localhost for local only)
HOST=0.0.0.0
NODE_ENV=production

# HTTPS Configuration (optional)
# ⚠️ IMPORTANT: Only enable HTTPS if backend is NOT behind Nginx/reverse proxy
#
# RECOMMENDED SETUP (Nginx reverse proxy):
#   - Set HTTPS_ENABLED=false (backend uses HTTP)
#   - Let Nginx handle SSL termination on port 443
#   - Nginx proxies to http://localhost:8081
#
# IF ENABLING HTTPS (not recommended with Nginx):
#   - Set HTTPS_ENABLED=true
#   - Provide valid SSL certificate paths
#   - Backend will serve HTTPS directly on PORT
#   - WARNING: Accessing HTTP port with HTTPS URL causes SSL_ERROR_RX_RECORD_TOO_LONG (Issue #2182)
#
HTTPS_ENABLED=false

# SSL Certificate Paths (only used if HTTPS_ENABLED=true)
# For Let's Encrypt certificates (production):
SSL_CERT_PATH=/etc/letsencrypt/live/your-domain.com/fullchain.pem
SSL_KEY_PATH=/etc/letsencrypt/live/your-domain.com/privkey.pem
# For development SSL certificates (self-signed):
# SSL_CERT_PATH=/path/to/your/cert.pem
# SSL_KEY_PATH=/path/to/your/key.pem

# Database Configuration
DATABASE_URL=postgresql://user:password@localhost:5432/integram
DB_HOST=localhost
DB_PORT=5432
DB_NAME=integram
DB_USER=integram
DB_PASSWORD=CHANGE_THIS_DB_PASSWORD

# AI Service API Keys
# Get your DeepSeek API key at: https://platform.deepseek.com/api_keys
# Required for MCP Bridge chat functionality and workspace AI agent
#
# Issue #4722: At least ONE of these keys must be configured for workspace chat to work
# Priority order: POLZA_AI_API_KEY > DEEPSEEK_API_KEY > ANTHROPIC_API_KEY > OPENAI_API_KEY
# If none are set, workspace chat will fail with "No AI provider API keys configured" error
POLZA_AI_API_KEY=your-polza-api-key
OPENAI_API_KEY=your-openai-api-key
DEEPSEEK_API_KEY=your-deepseek-api-key
ANTHROPIC_API_KEY=your-anthropic-api-key

# Tavily Search API (Issue #2754)
# Get your Tavily API key at: https://tavily.com/
# Required for SGR Research Agent web search functionality
# Falls back to DuckDuckGo if not set
TAVILY_API_KEY=your-tavily-api-key

# Claude SSH Proxy Configuration (Issue #2309)
# Use Claude installed on remote server instead of Anthropic API
# Leave empty to use direct Anthropic API
#CLAUDE_SSH_HOST=root@193.239.166.31
#CLAUDE_SSH_PASSWORD=your-ssh-password
#CLAUDE_SSH_USER=hive
#CLAUDE_SSH_COMMAND=claude chat

# Claude Proxy Configuration (Issue #2607, #2637)
# Proxy requests through intermediate server before reaching Claude API
# Architecture: Chat.vue → Monolith (/api/claude-proxy) → Intermediate Server → Claude API
# Set to true to enable proxy, false to disable
CLAUDE_PROXY_ENABLED=true
# URL of the intermediate Claude server (default: http://localhost:3002)
# Production: http://193.239.166.31:3002
CLAUDE_PROXY_SERVER_URL=http://193.239.166.31:3002
# Request timeout in milliseconds (default: 120000 = 2 minutes)
CLAUDE_PROXY_TIMEOUT=120000

# Integram API Configuration (Issue #1540, #1560)
# Used for fetching AI model configurations from Integram admin panel
# Token can be configured in two ways (similar to GitHub integration):
# 1. Unified token storage (ai_provider_api_keys table) - preferred for production
#    Add it via: POST /api/ai-tokens/provider-keys with providerName='integram'
# 2. Environment variable (fallback) - simpler for development/testing
INTEGRAM_API_BASE_URL=https://example.integram.io
INTEGRAM_AUTH_TOKEN=your-integram-auth-token

# YouTube Data API
YOUTUBE_API_KEY=your-youtube-api-key

# Telegram Bot
TELEGRAM_BOT_TOKEN=your-telegram-bot-token

# Email Configuration (Issue #5013)
# SMTP settings for sending verification emails, password resets, etc.
# Recommended providers:
# - Yandex Mail (Russian): smtp.yandex.ru:465 (secure=true)
# - Gmail: smtp.gmail.com:587 (secure=false, requires App Password)
# - SendGrid: smtp.sendgrid.net:587 (secure=false)
# - AWS SES: email-smtp.region.amazonaws.com:587 (secure=false)
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_SECURE=false
SMTP_USER=your-email@example.com
SMTP_PASSWORD=your-app-password
FROM_EMAIL=noreply@example.integram.io
FROM_NAME=Integram Platform

# Frontend URL for email verification links
# Production: https://example.integram.io
# Development: http://localhost:5173
FRONTEND_URL=https://example.integram.io

# Stripe Payment Gateway
STRIPE_API_KEY=your-stripe-api-key
STRIPE_WEBHOOK_SECRET=your-webhook-secret

# Russian Payment Systems
# Lava.ru
LAVA_API_KEY=your-lava-api-key
LAVA_SHOP_ID=your-shop-id

# Robokassa
ROBOKASSA_MERCHANT_ID=your-merchant-id
ROBOKASSA_PASSWORD_1=your-password-1
ROBOKASSA_PASSWORD_2=your-password-2
ROBOKASSA_TEST_MODE=true

# YooKassa (ex-Yandex.Kassa)
YOOKASSA_SHOP_ID=your-shop-id
YOOKASSA_SECRET_KEY=your-secret-key

# Tinkoff Acquiring
TINKOFF_TERMINAL_KEY=your-terminal-key
TINKOFF_SECRET_KEY=your-secret-key

# Tochka Bank
TOCHKA_CLIENT_ID=your-client-id
TOCHKA_CLIENT_SECRET=your-client-secret
TOCHKA_SANDBOX=true

# File Storage
UPLOAD_DIR=/var/integram/uploads
DATA_DIR=/var/integram/data
TEMP_DIR=/var/integram/temp

# Workspace Configuration (Issue #4548)
# Directory for AI workspace storage (must be persistent across deployments)
# ⚠️ CRITICAL: Use an absolute path outside the codebase to prevent workspace loss during updates!
# Production default: /var/lib/integram/workspaces
# Development default: backend/monolith/workspaces (relative to project root)
# Workspaces contain cloned repositories and user files
WORKSPACE_ROOT=/var/lib/integram/workspaces
# Maximum workspace size in bytes (default: 1GB)
MAX_WORKSPACE_SIZE=1073741824

# Orchestrator Configuration
MAX_RETRIES=3
TASK_TIMEOUT=300000
HEARTBEAT_INTERVAL=30000
HEARTBEAT_TIMEOUT=90000
POLL_INTERVAL=1000
ASSIGNMENT_STRATEGY=round-robin

# WebRTC Configuration
WEBRTC_STUN_SERVERS=stun:stun.l.google.com:19302,stun:stun1.l.google.com:19302
WEBRTC_TURN_URL=
WEBRTC_TURN_USERNAME=
WEBRTC_TURN_CREDENTIAL=

# Logging
LOG_LEVEL=info
LOG_FILE=/var/log/integram/backend.log

# Console Output Control (Issue #3728, #4144)
# ⚠️ WARNING: Setting DISABLE_LOGGING=true will suppress ALL console output!
# This includes:
#   - Route registration messages (40+ lines)
#   - Server startup banner
#   - Port and endpoint information
#   - Error messages and warnings
#
# NEVER enable this in development environments (makes debugging impossible)
# Only use in production when:
#   - External log aggregation is configured (ELK, Splunk, Datadog)
#   - Console output causes performance issues
#   - Running in containerized environment with log drivers
#
# Default: false (console output enabled)
# DISABLE_LOGGING=false

# Security
# CRITICAL: Generate strong secrets before deploying to production!
# Run: node scripts/generate-jwt-secret.js
#
# JWT_SECRET: Used for signing JWT tokens (must be at least 64 characters / 256 bits)
# NEVER use weak values like 'secret', 'password', or 'changeme'
# NEVER commit real secrets to git
# Use different secrets for development and production
JWT_SECRET=your-jwt-secret-generate-with-script
SESSION_SECRET=your-session-secret-generate-with-script

# JWT Token Expiration (optional, defaults shown)
# Access tokens: short-lived (15 minutes recommended)
# Refresh tokens: long-lived (7 days recommended)
JWT_ACCESS_TOKEN_EXPIRES_IN=15m
JWT_REFRESH_TOKEN_EXPIRES_IN=7d

# Password Hashing (optional, default: 10)
# Higher values = more secure but slower
# Recommended: 10-12 for production
BCRYPT_ROUNDS=10

# GitHub Integration (for error reporting)
# Note: GitHub API token can be stored in two ways:
# 1. Unified token storage (ai_provider_api_keys table) - preferred for production
#    Add it via: POST /api/ai-tokens/provider-keys with providerName='github'
# 2. Environment variable (fallback) - simpler for development/testing
GITHUB_TOKEN=your-github-token
GITHUB_OWNER=your-github-username
GITHUB_REPO=your-repo-name

# Auto-Solve Configuration (Issue #1764, #1809, #2146)
# Enable/disable automatic issue solving on remote server
# When enabled, automatically triggers gh issue solve on created error reports with 'auto-error-report' label
AUTO_SOLVE_ENABLED=true
# SSH connection string for remote server (user@host)
# SSH key authentication must be configured (no password)
AUTO_SOLVE_SSH_HOST=root@193.239.166.31
# Base name for screen sessions (will be appended with issue number and timestamp)
AUTO_SOLVE_SCREEN_SESSION=gh-issue-solver
# Path to wrapper script on remote server (absolute path on remote server)
# This script executes solve and sends Telegram notifications
AUTO_SOLVE_WRAPPER_SCRIPT=/root/dronedoc2025/backend/monolith/scripts/auto-solve-wrapper.sh

# CORS
CORS_ORIGIN=http://localhost:5173,https://example.integram.io

# Rate Limiting
RATE_LIMIT_WINDOW=15
RATE_LIMIT_MAX_REQUESTS=100

# ==========================================
# Backup and Disaster Recovery Configuration
# ==========================================

# Backup System
BACKUP_ENABLED=true
BACKUP_ENCRYPTION_ENABLED=true
BACKUP_ENCRYPTION_KEY=your-256-bit-encryption-key-change-this-in-production

# Local Backup Storage
LOCAL_BACKUP_PATH=/var/integram/backups

# Cloud Storage (S3-compatible)
S3_ENABLED=false
S3_BUCKET_PRIMARY=integram-backups-primary
S3_BUCKET_SECONDARY=
S3_REGION_PRIMARY=us-east-1
S3_REGION_SECONDARY=
S3_ENDPOINT=
S3_ACCESS_KEY_ID=
S3_SECRET_ACCESS_KEY=

# Backup Schedule (managed in database, these are fallback defaults)
BACKUP_FULL_SCHEDULE=0 2 * * *
BACKUP_INCREMENTAL_SCHEDULE=0 * * * *
BACKUP_CLEANUP_SCHEDULE=0 4 * * *

# Retention Policies (managed in database, these are fallback defaults)
RETENTION_DAYS_LOCAL=2
RETENTION_DAYS_CLOUD_PRIMARY=30
RETENTION_DAYS_CLOUD_SECONDARY=90
RETENTION_MONTHS_ARCHIVE=12

# Credentials for user registration in MY database
INTEGRAM_REGISTRATION_USERNAME=your_registration_username
INTEGRAM_REGISTRATION_PASSWORD=CHANGE_THIS_PASSWORD

# Purchase Journey Testing Agent Configuration (Issue #5106, #5113)
# Test credentials for automated authentication flow testing
# These credentials are used to test real user registration, login, and authentication flows
# Format: test-journey-TIMESTAMP@example.integram.io (auto-generated with timestamp)
JOURNEY_TEST_EMAIL=test-journey@example.integram.io
JOURNEY_TEST_PASSWORD=TestPassword123!
JOURNEY_TEST_ORG_NAME=Test Organization
# Enable/disable real browser automation (Playwright)
JOURNEY_USE_PLAYWRIGHT=true
# Headless mode for Playwright (true for CI/CD, false for debugging)
JOURNEY_HEADLESS_MODE=true
# Test interval in milliseconds (default: 1800000 = 30 minutes)
JOURNEY_TEST_INTERVAL=1800000
# Auto-cleanup test users after testing (recommended: true)
JOURNEY_AUTO_CLEANUP=true

# GitHub Webhook Integration (Issue #5113)
# Secret for verifying GitHub webhook signatures
# Generate a strong random secret: openssl rand -hex 32
# Configure this same secret in GitHub repository settings:
# Settings → Webhooks → Add webhook → Secret
GITHUB_WEBHOOK_SECRET=your-webhook-secret-change-me-in-production
# Trigger mode: 'webhook', 'timer', or 'both' (default: 'both')
# - webhook: Only trigger tests on GitHub events (push, PR, issue labels)
# - timer: Only trigger tests on interval (JOURNEY_TEST_INTERVAL)
# - both: Use both webhook triggers AND interval fallback
JOURNEY_TRIGGER_MODE=both
